var LC=Object.create;var Rc=Object.defineProperty;var IC=Object.getOwnPropertyDescriptor;var BC=Object.getOwnPropertyNames;var jC=Object.getPrototypeOf,$C=Object.prototype.hasOwnProperty;var zC=(t,e,r)=>e in t?Rc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Yy=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var Mc=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),yr=(t,e)=>{for(var r in e)Rc(t,r,{get:e[r],enumerable:!0})},FC=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of BC(e))!$C.call(t,i)&&i!==r&&Rc(t,i,{get:()=>e[i],enumerable:!(n=IC(e,i))||n.enumerable});return t};var Br=(t,e,r)=>(r=t!=null?LC(jC(t)):{},FC(e||!t||!t.__esModule?Rc(r,"default",{value:t,enumerable:!0}):r,t));var H=(t,e,r)=>(zC(t,typeof e!="symbol"?e+"":e,r),r),td=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var g=(t,e,r)=>(td(t,e,"read from private field"),r?r.call(t):e.get(t)),R=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},L=(t,e,r,n)=>(td(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),Xy=(t,e,r,n)=>({set _(i){L(t,e,i,r)},get _(){return g(t,e,n)}}),Qy=(t,e,r)=>(td(t,e,"access private method"),r);var eu=Mc((oj,Tw)=>{Tw.exports=function(t,e,r,n,i){var o,s;if(n===void 0)n=0;else if(n=n|0,n<0||n>=t.length)throw new RangeError("invalid lower bound");if(i===void 0)i=t.length-1;else if(i=i|0,i<n||i>=t.length)throw new RangeError("invalid upper bound");for(;n<=i;)if(o=n+(i-n>>>1),s=+r(t[o],e,o,t),s<0)n=o+1;else if(s>0)i=o-1;else return o;return~n}});var tu=Mc((sj,Ow)=>{"use strict";Ow.exports=PE;function cs(t){return t instanceof Buffer?Buffer.from(t):new t.constructor(t.buffer.slice(),t.byteOffset,t.length)}function PE(t){if(t=t||{},t.circles)return LE(t);return t.proto?n:r;function e(i,o){for(var s=Object.keys(i),a=new Array(s.length),l=0;l<s.length;l++){var c=s[l],f=i[c];typeof f!="object"||f===null?a[c]=f:f instanceof Date?a[c]=new Date(f):ArrayBuffer.isView(f)?a[c]=cs(f):a[c]=o(f)}return a}function r(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return e(i,r);if(i instanceof Map)return new Map(e(Array.from(i),r));if(i instanceof Set)return new Set(e(Array.from(i),r));var o={};for(var s in i)if(Object.hasOwnProperty.call(i,s)!==!1){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(e(Array.from(a),r)):a instanceof Set?o[s]=new Set(e(Array.from(a),r)):ArrayBuffer.isView(a)?o[s]=cs(a):o[s]=r(a)}return o}function n(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return e(i,n);if(i instanceof Map)return new Map(e(Array.from(i),n));if(i instanceof Set)return new Set(e(Array.from(i),n));var o={};for(var s in i){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(e(Array.from(a),n)):a instanceof Set?o[s]=new Set(e(Array.from(a),n)):ArrayBuffer.isView(a)?o[s]=cs(a):o[s]=n(a)}return o}}function LE(t){var e=[],r=[];return t.proto?o:i;function n(s,a){for(var l=Object.keys(s),c=new Array(l.length),f=0;f<l.length;f++){var u=l[f],h=s[u];if(typeof h!="object"||h===null)c[u]=h;else if(h instanceof Date)c[u]=new Date(h);else if(ArrayBuffer.isView(h))c[u]=cs(h);else{var d=e.indexOf(h);d!==-1?c[u]=r[d]:c[u]=a(h)}}return c}function i(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return n(s,i);if(s instanceof Map)return new Map(n(Array.from(s),i));if(s instanceof Set)return new Set(n(Array.from(s),i));var a={};e.push(s),r.push(a);for(var l in s)if(Object.hasOwnProperty.call(s,l)!==!1){var c=s[l];if(typeof c!="object"||c===null)a[l]=c;else if(c instanceof Date)a[l]=new Date(c);else if(c instanceof Map)a[l]=new Map(n(Array.from(c),i));else if(c instanceof Set)a[l]=new Set(n(Array.from(c),i));else if(ArrayBuffer.isView(c))a[l]=cs(c);else{var f=e.indexOf(c);f!==-1?a[l]=r[f]:a[l]=i(c)}}return e.pop(),r.pop(),a}function o(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return n(s,o);if(s instanceof Map)return new Map(n(Array.from(s),o));if(s instanceof Set)return new Set(n(Array.from(s),o));var a={};e.push(s),r.push(a);for(var l in s){var c=s[l];if(typeof c!="object"||c===null)a[l]=c;else if(c instanceof Date)a[l]=new Date(c);else if(c instanceof Map)a[l]=new Map(n(Array.from(c),o));else if(c instanceof Set)a[l]=new Set(n(Array.from(c),o));else if(ArrayBuffer.isView(c))a[l]=cs(c);else{var f=e.indexOf(c);f!==-1?a[l]=r[f]:a[l]=o(c)}}return e.pop(),r.pop(),a}}});var pu=Mc((Kw,du)=>{(function(t){if(typeof du=="object"&&typeof du.exports=="object"){var e=t(Yy,Kw);e!==void 0&&(du.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],t)})(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=void 0;class r{constructor(c,f,u,h){this._uri=c,this._languageId=f,this._version=u,this._content=h,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(c){if(c){let f=this.offsetAt(c.start),u=this.offsetAt(c.end);return this._content.substring(f,u)}return this._content}update(c,f){for(let u of c)if(r.isIncremental(u)){let h=s(u.range),d=this.offsetAt(h.start),p=this.offsetAt(h.end);this._content=this._content.substring(0,d)+u.text+this._content.substring(p,this._content.length);let b=Math.max(h.start.line,0),m=Math.max(h.end.line,0),k=this._lineOffsets,S=o(u.text,!1,d);if(m-b===S.length)for(let w=0,C=S.length;w<C;w++)k[w+b+1]=S[w];else S.length<1e4?k.splice(b+1,m-b,...S):this._lineOffsets=k=k.slice(0,b+1).concat(S,k.slice(m+1));let _=u.text.length-(p-d);if(_!==0)for(let w=b+1+S.length,C=k.length;w<C;w++)k[w]=k[w]+_}else if(r.isFull(u))this._content=u.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=f}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=o(this._content,!0)),this._lineOffsets}positionAt(c){c=Math.max(Math.min(c,this._content.length),0);let f=this.getLineOffsets(),u=0,h=f.length;if(h===0)return{line:0,character:c};for(;u<h;){let p=Math.floor((u+h)/2);f[p]>c?h=p:u=p+1}let d=u-1;return{line:d,character:c-f[d]}}offsetAt(c){let f=this.getLineOffsets();if(c.line>=f.length)return this._content.length;if(c.line<0)return 0;let u=f[c.line],h=c.line+1<f.length?f[c.line+1]:this._content.length;return Math.max(Math.min(u+c.character,h),u)}get lineCount(){return this.getLineOffsets().length}static isIncremental(c){let f=c;return f!=null&&typeof f.text=="string"&&f.range!==void 0&&(f.rangeLength===void 0||typeof f.rangeLength=="number")}static isFull(c){let f=c;return f!=null&&typeof f.text=="string"&&f.range===void 0&&f.rangeLength===void 0}}var n;(function(l){function c(h,d,p,b){return new r(h,d,p,b)}l.create=c;function f(h,d,p){if(h instanceof r)return h.update(d,p),h;throw new Error("TextDocument.update: document must be created by TextDocument.create")}l.update=f;function u(h,d){let p=h.getText(),b=i(d.map(a),(S,_)=>{let w=S.range.start.line-_.range.start.line;return w===0?S.range.start.character-_.range.start.character:w}),m=0,k=[];for(let S of b){let _=h.offsetAt(S.range.start);if(_<m)throw new Error("Overlapping edit");_>m&&k.push(p.substring(m,_)),S.newText.length&&k.push(S.newText),m=h.offsetAt(S.range.end)}return k.push(p.substr(m)),k.join("")}l.applyEdits=u})(n=e.TextDocument||(e.TextDocument={}));function i(l,c){if(l.length<=1)return l;let f=l.length/2|0,u=l.slice(0,f),h=l.slice(f);i(u,c),i(h,c);let d=0,p=0,b=0;for(;d<u.length&&p<h.length;)c(u[d],h[p])<=0?l[b++]=u[d++]:l[b++]=h[p++];for(;d<u.length;)l[b++]=u[d++];for(;p<h.length;)l[b++]=h[p++];return l}function o(l,c,f=0){let u=c?[f]:[];for(let h=0;h<l.length;h++){let d=l.charCodeAt(h);(d===13||d===10)&&(d===13&&h+1<l.length&&l.charCodeAt(h+1)===10&&h++,u.push(f+h+1))}return u}function s(l){let c=l.start,f=l.end;return c.line>f.line||c.line===f.line&&c.character>f.character?{start:f,end:c}:l}function a(l){let c=s(l.range);return c!==l.range?{newText:l.newText,range:c}:l}})});var Dx=Mc(($u,Mx)=>{(function(t,e){typeof $u=="object"&&typeof Mx<"u"?e($u):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t["base64-arraybuffer"]={}))})($u,function(t){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=typeof Uint8Array>"u"?[]:new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;var i=function(s){var a=new Uint8Array(s),l,c=a.length,f="";for(l=0;l<c;l+=3)f+=e[a[l]>>2],f+=e[(a[l]&3)<<4|a[l+1]>>4],f+=e[(a[l+1]&15)<<2|a[l+2]>>6],f+=e[a[l+2]&63];return c%3===2?f=f.substring(0,f.length-1)+"=":c%3===1&&(f=f.substring(0,f.length-2)+"=="),f},o=function(s){var a=s.length*.75,l=s.length,c,f=0,u,h,d,p;s[s.length-1]==="="&&(a--,s[s.length-2]==="="&&a--);var b=new ArrayBuffer(a),m=new Uint8Array(b);for(c=0;c<l;c+=4)u=r[s.charCodeAt(c)],h=r[s.charCodeAt(c+1)],d=r[s.charCodeAt(c+2)],p=r[s.charCodeAt(c+3)],m[f++]=u<<2|h>>4,m[f++]=(h&15)<<4|d>>2,m[f++]=(d&3)<<6|p&63;return b};t.decode=o,t.encode=i,Object.defineProperty(t,"__esModule",{value:!0})})});var ee=class{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,r,n){let i=[];return this.decompose(0,e,i,2),n.length&&n.decompose(0,n.length,i,3),this.decompose(r,this.length,i,1),qt.from(i,this.length-(r-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,r=this.length){let n=[];return this.decompose(e,r,n,0),qt.from(n,r-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let r=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),i=new Mi(this),o=new Mi(e);for(let s=r,a=r;;){if(i.next(s),o.next(s),s=0,i.lineBreak!=o.lineBreak||i.done!=o.done||i.value!=o.value)return!1;if(a+=i.value.length,i.done||a>=n)return!0}}iter(e=1){return new Mi(this,e)}iterRange(e,r=this.length){return new Lc(this,e,r)}iterLines(e,r){let n;if(e==null)n=this.iter();else{r==null&&(r=this.lines+1);let i=this.line(e).from;n=this.iterRange(i,Math.max(i,r==this.lines+1?this.length:r<=1?0:this.line(r-1).to))}return new Ic(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?ee.empty:e.length<=32?new xe(e):qt.from(xe.split(e,[]))}},xe=class extends ee{constructor(e,r=VC(e)){super(),this.text=e,this.length=r}get lines(){return this.text.length}get children(){return null}lineInner(e,r,n,i){for(let o=0;;o++){let s=this.text[o],a=i+s.length;if((r?n:a)>=e)return new nd(i,a,n,s);i=a+1,n++}}decompose(e,r,n,i){let o=e<=0&&r>=this.length?this:new xe(e0(this.text,e,r),Math.min(r,this.length)-Math.max(0,e));if(i&1){let s=n.pop(),a=Pc(o.text,s.text.slice(),0,o.length);if(a.length<=32)n.push(new xe(a,s.length+o.length));else{let l=a.length>>1;n.push(new xe(a.slice(0,l)),new xe(a.slice(l)))}}else n.push(o)}replace(e,r,n){if(!(n instanceof xe))return super.replace(e,r,n);let i=Pc(this.text,Pc(n.text,e0(this.text,0,e)),r),o=this.length+n.length-(r-e);return i.length<=32?new xe(i,o):qt.from(xe.split(i,[]),o)}sliceString(e,r=this.length,n=`
`){let i="";for(let o=0,s=0;o<=r&&s<this.text.length;s++){let a=this.text[s],l=o+a.length;o>e&&s&&(i+=n),e<l&&r>o&&(i+=a.slice(Math.max(0,e-o),r-o)),o=l+1}return i}flatten(e){for(let r of this.text)e.push(r)}scanIdentical(){return 0}static split(e,r){let n=[],i=-1;for(let o of e)n.push(o),i+=o.length+1,n.length==32&&(r.push(new xe(n,i)),n=[],i=-1);return i>-1&&r.push(new xe(n,i)),r}},qt=class extends ee{constructor(e,r){super(),this.children=e,this.length=r,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,r,n,i){for(let o=0;;o++){let s=this.children[o],a=i+s.length,l=n+s.lines-1;if((r?l:a)>=e)return s.lineInner(e,r,n,i);i=a+1,n=l+1}}decompose(e,r,n,i){for(let o=0,s=0;s<=r&&o<this.children.length;o++){let a=this.children[o],l=s+a.length;if(e<=l&&r>=s){let c=i&((s<=e?1:0)|(l>=r?2:0));s>=e&&l<=r&&!c?n.push(a):a.decompose(e-s,r-s,n,c)}s=l+1}}replace(e,r,n){if(n.lines<this.lines)for(let i=0,o=0;i<this.children.length;i++){let s=this.children[i],a=o+s.length;if(e>=o&&r<=a){let l=s.replace(e-o,r-o,n),c=this.lines-s.lines+l.lines;if(l.lines<c>>5-1&&l.lines>c>>5+1){let f=this.children.slice();return f[i]=l,new qt(f,this.length-(r-e)+n.length)}return super.replace(o,a,l)}o=a+1}return super.replace(e,r,n)}sliceString(e,r=this.length,n=`
`){let i="";for(let o=0,s=0;o<this.children.length&&s<=r;o++){let a=this.children[o],l=s+a.length;s>e&&o&&(i+=n),e<l&&r>s&&(i+=a.sliceString(e-s,r-s,n)),s=l+1}return i}flatten(e){for(let r of this.children)r.flatten(e)}scanIdentical(e,r){if(!(e instanceof qt))return 0;let n=0,[i,o,s,a]=r>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=r,o+=r){if(i==s||o==a)return n;let l=this.children[i],c=e.children[o];if(l!=c)return n+l.scanIdentical(c,r);n+=l.length+1}}static from(e,r=e.reduce((n,i)=>n+i.length+1,-1)){let n=0;for(let d of e)n+=d.lines;if(n<32){let d=[];for(let p of e)p.flatten(d);return new xe(d,r)}let i=Math.max(32,n>>5),o=i<<1,s=i>>1,a=[],l=0,c=-1,f=[];function u(d){let p;if(d.lines>o&&d instanceof qt)for(let b of d.children)u(b);else d.lines>s&&(l>s||!l)?(h(),a.push(d)):d instanceof xe&&l&&(p=f[f.length-1])instanceof xe&&d.lines+p.lines<=32?(l+=d.lines,c+=d.length+1,f[f.length-1]=new xe(p.text.concat(d.text),p.length+1+d.length)):(l+d.lines>i&&h(),l+=d.lines,c+=d.length+1,f.push(d))}function h(){l!=0&&(a.push(f.length==1?f[0]:qt.from(f,c)),c=-1,l=f.length=0)}for(let d of e)u(d);return h(),a.length==1?a[0]:new qt(a,r)}};ee.empty=new xe([""],0);function VC(t){let e=-1;for(let r of t)e+=r.length+1;return e}function Pc(t,e,r=0,n=1e9){for(let i=0,o=0,s=!0;o<t.length&&i<=n;o++){let a=t[o],l=i+a.length;l>=r&&(l>n&&(a=a.slice(0,n-i)),i<r&&(a=a.slice(r-i)),s?(e[e.length-1]+=a,s=!1):e.push(a)),i=l+1}return e}function e0(t,e,r){return Pc(t,[""],e,r)}var Mi=class{constructor(e,r=1){this.dir=r,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[r>0?1:(e instanceof xe?e.text.length:e.children.length)<<1]}nextInner(e,r){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],o=this.offsets[n],s=o>>1,a=i instanceof xe?i.text.length:i.children.length;if(s==(r>0?a:0)){if(n==0)return this.done=!0,this.value="",this;r>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((o&1)==(r>0?0:1)){if(this.offsets[n]+=r,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof xe){let l=i.text[s+(r<0?-1:0)];if(this.offsets[n]+=r,l.length>Math.max(0,e))return this.value=e==0?l:r>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=i.children[s+(r<0?-1:0)];e>l.length?(e-=l.length,this.offsets[n]+=r):(r<0&&this.offsets[n]--,this.nodes.push(l),this.offsets.push(r>0?1:(l instanceof xe?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},Lc=class{constructor(e,r,n){this.value="",this.done=!1,this.cursor=new Mi(e,r>n?-1:1),this.pos=r>n?e.length:0,this.from=Math.min(r,n),this.to=Math.max(r,n)}nextInner(e,r){if(r<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,r<0?this.pos-this.to:this.from-this.pos);let n=r<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*r,this.value=i.length<=n?i:r<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},Ic=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:r,lineBreak:n,value:i}=this.inner.next(e);return r?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(ee.prototype[Symbol.iterator]=function(){return this.iter()},Mi.prototype[Symbol.iterator]=Lc.prototype[Symbol.iterator]=Ic.prototype[Symbol.iterator]=function(){return this});var nd=class{constructor(e,r,n,i){this.from=e,this.to=r,this.number=n,this.text=i}get length(){return this.to-this.from}},Lo="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=1;t<Lo.length;t++)Lo[t]+=Lo[t-1];function UC(t){for(let e=1;e<Lo.length;e+=2)if(Lo[e]>t)return Lo[e-1]<=t;return!1}function t0(t){return t>=127462&&t<=127487}var r0=8205;function mt(t,e,r=!0,n=!0){return(r?l0:HC)(t,e,n)}function l0(t,e,r){if(e==t.length)return e;e&&c0(t.charCodeAt(e))&&f0(t.charCodeAt(e-1))&&e--;let n=je(t,e);for(e+=xt(n);e<t.length;){let i=je(t,e);if(n==r0||i==r0||r&&UC(i))e+=xt(i),n=i;else if(t0(i)){let o=0,s=e-2;for(;s>=0&&t0(je(t,s));)o++,s-=2;if(o%2==0)break;e+=2}else break}return e}function HC(t,e,r){for(;e>0;){let n=l0(t,e-2,r);if(n<e)return n;e--}return 0}function c0(t){return t>=56320&&t<57344}function f0(t){return t>=55296&&t<56320}function je(t,e){let r=t.charCodeAt(e);if(!f0(r)||e+1==t.length)return r;let n=t.charCodeAt(e+1);return c0(n)?(r-55296<<10)+(n-56320)+65536:r}function pa(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}function xt(t){return t<65536?1:2}var id=/\r\n?|\n/,Je=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(Je||(Je={})),Kt=class{constructor(e){this.sections=e}get length(){let e=0;for(let r=0;r<this.sections.length;r+=2)e+=this.sections[r];return e}get newLength(){let e=0;for(let r=0;r<this.sections.length;r+=2){let n=this.sections[r+1];e+=n<0?this.sections[r]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let r=0,n=0,i=0;r<this.sections.length;){let o=this.sections[r++],s=this.sections[r++];s<0?(e(n,i,o),i+=o):i+=s,n+=o}}iterChangedRanges(e,r=!1){od(this,e,r)}get invertedDesc(){let e=[];for(let r=0;r<this.sections.length;){let n=this.sections[r++],i=this.sections[r++];i<0?e.push(n,i):e.push(i,n)}return new Kt(e)}composeDesc(e){return this.empty?e:e.empty?this:u0(this,e)}mapDesc(e,r=!1){return e.empty?this:sd(this,e,r)}mapPos(e,r=-1,n=Je.Simple){let i=0,o=0;for(let s=0;s<this.sections.length;){let a=this.sections[s++],l=this.sections[s++],c=i+a;if(l<0){if(c>e)return o+(e-i);o+=a}else{if(n!=Je.Simple&&c>=e&&(n==Je.TrackDel&&i<e&&c>e||n==Je.TrackBefore&&i<e||n==Je.TrackAfter&&c>e))return null;if(c>e||c==e&&r<0&&!a)return e==i||r<0?o:o+l;o+=l}i=c}if(e>i)throw new RangeError(`Position ${e} is out of range for changeset of length ${i}`);return o}touchesRange(e,r=e){for(let n=0,i=0;n<this.sections.length&&i<=r;){let o=this.sections[n++],s=this.sections[n++],a=i+o;if(s>=0&&i<=r&&a>=e)return i<e&&a>r?"cover":!0;i=a}return!1}toString(){let e="";for(let r=0;r<this.sections.length;){let n=this.sections[r++],i=this.sections[r++];e+=(e?" ":"")+n+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(r=>typeof r!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Kt(e)}},Ce=class extends Kt{constructor(e,r){super(e),this.inserted=r}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return od(this,(r,n,i,o,s)=>e=e.replace(i,i+(n-r),s),!1),e}mapDesc(e,r=!1){return sd(this,e,r,!0)}invert(e){let r=this.sections.slice(),n=[];for(let i=0,o=0;i<r.length;i+=2){let s=r[i],a=r[i+1];if(a>=0){r[i]=a,r[i+1]=s;let l=i>>1;for(;n.length<l;)n.push(ee.empty);n.push(s?e.slice(o,o+s):ee.empty)}o+=s}return new Ce(r,n)}compose(e){return this.empty?e:e.empty?this:u0(this,e,!0)}map(e,r=!1){return e.empty?this:sd(this,e,r,!0)}iterChanges(e,r=!1){od(this,e,r)}get desc(){return new Kt(this.sections)}filter(e){let r=[],n=[],i=[],o=new Di(this);e:for(let s=0,a=0;;){let l=s==e.length?1e9:e[s++];for(;a<l||a==l&&o.len==0;){if(o.done)break e;let f=Math.min(o.len,l-a);pt(i,f,-1);let u=o.ins==-1?-1:o.off==0?o.ins:0;pt(r,f,u),u>0&&Ri(n,r,o.text),o.forward(f),a+=f}let c=e[s++];for(;a<c;){if(o.done)break e;let f=Math.min(o.len,c-a);pt(r,f,-1),pt(i,f,o.ins==-1?-1:o.off==0?o.ins:0),o.forward(f),a+=f}}return{changes:new Ce(r,n),filtered:new Kt(i)}}toJSON(){let e=[];for(let r=0;r<this.sections.length;r+=2){let n=this.sections[r],i=this.sections[r+1];i<0?e.push(n):i==0?e.push([n]):e.push([n].concat(this.inserted[r>>1].toJSON()))}return e}static of(e,r,n){let i=[],o=[],s=0,a=null;function l(f=!1){if(!f&&!i.length)return;s<r&&pt(i,r-s,-1);let u=new Ce(i,o);a=a?a.compose(u.map(a)):u,i=[],o=[],s=0}function c(f){if(Array.isArray(f))for(let u of f)c(u);else if(f instanceof Ce){if(f.length!=r)throw new RangeError(`Mismatched change set length (got ${f.length}, expected ${r})`);l(),a=a?a.compose(f.map(a)):f}else{let{from:u,to:h=u,insert:d}=f;if(u>h||u<0||h>r)throw new RangeError(`Invalid change range ${u} to ${h} (in doc of length ${r})`);let p=d?typeof d=="string"?ee.of(d.split(n||id)):d:ee.empty,b=p.length;if(u==h&&b==0)return;u<s&&l(),u>s&&pt(i,u-s,-1),pt(i,h-u,b),Ri(o,i,p),s=h}}return c(e),l(!a),a}static empty(e){return new Ce(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let r=[],n=[];for(let i=0;i<e.length;i++){let o=e[i];if(typeof o=="number")r.push(o,-1);else{if(!Array.isArray(o)||typeof o[0]!="number"||o.some((s,a)=>a&&typeof s!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(o.length==1)r.push(o[0],0);else{for(;n.length<i;)n.push(ee.empty);n[i]=ee.of(o.slice(1)),r.push(o[0],n[i].length)}}}return new Ce(r,n)}};function pt(t,e,r,n=!1){if(e==0&&r<=0)return;let i=t.length-2;i>=0&&r<=0&&r==t[i+1]?t[i]+=e:e==0&&t[i]==0?t[i+1]+=r:n?(t[i]+=e,t[i+1]+=r):t.push(e,r)}function Ri(t,e,r){if(r.length==0)return;let n=e.length-2>>1;if(n<t.length)t[t.length-1]=t[t.length-1].append(r);else{for(;t.length<n;)t.push(ee.empty);t.push(r)}}function od(t,e,r){let n=t.inserted;for(let i=0,o=0,s=0;s<t.sections.length;){let a=t.sections[s++],l=t.sections[s++];if(l<0)i+=a,o+=a;else{let c=i,f=o,u=ee.empty;for(;c+=a,f+=l,l&&n&&(u=u.append(n[s-2>>1])),!(r||s==t.sections.length||t.sections[s+1]<0);)a=t.sections[s++],l=t.sections[s++];e(i,c,o,f,u),i=c,o=f}}}function sd(t,e,r,n=!1){let i=[],o=n?[]:null,s=new Di(t),a=new Di(e);for(let l=0,c=0;;)if(s.ins==-1)l+=s.len,s.next();else if(a.ins==-1&&c<l){let f=Math.min(a.len,l-c);a.forward(f),pt(i,f,-1),c+=f}else if(a.ins>=0&&(s.done||c<l||c==l&&(a.len<s.len||a.len==s.len&&!r))){for(pt(i,a.ins,-1);l>c&&!s.done&&l+s.len<c+a.len;)l+=s.len,s.next();c+=a.len,a.next()}else if(s.ins>=0){let f=0,u=l+s.len;for(;;)if(a.ins>=0&&c>l&&c+a.len<u)f+=a.ins,c+=a.len,a.next();else if(a.ins==-1&&c<u){let h=Math.min(a.len,u-c);f+=h,a.forward(h),c+=h}else break;pt(i,f,s.ins),o&&Ri(o,i,s.text),l=u,s.next()}else{if(s.done&&a.done)return o?new Ce(i,o):new Kt(i);throw new Error("Mismatched change set lengths")}}function u0(t,e,r=!1){let n=[],i=r?[]:null,o=new Di(t),s=new Di(e);for(let a=!1;;){if(o.done&&s.done)return i?new Ce(n,i):new Kt(n);if(o.ins==0)pt(n,o.len,0,a),o.next();else if(s.len==0&&!s.done)pt(n,0,s.ins,a),i&&Ri(i,n,s.text),s.next();else{if(o.done||s.done)throw new Error("Mismatched change set lengths");{let l=Math.min(o.len2,s.len),c=n.length;if(o.ins==-1){let f=s.ins==-1?-1:s.off?0:s.ins;pt(n,l,f,a),i&&f&&Ri(i,n,s.text)}else s.ins==-1?(pt(n,o.off?0:o.len,l,a),i&&Ri(i,n,o.textBit(l))):(pt(n,o.off?0:o.len,s.off?0:s.ins,a),i&&!s.off&&Ri(i,n,s.text));a=(o.ins>l||s.ins>=0&&s.len>l)&&(a||n.length>c),o.forward2(l),s.forward(l)}}}}var Di=class{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,r=this.i-2>>1;return r>=e.length?ee.empty:e[r]}textBit(e){let{inserted:r}=this.set,n=this.i-2>>1;return n>=r.length&&!e?ee.empty:r[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}},Nn=class{constructor(e,r,n){this.from=e,this.to=r,this.flags=n}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,r=-1){let n,i;return this.empty?n=i=e.mapPos(this.from,r):(n=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),n==this.from&&i==this.to?this:new Nn(n,i,this.flags)}extend(e,r=e){if(e<=this.anchor&&r>=this.anchor)return A.range(e,r);let n=Math.abs(e-this.anchor)>Math.abs(r-this.anchor)?e:r;return A.range(this.anchor,n)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return A.range(e.anchor,e.head)}},A=class{constructor(e,r=0){this.ranges=e,this.mainIndex=r}map(e,r=-1){return e.empty?this:A.create(this.ranges.map(n=>n.map(e,r)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new A([this.main])}addRange(e,r=!0){return A.create([e].concat(this.ranges),r?0:this.mainIndex+1)}replaceRange(e,r=this.mainIndex){let n=this.ranges.slice();return n[r]=e,A.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new A(e.ranges.map(r=>Nn.fromJSON(r)),e.main)}static single(e,r=e){return new A([A.range(e,r)],0)}static create(e,r=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,i=0;i<e.length;i++){let o=e[i];if(o.empty?o.from<=n:o.from<n)return WC(e.slice(),r);n=o.to}return new A(e,r)}static cursor(e,r=0,n,i){return new Nn(e,e,(r==0?0:r<0?4:8)|(n==null?3:Math.min(2,n))|(i??33554431)<<5)}static range(e,r,n){let i=(n??33554431)<<5;return r<e?new Nn(r,e,16|i|8):new Nn(e,r,i|(r>e?4:0))}};function WC(t,e=0){let r=t[e];t.sort((n,i)=>n.from-i.from),e=t.indexOf(r);for(let n=1;n<t.length;n++){let i=t[n],o=t[n-1];if(i.empty?i.from<=o.to:i.from<o.to){let s=o.from,a=Math.max(i.to,o.to);n<=e&&e--,t.splice(--n,2,i.anchor>i.head?A.range(a,s):A.range(s,a))}}return new A(t,e)}function h0(t,e){for(let r of t.ranges)if(r.to>e)throw new RangeError("Selection points outside of document")}var pd=0,j=class{constructor(e,r,n,i,o){this.combine=e,this.compareInput=r,this.compare=n,this.isStatic=i,this.extensions=o,this.id=pd++,this.default=e([])}static define(e={}){return new j(e.combine||(r=>r),e.compareInput||((r,n)=>r===n),e.compare||(e.combine?(r,n)=>r===n:md),!!e.static,e.enables)}of(e){return new Io([],this,0,e)}compute(e,r){if(this.isStatic)throw new Error("Can't compute a static facet");return new Io(e,this,1,r)}computeN(e,r){if(this.isStatic)throw new Error("Can't compute a static facet");return new Io(e,this,2,r)}from(e,r){return r||(r=n=>n),this.compute([e],n=>r(n.field(e)))}};function md(t,e){return t==e||t.length==e.length&&t.every((r,n)=>r===e[n])}var Io=class{constructor(e,r,n,i){this.dependencies=e,this.facet=r,this.type=n,this.value=i,this.id=pd++}dynamicSlot(e){var r;let n=this.value,i=this.facet.compareInput,o=this.id,s=e[o]>>1,a=this.type==2,l=!1,c=!1,f=[];for(let u of this.dependencies)u=="doc"?l=!0:u=="selection"?c=!0:((r=e[u.id])!==null&&r!==void 0?r:1)&1||f.push(e[u.id]);return{create(u){return u.values[s]=n(u),1},update(u,h){if(l&&h.docChanged||c&&(h.docChanged||h.selection)||ad(u,f)){let d=n(u);if(a?!n0(d,u.values[s],i):!i(d,u.values[s]))return u.values[s]=d,1}return 0},reconfigure:(u,h)=>{let d=n(u),p=h.config.address[o];if(p!=null){let b=jc(h,p);if(this.dependencies.every(m=>m instanceof j?h.facet(m)===u.facet(m):m instanceof ce?h.field(m,!1)==u.field(m,!1):!0)||(a?n0(d,b,i):i(d,b)))return u.values[s]=b,0}return u.values[s]=d,1}}}};function n0(t,e,r){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!r(t[n],e[n]))return!1;return!0}function ad(t,e){let r=!1;for(let n of e)fa(t,n)&1&&(r=!0);return r}function qC(t,e,r){let n=r.map(l=>t[l.id]),i=r.map(l=>l.type),o=n.filter(l=>!(l&1)),s=t[e.id]>>1;function a(l){let c=[];for(let f=0;f<n.length;f++){let u=jc(l,n[f]);if(i[f]==2)for(let h of u)c.push(h);else c.push(u)}return e.combine(c)}return{create(l){for(let c of n)fa(l,c);return l.values[s]=a(l),1},update(l,c){if(!ad(l,o))return 0;let f=a(l);return e.compare(f,l.values[s])?0:(l.values[s]=f,1)},reconfigure(l,c){let f=ad(l,n),u=c.config.facets[e.id],h=c.facet(e);if(u&&!f&&md(r,u))return l.values[s]=h,0;let d=a(l);return e.compare(d,h)?(l.values[s]=h,0):(l.values[s]=d,1)}}}var i0=j.define({static:!0}),ce=class{constructor(e,r,n,i,o){this.id=e,this.createF=r,this.updateF=n,this.compareF=i,this.spec=o,this.provides=void 0}static define(e){let r=new ce(pd++,e.create,e.update,e.compare||((n,i)=>n===i),e);return e.provide&&(r.provides=e.provide(r)),r}create(e){let r=e.facet(i0).find(n=>n.field==this);return(r?.create||this.createF)(e)}slot(e){let r=e[this.id]>>1;return{create:n=>(n.values[r]=this.create(n),1),update:(n,i)=>{let o=n.values[r],s=this.updateF(o,i);return this.compareF(o,s)?0:(n.values[r]=s,1)},reconfigure:(n,i)=>i.config.address[this.id]!=null?(n.values[r]=i.field(this),0):(n.values[r]=this.create(n),1)}}init(e){return[this,i0.of({field:this,create:e})]}get extension(){return this}},Po={lowest:4,low:3,default:2,high:1,highest:0};function ca(t){return e=>new Bc(e,t)}var hn={highest:ca(Po.highest),high:ca(Po.high),default:ca(Po.default),low:ca(Po.low),lowest:ca(Po.lowest)},Bc=class{constructor(e,r){this.inner=e,this.prec=r}},jo=class{of(e){return new ua(this,e)}reconfigure(e){return jo.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}},ua=class{constructor(e,r){this.compartment=e,this.inner=r}},$o=class{constructor(e,r,n,i,o,s){for(this.base=e,this.compartments=r,this.dynamicSlots=n,this.address=i,this.staticValues=o,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let r=this.address[e.id];return r==null?e.default:this.staticValues[r>>1]}static resolve(e,r,n){let i=[],o=Object.create(null),s=new Map;for(let h of KC(e,r,s))h instanceof ce?i.push(h):(o[h.facet.id]||(o[h.facet.id]=[])).push(h);let a=Object.create(null),l=[],c=[];for(let h of i)a[h.id]=c.length<<1,c.push(d=>h.slot(d));let f=n?.config.facets;for(let h in o){let d=o[h],p=d[0].facet,b=f&&f[h]||[];if(d.every(m=>m.type==0))if(a[p.id]=l.length<<1|1,md(b,d))l.push(n.facet(p));else{let m=p.combine(d.map(k=>k.value));l.push(n&&p.compare(m,n.facet(p))?n.facet(p):m)}else{for(let m of d)m.type==0?(a[m.id]=l.length<<1|1,l.push(m.value)):(a[m.id]=c.length<<1,c.push(k=>m.dynamicSlot(k)));a[p.id]=c.length<<1,c.push(m=>qC(m,p,d))}}let u=c.map(h=>h(a));return new $o(e,s,u,a,l,o)}};function KC(t,e,r){let n=[[],[],[],[],[]],i=new Map;function o(s,a){let l=i.get(s);if(l!=null){if(l<=a)return;let c=n[l].indexOf(s);c>-1&&n[l].splice(c,1),s instanceof ua&&r.delete(s.compartment)}if(i.set(s,a),Array.isArray(s))for(let c of s)o(c,a);else if(s instanceof ua){if(r.has(s.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(s.compartment)||s.inner;r.set(s.compartment,c),o(c,a)}else if(s instanceof Bc)o(s.inner,s.prec);else if(s instanceof ce)n[a].push(s),s.provides&&o(s.provides,a);else if(s instanceof Io)n[a].push(s),s.facet.extensions&&o(s.facet.extensions,a);else{let c=s.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${s}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);o(c,a)}}return o(t,Po.default),n.reduce((s,a)=>s.concat(a))}function fa(t,e){if(e&1)return 2;let r=e>>1,n=t.status[r];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;t.status[r]=4;let i=t.computeSlot(t,t.config.dynamicSlots[r]);return t.status[r]=2|i}function jc(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}var d0=j.define(),p0=j.define({combine:t=>t.some(e=>e),static:!0}),m0=j.define({combine:t=>t.length?t[0]:void 0,static:!0}),g0=j.define(),y0=j.define(),b0=j.define(),k0=j.define({combine:t=>t.length?t[0]:!1}),br=class{constructor(e,r){this.type=e,this.value=r}static define(){return new ld}},ld=class{of(e){return new br(this,e)}},cd=class{constructor(e){this.map=e}of(e){return new W(this,e)}},W=class{constructor(e,r){this.type=e,this.value=r}map(e){let r=this.type.map(this.value,e);return r===void 0?void 0:r==this.value?this:new W(this.type,r)}is(e){return this.type==e}static define(e={}){return new cd(e.map||(r=>r))}static mapEffects(e,r){if(!e.length)return e;let n=[];for(let i of e){let o=i.map(r);o&&n.push(o)}return n}};W.reconfigure=W.define();W.appendConfig=W.define();var Ae=class{constructor(e,r,n,i,o,s){this.startState=e,this.changes=r,this.selection=n,this.effects=i,this.annotations=o,this.scrollIntoView=s,this._doc=null,this._state=null,n&&h0(n,r.newLength),o.some(a=>a.type==Ae.time)||(this.annotations=o.concat(Ae.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let r of this.annotations)if(r.type==e)return r.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let r=this.annotation(Ae.userEvent);return!!(r&&(r==e||r.length>e.length&&r.slice(0,e.length)==e&&r[e.length]=="."))}};Ae.time=br.define();Ae.userEvent=br.define();Ae.addToHistory=br.define();Ae.remote=br.define();function GC(t,e){let r=[];for(let n=0,i=0;;){let o,s;if(n<t.length&&(i==e.length||e[i]>=t[n]))o=t[n++],s=t[n++];else if(i<e.length)o=e[i++],s=e[i++];else return r;!r.length||r[r.length-1]<o?r.push(o,s):r[r.length-1]<s&&(r[r.length-1]=s)}}function v0(t,e,r){var n;let i,o,s;return r?(i=e.changes,o=Ce.empty(e.changes.length),s=t.changes.compose(e.changes)):(i=e.changes.map(t.changes),o=t.changes.mapDesc(e.changes,!0),s=t.changes.compose(i)),{changes:s,selection:e.selection?e.selection.map(o):(n=t.selection)===null||n===void 0?void 0:n.map(i),effects:W.mapEffects(t.effects,i).concat(W.mapEffects(e.effects,o)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function fd(t,e,r){let n=e.selection,i=Bo(e.annotations);return e.userEvent&&(i=i.concat(Ae.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ce?e.changes:Ce.of(e.changes||[],r,t.facet(m0)),selection:n&&(n instanceof A?n:A.single(n.anchor,n.head)),effects:Bo(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function w0(t,e,r){let n=fd(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(r=!1);for(let o=1;o<e.length;o++){e[o].filter===!1&&(r=!1);let s=!!e[o].sequential;n=v0(n,fd(t,e[o],s?n.changes.newLength:t.doc.length),s)}let i=new Ae(t,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return JC(r?ZC(i):i)}function ZC(t){let e=t.startState,r=!0;for(let i of e.facet(g0)){let o=i(t);if(o===!1){r=!1;break}Array.isArray(o)&&(r=r===!0?o:GC(r,o))}if(r!==!0){let i,o;if(r===!1)o=t.changes.invertedDesc,i=Ce.empty(e.doc.length);else{let s=t.changes.filter(r);i=s.changes,o=s.filtered.invertedDesc}t=new Ae(e,i,t.selection&&t.selection.map(o),W.mapEffects(t.effects,o),t.annotations,t.scrollIntoView)}let n=e.facet(y0);for(let i=n.length-1;i>=0;i--){let o=n[i](t);o instanceof Ae?t=o:Array.isArray(o)&&o.length==1&&o[0]instanceof Ae?t=o[0]:t=w0(e,Bo(o),!1)}return t}function JC(t){let e=t.startState,r=e.facet(b0),n=t;for(let i=r.length-1;i>=0;i--){let o=r[i](t);o&&Object.keys(o).length&&(n=v0(t,fd(e,o,t.changes.newLength),!0))}return n==t?t:new Ae(e,t.changes,t.selection,n.effects,n.annotations,n.scrollIntoView)}var YC=[];function Bo(t){return t==null?YC:Array.isArray(t)?t:[t]}var Be=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(Be||(Be={})),XC=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,ud;try{ud=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function QC(t){if(ud)return ud.test(t);for(let e=0;e<t.length;e++){let r=t[e];if(/\w/.test(r)||r>"\x80"&&(r.toUpperCase()!=r.toLowerCase()||XC.test(r)))return!0}return!1}function eA(t){return e=>{if(!/\S/.test(e))return Be.Space;if(QC(e))return Be.Word;for(let r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return Be.Word;return Be.Other}}var G=class{constructor(e,r,n,i,o,s){this.config=e,this.doc=r,this.selection=n,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=o,s&&(s._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)fa(this,a<<1);this.computeSlot=null}field(e,r=!0){let n=this.config.address[e.id];if(n==null){if(r)throw new RangeError("Field is not present in this state");return}return fa(this,n),jc(this,n)}update(...e){return w0(this,e,!0)}applyTransaction(e){let r=this.config,{base:n,compartments:i}=r;for(let s of e.effects)s.is(jo.reconfigure)?(r&&(i=new Map,r.compartments.forEach((a,l)=>i.set(l,a)),r=null),i.set(s.value.compartment,s.value.extension)):s.is(W.reconfigure)?(r=null,n=s.value):s.is(W.appendConfig)&&(r=null,n=Bo(n).concat(s.value));let o;r?o=e.startState.values.slice():(r=$o.resolve(n,i,this),o=new G(r,this.doc,this.selection,r.dynamicSlots.map(()=>null),(a,l)=>l.reconfigure(a,this),null).values),new G(r,e.newDoc,e.newSelection,o,(s,a)=>a.update(s,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:e},range:A.cursor(r.from+e.length)}))}changeByRange(e){let r=this.selection,n=e(r.ranges[0]),i=this.changes(n.changes),o=[n.range],s=Bo(n.effects);for(let a=1;a<r.ranges.length;a++){let l=e(r.ranges[a]),c=this.changes(l.changes),f=c.map(i);for(let h=0;h<a;h++)o[h]=o[h].map(f);let u=i.mapDesc(c,!0);o.push(l.range.map(u)),i=i.compose(f),s=W.mapEffects(s,f).concat(W.mapEffects(Bo(l.effects),u))}return{changes:i,selection:A.create(o,r.mainIndex),effects:s}}changes(e=[]){return e instanceof Ce?e:Ce.of(e,this.doc.length,this.facet(G.lineSeparator))}toText(e){return ee.of(e.split(this.facet(G.lineSeparator)||id))}sliceDoc(e=0,r=this.doc.length){return this.doc.sliceString(e,r,this.lineBreak)}facet(e){let r=this.config.address[e.id];return r==null?e.default:(fa(this,r),jc(this,r))}toJSON(e){let r={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let i=e[n];i instanceof ce&&(r[n]=i.spec.toJSON(this.field(e[n]),this))}return r}static fromJSON(e,r={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(n)for(let o in n){let s=n[o],a=e[o];i.push(s.init(l=>s.spec.fromJSON(a,l)))}return G.create({doc:e.doc,selection:A.fromJSON(e.selection),extensions:r.extensions?i.concat([r.extensions]):i})}static create(e={}){let r=$o.resolve(e.extensions||[],new Map),n=e.doc instanceof ee?e.doc:ee.of((e.doc||"").split(r.staticFacet(G.lineSeparator)||id)),i=e.selection?e.selection instanceof A?e.selection:A.single(e.selection.anchor,e.selection.head):A.single(0);return h0(i,n.length),r.staticFacet(p0)||(i=i.asSingle()),new G(r,n,i,r.dynamicSlots.map(()=>null),(o,s)=>s.create(o),null)}get tabSize(){return this.facet(G.tabSize)}get lineBreak(){return this.facet(G.lineSeparator)||`
`}get readOnly(){return this.facet(k0)}phrase(e){for(let r of this.facet(G.phrases))if(Object.prototype.hasOwnProperty.call(r,e))return r[e];return e}languageDataAt(e,r,n=-1){let i=[];for(let o of this.facet(d0))for(let s of o(this,r,n))Object.prototype.hasOwnProperty.call(s,e)&&i.push(s[e]);return i}charCategorizer(e){return eA(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:r,from:n,length:i}=this.doc.lineAt(e),o=this.charCategorizer(e),s=e-n,a=e-n;for(;s>0;){let l=mt(r,s,!1);if(o(r.slice(l,s))!=Be.Word)break;s=l}for(;a<i;){let l=mt(r,a);if(o(r.slice(a,l))!=Be.Word)break;a=l}return s==a?null:A.range(s+n,a+n)}};G.allowMultipleSelections=p0;G.tabSize=j.define({combine:t=>t.length?t[0]:4});G.lineSeparator=m0;G.readOnly=k0;G.phrases=j.define({compare(t,e){let r=Object.keys(t),n=Object.keys(e);return r.length==n.length&&r.every(i=>t[i]==e[i])}});G.languageData=d0;G.changeFilter=g0;G.transactionFilter=y0;G.transactionExtender=b0;jo.reconfigure=W.define();function gt(t,e,r={}){let n={};for(let i of t)for(let o of Object.keys(i)){let s=i[o],a=n[o];if(a===void 0)n[o]=s;else if(!(a===s||s===void 0))if(Object.hasOwnProperty.call(r,o))n[o]=r[o](a,s);else throw new Error("Config merge conflict for field "+o)}for(let i in e)n[i]===void 0&&(n[i]=e[i]);return n}var kr=class{eq(e){return this==e}range(e,r=e){return new ha(e,r,this)}};kr.prototype.startSide=kr.prototype.endSide=0;kr.prototype.point=!1;kr.prototype.mapMode=Je.TrackDel;var ha=class{constructor(e,r,n){this.from=e,this.to=r,this.value=n}};function hd(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}var da=class{constructor(e,r,n,i){this.from=e,this.to=r,this.value=n,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,r,n,i=0){let o=n?this.to:this.from;for(let s=i,a=o.length;;){if(s==a)return s;let l=s+a>>1,c=o[l]-e||(n?this.value[l].endSide:this.value[l].startSide)-r;if(l==s)return c>=0?s:a;c>=0?a=l:s=l+1}}between(e,r,n,i){for(let o=this.findIndex(r,-1e9,!0),s=this.findIndex(n,1e9,!1,o);o<s;o++)if(i(this.from[o]+e,this.to[o]+e,this.value[o])===!1)return!1}map(e,r){let n=[],i=[],o=[],s=-1,a=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],f=this.from[l]+e,u=this.to[l]+e,h,d;if(f==u){let p=r.mapPos(f,c.startSide,c.mapMode);if(p==null||(h=d=p,c.startSide!=c.endSide&&(d=r.mapPos(f,c.endSide),d<h)))continue}else if(h=r.mapPos(f,c.startSide),d=r.mapPos(u,c.endSide),h>d||h==d&&c.startSide>0&&c.endSide<=0)continue;(d-h||c.endSide-c.startSide)<0||(s<0&&(s=h),c.point&&(a=Math.max(a,d-h)),n.push(c),i.push(h-s),o.push(d-s))}return{mapped:n.length?new da(i,o,n,a):null,pos:s}}},te=class{constructor(e,r,n=te.empty,i){this.chunkPos=e,this.chunk=r,this.nextLayer=n,this.maxPoint=i}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let r of this.chunk)e+=r.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:r=[],sort:n=!1,filterFrom:i=0,filterTo:o=this.length}=e,s=e.filter;if(r.length==0&&!s)return this;if(n&&(r=r.slice().sort(hd)),this.isEmpty)return r.length?te.of(r):this;let a=new $c(this,null,-1).goto(0),l=0,c=[],f=new Mt;for(;a.value||l<r.length;)if(l<r.length&&(a.from-r[l].from||a.startSide-r[l].value.startSide)>=0){let u=r[l++];f.addInner(u.from,u.to,u.value)||c.push(u)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==r.length||this.chunkEnd(a.chunkIndex)<r[l].from)&&(!s||i>this.chunkEnd(a.chunkIndex)||o<this.chunkPos[a.chunkIndex])&&f.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!s||i>a.to||o<a.from||s(a.from,a.to,a.value))&&(f.addInner(a.from,a.to,a.value)||c.push(new ha(a.from,a.to,a.value))),a.next());return f.finishInner(this.nextLayer.isEmpty&&!c.length?te.empty:this.nextLayer.update({add:c,filter:s,filterFrom:i,filterTo:o}))}map(e){if(e.empty||this.isEmpty)return this;let r=[],n=[],i=-1;for(let s=0;s<this.chunk.length;s++){let a=this.chunkPos[s],l=this.chunk[s],c=e.touchesRange(a,a+l.length);if(c===!1)i=Math.max(i,l.maxPoint),r.push(l),n.push(e.mapPos(a));else if(c===!0){let{mapped:f,pos:u}=l.map(a,e);f&&(i=Math.max(i,f.maxPoint),r.push(f),n.push(u))}}let o=this.nextLayer.map(e);return r.length==0?o:new te(n,r,o,i)}between(e,r,n){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let o=this.chunkPos[i],s=this.chunk[i];if(r>=o&&e<=o+s.length&&s.between(o,e-o,r-o,n)===!1)return}this.nextLayer.between(e,r,n)}}iter(e=0){return Ni.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,r=0){return Ni.from(e).goto(r)}static compare(e,r,n,i,o=-1){let s=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=o),a=r.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=o),l=o0(s,a,n),c=new Ei(s,l,o),f=new Ei(a,l,o);n.iterGaps((u,h,d)=>s0(c,u,f,h,d,i)),n.empty&&n.length==0&&s0(c,0,f,0,0,i)}static eq(e,r,n=0,i){i==null&&(i=1e9);let o=e.filter(f=>!f.isEmpty&&r.indexOf(f)<0),s=r.filter(f=>!f.isEmpty&&e.indexOf(f)<0);if(o.length!=s.length)return!1;if(!o.length)return!0;let a=o0(o,s),l=new Ei(o,a,0).goto(n),c=new Ei(s,a,0).goto(n);for(;;){if(l.to!=c.to||!dd(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>i)return!0;l.next(),c.next()}}static spans(e,r,n,i,o=-1){let s=new Ei(e,null,o).goto(r),a=r,l=s.openStart;for(;;){let c=Math.min(s.to,n);if(s.point?(i.point(a,c,s.point,s.activeForPoint(s.to),l,s.pointRank),l=s.openEnd(c)+(s.to>c?1:0)):c>a&&(i.span(a,c,s.active,l),l=s.openEnd(c)),s.to>n)break;a=s.to,s.next()}return l}static of(e,r=!1){let n=new Mt;for(let i of e instanceof ha?[e]:r?tA(e):e)n.add(i.from,i.to,i.value);return n.finish()}};te.empty=new te([],[],null,-1);function tA(t){if(t.length>1)for(let e=t[0],r=1;r<t.length;r++){let n=t[r];if(hd(e,n)>0)return t.slice().sort(hd);e=n}return t}te.empty.nextLayer=te.empty;var Mt=class{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new da(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,r,n){this.addInner(e,r,n)||(this.nextLayer||(this.nextLayer=new Mt)).add(e,r,n)}addInner(e,r,n){let i=e-this.lastTo||n.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(r-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=r,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,r-e)),!0)}addChunk(e,r){if((e-this.lastTo||r.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,r.maxPoint),this.chunks.push(r),this.chunkPos.push(e);let n=r.value.length-1;return this.last=r.value[n],this.lastFrom=r.from[n]+e,this.lastTo=r.to[n]+e,!0}finish(){return this.finishInner(te.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let r=new te(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,r}};function o0(t,e,r){let n=new Map;for(let o of t)for(let s=0;s<o.chunk.length;s++)o.chunk[s].maxPoint<=0&&n.set(o.chunk[s],o.chunkPos[s]);let i=new Set;for(let o of e)for(let s=0;s<o.chunk.length;s++){let a=n.get(o.chunk[s]);a!=null&&(r?r.mapPos(a):a)==o.chunkPos[s]&&!r?.touchesRange(a,a+o.chunk[s].length)&&i.add(o.chunk[s])}return i}var $c=class{constructor(e,r,n,i=0){this.layer=e,this.skip=r,this.minPoint=n,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,r=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,r,!1),this}gotoInner(e,r,n){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],r,!0);(!n||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,r){(this.to-e||this.endSide-r)<0&&this.gotoInner(e,r,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],r=this.layer.chunk[this.chunkIndex],n=e+r.from[this.rangeIndex];if(this.from=n,this.to=e+r.to[this.rangeIndex],this.value=r.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},Ni=class{constructor(e){this.heap=e}static from(e,r=null,n=-1){let i=[];for(let o=0;o<e.length;o++)for(let s=e[o];!s.isEmpty;s=s.nextLayer)s.maxPoint>=n&&i.push(new $c(s,r,n,o));return i.length==1?i[0]:new Ni(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,r=-1e9){for(let n of this.heap)n.goto(e,r);for(let n=this.heap.length>>1;n>=0;n--)rd(this.heap,n);return this.next(),this}forward(e,r){for(let n of this.heap)n.forward(e,r);for(let n=this.heap.length>>1;n>=0;n--)rd(this.heap,n);(this.to-e||this.value.endSide-r)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),rd(this.heap,0)}}};function rd(t,e){for(let r=t[e];;){let n=(e<<1)+1;if(n>=t.length)break;let i=t[n];if(n+1<t.length&&i.compare(t[n+1])>=0&&(i=t[n+1],n++),r.compare(i)<0)break;t[n]=r,t[e]=i,e=n}}var Ei=class{constructor(e,r,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Ni.from(e,r,n)}goto(e,r=-1e9){return this.cursor.goto(e,r),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=r,this.openStart=-1,this.next(),this}forward(e,r){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-r)<0;)this.removeActive(this.minActive);this.cursor.forward(e,r)}removeActive(e){Dc(this.active,e),Dc(this.activeTo,e),Dc(this.activeRank,e),this.minActive=a0(this.active,this.activeTo)}addActive(e){let r=0,{value:n,to:i,rank:o}=this.cursor;for(;r<this.activeRank.length&&this.activeRank[r]<=o;)r++;Nc(this.active,r,n),Nc(this.activeTo,r,i),Nc(this.activeRank,r,o),e&&Nc(e,r,this.cursor.from),this.minActive=a0(this.active,this.activeTo)}next(){let e=this.to,r=this.point;this.point=null;let n=this.openStart<0?[]:null,i=0;for(;;){let o=this.minActive;if(o>-1&&(this.activeTo[o]-this.cursor.from||this.active[o].endSide-this.cursor.startSide)<0){if(this.activeTo[o]>e){this.to=this.activeTo[o],this.endSide=this.active[o].endSide;break}this.removeActive(o),n&&Dc(n,o)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(n),this.cursor.next();else if(r&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.from<e&&(i=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){let o=0;for(;o<n.length&&n[o]<e;)o++;this.openStart=o+i}}activeForPoint(e){if(!this.active.length)return this.active;let r=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&r.push(this.active[n]);return r.reverse()}openEnd(e){let r=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)r++;return r}};function s0(t,e,r,n,i,o){t.goto(e),r.goto(n);let s=n+i,a=n,l=n-e;for(;;){let c=t.to+l-r.to||t.endSide-r.endSide,f=c<0?t.to+l:r.to,u=Math.min(f,s);if(t.point||r.point?t.point&&r.point&&(t.point==r.point||t.point.eq(r.point))&&dd(t.activeForPoint(t.to+l),r.activeForPoint(r.to))||o.comparePoint(a,u,t.point,r.point):u>a&&!dd(t.active,r.active)&&o.compareRange(a,u,t.active,r.active),f>s)break;a=f,c<=0&&t.next(),c>=0&&r.next()}}function dd(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!=e[r]&&!t[r].eq(e[r]))return!1;return!0}function Dc(t,e){for(let r=e,n=t.length-1;r<n;r++)t[r]=t[r+1];t.pop()}function Nc(t,e,r){for(let n=t.length-1;n>=e;n--)t[n+1]=t[n];t[e]=r}function a0(t,e){let r=-1,n=1e9;for(let i=0;i<e.length;i++)(e[i]-n||t[i].endSide-t[r].endSide)<0&&(r=i,n=e[i]);return r}function Pn(t,e,r=t.length){let n=0;for(let i=0;i<r;)t.charCodeAt(i)==9?(n+=e-n%e,i++):(n++,i=mt(t,i));return n}function zc(t,e,r,n){for(let i=0,o=0;;){if(o>=e)return i;if(i==t.length)break;o+=t.charCodeAt(i)==9?r-o%r:1,i=mt(t,i)}return n===!0?-1:t.length}var gd="\u037C",x0=typeof Symbol>"u"?"__"+gd:Symbol.for(gd),yd=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),S0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},Gt=class{constructor(e,r){this.rules=[];let{finish:n}=r||{};function i(s){return/^@/.test(s)?[s]:s.split(/,\s*/)}function o(s,a,l,c){let f=[],u=/^@(\w+)\b/.exec(s[0]),h=u&&u[1]=="keyframes";if(u&&a==null)return l.push(s[0]+";");for(let d in a){let p=a[d];if(/&/.test(d))o(d.split(/,\s*/).map(b=>s.map(m=>b.replace(/&/,m))).reduce((b,m)=>b.concat(m)),p,l);else if(p&&typeof p=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");o(i(d),p,f,h)}else p!=null&&f.push(d.replace(/_.*/,"").replace(/[A-Z]/g,b=>"-"+b.toLowerCase())+": "+p+";")}(f.length||h)&&l.push((n&&!u&&!c?s.map(n):s).join(", ")+" {"+f.join(" ")+"}")}for(let s in e)o(i(s),e[s],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=S0[x0]||1;return S0[x0]=e+1,gd+e.toString(36)}static mount(e,r){(e[yd]||new bd(e)).mount(Array.isArray(r)?r:[r])}},Fc=null,bd=class{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet<"u"){if(Fc)return e.adoptedStyleSheets=[Fc.sheet].concat(e.adoptedStyleSheets),e[yd]=Fc;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),Fc=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let r=e.head||e;r.insertBefore(this.styleTag,r.firstChild)}this.modules=[],e[yd]=this}mount(e){let r=this.sheet,n=0,i=0;for(let o=0;o<e.length;o++){let s=e[o],a=this.modules.indexOf(s);if(a<i&&a>-1&&(this.modules.splice(a,1),i--,a=-1),a==-1){if(this.modules.splice(i++,0,s),r)for(let l=0;l<s.rules.length;l++)r.insertRule(s.rules[l],n++)}else{for(;i<a;)n+=this.modules[i++].rules.length;n+=s.rules.length,i++}}if(!r){let o="";for(let s=0;s<this.modules.length;s++)o+=this.modules[s].getRules()+`
`;this.styleTag.textContent=o}}};var dn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Uc={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},_0=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent),rA=typeof navigator<"u"&&/Apple Computer/.test(navigator.vendor),nA=typeof navigator<"u"&&/Gecko\/\d+/.test(navigator.userAgent),C0=typeof navigator<"u"&&/Mac/.test(navigator.platform),iA=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),oA=_0&&(C0||+_0[1]<57)||nA&&C0;for(Me=0;Me<10;Me++)dn[48+Me]=dn[96+Me]=String(Me);var Me;for(Me=1;Me<=24;Me++)dn[Me+111]="F"+Me;var Me;for(Me=65;Me<=90;Me++)dn[Me]=String.fromCharCode(Me+32),Uc[Me]=String.fromCharCode(Me);var Me;for(Vc in dn)Uc.hasOwnProperty(Vc)||(Uc[Vc]=dn[Vc]);var Vc;function A0(t){var e=oA&&(t.ctrlKey||t.altKey||t.metaKey)||(rA||iA)&&t.shiftKey&&t.key&&t.key.length==1,r=!e&&t.key||(t.shiftKey?Uc:dn)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}function Jc(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function Ho(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function sA(){let t=document.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function Od(t,e){if(!e.anchorNode)return!1;try{return Ho(t,e.anchorNode)}catch{return!1}}function Ca(t){return t.nodeType==3?Aa(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function Yc(t,e,r,n){return r?T0(t,e,r,n,-1)||T0(t,e,r,n,1):!1}function Ed(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function T0(t,e,r,n,i){for(;;){if(t==r&&e==n)return!0;if(e==(i<0?0:Xc(t))){if(t.nodeName=="DIV")return!1;let o=t.parentNode;if(!o||o.nodeType!=1)return!1;e=Ed(t)+(i<0?0:1),t=o}else if(t.nodeType==1){if(t=t.childNodes[e+(i<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=i<0?Xc(t):0}else return!1}}function Xc(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}var hb={left:0,right:0,top:0,bottom:0};function pf(t,e){let r=e?t.left:t.right;return{left:r,right:r,top:t.top,bottom:t.bottom}}function aA(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function lA(t,e,r,n,i,o,s,a){let l=t.ownerDocument,c=l.defaultView;for(let f=t;f;)if(f.nodeType==1){let u,h=f==l.body;if(h)u=aA(c);else{if(f.scrollHeight<=f.clientHeight&&f.scrollWidth<=f.clientWidth){f=f.parentNode;continue}let b=f.getBoundingClientRect();u={left:b.left,right:b.left+f.clientWidth,top:b.top,bottom:b.top+f.clientHeight}}let d=0,p=0;if(i=="nearest")e.top<u.top?(p=-(u.top-e.top+s),r>0&&e.bottom>u.bottom+p&&(p=e.bottom-u.bottom+p+s)):e.bottom>u.bottom&&(p=e.bottom-u.bottom+s,r<0&&e.top-p<u.top&&(p=-(u.top+p-e.top+s)));else{let b=e.bottom-e.top,m=u.bottom-u.top;p=(i=="center"&&b<=m?e.top+b/2-m/2:i=="start"||i=="center"&&r<0?e.top-s:e.bottom-m+s)-u.top}if(n=="nearest"?e.left<u.left?(d=-(u.left-e.left+o),r>0&&e.right>u.right+d&&(d=e.right-u.right+d+o)):e.right>u.right&&(d=e.right-u.right+o,r<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+o))):d=(n=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:n=="start"==a?e.left-o:e.right-(u.right-u.left)+o)-u.left,d||p)if(h)c.scrollBy(d,p);else{if(p){let b=f.scrollTop;f.scrollTop+=p,p=f.scrollTop-b}if(d){let b=f.scrollLeft;f.scrollLeft+=d,d=f.scrollLeft-b}e={left:e.left-d,top:e.top-p,right:e.right-d,bottom:e.bottom-p}}if(h)break;f=f.assignedSlot||f.parentNode,n=i="nearest"}else if(f.nodeType==11)f=f.host;else break}var Rd=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,r,n,i){this.anchorNode=e,this.anchorOffset=r,this.focusNode=n,this.focusOffset=i}},zo=null;function db(t){if(t.setActive)return t.setActive();if(zo)return t.focus(zo);let e=[];for(let r=t;r&&(e.push(r,r.scrollTop,r.scrollLeft),r!=r.ownerDocument);r=r.parentNode);if(t.focus(zo==null?{get preventScroll(){return zo={preventScroll:!0},!0}}:void 0),!zo){zo=!1;for(let r=0;r<e.length;){let n=e[r++],i=e[r++],o=e[r++];n.scrollTop!=i&&(n.scrollTop=i),n.scrollLeft!=o&&(n.scrollLeft=o)}}}var O0;function Aa(t,e,r=e){let n=O0||(O0=document.createRange());return n.setEnd(t,r),n.setStart(t,e),n}function va(t,e,r){let n={key:e,code:e,keyCode:r,which:r,cancelable:!0},i=new KeyboardEvent("keydown",n);i.synthetic=!0,t.dispatchEvent(i);let o=new KeyboardEvent("keyup",n);return o.synthetic=!0,t.dispatchEvent(o),i.defaultPrevented||o.defaultPrevented}function cA(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function pb(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}var ze=class{constructor(e,r,n=!0){this.node=e,this.offset=r,this.precise=n}static before(e,r){return new ze(e.parentNode,Ed(e),r)}static after(e,r){return new ze(e.parentNode,Ed(e)+1,r)}},hp=[],ve=class{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let r=this.posAtStart;for(let n of this.children){if(n==e)return r;r+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,r){return null}sync(e){if(this.dirty&2){let r=this.dom,n=null,i;for(let o of this.children){if(o.dirty){if(!o.dom&&(i=n?n.nextSibling:r.firstChild)){let s=ve.get(i);(!s||!s.parent&&s.constructor==o.constructor)&&o.reuseDOM(i)}o.sync(e),o.dirty=0}if(i=n?n.nextSibling:r.firstChild,e&&!e.written&&e.node==r&&i!=o.dom&&(e.written=!0),o.dom.parentNode==r)for(;i&&i!=o.dom;)i=E0(i);else r.insertBefore(o.dom,i);n=o.dom}for(i=n?n.nextSibling:r.firstChild,i&&e&&e.node==r&&(e.written=!0);i;)i=E0(i)}else if(this.dirty&1)for(let r of this.children)r.dirty&&(r.sync(e),r.dirty=0)}reuseDOM(e){}localPosFromDOM(e,r){let n;if(e==this.dom)n=this.dom.childNodes[r];else{let i=Xc(e)==0?0:r==0?-1:1;for(;;){let o=e.parentNode;if(o==this.dom)break;i==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?i=-1:i=1),e=o}i<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!ve.get(n);)n=n.nextSibling;if(!n)return this.length;for(let i=0,o=0;;i++){let s=this.children[i];if(s.dom==n)return o;o+=s.length+s.breakAfter}}domBoundsAround(e,r,n=0){let i=-1,o=-1,s=-1,a=-1;for(let l=0,c=n,f=n;l<this.children.length;l++){let u=this.children[l],h=c+u.length;if(c<e&&h>r)return u.domBoundsAround(e,r,c);if(h>=e&&i==-1&&(i=l,o=c),c>r&&u.dom.parentNode==this.dom){s=l,a=f;break}f=h,c=h+u.breakAfter}return{from:o,to:a<0?n+this.length:a,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let r=this.parent;r;r=r.parent){if(e&&(r.dirty|=2),r.dirty&1)return;r.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let r=e.parent;if(!r)return e;e=r}}replaceChildren(e,r,n=hp){this.markDirty();for(let i=e;i<r;i++){let o=this.children[i];o.parent==this&&o.destroy()}this.children.splice(e,r-e,...n);for(let i=0;i<n.length;i++)n[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Qc(this.children,e,this.children.length)}childPos(e,r=1){return this.childCursor().findPos(e,r)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,r,n,i,o,s){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}};ve.prototype.breakAfter=0;function E0(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}var Qc=class{constructor(e,r,n){this.children=e,this.pos=r,this.i=n,this.off=0}findPos(e,r=1){for(;;){if(e>this.pos||e==this.pos&&(r>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}};function mb(t,e,r,n,i,o,s,a,l){let{children:c}=t,f=c.length?c[e]:null,u=o.length?o[o.length-1]:null,h=u?u.breakAfter:s;if(!(e==n&&f&&!s&&!h&&o.length<2&&f.merge(r,i,o.length?u:null,r==0,a,l))){if(n<c.length){let d=c[n];d&&i<d.length?(e==n&&(d=d.split(i),i=0),!h&&u&&d.merge(0,i,u,!0,0,l)?o[o.length-1]=d:(i&&d.merge(0,i,null,!1,0,l),o.push(d))):d?.breakAfter&&(u?u.breakAfter=1:s=1),n++}for(f&&(f.breakAfter=s,r>0&&(!s&&o.length&&f.merge(r,f.length,o[0],!1,a,0)?f.breakAfter=o.shift().breakAfter:(r<f.length||f.children.length&&f.children[f.children.length-1].length==0)&&f.merge(r,f.length,null,!1,a,0),e++));e<n&&o.length;)if(c[n-1].become(o[o.length-1]))n--,o.pop(),l=o.length?0:a;else if(c[e].become(o[0]))e++,o.shift(),a=o.length?0:l;else break;!o.length&&e&&n<c.length&&!c[e-1].breakAfter&&c[n].merge(0,0,c[e-1],!1,a,l)&&e--,(e<n||o.length)&&t.replaceChildren(e,n,o)}}function gb(t,e,r,n,i,o){let s=t.childCursor(),{i:a,off:l}=s.findPos(r,1),{i:c,off:f}=s.findPos(e,-1),u=e-r;for(let h of n)u+=h.length;t.length+=u,mb(t,c,f,a,l,n,0,i,o)}var Dt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Md=typeof document<"u"?document:{documentElement:{style:{}}},Dd=/Edge\/(\d+)/.exec(Dt.userAgent),yb=/MSIE \d/.test(Dt.userAgent),Nd=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Dt.userAgent),mf=!!(yb||Nd||Dd),R0=!mf&&/gecko\/(\d+)/i.test(Dt.userAgent),kd=!mf&&/Chrome\/(\d+)/.exec(Dt.userAgent),M0="webkitFontSmoothing"in Md.documentElement.style,bb=!mf&&/Apple Computer/.test(Dt.vendor),D0=bb&&(/Mobile\/\w+/.test(Dt.userAgent)||Dt.maxTouchPoints>2),F={mac:D0||/Mac/.test(Dt.platform),windows:/Win/.test(Dt.platform),linux:/Linux|X11/.test(Dt.platform),ie:mf,ie_version:yb?Md.documentMode||6:Nd?+Nd[1]:Dd?+Dd[1]:0,gecko:R0,gecko_version:R0?+(/Firefox\/(\d+)/.exec(Dt.userAgent)||[0,0])[1]:0,chrome:!!kd,chrome_version:kd?+kd[1]:0,ios:D0,android:/Android\b/.test(Dt.userAgent),webkit:M0,safari:bb,webkit_version:M0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Md.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"},fA=256,Fr=class extends ve{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,r,n){return n&&(!(n instanceof Fr)||this.length-(r-e)+n.length>fA)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(r),this.markDirty(),!0)}split(e){let r=new Fr(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),r}localPosFromDOM(e,r){return e==this.dom?r:r?this.text.length:0}domAtPos(e){return new ze(this.dom,e)}domBoundsAround(e,r,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,r){return Pd(this.dom,e,r)}},Zt=class extends ve{constructor(e,r=[],n=0){super(),this.mark=e,this.children=r,this.length=n;for(let i of r)i.setParent(this)}setAttrs(e){if(pb(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let r in this.mark.attrs)e.setAttribute(r,this.mark.attrs[r]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,r,n,i,o,s){return n&&(!(n instanceof Zt&&n.mark.eq(this.mark))||e&&o<=0||r<this.length&&s<=0)?!1:(gb(this,e,r,n?n.children:[],o-1,s-1),this.markDirty(),!0)}split(e){let r=[],n=0,i=-1,o=0;for(let a of this.children){let l=n+a.length;l>e&&r.push(n<e?a.split(e-n):a),i<0&&n>=e&&(i=o),n=l,o++}let s=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new Zt(this.mark,r,s)}domAtPos(e){return vb(this.dom,this.children,e)}coordsAt(e,r){return xb(this,e,r)}};function Pd(t,e,r){let n=t.nodeValue.length;e>n&&(e=n);let i=e,o=e,s=0;e==0&&r<0||e==n&&r>=0?F.chrome||F.gecko||(e?(i--,s=1):(o++,s=-1)):r<0?i--:o++;let a=Aa(t,i,o).getClientRects();if(!a.length)return hb;let l=a[(s?s<0:r>=0)?0:a.length-1];return F.safari&&!s&&l.width==0&&(l=Array.prototype.find.call(a,c=>c.width)||l),s?pf(l,s<0):l||null}var $r=class extends ve{constructor(e,r,n){super(),this.widget=e,this.length=r,this.side=n,this.prevWidget=null}static create(e,r,n){return new(e.customView||$r)(e,r,n)}split(e){let r=$r.create(this.widget,this.length-e,this.side);return this.length-=e,r}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,r,n,i,o,s){return n&&(!(n instanceof $r)||!this.widget.compare(n.widget)||e>0&&o<=0||r<this.length&&s<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-r),!0)}become(e){return e.length==this.length&&e instanceof $r&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return ee.empty;let e=this;for(;e.parent;)e=e.parent;let r=e.editorView,n=r&&r.state.doc,i=this.posAtStart;return n?n.slice(i,i+this.length):ee.empty}domAtPos(e){return e==0?ze.before(this.dom):ze.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,r){let n=this.dom.getClientRects(),i=null;if(!n.length)return hb;for(let o=e>0?n.length-1:0;i=n[o],!(e>0?o==0:o==n.length-1||i.top<i.bottom);o+=e>0?-1:1);return e==0&&r>0||e==this.length&&r<=0?i:pf(i,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},ef=class extends $r{domAtPos(e){let{topView:r,text:n}=this.widget;return r?Ld(e,0,r,n,(i,o)=>i.domAtPos(o),i=>new ze(n,Math.min(i,n.nodeValue.length))):new ze(n,Math.min(e,n.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,r){let{topView:n,text:i}=this.widget;return n?kb(e,r,n,i):Math.min(r,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,r){let{topView:n,text:i}=this.widget;return n?Ld(e,r,n,i,(o,s,a)=>o.coordsAt(s,a),(o,s)=>Pd(i,o,s)):Pd(i,e,r)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}};function Ld(t,e,r,n,i,o){if(r instanceof Zt){for(let s of r.children){let a=Ho(s.dom,n),l=a?n.nodeValue.length:s.length;if(t<l||t==l&&s.getSide()<=0)return a?Ld(t,e,s,n,i,o):i(s,t,e);t-=l}return i(r,r.length,-1)}else return r.dom==n?o(t,e):i(r,t,e)}function kb(t,e,r,n){if(r instanceof Zt)for(let i of r.children){let o=0,s=Ho(i.dom,n);if(Ho(i.dom,t))return o+(s?kb(t,e,i,n):i.localPosFromDOM(t,e));o+=s?n.nodeValue.length:i.length}else if(r.dom==n)return Math.min(e,n.nodeValue.length);return r.localPosFromDOM(t,e)}var jn=class extends ve{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof jn&&e.side==this.side}split(){return new jn(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return ze.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let r=this.dom.getBoundingClientRect(),n=uA(this,this.side>0?-1:1);return n&&n.top<r.bottom&&n.bottom>r.top?{left:r.left,right:r.right,top:n.top,bottom:n.bottom}:r}get overrideDOMText(){return ee.empty}};Fr.prototype.children=$r.prototype.children=jn.prototype.children=hp;function uA(t,e){let r=t.parent,n=r?r.children.indexOf(t):-1;for(;r&&n>=0;)if(e<0?n>0:n<r.children.length){let i=r.children[n+e];if(i instanceof Fr){let o=i.coordsAt(e<0?i.length:0,e);if(o)return o}n+=e}else if(r instanceof Zt&&r.parent)n=r.parent.children.indexOf(r)+(e<0?0:1),r=r.parent;else{let i=r.dom.lastChild;if(i&&i.nodeName=="BR")return i.getClientRects()[0];break}}function vb(t,e,r){let n=0;for(let i=0;n<e.length;n++){let o=e[n],s=i+o.length;if(!(s==i&&o.getSide()<=0)){if(r>i&&r<s&&o.dom.parentNode==t)return o.domAtPos(r-i);if(r<=i)break;i=s}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==t)return ze.after(i)}return new ze(t,0)}function wb(t,e,r){let n,{children:i}=t;r>0&&e instanceof Zt&&i.length&&(n=i[i.length-1])instanceof Zt&&n.mark.eq(e.mark)?wb(n,e.children[0],r-1):(i.push(e),e.setParent(t)),t.length+=e.length}function xb(t,e,r){for(let o=0,s=0;s<t.children.length;s++){let a=t.children[s],l=o+a.length,c;if((r<=0||l==t.length||a.getSide()>0?l>=e:l>e)&&(e<l||s+1==t.children.length||(c=t.children[s+1]).length||c.getSide()>0)){let f=0;if(l==o){if(a.getSide()<=0)continue;f=r=-a.getSide()}let u=a.coordsAt(Math.max(0,e-o),r);return f&&u?pf(u,r<0):u}o=l}let n=t.dom.lastChild;if(!n)return t.dom.getBoundingClientRect();let i=Ca(n);return i[i.length-1]||null}function Id(t,e){for(let r in t)r=="class"&&e.class?e.class+=" "+t.class:r=="style"&&e.style?e.style+=";"+t.style:e[r]=t[r];return e}function dp(t,e){if(t==e)return!0;if(!t||!e)return!1;let r=Object.keys(t),n=Object.keys(e);if(r.length!=n.length)return!1;for(let i of r)if(n.indexOf(i)==-1||t[i]!==e[i])return!1;return!0}function Bd(t,e,r){let n=null;if(e)for(let i in e)r&&i in r||t.removeAttribute(n=i);if(r)for(let i in r)e&&e[i]==r[i]||t.setAttribute(n=i,r[i]);return!!n}var Nt=class{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}},he=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(he||(he={})),$=class extends kr{constructor(e,r,n,i){super(),this.startSide=e,this.endSide=r,this.widget=n,this.spec=i}get heightRelevant(){return!1}static mark(e){return new Wo(e)}static widget(e){let r=e.side||0,n=!!e.block;return r+=n?r>0?3e8:-4e8:r>0?1e8:-1e8,new mn(e,r,r,n,e.widget||null,!1)}static replace(e){let r=!!e.block,n,i;if(e.isBlockGap)n=-5e8,i=4e8;else{let{start:o,end:s}=Sb(e,r);n=(o?r?-3e8:-1:5e8)-1,i=(s?r?2e8:1:-6e8)+1}return new mn(e,n,i,r,e.widget||null,!0)}static line(e){return new Pi(e)}static set(e,r=!1){return te.of(e,r)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};$.none=te.empty;var Wo=class extends ${constructor(e){let{start:r,end:n}=Sb(e);super(r?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof Wo&&this.tagName==e.tagName&&this.class==e.class&&dp(this.attrs,e.attrs)}range(e,r=e){if(e>=r)throw new RangeError("Mark decorations may not be empty");return super.range(e,r)}};Wo.prototype.point=!1;var Pi=class extends ${constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Pi&&dp(this.spec.attributes,e.spec.attributes)}range(e,r=e){if(r!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,r)}};Pi.prototype.mapMode=Je.TrackBefore;Pi.prototype.point=!0;var mn=class extends ${constructor(e,r,n,i,o,s){super(r,n,o,e),this.block=i,this.isReplace=s,this.mapMode=i?r<=0?Je.TrackBefore:Je.TrackAfter:Je.TrackDel}get type(){return this.startSide<this.endSide?he.WidgetRange:this.startSide<=0?he.WidgetBefore:he.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof mn&&hA(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,r=e){if(this.isReplace&&(e>r||e==r&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&r!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,r)}};mn.prototype.point=!0;function Sb(t,e=!1){let{inclusiveStart:r,inclusiveEnd:n}=t;return r==null&&(r=t.inclusive),n==null&&(n=t.inclusive),{start:r??e,end:n??e}}function hA(t,e){return t==e||!!(t&&e&&t.compare(e))}function jd(t,e,r,n=0){let i=r.length-1;i>=0&&r[i]+n>=t?r[i]=Math.max(r[i],e):r.push(t,e)}var Ye=class extends ve{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,r,n,i,o,s){if(n){if(!(n instanceof Ye))return!1;this.dom||n.transferDOM(this)}return i&&this.setDeco(n?n.attrs:null),gb(this,e,r,n?n.children:[],o,s),!0}split(e){let r=new Ye;if(r.breakAfter=this.breakAfter,this.length==0)return r;let{i:n,off:i}=this.childPos(e);i&&(r.append(this.children[n].split(i),0),this.children[n].merge(i,this.children[n].length,null,!1,0,0),n++);for(let o=n;o<this.children.length;o++)r.append(this.children[o],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,r}transferDOM(e){this.dom&&(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){dp(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,r){wb(this,e,r)}addLineDeco(e){let r=e.spec.attributes,n=e.spec.class;r&&(this.attrs=Id(r,this.attrs||{})),n&&(this.attrs=Id({class:n},this.attrs||{}))}domAtPos(e){return vb(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var r;this.dom?this.dirty&4&&(pb(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Bd(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let n=this.dom.lastChild;for(;n&&ve.get(n)instanceof Zt;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((r=ve.get(n))===null||r===void 0?void 0:r.isEditable)==!1&&(!F.ios||!this.children.some(i=>i instanceof Fr))){let i=document.createElement("BR");i.cmIgnore=!0,this.dom.appendChild(i)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let r of this.children){if(!(r instanceof Fr))return null;let n=Ca(r.dom);if(n.length!=1)return null;e+=n[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,r){return xb(this,e,r)}become(e){return!1}get type(){return he.Text}static find(e,r){for(let n=0,i=0;n<e.children.length;n++){let o=e.children[n],s=i+o.length;if(s>=r){if(o instanceof Ye)return o;if(s>r)break}i=s+o.breakAfter}return null}},pn=class extends ve{constructor(e,r,n){super(),this.widget=e,this.length=r,this.type=n,this.breakAfter=0,this.prevWidget=null}merge(e,r,n,i,o,s){return n&&(!(n instanceof pn)||!this.widget.compare(n.widget)||e>0&&o<=0||r<this.length&&s<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-r),!0)}domAtPos(e){return e==0?ze.before(this.dom):ze.after(this.dom,e==this.length)}split(e){let r=this.length-e;this.length=e;let n=new pn(this.widget,r,this.type);return n.breakAfter=this.breakAfter,n}get children(){return hp}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):ee.empty}domBoundsAround(){return null}become(e){return e instanceof pn&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},Ta=class{constructor(e,r,n,i){this.doc=e,this.pos=r,this.end=n,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=r}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof pn&&e.type==he.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ye),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(Hc(new jn(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,r,n){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:s,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(s){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=o,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(r.slice(0,n)),this.getLine().append(Hc(new Fr(this.text.slice(this.textOff,this.textOff+i)),r),n),this.atCursorPos=!0,this.textOff+=i,e-=i,n=0}}span(e,r,n,i){this.buildText(r-e,n,i),this.pos=r,this.openStart<0&&(this.openStart=i)}point(e,r,n,i,o,s){if(this.disallowBlockEffectsFor[s]&&n instanceof mn){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(r>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=r-e;if(n instanceof mn)if(n.block){let{type:l}=n;l==he.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new pn(n.widget||new tf("div"),a,l))}else{let l=$r.create(n.widget||new tf("span"),a,n.startSide),c=this.atCursorPos&&!l.isEditable&&o<=i.length&&(e<r||n.startSide>0),f=!l.isEditable&&(e<r||n.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!c&&(this.pendingBuffer=0),this.flushBuffer(i),c&&(u.append(Hc(new jn(1),i),o),o=i.length+Math.max(0,o-i.length)),u.append(Hc(l,i),o),this.atCursorPos=f,this.pendingBuffer=f?e<r?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=r),this.openStart<0&&(this.openStart=o)}static build(e,r,n,i,o){let s=new Ta(e,r,n,o);return s.openEnd=te.spans(i,r,n,s),s.openStart<0&&(s.openStart=s.openEnd),s.finish(s.openEnd),s}};function Hc(t,e){for(let r of e)t=new Zt(r,[t],t.length);return t}var tf=class extends Nt{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}},_b=j.define(),Cb=j.define(),Ab=j.define(),Tb=j.define(),$d=j.define(),Ob=j.define(),Eb=j.define({combine:t=>t.some(e=>e)}),qo=class{constructor(e,r="nearest",n="nearest",i=5,o=5){this.range=e,this.y=r,this.x=n,this.yMargin=i,this.xMargin=o}map(e){return e.empty?this:new qo(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}},N0=W.define({map:(t,e)=>t.map(e)});function at(t,e,r){let n=t.facet(Tb);n.length?n[0](e):window.onerror?window.onerror(String(e),r,void 0,void 0,e):r?console.error(r+":",e):console.error(e)}var Ma=j.define({combine:t=>t.length?t[0]:!0}),dA=0,ma=j.define(),de=class{constructor(e,r,n,i){this.id=e,this.create=r,this.domEventHandlers=n,this.extension=i(this)}static define(e,r){let{eventHandlers:n,provide:i,decorations:o}=r||{};return new de(dA++,e,n,s=>{let a=[ma.of(s)];return o&&a.push(Oa.of(l=>{let c=l.plugin(s);return c?o(c):$.none})),i&&a.push(i(s)),a})}static fromClass(e,r){return de.define(n=>new e(n),r)}},wa=class{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let r=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(r)}catch(n){if(at(r.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(r){at(e.state,r,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var r;if(!((r=this.value)===null||r===void 0)&&r.destroy)try{this.value.destroy()}catch(n){at(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}},Rb=j.define(),Mb=j.define(),Oa=j.define(),Db=j.define(),Nb=j.define(),ga=j.define(),vr=class{constructor(e,r,n,i){this.fromA=e,this.toA=r,this.fromB=n,this.toB=i}join(e){return new vr(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let r=e.length,n=this;for(;r>0;r--){let i=e[r-1];if(!(i.fromA>n.toA)){if(i.toA<n.fromA)break;n=n.join(i),e.splice(r-1,1)}}return e.splice(r,0,n),e}static extendWithRanges(e,r){if(r.length==0)return e;let n=[];for(let i=0,o=0,s=0,a=0;;i++){let l=i==e.length?null:e[i],c=s-a,f=l?l.fromB:1e9;for(;o<r.length&&r[o]<f;){let u=r[o],h=r[o+1],d=Math.max(a,u),p=Math.min(f,h);if(d<=p&&new vr(d+c,p+c,d,p).addToSet(n),h>f)break;o+=2}if(!l)return n;new vr(l.fromA,l.toA,l.fromB,l.toB).addToSet(n),s=l.toA,a=l.toB}}},Ko=class{constructor(e,r,n){this.view=e,this.state=r,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=Ce.empty(this.startState.doc.length);for(let s of n)this.changes=this.changes.compose(s.changes);let i=[];this.changes.iterChangedRanges((s,a,l,c)=>i.push(new vr(s,a,l,c))),this.changedRanges=i;let o=e.hasFocus;o!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=o,this.flags|=1)}static create(e,r,n){return new Ko(e,r,n)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}},ye=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(ye||(ye={})),zd=ye.LTR,pA=ye.RTL;function Pb(t){let e=[];for(let r=0;r<t.length;r++)e.push(1<<+t[r]);return e}var mA=Pb("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),gA=Pb("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Fd=Object.create(null),jr=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),r=t.charCodeAt(1);Fd[e]=r,Fd[r]=-e}function yA(t){return t<=247?mA[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?gA[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8203||t==8204?256:1}var bA=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,Bn=class{constructor(e,r,n){this.from=e,this.to=r,this.level=n}get dir(){return this.level%2?pA:zd}side(e,r){return this.dir==r==e?this.to:this.from}static find(e,r,n,i){let o=-1;for(let s=0;s<e.length;s++){let a=e[s];if(a.from<=r&&a.to>=r){if(a.level==n)return s;(o<0||(i!=0?i<0?a.from<r:a.to>r:e[o].level>a.level))&&(o=s)}}if(o<0)throw new RangeError("Index out of range");return o}},Se=[];function kA(t,e){let r=t.length,n=e==zd?1:2,i=e==zd?2:1;if(!t||n==1&&!bA.test(t))return Lb(r);for(let s=0,a=n,l=n;s<r;s++){let c=yA(t.charCodeAt(s));c==512?c=a:c==8&&l==4&&(c=16),Se[s]=c==4?2:c,c&7&&(l=c),a=c}for(let s=0,a=n,l=n;s<r;s++){let c=Se[s];if(c==128)s<r-1&&a==Se[s+1]&&a&24?c=Se[s]=a:Se[s]=256;else if(c==64){let f=s+1;for(;f<r&&Se[f]==64;)f++;let u=s&&a==8||f<r&&Se[f]==8?l==1?1:8:256;for(let h=s;h<f;h++)Se[h]=u;s=f-1}else c==8&&l==1&&(Se[s]=1);a=c,c&7&&(l=c)}for(let s=0,a=0,l=0,c,f,u;s<r;s++)if(f=Fd[c=t.charCodeAt(s)])if(f<0){for(let h=a-3;h>=0;h-=3)if(jr[h+1]==-f){let d=jr[h+2],p=d&2?n:d&4?d&1?i:n:0;p&&(Se[s]=Se[jr[h]]=p),a=h;break}}else{if(jr.length==189)break;jr[a++]=s,jr[a++]=c,jr[a++]=l}else if((u=Se[s])==2||u==1){let h=u==n;l=h?0:1;for(let d=a-3;d>=0;d-=3){let p=jr[d+2];if(p&2)break;if(h)jr[d+2]|=2;else{if(p&4)break;jr[d+2]|=4}}}for(let s=0;s<r;s++)if(Se[s]==256){let a=s+1;for(;a<r&&Se[a]==256;)a++;let l=(s?Se[s-1]:n)==1,c=(a<r?Se[a]:n)==1,f=l==c?l?1:2:n;for(let u=s;u<a;u++)Se[u]=f;s=a-1}let o=[];if(n==1)for(let s=0;s<r;){let a=s,l=Se[s++]!=1;for(;s<r&&l==(Se[s]!=1);)s++;if(l)for(let c=s;c>a;){let f=c,u=Se[--c]!=2;for(;c>a&&u==(Se[c-1]!=2);)c--;o.push(new Bn(c,f,u?2:1))}else o.push(new Bn(a,s,0))}else for(let s=0;s<r;){let a=s,l=Se[s++]==2;for(;s<r&&l==(Se[s]==2);)s++;o.push(new Bn(a,s,l?1:2))}return o}function Lb(t){return[new Bn(0,t,0)]}var Ib="";function vA(t,e,r,n,i){var o;let s=n.head-t.from,a=-1;if(s==0){if(!i||!t.length)return null;e[0].level!=r&&(s=e[0].side(!1,r),a=0)}else if(s==t.length){if(i)return null;let h=e[e.length-1];h.level!=r&&(s=h.side(!0,r),a=e.length-1)}a<0&&(a=Bn.find(e,s,(o=n.bidiLevel)!==null&&o!==void 0?o:-1,n.assoc));let l=e[a];s==l.side(i,r)&&(l=e[a+=i?1:-1],s=l.side(!i,r));let c=i==(l.dir==r),f=mt(t.text,s,c);if(Ib=t.text.slice(Math.min(s,f),Math.max(s,f)),f!=l.side(i,r))return A.cursor(f+t.from,c?-1:1,l.level);let u=a==(i?e.length-1:0)?null:e[a+(i?1:-1)];return!u&&l.level!=r?A.cursor(i?t.to:t.from,i?-1:1,r):u&&u.level<l.level?A.cursor(u.side(!i,r)+t.from,i?1:-1,u.level):A.cursor(f+t.from,i?-1:1,l.level)}var In="\uFFFF",rf=class{constructor(e,r){this.points=e,this.text="",this.lineSeparator=r.facet(G.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=In}readRange(e,r){if(!e)return this;let n=e.parentNode;for(let i=e;;){this.findPointBefore(n,i),this.readNode(i);let o=i.nextSibling;if(o==r)break;let s=ve.get(i),a=ve.get(o);(s&&a?s.breakAfter:(s?s.breakAfter:P0(i))||P0(o)&&(i.nodeName!="BR"||i.cmIgnore))&&this.lineBreak(),i=o}return this.findPointBefore(n,r),this}readTextNode(e){let r=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,r.length));for(let n=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let o=-1,s=1,a;if(this.lineSeparator?(o=r.indexOf(this.lineSeparator,n),s=this.lineSeparator.length):(a=i.exec(r))&&(o=a.index,s=a[0].length),this.append(r.slice(n,o<0?r.length:o)),o<0)break;if(this.lineBreak(),s>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=s-1);n=o+s}}readNode(e){if(e.cmIgnore)return;let r=ve.get(e),n=r&&r.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let i=n.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,r){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==r&&(n.pos=this.text.length)}findPointInside(e,r){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+Math.min(r,n.offset))}};function P0(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}var nf=class{constructor(e,r){this.node=e,this.offset=r,this.pos=-1}},of=class extends ve{constructor(e){super(),this.view=e,this.compositionDeco=$.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ye],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new vr(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:s,toA:a})=>a<this.minWidthFrom||s>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=$.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=xA(this.view,e.changes)),(F.ie||F.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let n=this.decorations,i=this.updateDeco(),o=_A(n,i,e.changes);return r=vr.extendWithRanges(r,o),this.dirty==0&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,r);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let o=F.chrome||F.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(o),this.dirty=0,o&&(o.written||n.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""});let i=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof pn&&o.widget instanceof sf&&i.push(o.dom);n.updateGaps(i)}updateChildren(e,r){let n=this.childCursor(r);for(let i=e.length-1;;i--){let o=i>=0?e[i]:null;if(!o)break;let{fromA:s,toA:a,fromB:l,toB:c}=o,{content:f,breakAtStart:u,openStart:h,openEnd:d}=Ta.build(this.view.state.doc,l,c,this.decorations,this.dynamicDecorationMap),{i:p,off:b}=n.findPos(a,1),{i:m,off:k}=n.findPos(s,-1);mb(this,m,k,p,b,f,u,h,d)}}updateSelection(e=!1,r=!1){if(e&&this.view.observer.readSelectionRange(),!(r||this.mayControlSelection())||F.ios&&this.view.inputState.rapidCompositionStart)return;let n=this.forceSelection;this.forceSelection=!1;let i=this.view.state.selection.main,o=this.domAtPos(i.anchor),s=i.empty?o:this.domAtPos(i.head);if(F.gecko&&i.empty&&wA(o)){let l=document.createTextNode("");this.view.observer.ignore(()=>o.node.insertBefore(l,o.node.childNodes[o.offset]||null)),o=s=new ze(l,0),n=!0}let a=this.view.observer.selectionRange;(n||!a.focusNode||!Yc(o.node,o.offset,a.anchorNode,a.anchorOffset)||!Yc(s.node,s.offset,a.focusNode,a.focusOffset))&&(this.view.observer.ignore(()=>{F.android&&F.chrome&&this.dom.contains(a.focusNode)&&CA(a.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let l=Jc(this.root);if(i.empty){if(F.gecko){let c=SA(o.node,o.offset);if(c&&c!=3){let f=jb(o.node,o.offset,c==1?1:-1);f&&(o=new ze(f,c==1?0:f.nodeValue.length))}}l.collapse(o.node,o.offset),i.bidiLevel!=null&&a.cursorBidiLevel!=null&&(a.cursorBidiLevel=i.bidiLevel)}else if(l.extend)l.collapse(o.node,o.offset),l.extend(s.node,s.offset);else{let c=document.createRange();i.anchor>i.head&&([o,s]=[s,o]),c.setEnd(s.node,s.offset),c.setStart(o.node,o.offset),l.removeAllRanges(),l.addRange(c)}}),this.view.observer.setSelectionRange(o,s)),this.impreciseAnchor=o.precise?null:new ze(a.anchorNode,a.anchorOffset),this.impreciseHead=s.precise?null:new ze(a.focusNode,a.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,r=Jc(this.root);if(!e.empty||!e.assoc||!r.modify)return;let n=Ye.find(this,e.head);if(!n)return;let i=n.posAtStart;if(e.head==i||e.head==i+n.length)return;let o=this.coordsAt(e.head,-1),s=this.coordsAt(e.head,1);if(!o||!s||o.bottom>s.top)return;let a=this.domAtPos(e.head+e.assoc);r.collapse(a.node,a.offset),r.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ma)?this.root.activeElement==this.dom:Od(this.dom,this.view.observer.selectionRange)}nearest(e){for(let r=e;r;){let n=ve.get(r);if(n&&n.rootView==this)return n;r=r.parentNode}return null}posFromDOM(e,r){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,r)+n.posAtStart}domAtPos(e){let{i:r,off:n}=this.childCursor().findPos(e,-1);for(;r<this.children.length-1;){let i=this.children[r];if(n<i.length||i instanceof Ye)break;r++,n=0}return this.children[r].domAtPos(n)}coordsAt(e,r){for(let n=this.length,i=this.children.length-1;;i--){let o=this.children[i],s=n-o.breakAfter-o.length;if(e>s||e==s&&o.type!=he.WidgetBefore&&o.type!=he.WidgetAfter&&(!i||r==2||this.children[i-1].breakAfter||this.children[i-1].type==he.WidgetBefore&&r>-2))return o.coordsAt(e-s,r);n=s}}measureVisibleLineHeights(e){let r=[],{from:n,to:i}=e,o=this.view.contentDOM.clientWidth,s=o>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==ye.LTR;for(let c=0,f=0;f<this.children.length;f++){let u=this.children[f],h=c+u.length;if(h>i)break;if(c>=n){let d=u.dom.getBoundingClientRect();if(r.push(d.height),s){let p=u.dom.lastChild,b=p?Ca(p):[];if(b.length){let m=b[b.length-1],k=l?m.right-d.left:d.right-m.left;k>a&&(a=k,this.minWidth=o,this.minWidthFrom=c,this.minWidthTo=h)}}}c=h+u.breakAfter}return r}textDirectionAt(e){let{i:r}=this.childPos(e,1);return getComputedStyle(this.children[r].dom).direction=="rtl"?ye.RTL:ye.LTR}measureTextSize(){for(let i of this.children)if(i instanceof Ye){let o=i.measureTextSize();if(o)return o}let e=document.createElement("div"),r,n;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let i=Ca(e.firstChild)[0];r=e.getBoundingClientRect().height,n=i?i.width/27:7,e.remove()}),{lineHeight:r,charWidth:n}}childCursor(e=this.length){let r=this.children.length;return r&&(e-=this.children[--r].length),new Qc(this.children,e,r)}computeBlockGapDeco(){let e=[],r=this.view.viewState;for(let n=0,i=0;;i++){let o=i==r.viewports.length?null:r.viewports[i],s=o?o.from-1:this.length;if(s>n){let a=r.lineBlockAt(s).bottom-r.lineBlockAt(n).top;e.push($.replace({widget:new sf(a),block:!0,inclusive:!0,isBlockGap:!0}).range(n,s))}if(!o)break;n=o.to+1}return $.set(e)}updateDeco(){let e=this.view.state.facet(Oa).map((r,n)=>(this.dynamicDecorationMap[n]=typeof r=="function")?r(this.view):r);for(let r=e.length;r<e.length+3;r++)this.dynamicDecorationMap[r]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:r}=e,n=this.coordsAt(r.head,r.empty?r.assoc:r.head>r.anchor?-1:1),i;if(!n)return;!r.empty&&(i=this.coordsAt(r.anchor,r.anchor>r.head?-1:1))&&(n={left:Math.min(n.left,i.left),top:Math.min(n.top,i.top),right:Math.max(n.right,i.right),bottom:Math.max(n.bottom,i.bottom)});let o=0,s=0,a=0,l=0;for(let f of this.view.state.facet(Nb).map(u=>u(this.view)))if(f){let{left:u,right:h,top:d,bottom:p}=f;u!=null&&(o=Math.max(o,u)),h!=null&&(s=Math.max(s,h)),d!=null&&(a=Math.max(a,d)),p!=null&&(l=Math.max(l,p))}let c={left:n.left-o,top:n.top-a,right:n.right+s,bottom:n.bottom+l};lA(this.view.scrollDOM,c,r.head<r.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==ye.LTR)}};function wA(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}var sf=class extends Nt{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function Bb(t){let e=t.observer.selectionRange,r=e.focusNode&&jb(e.focusNode,e.focusOffset,0);if(!r)return null;let n=t.docView.nearest(r);if(!n)return null;if(n instanceof Ye){let i=r;for(;i.parentNode!=n.dom;)i=i.parentNode;let o=i.previousSibling;for(;o&&!ve.get(o);)o=o.previousSibling;let s=o?ve.get(o).posAtEnd:n.posAtStart;return{from:s,to:s,node:i,text:r}}else{for(;;){let{parent:o}=n;if(!o)return null;if(o instanceof Ye)break;n=o}let i=n.posAtStart;return{from:i,to:i+n.length,node:n.dom,text:r}}}function xA(t,e){let r=Bb(t);if(!r)return $.none;let{from:n,to:i,node:o,text:s}=r,a=e.mapPos(n,1),l=Math.max(a,e.mapPos(i,-1)),{state:c}=t,f=o.nodeType==3?o.nodeValue:new rf([],c).readRange(o.firstChild,null).text;if(l-a<f.length)if(c.doc.sliceString(a,Math.min(c.doc.length,a+f.length),In)==f)l=a+f.length;else if(c.doc.sliceString(Math.max(0,l-f.length),l,In)==f)a=l-f.length;else return $.none;else if(c.doc.sliceString(a,l,In)!=f)return $.none;let u=ve.get(o);return u instanceof ef?u=u.widget.topView:u&&(u.parent=null),$.set($.replace({widget:new Vd(o,s,u),inclusive:!0}).range(a,l))}var Vd=class extends Nt{constructor(e,r,n){super(),this.top=e,this.text=r,this.topView=n}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return ef}};function jb(t,e,r){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0&&r<=0)t=t.childNodes[e-1],e=Xc(t);else if(t.nodeType==1&&e<t.childNodes.length&&r>=0)t=t.childNodes[e],e=0;else return null}}function SA(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}var Ud=class{constructor(){this.changes=[]}compareRange(e,r){jd(e,r,this.changes)}comparePoint(e,r){jd(e,r,this.changes)}};function _A(t,e,r){let n=new Ud;return te.compare(t,e,r,n),n.changes}function CA(t,e){for(let r=t;r&&r!=e;r=r.assignedSlot||r.parentNode)if(r.nodeType==1&&r.contentEditable=="false")return!0;return!1}function AA(t,e,r=1){let n=t.charCategorizer(e),i=t.doc.lineAt(e),o=e-i.from;if(i.length==0)return A.cursor(e);o==0?r=1:o==i.length&&(r=-1);let s=o,a=o;r<0?s=mt(i.text,o,!1):a=mt(i.text,o);let l=n(i.text.slice(s,a));for(;s>0;){let c=mt(i.text,s,!1);if(n(i.text.slice(c,s))!=l)break;s=c}for(;a<i.length;){let c=mt(i.text,a);if(n(i.text.slice(a,c))!=l)break;a=c}return A.range(s+i.from,a+i.from)}function TA(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function OA(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function vd(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function L0(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function I0(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Hd(t,e,r){let n,i,o,s,a,l,c,f;for(let d=t.firstChild;d;d=d.nextSibling){let p=Ca(d);for(let b=0;b<p.length;b++){let m=p[b];i&&vd(i,m)&&(m=L0(I0(m,i.bottom),i.top));let k=TA(e,m),S=OA(r,m);if(k==0&&S==0)return d.nodeType==3?B0(d,e,r):Hd(d,e,r);(!n||s>S||s==S&&o>k)&&(n=d,i=m,o=k,s=S),k==0?r>m.bottom&&(!c||c.bottom<m.bottom)?(a=d,c=m):r<m.top&&(!f||f.top>m.top)&&(l=d,f=m):c&&vd(c,m)?c=I0(c,m.bottom):f&&vd(f,m)&&(f=L0(f,m.top))}}if(c&&c.bottom>=r?(n=a,i=c):f&&f.top<=r&&(n=l,i=f),!n)return{node:t,offset:0};let u=Math.max(i.left,Math.min(i.right,e));if(n.nodeType==3)return B0(n,u,r);if(!o&&n.contentEditable=="true")return Hd(n,u,r);let h=Array.prototype.indexOf.call(t.childNodes,n)+(e>=(i.left+i.right)/2?1:0);return{node:t,offset:h}}function B0(t,e,r){let n=t.nodeValue.length,i=-1,o=1e9,s=0;for(let a=0;a<n;a++){let l=Aa(t,a,a+1).getClientRects();for(let c=0;c<l.length;c++){let f=l[c];if(f.top==f.bottom)continue;s||(s=e-f.left);let u=(f.top>r?f.top-r:r-f.bottom)-1;if(f.left-1<=e&&f.right+1>=e&&u<o){let h=e>=(f.left+f.right)/2,d=h;if((F.chrome||F.gecko)&&Aa(t,a).getBoundingClientRect().left==f.right&&(d=!h),u<=0)return{node:t,offset:a+(d?1:0)};i=a+(d?1:0),o=u}}}return{node:t,offset:i>-1?i:s>0?t.nodeValue.length:0}}function $b(t,{x:e,y:r},n,i=-1){var o;let s=t.contentDOM.getBoundingClientRect(),a=s.top+t.viewState.paddingTop,l,{docHeight:c}=t.viewState,f=r-a;if(f<0)return 0;if(f>c)return t.state.doc.length;for(let k=t.defaultLineHeight/2,S=!1;l=t.elementAtHeight(f),l.type!=he.Text;)for(;f=i>0?l.bottom+k:l.top-k,!(f>=0&&f<=c);){if(S)return n?null:0;S=!0,i=-i}r=a+f;let u=l.from;if(u<t.viewport.from)return t.viewport.from==0?0:n?null:j0(t,s,l,e,r);if(u>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:j0(t,s,l,e,r);let h=t.dom.ownerDocument,d=t.root.elementFromPoint?t.root:h,p=d.elementFromPoint(e,r);p&&!t.contentDOM.contains(p)&&(p=null),p||(e=Math.max(s.left+1,Math.min(s.right-1,e)),p=d.elementFromPoint(e,r),p&&!t.contentDOM.contains(p)&&(p=null));let b,m=-1;if(p&&((o=t.docView.nearest(p))===null||o===void 0?void 0:o.isEditable)!=!1){if(h.caretPositionFromPoint){let k=h.caretPositionFromPoint(e,r);k&&({offsetNode:b,offset:m}=k)}else if(h.caretRangeFromPoint){let k=h.caretRangeFromPoint(e,r);k&&({startContainer:b,startOffset:m}=k,F.safari&&EA(b,m,e)&&(b=void 0))}}if(!b||!t.docView.dom.contains(b)){let k=Ye.find(t.docView,u);if(!k)return f>l.top+l.height/2?l.to:l.from;({node:b,offset:m}=Hd(k.dom,e,r))}return t.docView.posFromDOM(b,m)}function j0(t,e,r,n,i){let o=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&r.height>t.defaultLineHeight*1.5){let a=Math.floor((i-r.top)/t.defaultLineHeight);o+=a*t.viewState.heightOracle.lineLength}let s=t.state.sliceDoc(r.from,r.to);return r.from+zc(s,o,t.state.tabSize)}function EA(t,e,r){let n;if(t.nodeType!=3||e!=(n=t.nodeValue.length))return!1;for(let i=t.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return!1;return Aa(t,n-1,n).getBoundingClientRect().left>r}function RA(t,e,r,n){let i=t.state.doc.lineAt(e.head),o=!n||!t.lineWrapping?null:t.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(o){let l=t.dom.getBoundingClientRect(),c=t.textDirectionAt(i.from),f=t.posAtCoords({x:r==(c==ye.LTR)?l.right-1:l.left+1,y:(o.top+o.bottom)/2});if(f!=null)return A.cursor(f,r?-1:1)}let s=Ye.find(t.docView,e.head),a=s?r?s.posAtEnd:s.posAtStart:r?i.to:i.from;return A.cursor(a,r?-1:1)}function $0(t,e,r,n){let i=t.state.doc.lineAt(e.head),o=t.bidiSpans(i),s=t.textDirectionAt(i.from);for(let a=e,l=null;;){let c=vA(i,o,s,a,r),f=Ib;if(!c){if(i.number==(r?t.state.doc.lines:1))return a;f=`
`,i=t.state.doc.line(i.number+(r?1:-1)),o=t.bidiSpans(i),c=A.cursor(r?i.from:i.to)}if(l){if(!l(f))return a}else{if(!n)return c;l=n(f)}a=c}}function MA(t,e,r){let n=t.state.charCategorizer(e),i=n(r);return o=>{let s=n(o);return i==Be.Space&&(i=s),i==s}}function DA(t,e,r,n){let i=e.head,o=r?1:-1;if(i==(r?t.state.doc.length:0))return A.cursor(i,e.assoc);let s=e.goalColumn,a,l=t.contentDOM.getBoundingClientRect(),c=t.coordsAtPos(i),f=t.documentTop;if(c)s==null&&(s=c.left-l.left),a=o<0?c.top:c.bottom;else{let d=t.viewState.lineBlockAt(i);s==null&&(s=Math.min(l.right-l.left,t.defaultCharacterWidth*(i-d.from))),a=(o<0?d.top:d.bottom)+f}let u=l.left+s,h=n??t.defaultLineHeight>>1;for(let d=0;;d+=10){let p=a+(h+d)*o,b=$b(t,{x:u,y:p},!1,o);if(p<l.top||p>l.bottom||(o<0?b<i:b>i))return A.cursor(b,e.assoc,void 0,s)}}function wd(t,e,r){let n=t.state.facet(Db).map(i=>i(t));for(;;){let i=!1;for(let o of n)o.between(r.from-1,r.from+1,(s,a,l)=>{r.from>s&&r.from<a&&(r=e.from>r.from?A.cursor(s,1):A.cursor(a,-1),i=!0)});if(!i)return r}}var Wd=class{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let r in We){let n=We[r];e.contentDOM.addEventListener(r,i=>{!z0(e,i)||this.ignoreDuringComposition(i)||r=="keydown"&&this.keydown(e,i)||(this.mustFlushObserver(i)&&e.observer.forceFlush(),this.runCustomHandlers(r,e,i)?i.preventDefault():n(e,i))}),this.registeredEvents.push(r)}this.notifiedFocused=e.hasFocus,F.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,r){var n;let i;this.customHandlers=[];for(let o of r)if(i=(n=o.update(e).spec)===null||n===void 0?void 0:n.domEventHandlers){this.customHandlers.push({plugin:o.value,handlers:i});for(let s in i)this.registeredEvents.indexOf(s)<0&&s!="scroll"&&(this.registeredEvents.push(s),e.contentDOM.addEventListener(s,a=>{z0(e,a)&&this.runCustomHandlers(s,e,a)&&a.preventDefault()}))}}runCustomHandlers(e,r,n){for(let i of this.customHandlers){let o=i.handlers[e];if(o)try{if(o.call(i.plugin,n,r)||n.defaultPrevented)return!0}catch(s){at(r.state,s)}}return!1}runScrollHandlers(e,r){for(let n of this.customHandlers){let i=n.handlers.scroll;if(i)try{i.call(n.plugin,r,e)}catch(o){at(e.state,o)}}}keydown(e,r){if(this.lastKeyCode=r.keyCode,this.lastKeyTime=Date.now(),r.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(F.android&&F.chrome&&!r.synthetic&&(r.keyCode==13||r.keyCode==8))return e.observer.delayAndroidKey(r.key,r.keyCode),!0;let n;return F.ios&&(n=zb.find(i=>i.keyCode==r.keyCode))&&!(r.ctrlKey||r.altKey||r.metaKey)&&!r.synthetic?(this.pendingIOSKey=n,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let r=this.pendingIOSKey;return r?(this.pendingIOSKey=void 0,va(e.contentDOM,r.key,r.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:F.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!F.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}},zb=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Fb=[16,17,18,20,91,92,224,225],qd=class{constructor(e,r,n,i){this.view=e,this.style=n,this.mustSelect=i,this.lastEvent=r;let o=e.contentDOM.ownerDocument;o.addEventListener("mousemove",this.move=this.move.bind(this)),o.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=r.shiftKey,this.multiple=e.state.facet(G.allowMultipleSelections)&&NA(e,r),this.dragMove=PA(e,r),this.dragging=LA(e,r)&&pp(r)==1?null:!1,this.dragging===!1&&(r.preventDefault(),this.select(r))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let r=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!r.eq(this.view.state.selection)||r.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:r,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}};function NA(t,e){let r=t.state.facet(_b);return r.length?r[0](e):F.mac?e.metaKey:e.ctrlKey}function PA(t,e){let r=t.state.facet(Cb);return r.length?r[0](e):F.mac?!e.altKey:!e.ctrlKey}function LA(t,e){let{main:r}=t.state.selection;if(r.empty)return!1;let n=Jc(t.root);if(n.rangeCount==0)return!0;let i=n.getRangeAt(0).getClientRects();for(let o=0;o<i.length;o++){let s=i[o];if(s.left<=e.clientX&&s.right>=e.clientX&&s.top<=e.clientY&&s.bottom>=e.clientY)return!0}return!1}function z0(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target,n;r!=t.contentDOM;r=r.parentNode)if(!r||r.nodeType==11||(n=ve.get(r))&&n.ignoreEvent(e))return!1;return!0}var We=Object.create(null),Vb=F.ie&&F.ie_version<15||F.ios&&F.webkit_version<604;function IA(t){let e=t.dom.parentNode;if(!e)return;let r=e.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{t.focus(),r.remove(),Ub(t,r.value)},50)}function Ub(t,e){let{state:r}=t,n,i=1,o=r.toText(e),s=o.lines==r.selection.ranges.length;if(Kd!=null&&r.selection.ranges.every(l=>l.empty)&&Kd==o.toString()){let l=-1;n=r.changeByRange(c=>{let f=r.doc.lineAt(c.from);if(f.from==l)return{range:c};l=f.from;let u=r.toText((s?o.line(i++).text:e)+r.lineBreak);return{changes:{from:f.from,insert:u},range:A.cursor(c.from+u.length)}})}else s?n=r.changeByRange(l=>{let c=o.line(i++);return{changes:{from:l.from,to:l.to,insert:c.text},range:A.cursor(l.from+c.length)}}):n=r.replaceSelection(o);t.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}We.keydown=(t,e)=>{t.inputState.setSelectionOrigin("select"),e.keyCode==27?t.inputState.lastEscPress=Date.now():Fb.indexOf(e.keyCode)<0&&(t.inputState.lastEscPress=0)};var Hb=0;We.touchstart=(t,e)=>{Hb=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};We.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};We.mousedown=(t,e)=>{if(t.observer.flush(),Hb>Date.now()-2e3&&pp(e)==1)return;let r=null;for(let n of t.state.facet(Ab))if(r=n(t,e),r)break;if(!r&&e.button==0&&(r=$A(t,e)),r){let n=t.root.activeElement!=t.contentDOM;n&&t.observer.ignore(()=>db(t.contentDOM)),t.inputState.startMouseSelection(new qd(t,e,r,n))}};function F0(t,e,r,n){if(n==1)return A.cursor(e,r);if(n==2)return AA(t.state,e,r);{let i=Ye.find(t.docView,e),o=t.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:o.from,a=i?i.posAtEnd:o.to;return a<t.state.doc.length&&a==o.to&&a++,A.range(s,a)}}var Wb=(t,e)=>t>=e.top&&t<=e.bottom,V0=(t,e,r)=>Wb(e,r)&&t>=r.left&&t<=r.right;function BA(t,e,r,n){let i=Ye.find(t.docView,e);if(!i)return 1;let o=e-i.posAtStart;if(o==0)return 1;if(o==i.length)return-1;let s=i.coordsAt(o,-1);if(s&&V0(r,n,s))return-1;let a=i.coordsAt(o,1);return a&&V0(r,n,a)?1:s&&Wb(n,s)?-1:1}function U0(t,e){let r=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:r,bias:BA(t,r,e.clientX,e.clientY)}}var jA=F.ie&&F.ie_version<=11,H0=null,W0=0,q0=0;function pp(t){if(!jA)return t.detail;let e=H0,r=q0;return H0=t,q0=Date.now(),W0=!e||r>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(W0+1)%3:1}function $A(t,e){let r=U0(t,e),n=pp(e),i=t.state.selection,o=r,s=e;return{update(a){a.docChanged&&(r&&(r.pos=a.changes.mapPos(r.pos)),i=i.map(a.changes),s=null)},get(a,l,c){let f;if(s&&a.clientX==s.clientX&&a.clientY==s.clientY?f=o:(f=o=U0(t,a),s=a),!f||!r)return i;let u=F0(t,f.pos,f.bias,n);if(r.pos!=f.pos&&!l){let h=F0(t,r.pos,r.bias,n),d=Math.min(h.from,u.from),p=Math.max(h.to,u.to);u=d<u.from?A.range(d,p):A.range(p,d)}return l?i.replaceRange(i.main.extend(u.from,u.to)):c?i.addRange(u):A.create([u])}}}We.dragstart=(t,e)=>{let{selection:{main:r}}=t.state,{mouseSelection:n}=t.inputState;n&&(n.dragging=r),e.dataTransfer&&(e.dataTransfer.setData("Text",t.state.sliceDoc(r.from,r.to)),e.dataTransfer.effectAllowed="copyMove")};function K0(t,e,r,n){if(!r)return;let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:o}=t.inputState,s=n&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null,a={from:i,insert:r},l=t.state.changes(s?[s,a]:a);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(i,-1),head:l.mapPos(i,1)},userEvent:s?"move.drop":"input.drop"})}We.drop=(t,e)=>{if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();let r=e.dataTransfer.files;if(r&&r.length){e.preventDefault();let n=Array(r.length),i=0,o=()=>{++i==r.length&&K0(t,e,n.filter(s=>s!=null).join(t.state.lineBreak),!1)};for(let s=0;s<r.length;s++){let a=new FileReader;a.onerror=o,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(n[s]=a.result),o()},a.readAsText(r[s])}}else K0(t,e,e.dataTransfer.getData("Text"),!0)};We.paste=(t,e)=>{if(t.state.readOnly)return e.preventDefault();t.observer.flush();let r=Vb?null:e.clipboardData;r?(Ub(t,r.getData("text/plain")),e.preventDefault()):IA(t)};function zA(t,e){let r=t.dom.parentNode;if(!r)return;let n=r.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),t.focus()},50)}function FA(t){let e=[],r=[],n=!1;for(let i of t.selection.ranges)i.empty||(e.push(t.sliceDoc(i.from,i.to)),r.push(i));if(!e.length){let i=-1;for(let{from:o}of t.selection.ranges){let s=t.doc.lineAt(o);s.number>i&&(e.push(s.text),r.push({from:s.from,to:Math.min(t.doc.length,s.to+1)})),i=s.number}n=!0}return{text:e.join(t.lineBreak),ranges:r,linewise:n}}var Kd=null;We.copy=We.cut=(t,e)=>{let{text:r,ranges:n,linewise:i}=FA(t.state);if(!r&&!i)return;Kd=i?r:null;let o=Vb?null:e.clipboardData;o?(e.preventDefault(),o.clearData(),o.setData("text/plain",r)):zA(t,r),e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})};function qb(t){setTimeout(()=>{t.hasFocus!=t.inputState.notifiedFocused&&t.update([])},10)}We.focus=qb;We.blur=t=>{t.observer.clearSelectionRange(),qb(t)};function Kb(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=!1}}}We.compositionstart=We.compositionupdate=t=>{t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0,t.docView.compositionDeco.size&&(t.observer.flush(),Kb(t,!0)))};We.compositionend=t=>{t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionFirstChange=null,setTimeout(()=>{t.inputState.composing<0&&Kb(t,!1)},50)};We.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};We.beforeinput=(t,e)=>{var r;let n;if(F.chrome&&F.android&&(n=zb.find(i=>i.inputType==e.inputType))&&(t.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let i=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>i+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}};var G0=["pre-wrap","normal","pre-line","break-spaces"],Gd=class{constructor(){this.doc=ee.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,r){let n=this.doc.lineAt(r).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.ceil((r-e-n*this.lineLength*.5)/this.lineLength)),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return G0.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let r=!1;for(let n=0;n<e.length;n++){let i=e[n];i<0?n++:this.heightSamples[Math.floor(i*10)]||(r=!0,this.heightSamples[Math.floor(i*10)]=!0)}return r}refresh(e,r,n,i,o){let s=G0.indexOf(e)>-1,a=Math.round(r)!=Math.round(this.lineHeight)||this.lineWrapping!=s;if(this.lineWrapping=s,this.lineHeight=r,this.charWidth=n,this.lineLength=i,a){this.heightSamples={};for(let l=0;l<o.length;l++){let c=o[l];c<0?l++:this.heightSamples[Math.floor(c*10)]=!0}}return a}},Zd=class{constructor(e,r){this.from=e,this.heights=r,this.index=0}get more(){return this.index<this.heights.length}},zr=class{constructor(e,r,n,i,o){this.from=e,this.length=r,this.top=n,this.height=i,this.type=o}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let r=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new zr(this.from,this.length+e.length,this.top,this.height+e.height,r)}},ge=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(ge||(ge={})),Kc=.001,lt=class{constructor(e,r,n=2){this.length=e,this.height=r,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,r){this.height!=r&&(Math.abs(this.height-r)>Kc&&(e.heightChanged=!0),this.height=r)}replace(e,r,n){return lt.of(n)}decomposeLeft(e,r){r.push(this)}decomposeRight(e,r){r.push(this)}applyChanges(e,r,n,i){let o=this;for(let s=i.length-1;s>=0;s--){let{fromA:a,toA:l,fromB:c,toB:f}=i[s],u=o.lineAt(a,ge.ByPosNoHeight,r,0,0),h=u.to>=l?u:o.lineAt(l,ge.ByPosNoHeight,r,0,0);for(f+=h.to-l,l=h.to;s>0&&u.from<=i[s-1].toA;)a=i[s-1].fromA,c=i[s-1].fromB,s--,a<u.from&&(u=o.lineAt(a,ge.ByPosNoHeight,r,0,0));c+=u.from-a,a=u.from;let d=Ea.build(n,e,c,f);o=o.replace(a,l,d)}return o.updateHeight(n,0)}static empty(){return new yt(0,0)}static of(e){if(e.length==1)return e[0];let r=0,n=e.length,i=0,o=0;for(;;)if(r==n)if(i>o*2){let a=e[r-1];a.break?e.splice(--r,1,a.left,null,a.right):e.splice(--r,1,a.left,a.right),n+=1+a.break,i-=a.size}else if(o>i*2){let a=e[n];a.break?e.splice(n,1,a.left,null,a.right):e.splice(n,1,a.left,a.right),n+=2+a.break,o-=a.size}else break;else if(i<o){let a=e[r++];a&&(i+=a.size)}else{let a=e[--n];a&&(o+=a.size)}let s=0;return e[r-1]==null?(s=1,r--):e[r]==null&&(s=1,n++),new Jd(lt.of(e.slice(0,r)),s,lt.of(e.slice(n)))}};lt.prototype.size=1;var af=class extends lt{constructor(e,r,n){super(e,r),this.type=n}blockAt(e,r,n,i){return new zr(i,this.length,n,this.height,this.type)}lineAt(e,r,n,i,o){return this.blockAt(0,n,i,o)}forEachLine(e,r,n,i,o,s){e<=o+this.length&&r>=o&&s(this.blockAt(0,n,i,o))}updateHeight(e,r=0,n=!1,i){return i&&i.from<=r&&i.more&&this.setHeight(e,i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},yt=class extends af{constructor(e,r){super(e,r,he.Text),this.collapsed=0,this.widgetHeight=0}replace(e,r,n){let i=n[0];return n.length==1&&(i instanceof yt||i instanceof $e&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof $e?i=new yt(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):lt.of(n)}updateHeight(e,r=0,n=!1,i){return i&&i.from<=r&&i.more?this.setHeight(e,i.heights[i.index++]):(n||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},$e=class extends lt{constructor(e){super(e,0)}lines(e,r){let n=e.lineAt(r).number,i=e.lineAt(r+this.length).number;return{firstLine:n,lastLine:i,lineHeight:this.height/(i-n+1)}}blockAt(e,r,n,i){let{firstLine:o,lastLine:s,lineHeight:a}=this.lines(r,i),l=Math.max(0,Math.min(s-o,Math.floor((e-n)/a))),{from:c,length:f}=r.line(o+l);return new zr(c,f,n+a*l,a,he.Text)}lineAt(e,r,n,i,o){if(r==ge.ByHeight)return this.blockAt(e,n,i,o);if(r==ge.ByPosNoHeight){let{from:u,to:h}=n.lineAt(e);return new zr(u,h-u,0,0,he.Text)}let{firstLine:s,lineHeight:a}=this.lines(n,o),{from:l,length:c,number:f}=n.lineAt(e);return new zr(l,c,i+a*(f-s),a,he.Text)}forEachLine(e,r,n,i,o,s){let{firstLine:a,lineHeight:l}=this.lines(n,o);for(let c=Math.max(e,o),f=Math.min(o+this.length,r);c<=f;){let u=n.lineAt(c);c==e&&(i+=l*(u.number-a)),s(new zr(u.from,u.length,i,l,he.Text)),i+=l,c=u.to+1}}replace(e,r,n){let i=this.length-r;if(i>0){let o=n[n.length-1];o instanceof $e?n[n.length-1]=new $e(o.length+i):n.push(null,new $e(i-1))}if(e>0){let o=n[0];o instanceof $e?n[0]=new $e(e+o.length):n.unshift(new $e(e-1),null)}return lt.of(n)}decomposeLeft(e,r){r.push(new $e(e-1),null)}decomposeRight(e,r){r.push(null,new $e(this.length-e-1))}updateHeight(e,r=0,n=!1,i){let o=r+this.length;if(i&&i.from<=r+this.length&&i.more){let s=[],a=Math.max(r,i.from),l=-1,c=e.heightChanged;for(i.from>r&&s.push(new $e(i.from-r-1).updateHeight(e,r));a<=o&&i.more;){let u=e.doc.lineAt(a).length;s.length&&s.push(null);let h=i.heights[i.index++];l==-1?l=h:Math.abs(h-l)>=Kc&&(l=-2);let d=new yt(u,h);d.outdated=!1,s.push(d),a+=u+1}a<=o&&s.push(null,new $e(o-a).updateHeight(e,a));let f=lt.of(s);return e.heightChanged=c||l<0||Math.abs(f.height-this.height)>=Kc||Math.abs(l-this.lines(e.doc,r).lineHeight)>=Kc,f}else(n||this.outdated)&&(this.setHeight(e,e.heightForGap(r,r+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},Jd=class extends lt{constructor(e,r,n){super(e.length+r+n.length,e.height+n.height,r|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,r,n,i){let o=n+this.left.height;return e<o?this.left.blockAt(e,r,n,i):this.right.blockAt(e,r,o,i+this.left.length+this.break)}lineAt(e,r,n,i,o){let s=i+this.left.height,a=o+this.left.length+this.break,l=r==ge.ByHeight?e<s:e<a,c=l?this.left.lineAt(e,r,n,i,o):this.right.lineAt(e,r,n,s,a);if(this.break||(l?c.to<a:c.from>a))return c;let f=r==ge.ByPosNoHeight?ge.ByPosNoHeight:ge.ByPos;return l?c.join(this.right.lineAt(a,f,n,s,a)):this.left.lineAt(a,f,n,i,o).join(c)}forEachLine(e,r,n,i,o,s){let a=i+this.left.height,l=o+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,r,n,i,o,s),r>=l&&this.right.forEachLine(e,r,n,a,l,s);else{let c=this.lineAt(l,ge.ByPos,n,i,o);e<c.from&&this.left.forEachLine(e,c.from-1,n,i,o,s),c.to>=e&&c.from<=r&&s(c),r>c.to&&this.right.forEachLine(c.to+1,r,n,a,l,s)}}replace(e,r,n){let i=this.left.length+this.break;if(r<i)return this.balanced(this.left.replace(e,r,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,r-i,n));let o=[];e>0&&this.decomposeLeft(e,o);let s=o.length;for(let a of n)o.push(a);if(e>0&&Z0(o,s-1),r<this.length){let a=o.length;this.decomposeRight(r,o),Z0(o,a)}return lt.of(o)}decomposeLeft(e,r){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,r);r.push(this.left),this.break&&(n++,e>=n&&r.push(null)),e>n&&this.right.decomposeLeft(e-n,r)}decomposeRight(e,r){let n=this.left.length,i=n+this.break;if(e>=i)return this.right.decomposeRight(e-i,r);e<n&&this.left.decomposeRight(e,r),this.break&&e<i&&r.push(null),r.push(this.right)}balanced(e,r){return e.size>2*r.size||r.size>2*e.size?lt.of(this.break?[e,null,r]:[e,r]):(this.left=e,this.right=r,this.height=e.height+r.height,this.outdated=e.outdated||r.outdated,this.size=e.size+r.size,this.length=e.length+this.break+r.length,this)}updateHeight(e,r=0,n=!1,i){let{left:o,right:s}=this,a=r+o.length+this.break,l=null;return i&&i.from<=r+o.length&&i.more?l=o=o.updateHeight(e,r,n,i):o.updateHeight(e,r,n),i&&i.from<=a+s.length&&i.more?l=s=s.updateHeight(e,a,n,i):s.updateHeight(e,a,n),l?this.balanced(o,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function Z0(t,e){let r,n;t[e]==null&&(r=t[e-1])instanceof $e&&(n=t[e+1])instanceof $e&&t.splice(e-1,3,new $e(r.length+1+n.length))}var VA=5,Ea=class{constructor(e,r){this.pos=e,this.oracle=r,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,r){if(this.lineStart>-1){let n=Math.min(r,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof yt?i.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new yt(n-this.pos,-1)),this.writtenTo=n,r>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=r}point(e,r,n){if(e<r||n.heightRelevant){let i=n.widget?n.widget.estimatedHeight:0;i<0&&(i=this.oracle.lineHeight);let o=r-e;n.block?this.addBlock(new af(o,i,n.type)):(o||i>=VA)&&this.addLineDeco(i,o)}else r>e&&this.span(e,r);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:r}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=r,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new yt(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,r){let n=new $e(r-e);return this.oracle.doc.lineAt(e).to==r&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof yt)return e;let r=new yt(0,-1);return this.nodes.push(r),r}addBlock(e){this.enterLine(),e.type==he.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=he.WidgetBefore&&(this.covering=e)}addLineDeco(e,r){let n=this.ensureLine();n.length+=r,n.collapsed+=r,n.widgetHeight=Math.max(n.widgetHeight,e),this.writtenTo=this.pos=this.pos+r}finish(e){let r=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(r instanceof yt)&&!this.isCovered?this.nodes.push(new yt(0,-1)):(this.writtenTo<this.pos||r==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let i of this.nodes)i instanceof yt&&i.updateHeight(this.oracle,n),n+=i?i.length:1;return this.nodes}static build(e,r,n,i){let o=new Ea(n,e);return te.spans(r,n,i,o,0),o.finish(n)}};function UA(t,e,r){let n=new Yd;return te.compare(t,e,r,n,0),n.changes}var Yd=class{constructor(){this.changes=[]}compareRange(){}comparePoint(e,r,n,i){(e<r||n&&n.heightRelevant||i&&i.heightRelevant)&&jd(e,r,this.changes,5)}};function HA(t,e){let r=t.getBoundingClientRect(),n=Math.max(0,r.left),i=Math.min(innerWidth,r.right),o=Math.max(0,r.top),s=Math.min(innerHeight,r.bottom),a=t.ownerDocument.body;for(let l=t.parentNode;l&&l!=a;)if(l.nodeType==1){let c=l,f=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&f.overflow!="visible"){let u=c.getBoundingClientRect();n=Math.max(n,u.left),i=Math.min(i,u.right),o=Math.max(o,u.top),s=Math.min(s,u.bottom)}l=f.position=="absolute"||f.position=="fixed"?c.offsetParent:c.parentNode}else if(l.nodeType==11)l=l.host;else break;return{left:n-r.left,right:Math.max(n,i)-r.left,top:o-(r.top+e),bottom:Math.max(o,s)-(r.top+e)}}function WA(t,e){let r=t.getBoundingClientRect();return{left:0,right:r.right-r.left,top:e,bottom:r.bottom-(r.top+e)}}var xa=class{constructor(e,r,n){this.from=e,this.to=r,this.size=n}static same(e,r){if(e.length!=r.length)return!1;for(let n=0;n<e.length;n++){let i=e[n],o=r[n];if(i.from!=o.from||i.to!=o.to||i.size!=o.size)return!1}return!0}draw(e){return $.replace({widget:new Xd(this.size,e)}).range(this.from,this.to)}},Xd=class extends Nt{constructor(e,r){super(),this.size=e,this.vertical=r}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}},lf=class{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Gd,this.scaler=X0,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=ye.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=e.facet(Oa).filter(r=>typeof r!="function"),this.heightMap=lt.empty().applyChanges(this.stateDeco,ee.empty,this.heightOracle.setDoc(e.doc),[new vr(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=$.set(this.lineGaps.map(r=>r.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:r}=this.state.selection;for(let n=0;n<=1;n++){let i=n?r.head:r.anchor;if(!e.some(({from:o,to:s})=>i>=o&&i<=s)){let{from:o,to:s}=this.lineBlockAt(i);e.push(new Fo(o,s))}}this.viewports=e.sort((n,i)=>n.from-i.from),this.scaler=this.heightMap.height<=7e6?X0:new Qd(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:ya(e,this.scaler))})}update(e,r=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(Oa).filter(c=>typeof c!="function");let i=e.changedRanges,o=vr.extendWithRanges(i,UA(n,this.stateDeco,e?e.changes:Ce.empty(this.state.doc.length))),s=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=s&&(e.flags|=2);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(r&&(r.range.head<a.from||r.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,r));let l=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),r&&(this.scrollTarget=r),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let r=e.contentDOM,n=window.getComputedStyle(r),i=this.heightOracle,o=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?ye.RTL:ye.LTR;let s=this.heightOracle.mustRefreshForWrapping(o),a=s||this.mustMeasureContent||this.contentDOMHeight!=r.clientHeight;this.contentDOMHeight=r.clientHeight,this.mustMeasureContent=!1;let l=0,c=0,f=parseInt(n.paddingTop)||0,u=parseInt(n.paddingBottom)||0;(this.paddingTop!=f||this.paddingBottom!=u)&&(this.paddingTop=f,this.paddingBottom=u,l|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=8);let h=(this.printing?WA:HA)(r,this.paddingTop),d=h.top-this.pixelViewport.top,p=h.bottom-this.pixelViewport.bottom;this.pixelViewport=h;let b=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(b!=this.inView&&(this.inView=b,b&&(a=!0)),!this.inView)return 0;let m=r.clientWidth;if((this.contentDOMWidth!=m||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=m,this.editorHeight=e.scrollDOM.clientHeight,l|=8),a){let S=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(S)&&(s=!0),s||i.lineWrapping&&Math.abs(m-this.contentDOMWidth)>i.charWidth){let{lineHeight:_,charWidth:w}=e.docView.measureTextSize();s=i.refresh(o,_,w,m/w,S),s&&(e.docView.minWidth=0,l|=8)}d>0&&p>0?c=Math.max(d,p):d<0&&p<0&&(c=Math.min(d,p)),i.heightChanged=!1;for(let _ of this.viewports){let w=_.from==this.viewport.from?S:e.docView.measureVisibleLineHeights(_);this.heightMap=this.heightMap.updateHeight(i,0,s,new Zd(_.from,w))}i.heightChanged&&(l|=2)}let k=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return k&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(l&2||k)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,r){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,o=this.state.doc,{visibleTop:s,visibleBottom:a}=this,l=new Fo(i.lineAt(s-n*1e3,ge.ByHeight,o,0,0).from,i.lineAt(a+(1-n)*1e3,ge.ByHeight,o,0,0).to);if(r){let{head:c}=r.range;if(c<l.from||c>l.to){let f=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=i.lineAt(c,ge.ByPos,o,0,0),h;r.y=="center"?h=(u.top+u.bottom)/2-f/2:r.y=="start"||r.y=="nearest"&&c<l.from?h=u.top:h=u.bottom-f,l=new Fo(i.lineAt(h-1e3/2,ge.ByHeight,o,0,0).from,i.lineAt(h+f+1e3/2,ge.ByHeight,o,0,0).to)}}return l}mapViewport(e,r){let n=r.mapPos(e.from,-1),i=r.mapPos(e.to,1);return new Fo(this.heightMap.lineAt(n,ge.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(i,ge.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:r},n=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,ge.ByPos,this.state.doc,0,0),{bottom:o}=this.heightMap.lineAt(r,ge.ByPos,this.state.doc,0,0),{visibleTop:s,visibleBottom:a}=this;return(e==0||i<=s-Math.max(10,Math.min(-n,250)))&&(r==this.state.doc.length||o>=a+Math.max(10,Math.min(n,250)))&&i>s-2*1e3&&o<a+2*1e3}mapLineGaps(e,r){if(!e.length||r.empty)return e;let n=[];for(let i of e)r.touchesRange(i.from,i.to)||n.push(new xa(r.mapPos(i.from),r.mapPos(i.to),i.size));return n}ensureLineGaps(e){let r=[];if(this.defaultTextDirection!=ye.LTR)return r;for(let n of this.viewportLines){if(n.length<4e3)continue;let i=qA(n.from,n.to,this.stateDeco);if(i.total<4e3)continue;let o,s;if(this.heightOracle.lineWrapping){let c=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;o=Wc(i,(this.visibleTop-n.top-c)/n.height),s=Wc(i,(this.visibleBottom-n.top+c)/n.height)}else{let c=i.total*this.heightOracle.charWidth,f=2e3*this.heightOracle.charWidth;o=Wc(i,(this.pixelViewport.left-f)/c),s=Wc(i,(this.pixelViewport.right+f)/c)}let a=[];o>n.from&&a.push({from:n.from,to:o}),s<n.to&&a.push({from:s,to:n.to});let l=this.state.selection.main;l.from>=n.from&&l.from<=n.to&&Y0(a,l.from-10,l.from+10),!l.empty&&l.to>=n.from&&l.to<=n.to&&Y0(a,l.to-10,l.to+10);for(let{from:c,to:f}of a)f-c>1e3&&r.push(KA(e,u=>u.from>=n.from&&u.to<=n.to&&Math.abs(u.from-c)<1e3&&Math.abs(u.to-f)<1e3)||new xa(c,f,this.gapSize(n,c,f,i)))}return r}gapSize(e,r,n,i){let o=J0(i,n)-J0(i,r);return this.heightOracle.lineWrapping?e.height*o:i.total*this.heightOracle.charWidth*o}updateLineGaps(e){xa.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=$.set(e.map(r=>r.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let r=[];te.spans(e,this.viewport.from,this.viewport.to,{span(i,o){r.push({from:i,to:o})},point(){}},20);let n=r.length!=this.visibleRanges.length||this.visibleRanges.some((i,o)=>i.from!=r[o].from||i.to!=r[o].to);return this.visibleRanges=r,n?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(r=>r.from<=e&&r.to>=e)||ya(this.heightMap.lineAt(e,ge.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return ya(this.heightMap.lineAt(this.scaler.fromDOM(e),ge.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return ya(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},Fo=class{constructor(e,r){this.from=e,this.to=r}};function qA(t,e,r){let n=[],i=t,o=0;return te.spans(r,t,e,{span(){},point(s,a){s>i&&(n.push({from:i,to:s}),o+=s-i),i=a}},20),i<e&&(n.push({from:i,to:e}),o+=e-i),{total:o,ranges:n}}function Wc({total:t,ranges:e},r){if(r<=0)return e[0].from;if(r>=1)return e[e.length-1].to;let n=Math.floor(t*r);for(let i=0;;i++){let{from:o,to:s}=e[i],a=s-o;if(n<=a)return o+n;n-=a}}function J0(t,e){let r=0;for(let{from:n,to:i}of t.ranges){if(e<=i){r+=e-n;break}r+=i-n}return r/t.total}function Y0(t,e,r){for(let n=0;n<t.length;n++){let i=t[n];if(i.from<r&&i.to>e){let o=[];i.from<e&&o.push({from:i.from,to:e}),i.to>r&&o.push({from:r,to:i.to}),t.splice(n,1,...o),n+=o.length-1}}}function KA(t,e){for(let r of t)if(e(r))return r}var X0={toDOM(t){return t},fromDOM(t){return t},scale:1},Qd=class{constructor(e,r,n){let i=0,o=0,s=0;this.viewports=n.map(({from:a,to:l})=>{let c=r.lineAt(a,ge.ByPos,e,0,0).top,f=r.lineAt(l,ge.ByPos,e,0,0).bottom;return i+=f-c,{from:a,to:l,top:c,bottom:f,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(r.height-i);for(let a of this.viewports)a.domTop=s+(a.top-o)*this.scale,s=a.domBottom=a.domTop+(a.bottom-a.top),o=a.bottom}toDOM(e){for(let r=0,n=0,i=0;;r++){let o=r<this.viewports.length?this.viewports[r]:null;if(!o||e<o.top)return i+(e-n)*this.scale;if(e<=o.bottom)return o.domTop+(e-o.top);n=o.bottom,i=o.domBottom}}fromDOM(e){for(let r=0,n=0,i=0;;r++){let o=r<this.viewports.length?this.viewports[r]:null;if(!o||e<o.domTop)return n+(e-i)/this.scale;if(e<=o.domBottom)return o.top+(e-o.domTop);n=o.bottom,i=o.domBottom}}};function ya(t,e){if(e.scale==1)return t;let r=e.toDOM(t.top),n=e.toDOM(t.bottom);return new zr(t.from,t.length,r,n-r,Array.isArray(t.type)?t.type.map(i=>ya(i,e)):t.type)}var qc=j.define({combine:t=>t.join(" ")}),ep=j.define({combine:t=>t.indexOf(!0)>-1}),tp=Gt.newName(),Gb=Gt.newName(),Zb=Gt.newName(),Jb={"&light":"."+Gb,"&dark":"."+Zb};function rp(t,e,r){return new Gt(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,i=>{if(i=="&")return t;if(!r||!r[i])throw new RangeError(`Unsupported selector: ${i}`);return r[i]}):t+" "+n}})}var GA=rp("."+tp,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Jb),ZA={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},xd=F.ie&&F.ie_version<=11,np=class{constructor(e,r,n){this.view=e,this.onChange=r,this.onScrollChanged=n,this.active=!1,this.selectionRange=new Rd,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(i=>{for(let o of i)this.queue.push(o);(F.ie&&F.ie_version<=11||F.ios&&e.composing)&&i.some(o=>o.type=="childList"&&o.removedNodes.length||o.type=="characterData"&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),xd&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(i=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),i.length>0&&i[i.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(i=>{i.length>0&&i[i.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((r,n)=>r!=e[n]))){this.gapIntersection.disconnect();for(let r of e)this.gapIntersection.observe(r);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,n=this.selectionRange;if(r.state.facet(Ma)?r.root.activeElement!=this.dom:!Od(r.dom,n))return;let i=n.anchorNode&&r.docView.nearest(n.anchorNode);i&&i.ignoreEvent(e)||((F.ie&&F.ie_version<=11||F.android&&F.chrome)&&!r.state.selection.main.empty&&n.focusNode&&Yc(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,r=Jc(e),n=F.safari&&e.nodeType==11&&sA()==this.view.contentDOM&&JA(this.view)||r;return this.selectionRange.eq(n)?!1:(this.selectionRange.setRange(n),this.selectionChanged=!0)}setSelectionRange(e,r){this.selectionRange.set(e.node,e.offset,r.node,r.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,r=null;for(let n=this.dom;n;)if(n.nodeType==1)!r&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:r||(r=this.scrollTargets.slice(0,e)),r&&r.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!r&&(r=this.scrollTargets.slice(0,e)),r){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=r)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,ZA),xd&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),xd&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,r){this.delayedAndroidKey||requestAnimationFrame(()=>{let n=this.delayedAndroidKey;this.delayedAndroidKey=null;let i=this.view.state;this.readSelectionRange(),va(this.view.contentDOM,n.key,n.keyCode)?this.processRecords():this.flush(),this.view.state==i&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:r})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let o of this.observer.takeRecords())e.push(o);e.length&&(this.queue=[]);let r=-1,n=-1,i=!1;for(let o of e){let s=this.readMutation(o);s&&(s.typeOver&&(i=!0),r==-1?{from:r,to:n}=s:(r=Math.min(s.from,r),n=Math.max(s.to,n)))}return{from:r,to:n,typeOver:i}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:r,to:n,typeOver:i}=this.processRecords(),o=this.selectionChanged&&Od(this.dom,this.selectionRange);if(r<0&&!o)return;this.selectionChanged=!1;let s=this.view.state;this.onChange(r,n,i),this.view.state==s&&this.view.update([])}readMutation(e){let r=this.view.docView.nearest(e.target);if(!r||r.ignoreMutation(e))return null;if(r.markDirty(e.type=="attributes"),e.type=="attributes"&&(r.dirty|=4),e.type=="childList"){let n=Q0(r,e.previousSibling||e.target.previousSibling,-1),i=Q0(r,e.nextSibling||e.target.nextSibling,1);return{from:n?r.posAfter(n):r.posAtStart,to:i?r.posBefore(i):r.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,r,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(r=this.gapIntersection)===null||r===void 0||r.disconnect(),(n=this.resize)===null||n===void 0||n.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function Q0(t,e,r){for(;e;){let n=ve.get(e);if(n&&n.parent==t)return n;let i=e.parentNode;e=i!=t.dom?i:r>0?e.nextSibling:e.previousSibling}return null}function JA(t){let e=null;function r(l){l.preventDefault(),l.stopImmediatePropagation(),e=l.getTargetRanges()[0]}if(t.contentDOM.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",r,!0),!e)return null;let n=e.startContainer,i=e.startOffset,o=e.endContainer,s=e.endOffset,a=t.docView.domAtPos(t.state.selection.main.anchor);return Yc(a.node,a.offset,o,s)&&([n,i,o,s]=[o,s,n,i]),{anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:s}}function YA(t,e,r,n){let i,o,s=t.state.selection.main;if(e>-1){let a=t.docView.domBoundsAround(e,r,0);if(!a||t.state.readOnly)return;let{from:l,to:c}=a,f=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:QA(t),u=new rf(f,t.state);u.readRange(a.startDOM,a.endDOM);let h=s.from,d=null;(t.inputState.lastKeyCode===8&&t.inputState.lastKeyTime>Date.now()-100||F.android&&u.text.length<c-l)&&(h=s.to,d="end");let p=XA(t.state.doc.sliceString(l,c,In),u.text,h-l,d);p&&(F.chrome&&t.inputState.lastKeyCode==13&&p.toB==p.from+2&&u.text.slice(p.from,p.toB)==In+In&&p.toB--,i={from:l+p.from,to:l+p.toA,insert:ee.of(u.text.slice(p.from,p.toB).split(In))}),o=e2(f,l)}else if(t.hasFocus||!t.state.facet(Ma)){let a=t.observer.selectionRange,{impreciseHead:l,impreciseAnchor:c}=t.docView,f=l&&l.node==a.focusNode&&l.offset==a.focusOffset||!Ho(t.contentDOM,a.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(a.focusNode,a.focusOffset),u=c&&c.node==a.anchorNode&&c.offset==a.anchorOffset||!Ho(t.contentDOM,a.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(a.anchorNode,a.anchorOffset);(f!=s.head||u!=s.anchor)&&(o=A.single(u,f))}if(!(!i&&!o)){if(!i&&n&&!s.empty&&o&&o.main.empty?i={from:s.from,to:s.to,insert:t.state.doc.slice(s.from,s.to)}:i&&i.from>=s.from&&i.to<=s.to&&(i.from!=s.from||i.to!=s.to)&&s.to-s.from-(i.to-i.from)<=4?i={from:s.from,to:s.to,insert:t.state.doc.slice(s.from,i.from).append(i.insert).append(t.state.doc.slice(i.to,s.to))}:F.mac&&i&&i.from==i.to&&i.from==s.head-1&&i.insert.toString()=="."&&(i={from:s.from,to:s.to,insert:ee.of([" "])}),i){let a=t.state;if(F.ios&&t.inputState.flushIOSKey(t)||F.android&&(i.from==s.from&&i.to==s.to&&i.insert.length==1&&i.insert.lines==2&&va(t.contentDOM,"Enter",13)||i.from==s.from-1&&i.to==s.to&&i.insert.length==0&&va(t.contentDOM,"Backspace",8)||i.from==s.from&&i.to==s.to+1&&i.insert.length==0&&va(t.contentDOM,"Delete",46)))return;let l=i.insert.toString();if(t.state.facet(Ob).some(u=>u(t,i.from,i.to,l)))return;t.inputState.composing>=0&&t.inputState.composing++;let c;if(i.from>=s.from&&i.to<=s.to&&i.to-i.from>=(s.to-s.from)/3&&(!o||o.main.empty&&o.main.from==i.from+i.insert.length)&&t.inputState.composing<0){let u=s.from<i.from?a.sliceDoc(s.from,i.from):"",h=s.to>i.to?a.sliceDoc(i.to,s.to):"";c=a.replaceSelection(t.state.toText(u+i.insert.sliceString(0,void 0,t.state.lineBreak)+h))}else{let u=a.changes(i),h=o&&!a.selection.main.eq(o.main)&&o.main.to<=u.newLength?o.main:void 0;if(a.selection.ranges.length>1&&t.inputState.composing>=0&&i.to<=s.to&&i.to>=s.to-10){let d=t.state.sliceDoc(i.from,i.to),p=Bb(t)||t.state.doc.lineAt(s.head),b=s.to-i.to,m=s.to-s.from;c=a.changeByRange(k=>{if(k.from==s.from&&k.to==s.to)return{changes:u,range:h||k.map(u)};let S=k.to-b,_=S-d.length;if(k.to-k.from!=m||t.state.sliceDoc(_,S)!=d||p&&k.to>=p.from&&k.from<=p.to)return{range:k};let w=a.changes({from:_,to:S,insert:i.insert}),C=k.to-s.to;return{changes:w,range:h?A.range(Math.max(0,h.anchor+C),Math.max(0,h.head+C)):k.map(w)}})}else c={changes:u,selection:h&&a.selection.replaceRange(h)}}let f="input.type";t.composing&&(f+=".compose",t.inputState.compositionFirstChange&&(f+=".start",t.inputState.compositionFirstChange=!1)),t.dispatch(c,{scrollIntoView:!0,userEvent:f})}else if(o&&!o.main.eq(s)){let a=!1,l="select";t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(a=!0),l=t.inputState.lastSelectionOrigin),t.dispatch({selection:o,scrollIntoView:a,userEvent:l})}}}function XA(t,e,r,n){let i=Math.min(t.length,e.length),o=0;for(;o<i&&t.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==i&&t.length==e.length)return null;let s=t.length,a=e.length;for(;s>0&&a>0&&t.charCodeAt(s-1)==e.charCodeAt(a-1);)s--,a--;if(n=="end"){let l=Math.max(0,o-Math.min(s,a));r-=s+l-o}if(s<o&&t.length<e.length){let l=r<=o&&r>=s?o-r:0;o-=l,a=o+(a-s),s=o}else if(a<o){let l=r<=o&&r>=a?o-r:0;o-=l,s=o+(s-a),a=o}return{from:o,toA:s,toB:a}}function QA(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:r,anchorOffset:n,focusNode:i,focusOffset:o}=t.observer.selectionRange;return r&&(e.push(new nf(r,n)),(i!=r||o!=n)&&e.push(new nf(i,o))),e}function e2(t,e){if(t.length==0)return null;let r=t[0].pos,n=t.length==2?t[1].pos:r;return r>-1&&n>-1?A.single(r+e,n+e):null}var B=class{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(r=>this.update([r])),this.dispatch=this.dispatch.bind(this),this.root=e.root||cA(e.parent)||document,this.viewState=new lf(e.state||G.create()),this.plugins=this.state.facet(ma).map(r=>new wa(r));for(let r of this.plugins)r.update(this);this.observer=new np(this,(r,n,i)=>{YA(this,r,n,i)},r=>{this.inputState.runScrollHandlers(this,r),this.observer.intersecting&&this.measure()}),this.inputState=new Wd(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new of(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Ae?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let r=!1,n=!1,i,o=this.state;for(let a of e){if(a.startState!=o)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");o=a.state}if(this.destroyed){this.viewState.state=o;return}if(o.facet(G.phrases)!=this.state.facet(G.phrases))return this.setState(o);i=Ko.create(this,o,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let a of e){if(s&&(s=s.map(a.changes)),a.scrollIntoView){let{main:l}=a.state.selection;s=new qo(l.empty?l:A.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of a.effects)l.is(N0)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=Go.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),r=this.docView.update(i),this.state.facet(ga)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(r,e.some(a=>a.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(qc)!=i.state.facet(qc)&&(this.viewState.mustMeasureContent=!0),(r||n||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let a of this.state.facet($d))a(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let r=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new lf(e),this.plugins=e.facet(ma).map(n=>new wa(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView=new of(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}r&&this.focus(),this.requestMeasure()}updatePlugins(e){let r=e.startState.facet(ma),n=e.state.facet(ma);if(r!=n){let i=[];for(let o of n){let s=r.indexOf(o);if(s<0)i.push(new wa(o));else{let a=this.plugins[s];a.mustUpdate=e,i.push(a)}}for(let o of this.plugins)o.mustUpdate!=e&&o.destroy(this);this.plugins=i,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let i of this.plugins)i.mustUpdate=e;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let r=null;try{for(let n=0;;n++){this.updateState=1;let i=this.viewport,o=this.viewState.measure(this);if(!o&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(n>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];o&4||([this.measureRequests,s]=[s,this.measureRequests]);let a=s.map(u=>{try{return u.read(this)}catch(h){return at(this.state,h),eb}}),l=Ko.create(this,this.state,[]),c=!1,f=!1;l.flags|=o,r?r.flags|=o:r=l,this.updateState=2,l.empty||(this.updatePlugins(l),this.inputState.update(l),this.updateAttrs(),c=this.docView.update(l));for(let u=0;u<s.length;u++)if(a[u]!=eb)try{let h=s[u];h.write&&h.write(a[u],this)}catch(h){at(this.state,h)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,f=!0),c&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!f&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(r&&!r.empty)for(let n of this.state.facet($d))n(r)}get themeClasses(){return tp+" "+(this.state.facet(ep)?Zb:Gb)+" "+this.state.facet(qc)}updateAttrs(){let e=tb(this,Rb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),r={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ma)?"true":"false",class:"cm-content",style:`${F.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(r["aria-readonly"]="true"),tb(this,Mb,r);let n=this.observer.ignore(()=>{let i=Bd(this.contentDOM,this.contentAttrs,r),o=Bd(this.dom,this.editorAttrs,e);return i||o});return this.editorAttrs=e,this.contentAttrs=r,n}showAnnouncements(e){let r=!0;for(let n of e)for(let i of n.effects)if(i.is(B.announce)){r&&(this.announceDOM.textContent=""),r=!1;let o=this.announceDOM.appendChild(document.createElement("div"));o.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet(ga),Gt.mount(this.root,this.styleModules.concat(GA).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let r=0;r<this.measureRequests.length;r++)if(this.measureRequests[r].key===e.key){this.measureRequests[r]=e;return}}this.measureRequests.push(e)}}plugin(e){let r=this.pluginMap.get(e);return(r===void 0||r&&r.spec!=e)&&this.pluginMap.set(e,r=this.plugins.find(n=>n.spec==e)||null),r&&r.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,r,n){return wd(this,e,$0(this,e,r,n))}moveByGroup(e,r){return wd(this,e,$0(this,e,r,n=>MA(this,e.head,n)))}moveToLineBoundary(e,r,n=!0){return RA(this,e,r,n)}moveVertically(e,r,n){return wd(this,e,DA(this,e,r,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,r=0){return this.docView.posFromDOM(e,r)}posAtCoords(e,r=!0){return this.readMeasured(),$b(this,e,r)}coordsAtPos(e,r=1){this.readMeasured();let n=this.docView.coordsAt(e,r);if(!n||n.left==n.right)return n;let i=this.state.doc.lineAt(e),o=this.bidiSpans(i),s=o[Bn.find(o,e-i.from,-1,r)];return pf(n,s.dir==ye.LTR==r>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Eb)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>t2)return Lb(e.length);let r=this.textDirectionAt(e.from);for(let i of this.bidiCache)if(i.from==e.from&&i.dir==r)return i.order;let n=kA(e.text,r);return this.bidiCache.push(new Go(e.from,e.to,r,n)),n}get hasFocus(){var e;return(document.hasFocus()||F.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{db(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,r={}){return N0.of(new qo(typeof e=="number"?A.cursor(e):e,r.y,r.x,r.yMargin,r.xMargin))}static domEventHandlers(e){return de.define(()=>({}),{eventHandlers:e})}static theme(e,r){let n=Gt.newName(),i=[qc.of(n),ga.of(rp(`.${n}`,e))];return r&&r.dark&&i.push(ep.of(!0)),i}static baseTheme(e){return hn.lowest(ga.of(rp("."+tp,e,Jb)))}};B.styleModule=ga;B.inputHandler=Ob;B.perLineTextDirection=Eb;B.exceptionSink=Tb;B.updateListener=$d;B.editable=Ma;B.mouseSelectionStyle=Ab;B.dragMovesSelection=Cb;B.clickAddsSelectionRange=_b;B.decorations=Oa;B.atomicRanges=Db;B.scrollMargins=Nb;B.darkTheme=ep;B.contentAttributes=Mb;B.editorAttributes=Rb;B.lineWrapping=B.contentAttributes.of({class:"cm-lineWrapping"});B.announce=W.define();var t2=4096,eb={},Go=class{constructor(e,r,n,i){this.from=e,this.to=r,this.dir=n,this.order=i}static update(e,r){if(r.empty)return e;let n=[],i=e.length?e[e.length-1].dir:ye.LTR;for(let o=Math.max(0,e.length-10);o<e.length;o++){let s=e[o];s.dir==i&&!r.touchesRange(s.from,s.to)&&n.push(new Go(r.mapPos(s.from,1),r.mapPos(s.to,-1),s.dir,s.order))}return n}};function tb(t,e,r){for(let n=t.state.facet(e),i=n.length-1;i>=0;i--){let o=n[i],s=typeof o=="function"?o(t):o;s&&Id(s,r)}return r}var r2=F.mac?"mac":F.windows?"win":F.linux?"linux":"key";function n2(t,e){let r=t.split(/-(?!$)/),n=r[r.length-1];n=="Space"&&(n=" ");let i,o,s,a;for(let l=0;l<r.length-1;++l){let c=r[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))i=!0;else if(/^(c|ctrl|control)$/i.test(c))o=!0;else if(/^s(hift)?$/i.test(c))s=!0;else if(/^mod$/i.test(c))e=="mac"?a=!0:o=!0;else throw new Error("Unrecognized modifier name: "+c)}return i&&(n="Alt-"+n),o&&(n="Ctrl-"+n),a&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Sd(t,e,r){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r!==!1&&e.shiftKey&&(t="Shift-"+t),t}var i2=B.domEventHandlers({keydown(t,e){return Qb(Yb(e.state),t,e,"editor")}}),Ii=j.define({enables:i2}),rb=new WeakMap;function Yb(t){let e=t.facet(Ii),r=rb.get(e);return r||rb.set(e,r=s2(e.reduce((n,i)=>n.concat(i),[]))),r}function Xb(t,e,r){return Qb(Yb(t.state),e,t,r)}var Ln=null,o2=4e3;function s2(t,e=r2){let r=Object.create(null),n=Object.create(null),i=(s,a)=>{let l=n[s];if(l==null)n[s]=a;else if(l!=a)throw new Error("Key binding "+s+" is used both as a regular binding and as a multi-stroke prefix")},o=(s,a,l,c)=>{let f=r[s]||(r[s]=Object.create(null)),u=a.split(/ (?!$)/).map(p=>n2(p,e));for(let p=1;p<u.length;p++){let b=u.slice(0,p).join(" ");i(b,!0),f[b]||(f[b]={preventDefault:!0,commands:[m=>{let k=Ln={view:m,prefix:b,scope:s};return setTimeout(()=>{Ln==k&&(Ln=null)},o2),!0}]})}let h=u.join(" ");i(h,!1);let d=f[h]||(f[h]={preventDefault:!1,commands:[]});d.commands.push(l),c&&(d.preventDefault=!0)};for(let s of t){let a=s[e]||s.key;if(a)for(let l of s.scope?s.scope.split(" "):["editor"])o(l,a,s.run,s.preventDefault),s.shift&&o(l,"Shift-"+a,s.shift,s.preventDefault)}return r}function Qb(t,e,r,n){let i=A0(e),o=i.length==1&&i!=" ",s="",a=!1;Ln&&Ln.view==r&&Ln.scope==n&&(s=Ln.prefix+" ",(a=Fb.indexOf(e.keyCode)<0)&&(Ln=null));let l=u=>{if(u){for(let h of u.commands)if(h(r))return!0;u.preventDefault&&(a=!0)}return!1},c=t[n],f;if(c){if(l(c[s+Sd(i,e,!o)]))return!0;if(o&&(e.shiftKey||e.altKey||e.metaKey)&&(f=dn[e.keyCode])&&f!=i){if(l(c[s+Sd(f,e,!0)]))return!0}else if(o&&e.shiftKey&&l(c[s+Sd(i,e,!0)]))return!0}return a}var ek=!F.ios,ba=j.define({combine(t){return gt(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,r)=>Math.min(e,r),drawRangeCursor:(e,r)=>e||r})}});function tk(t={}){return[ba.of(t),a2,l2]}var cf=class{constructor(e,r,n,i,o){this.left=e,this.top=r,this.width=n,this.height=i,this.className=o}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}},a2=de.fromClass(class{constructor(t){this.view=t,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=t.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=t.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),t.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(ba).cursorBlinkRate+"ms"}update(t){let e=t.startState.facet(ba)!=t.state.facet(ba);(e||t.selectionSet||t.geometryChanged||t.viewportChanged)&&this.view.requestMeasure(this.measureReq),t.transactions.some(r=>r.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),e&&this.setBlinkRate()}readPos(){let{state:t}=this.view,e=t.facet(ba),r=t.selection.ranges.map(i=>i.empty?[]:c2(this.view,i)).reduce((i,o)=>i.concat(o)),n=[];for(let i of t.selection.ranges){let o=i==t.selection.main;if(i.empty?!o||ek:e.drawRangeCursor){let s=f2(this.view,i,o);s&&n.push(s)}}return{rangePieces:r,cursors:n}}drawSel({rangePieces:t,cursors:e}){if(t.length!=this.rangePieces.length||t.some((r,n)=>!r.eq(this.rangePieces[n]))){this.selectionLayer.textContent="";for(let r of t)this.selectionLayer.appendChild(r.draw());this.rangePieces=t}if(e.length!=this.cursors.length||e.some((r,n)=>!r.eq(this.cursors[n]))){let r=this.cursorLayer.children;if(r.length!==e.length){this.cursorLayer.textContent="";for(let n of e)this.cursorLayer.appendChild(n.draw())}else e.forEach((n,i)=>n.adjust(r[i]));this.cursors=e}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),rk={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};ek&&(rk[".cm-line"].caretColor="transparent !important");var l2=hn.highest(B.theme(rk));function nk(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==ye.LTR?e.left:e.right-t.scrollDOM.clientWidth)-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function nb(t,e,r){let n=A.cursor(e);return{from:Math.max(r.from,t.moveToLineBoundary(n,!1,!0).from),to:Math.min(r.to,t.moveToLineBoundary(n,!0,!0).from),type:he.Text}}function ib(t,e){let r=t.lineBlockAt(e);if(Array.isArray(r.type)){for(let n of r.type)if(n.to>e||n.to==e&&(n.to==r.to||n.type==he.Text))return n}return r}function c2(t,e){if(e.to<=t.viewport.from||e.from>=t.viewport.to)return[];let r=Math.max(e.from,t.viewport.from),n=Math.min(e.to,t.viewport.to),i=t.textDirection==ye.LTR,o=t.contentDOM,s=o.getBoundingClientRect(),a=nk(t),l=window.getComputedStyle(o.firstChild),c=s.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent)),f=s.right-parseInt(l.paddingRight),u=ib(t,r),h=ib(t,n),d=u.type==he.Text?u:null,p=h.type==he.Text?h:null;if(t.lineWrapping&&(d&&(d=nb(t,r,d)),p&&(p=nb(t,n,p))),d&&p&&d.from==p.from)return m(k(e.from,e.to,d));{let _=d?k(e.from,null,d):S(u,!1),w=p?k(null,e.to,p):S(h,!0),C=[];return(d||u).to<(p||h).from-1?C.push(b(c,_.bottom,f,w.top)):_.bottom<w.top&&t.elementAtHeight((_.bottom+w.top)/2).type==he.Text&&(_.bottom=w.top=(_.bottom+w.top)/2),m(_).concat(C).concat(m(w))}function b(_,w,C,E){return new cf(_-a.left,w-a.top-.01,C-_,E-w+.01,"cm-selectionBackground")}function m({top:_,bottom:w,horizontal:C}){let E=[];for(let x=0;x<C.length;x+=2)E.push(b(C[x],_,C[x+1],w));return E}function k(_,w,C){let E=1e9,x=-1e9,T=[];function O(ae,me,ot,Ie,Re){let st=t.coordsAtPos(ae,ae==C.to?-2:2),Ze=t.coordsAtPos(ot,ot==C.from?2:-2);E=Math.min(st.top,Ze.top,E),x=Math.max(st.bottom,Ze.bottom,x),Re==ye.LTR?T.push(i&&me?c:st.left,i&&Ie?f:Ze.right):T.push(!i&&Ie?c:Ze.left,!i&&me?f:st.right)}let M=_??C.from,I=w??C.to;for(let ae of t.visibleRanges)if(ae.to>M&&ae.from<I)for(let me=Math.max(ae.from,M),ot=Math.min(ae.to,I);;){let Ie=t.state.doc.lineAt(me);for(let Re of t.bidiSpans(Ie)){let st=Re.from+Ie.from,Ze=Re.to+Ie.from;if(st>=ot)break;Ze>me&&O(Math.max(st,me),_==null&&st<=M,Math.min(Ze,ot),w==null&&Ze>=I,Re.dir)}if(me=Ie.to+1,me>=ot)break}return T.length==0&&O(M,_==null,I,w==null,t.textDirection),{top:E,bottom:x,horizontal:T}}function S(_,w){let C=s.top+(w?_.top:_.bottom);return{top:C,bottom:C,horizontal:[]}}}function f2(t,e,r){let n=t.coordsAtPos(e.head,e.assoc||1);if(!n)return null;let i=nk(t);return new cf(n.left-i.left,n.top-i.top,-1,n.bottom-n.top,r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}var ik=W.define({map(t,e){return t==null?null:e.mapPos(t)}}),ka=ce.define({create(){return null},update(t,e){return t!=null&&(t=e.changes.mapPos(t)),e.effects.reduce((r,n)=>n.is(ik)?n.value:r,t)}}),u2=de.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e;let r=t.state.field(ka);r==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(ka)!=r||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let t=this.view.state.field(ka),e=t!=null&&this.view.coordsAtPos(t);if(!e)return null;let r=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-r.left+this.view.scrollDOM.scrollLeft,top:e.top-r.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(t){this.cursor&&(t?(this.cursor.style.left=t.left+"px",this.cursor.style.top=t.top+"px",this.cursor.style.height=t.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(ka)!=t&&this.view.dispatch({effects:ik.of(t)})}},{eventHandlers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){(t.target==this.view.contentDOM||!this.view.contentDOM.contains(t.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function ok(){return[ka,u2]}function ob(t,e,r,n,i){e.lastIndex=0;for(let o=t.iterRange(r,n),s=r,a;!o.next().done;s+=o.value.length)if(!o.lineBreak)for(;a=e.exec(o.value);)i(s+a.index,s+a.index+a[0].length,a)}function h2(t,e){let r=t.visibleRanges;if(r.length==1&&r[0].from==t.viewport.from&&r[0].to==t.viewport.to)return r;let n=[];for(let{from:i,to:o}of r)i=Math.max(t.state.doc.lineAt(i).from,i-e),o=Math.min(t.state.doc.lineAt(o).to,o+e),n.length&&n[n.length-1].to>=i?n[n.length-1].to=o:n.push({from:i,to:o});return n}var ip=class{constructor(e){let{regexp:r,decoration:n,boundary:i,maxLength:o=1e3}=e;if(!r.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=r,this.getDeco=typeof n=="function"?n:()=>n,this.boundary=i,this.maxLength=o}createDeco(e){let r=new Mt;for(let{from:n,to:i}of h2(e,this.maxLength))ob(e.state.doc,this.regexp,n,i,(o,s,a)=>r.add(o,s,this.getDeco(a,e,o)));return r.finish()}updateDeco(e,r){let n=1e9,i=-1;return e.docChanged&&e.changes.iterChanges((o,s,a,l)=>{l>e.view.viewport.from&&a<e.view.viewport.to&&(n=Math.min(a,n),i=Math.max(l,i))}),e.viewportChanged||i-n>1e3?this.createDeco(e.view):i>-1?this.updateRange(e.view,r.map(e.changes),n,i):r}updateRange(e,r,n,i){for(let o of e.visibleRanges){let s=Math.max(o.from,n),a=Math.min(o.to,i);if(a>s){let l=e.state.doc.lineAt(s),c=l.to<a?e.state.doc.lineAt(a):l,f=Math.max(o.from,l.from),u=Math.min(o.to,c.to);if(this.boundary){for(;s>l.from;s--)if(this.boundary.test(l.text[s-1-l.from])){f=s;break}for(;a<c.to;a++)if(this.boundary.test(c.text[a-c.from])){u=a;break}}let h=[],d;if(l==c)for(this.regexp.lastIndex=f-l.from;(d=this.regexp.exec(l.text))&&d.index<u-l.from;){let p=d.index+l.from;h.push(this.getDeco(d,e,p).range(p,p+d[0].length))}else ob(e.state.doc,this.regexp,f,u,(p,b,m)=>h.push(this.getDeco(m,e,p).range(p,b)));r=r.update({filterFrom:f,filterTo:u,filter:(p,b)=>p<f||b>u,add:h})}}return r}},op=/x/.unicode!=null?"gu":"g",d2=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,op),p2={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"},_d=null;function m2(){var t;if(_d==null&&typeof document<"u"&&document.body){let e=document.body.style;_d=((t=e.tabSize)!==null&&t!==void 0?t:e.MozTabSize)!=null}return _d||!1}var Gc=j.define({combine(t){let e=gt(t,{render:null,specialChars:d2,addSpecialChars:null});return(e.replaceTabs=!m2())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,op)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,op)),e}});function sk(t={}){return[Gc.of(t),g2()]}var sb=null;function g2(){return sb||(sb=de.fromClass(class{constructor(t){this.view=t,this.decorations=$.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(Gc)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new ip({regexp:t.specialChars,decoration:(e,r,n)=>{let{doc:i}=r.state,o=je(e[0],0);if(o==9){let s=i.lineAt(n),a=r.state.tabSize,l=Pn(s.text,a,n-s.from);return $.replace({widget:new ap((a-l%a)*this.view.defaultCharacterWidth)})}return this.decorationCache[o]||(this.decorationCache[o]=$.replace({widget:new sp(t,o)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(Gc);t.startState.facet(Gc)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))}var y2="\u2022";function b2(t){return t>=32?y2:t==10?"\u2424":String.fromCharCode(9216+t)}var sp=class extends Nt{constructor(e,r){super(),this.options=e,this.code=r}eq(e){return e.code==this.code}toDOM(e){let r=b2(this.code),n=e.state.phrase("Control character")+" "+(p2[this.code]||"0x"+this.code.toString(16)),i=this.options.render&&this.options.render(this.code,n,r);if(i)return i;let o=document.createElement("span");return o.textContent=r,o.title=n,o.setAttribute("aria-label",n),o.className="cm-specialChar",o}ignoreEvent(){return!1}},ap=class extends Nt{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}};function ak(){return v2}var k2=$.line({class:"cm-activeLine"}),v2=de.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,r=[];for(let n of t.state.selection.ranges){if(!n.empty)return $.none;let i=t.lineBlockAt(n.head);i.from>e&&(r.push(k2.range(i.from)),e=i.from)}return $.set(r)}},{decorations:t=>t.decorations});var lp=2e3;function w2(t,e,r){let n=Math.min(e.line,r.line),i=Math.max(e.line,r.line),o=[];if(e.off>lp||r.off>lp||e.col<0||r.col<0){let s=Math.min(e.off,r.off),a=Math.max(e.off,r.off);for(let l=n;l<=i;l++){let c=t.doc.line(l);c.length<=a&&o.push(A.range(c.from+s,c.to+a))}}else{let s=Math.min(e.col,r.col),a=Math.max(e.col,r.col);for(let l=n;l<=i;l++){let c=t.doc.line(l),f=zc(c.text,s,t.tabSize,!0);if(f>-1){let u=zc(c.text,a,t.tabSize);o.push(A.range(c.from+f,c.from+u))}}}return o}function x2(t,e){let r=t.coordsAtPos(t.viewport.from);return r?Math.round(Math.abs((r.left-e)/t.defaultCharacterWidth)):-1}function ab(t,e){let r=t.posAtCoords({x:e.clientX,y:e.clientY},!1),n=t.state.doc.lineAt(r),i=r-n.from,o=i>lp?-1:i==n.length?x2(t,e.clientX):Pn(n.text,t.state.tabSize,r-n.from);return{line:n.number,col:o,off:i}}function S2(t,e){let r=ab(t,e),n=t.state.selection;return r?{update(i){if(i.docChanged){let o=i.changes.mapPos(i.startState.doc.line(r.line).from),s=i.state.doc.lineAt(o);r={line:s.number,col:r.col,off:Math.min(r.off,s.length)},n=n.map(i.changes)}},get(i,o,s){let a=ab(t,i);if(!a)return n;let l=w2(t.state,r,a);return l.length?s?A.create(l.concat(n.ranges)):A.create(l):n}}:null}function lk(t){let e=t?.eventFilter||(r=>r.altKey&&r.button==0);return B.mouseSelectionStyle.of((r,n)=>e(n)?S2(r,n):null)}var _2={Alt:[18,t=>t.altKey],Control:[17,t=>t.ctrlKey],Shift:[16,t=>t.shiftKey],Meta:[91,t=>t.metaKey]},C2={style:"cursor: crosshair"};function ck(t={}){let[e,r]=_2[t.key||"Alt"],n=de.fromClass(class{constructor(i){this.view=i,this.isDown=!1}set(i){this.isDown!=i&&(this.isDown=i,this.view.update([]))}},{eventHandlers:{keydown(i){this.set(i.keyCode==e||r(i))},keyup(i){(i.keyCode==e||!r(i))&&this.set(!1)}}});return[n,B.contentAttributes.of(i=>{var o;return!((o=i.plugin(n))===null||o===void 0)&&o.isDown?C2:null})]}var Cd="-10000px",ff=class{constructor(e,r,n){this.facet=r,this.createTooltipView=n,this.input=e.state.facet(r),this.tooltips=this.input.filter(i=>i),this.tooltipViews=this.tooltips.map(n)}update(e){let r=e.state.facet(this.facet),n=r.filter(o=>o);if(r===this.input){for(let o of this.tooltipViews)o.update&&o.update(e);return!1}let i=[];for(let o=0;o<n.length;o++){let s=n[o],a=-1;if(s){for(let l=0;l<this.tooltips.length;l++){let c=this.tooltips[l];c&&c.create==s.create&&(a=l)}if(a<0)i[o]=this.createTooltipView(s);else{let l=i[o]=this.tooltipViews[a];l.update&&l.update(e)}}}for(let o of this.tooltipViews)i.indexOf(o)<0&&o.dom.remove();return this.input=r,this.tooltips=n,this.tooltipViews=i,!0}};function A2(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}var Ad=j.define({combine:t=>{var e,r,n;return{position:F.ios?"absolute":((e=t.find(i=>i.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((r=t.find(i=>i.parent))===null||r===void 0?void 0:r.parent)||null,tooltipSpace:((n=t.find(i=>i.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||A2}}}),fk=de.fromClass(class{constructor(t){var e;this.view=t,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let r=t.state.facet(Ad);this.position=r.position,this.parent=r.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new ff(t,Da,n=>this.createTooltip(n)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(n=>{Date.now()>this.lastTransaction-50&&n.length>0&&n[n.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(e=t.dom.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t);e&&this.observeIntersection();let r=e||t.geometryChanged,n=t.state.facet(Ad);if(n.position!=this.position){this.position=n.position;for(let i of this.manager.tooltipViews)i.dom.style.position=this.position;r=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let i of this.manager.tooltipViews)this.container.appendChild(i.dom);r=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);r&&this.maybeMeasure()}createTooltip(t){let e=t.create(this.view);if(e.dom.classList.add("cm-tooltip"),t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let r=document.createElement("div");r.className="cm-tooltip-arrow",e.dom.appendChild(r)}return e.dom.style.position=this.position,e.dom.style.top=Cd,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var t,e;(t=this.view.dom.ownerDocument.defaultView)===null||t===void 0||t.removeEventListener("resize",this.measureSoon);for(let{dom:r}of this.manager.tooltipViews)r.remove();(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map((e,r)=>{let n=this.manager.tooltipViews[r];return n.getCoords?n.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(Ad).tooltipSpace(this.view)}}writeMeasure(t){let{editor:e,space:r}=t,n=[];for(let i=0;i<this.manager.tooltips.length;i++){let o=this.manager.tooltips[i],s=this.manager.tooltipViews[i],{dom:a}=s,l=t.pos[i],c=t.size[i];if(!l||l.bottom<=Math.max(e.top,r.top)||l.top>=Math.min(e.bottom,r.bottom)||l.right<Math.max(e.left,r.left)-.1||l.left>Math.min(e.right,r.right)+.1){a.style.top=Cd;continue}let f=o.arrow?s.dom.querySelector(".cm-tooltip-arrow"):null,u=f?7:0,h=c.right-c.left,d=c.bottom-c.top,p=s.offset||O2,b=this.view.textDirection==ye.LTR,m=c.width>r.right-r.left?b?r.left:r.right-c.width:b?Math.min(l.left-(f?14:0)+p.x,r.right-h):Math.max(r.left,l.left-h+(f?14:0)-p.x),k=!!o.above;!o.strictSide&&(k?l.top-(c.bottom-c.top)-p.y<r.top:l.bottom+(c.bottom-c.top)+p.y>r.bottom)&&k==r.bottom-l.bottom>l.top-r.top&&(k=!k);let S=k?l.top-d-u-p.y:l.bottom+u+p.y,_=m+h;if(s.overlap!==!0)for(let w of n)w.left<_&&w.right>m&&w.top<S+d&&w.bottom>S&&(S=k?w.top-d-2-u:w.bottom+u+2);this.position=="absolute"?(a.style.top=S-t.parent.top+"px",a.style.left=m-t.parent.left+"px"):(a.style.top=S+"px",a.style.left=m+"px"),f&&(f.style.left=`${l.left+(b?p.x:-p.x)-(m+14-7)}px`),s.overlap!==!0&&n.push({left:m,top:S,right:_,bottom:S+d}),a.classList.toggle("cm-tooltip-above",k),a.classList.toggle("cm-tooltip-below",!k),s.positioned&&s.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=Cd}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),T2=B.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),O2={x:0,y:0},Da=j.define({enables:[fk,T2]}),uf=j.define(),Ra=class{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new ff(e,uf,r=>this.createHostedView(r))}static create(e){return new Ra(e)}createHostedView(e){let r=e.create(this.view);return r.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(r.dom),this.mounted&&r.mount&&r.mount(this.view),r}mount(e){for(let r of this.manager.tooltipViews)r.mount&&r.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}},E2=Da.compute([uf],t=>{let e=t.facet(uf).filter(r=>r);return e.length===0?null:{pos:Math.min(...e.map(r=>r.pos)),end:Math.max(...e.filter(r=>r.end!=null).map(r=>r.end)),create:Ra.create,above:e[0].above,arrow:e.some(r=>r.arrow)}}),cp=class{constructor(e,r,n,i,o){this.view=e,this.source=r,this.field=n,this.setHover=i,this.hoverTime=o,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,r=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(r==null)return;let n=this.view.coordsAtPos(r);if(n==null||e.y<n.top||e.y>n.bottom||e.x<n.left-this.view.defaultCharacterWidth||e.x>n.right+this.view.defaultCharacterWidth)return;let i=this.view.bidiSpans(this.view.state.doc.lineAt(r)).find(a=>a.from<=r&&a.to>=r),o=i&&i.dir==ye.RTL?-1:1,s=this.source(this.view,r,e.x<n.left?-o:o);if(s?.then){let a=this.pending={pos:r};s.then(l=>{this.pending==a&&(this.pending=null,l&&this.view.dispatch({effects:this.setHover.of(l)}))},l=>at(this.view.state,l,"hover tooltip"))}else s&&this.view.dispatch({effects:this.setHover.of(s)})}mousemove(e){var r;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let n=this.active;if(n&&!R2(this.lastMove.target)||this.pending){let{pos:i}=n||this.pending,o=(r=n?.end)!==null&&r!==void 0?r:i;(i==o?this.view.posAtCoords(this.lastMove)!=i:!M2(this.view,i,o,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}};function R2(t){for(let e=t;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function M2(t,e,r,n,i,o){let s=document.createRange(),a=t.domAtPos(e),l=t.domAtPos(r);s.setEnd(l.node,l.offset),s.setStart(a.node,a.offset);let c=s.getClientRects();s.detach();for(let f=0;f<c.length;f++){let u=c[f];if(Math.max(u.top-i,i-u.bottom,u.left-n,n-u.right)<=o)return!0}return!1}function uk(t,e={}){let r=W.define(),n=ce.define({create(){return null},update(i,o){if(i&&(e.hideOnChange&&(o.docChanged||o.selection)||e.hideOn&&e.hideOn(o,i)))return null;if(i&&o.docChanged){let s=o.changes.mapPos(i.pos,-1,Je.TrackDel);if(s==null)return null;let a=Object.assign(Object.create(null),i);a.pos=s,i.end!=null&&(a.end=o.changes.mapPos(i.end)),i=a}for(let s of o.effects)s.is(r)&&(i=s.value),s.is(D2)&&(i=null);return i},provide:i=>uf.from(i)});return[n,de.define(i=>new cp(i,t,n,r,e.hoverTime||300)),E2]}function hk(t,e){let r=t.plugin(fk);if(!r)return null;let n=r.manager.tooltips.indexOf(e);return n<0?null:r.manager.tooltipViews[n]}var D2=W.define();var lb=j.define({combine(t){let e,r;for(let n of t)e=e||n.topContainer,r=r||n.bottomContainer;return{topContainer:e,bottomContainer:r}}});function Bi(t,e){let r=t.plugin(dk),n=r?r.specs.indexOf(e):-1;return n>-1?r.panels[n]:null}var dk=de.fromClass(class{constructor(t){this.input=t.state.facet(Li),this.specs=this.input.filter(r=>r),this.panels=this.specs.map(r=>r(t));let e=t.state.facet(lb);this.top=new Vo(t,!0,e.topContainer),this.bottom=new Vo(t,!1,e.bottomContainer),this.top.sync(this.panels.filter(r=>r.top)),this.bottom.sync(this.panels.filter(r=>!r.top));for(let r of this.panels)r.dom.classList.add("cm-panel"),r.mount&&r.mount()}update(t){let e=t.state.facet(lb);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Vo(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Vo(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let r=t.state.facet(Li);if(r!=this.input){let n=r.filter(l=>l),i=[],o=[],s=[],a=[];for(let l of n){let c=this.specs.indexOf(l),f;c<0?(f=l(t.view),a.push(f)):(f=this.panels[c],f.update&&f.update(t)),i.push(f),(f.top?o:s).push(f)}this.specs=n,this.panels=i,this.top.sync(o),this.bottom.sync(s);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let n of this.panels)n.update&&n.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>B.scrollMargins.of(e=>{let r=e.plugin(t);return r&&{top:r.top.scrollMargin(),bottom:r.bottom.scrollMargin()}})}),Vo=class{constructor(e,r,n){this.view=e,this.top=r,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let r of this.panels)r.destroy&&e.indexOf(r)<0&&r.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let r=this.container||this.view.dom;r.insertBefore(this.dom,this.top?r.firstChild:null)}let e=this.dom.firstChild;for(let r of this.panels)if(r.dom.parentNode==this.dom){for(;e!=r.dom;)e=cb(e);e=e.nextSibling}else this.dom.insertBefore(r.dom,e);for(;e;)e=cb(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}};function cb(t){let e=t.nextSibling;return t.remove(),e}var Li=j.define({enables:dk}),Pt=class extends kr{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}};Pt.prototype.elementClass="";Pt.prototype.toDOM=void 0;Pt.prototype.mapMode=Je.TrackBefore;Pt.prototype.startSide=Pt.prototype.endSide=-1;Pt.prototype.point=!0;var Zc=j.define(),N2={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>te.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Sa=j.define();function mp(t){return[pk(),Sa.of(Object.assign(Object.assign({},N2),t))]}var fp=j.define({combine:t=>t.some(e=>e)});function pk(t){let e=[P2];return t&&t.fixed===!1&&e.push(fp.of(!0)),e}var P2=de.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=t.state.facet(Sa).map(e=>new hf(t,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!t.state.facet(fp),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,r=t.view.viewport,n=Math.min(e.to,r.to)-Math.max(e.from,r.from);this.syncGutters(n<(r.to-r.from)*.8)}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(fp)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let r=te.iter(this.view.state.facet(Zc),this.view.viewport.from),n=[],i=this.gutters.map(o=>new up(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks){let s;if(Array.isArray(o.type)){for(let a of o.type)if(a.type==he.Text){s=a;break}}else s=o.type==he.Text?o:void 0;if(s){n.length&&(n=[]),mk(r,n,o.from);for(let a of i)a.line(this.view,s,n)}}for(let o of i)o.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(Sa),r=t.state.facet(Sa),n=t.docChanged||t.heightChanged||t.viewportChanged||!te.eq(t.startState.facet(Zc),t.state.facet(Zc),t.view.viewport.from,t.view.viewport.to);if(e==r)for(let i of this.gutters)i.update(t)&&(n=!0);else{n=!0;let i=[];for(let o of r){let s=e.indexOf(o);s<0?i.push(new hf(this.view,o)):(this.gutters[s].update(t),i.push(this.gutters[s]))}for(let o of this.gutters)o.dom.remove(),i.indexOf(o)<0&&o.destroy();for(let o of i)this.dom.appendChild(o.dom);this.gutters=i}return n}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:t=>B.scrollMargins.of(e=>{let r=e.plugin(t);return!r||r.gutters.length==0||!r.fixed?null:e.textDirection==ye.LTR?{left:r.dom.offsetWidth}:{right:r.dom.offsetWidth}})});function fb(t){return Array.isArray(t)?t:[t]}function mk(t,e,r){for(;t.value&&t.from<=r;)t.from==r&&e.push(t.value),t.next()}var up=class{constructor(e,r,n){this.gutter=e,this.height=n,this.localMarkers=[],this.i=0,this.cursor=te.iter(e.markers,r.from)}line(e,r,n){this.localMarkers.length&&(this.localMarkers=[]),mk(this.cursor,this.localMarkers,r.from);let i=n.length?this.localMarkers.concat(n):this.localMarkers,o=this.gutter.config.lineMarker(e,r,i);o&&i.unshift(o);let s=this.gutter;if(i.length==0&&!s.config.renderEmptyElements)return;let a=r.top-this.height;if(this.i==s.elements.length){let l=new df(e,r.height,a,i);s.elements.push(l),s.dom.appendChild(l.dom)}else s.elements[this.i].update(e,r.height,a,i);this.height=r.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let r=e.elements.pop();e.dom.removeChild(r.dom),r.destroy()}}},hf=class{constructor(e,r){this.view=e,this.config=r,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in r.domEventHandlers)this.dom.addEventListener(n,i=>{let o=e.lineBlockAtHeight(i.clientY-e.documentTop);r.domEventHandlers[n](e,o,i)&&i.preventDefault()});this.markers=fb(r.markers(e)),r.initialSpacer&&(this.spacer=new df(e,0,0,[r.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let r=this.markers;if(this.markers=fb(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let i=this.config.updateSpacer(this.spacer.markers[0],e);i!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[i])}let n=e.view.viewport;return!te.eq(this.markers,r,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}},df=class{constructor(e,r,n,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,r,n,i)}update(e,r,n,i){this.height!=r&&(this.dom.style.height=(this.height=r)+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),L2(this.markers,i)||this.setMarkers(e,i)}setMarkers(e,r){let n="cm-gutterElement",i=this.dom.firstChild;for(let o=0,s=0;;){let a=s,l=o<r.length?r[o++]:null,c=!1;if(l){let f=l.elementClass;f&&(n+=" "+f);for(let u=s;u<this.markers.length;u++)if(this.markers[u].compare(l)){a=u,c=!0;break}}else a=this.markers.length;for(;s<a;){let f=this.markers[s++];if(f.toDOM){f.destroy(i);let u=i.nextSibling;i.remove(),i=u}}if(!l)break;l.toDOM&&(c?i=i.nextSibling:this.dom.insertBefore(l.toDOM(e),i)),c&&s++}this.dom.className=n,this.markers=r}destroy(){this.setMarkers(null,[])}};function L2(t,e){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!t[r].compare(e[r]))return!1;return!0}var I2=j.define(),Uo=j.define({combine(t){return gt(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,r){let n=Object.assign({},e);for(let i in r){let o=n[i],s=r[i];n[i]=o?(a,l,c)=>o(a,l,c)||s(a,l,c):s}return n}})}}),_a=class extends Pt{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}};function Td(t,e){return t.state.facet(Uo).formatNumber(e,t.state)}var B2=Sa.compute([Uo],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(I2)},lineMarker(e,r,n){return n.some(i=>i.toDOM)?null:new _a(Td(e,e.state.doc.lineAt(r.from).number))},lineMarkerChange:e=>e.startState.facet(Uo)!=e.state.facet(Uo),initialSpacer(e){return new _a(Td(e,ub(e.state.doc.lines)))},updateSpacer(e,r){let n=Td(r.view,ub(r.view.state.doc.lines));return n==e.number?e:new _a(n)},domEventHandlers:t.facet(Uo).domEventHandlers}));function gk(t={}){return[Uo.of(t),pk(),B2]}function ub(t){let e=9;for(;e<t;)e=e*10+9;return e}var j2=new class extends Pt{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},$2=Zc.compute(["selection"],t=>{let e=[],r=-1;for(let n of t.selection.ranges)if(n.empty){let i=t.doc.lineAt(n.head).from;i>r&&(r=i,e.push(j2.range(i)))}return te.of(e)});function yk(){return $2}var z2=0,Na=class{constructor(e,r){this.from=e,this.to=r}},Z=class{constructor(e={}){this.id=z2++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=bt.match(e)),r=>{let n=e(r);return n===void 0?null:[this,n]}}};Z.closedBy=new Z({deserialize:t=>t.split(" ")});Z.openedBy=new Z({deserialize:t=>t.split(" ")});Z.group=new Z({deserialize:t=>t.split(" ")});Z.contextHash=new Z({perNode:!0});Z.lookAhead=new Z({perNode:!0});Z.mounted=new Z({perNode:!0});var F2=Object.create(null),bt=class{constructor(e,r,n,i=0){this.name=e,this.props=r,this.id=n,this.flags=i}static define(e){let r=e.props&&e.props.length?Object.create(null):F2,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new bt(e.name||"",r,e.id,n);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(i)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");r[o[0].id]=o[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let r=this.prop(Z.group);return r?r.indexOf(e)>-1:!1}return this.id==e}static match(e){let r=Object.create(null);for(let n in e)for(let i of n.split(" "))r[i]=e[n];return n=>{for(let i=n.prop(Z.group),o=-1;o<(i?i.length:0);o++){let s=r[o<0?n.name:i[o]];if(s)return s}}}};bt.none=new bt("",Object.create(null),0,8);var gf=new WeakMap,bk=new WeakMap,Xe;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(Xe||(Xe={}));var Fe=class{constructor(e,r,n,i,o){if(this.type=e,this.children=r,this.positions=n,this.length=i,this.props=null,o&&o.length){this.props=Object.create(null);for(let[s,a]of o)this.props[typeof s=="number"?s:s.id]=a}}toString(){let e=this.prop(Z.mounted);if(e&&!e.overlay)return e.tree.toString();let r="";for(let n of this.children){let i=n.toString();i&&(r&&(r+=","),r+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(r.length?"("+r+")":""):r}cursor(e=0){return new Jo(this.topNode,e)}cursorAt(e,r=0,n=0){let i=gf.get(this)||this.topNode,o=new Jo(i);return o.moveTo(e,r),gf.set(this,o._tree),o}get topNode(){return new wr(this,0,0,null)}resolve(e,r=0){let n=Zo(gf.get(this)||this.topNode,e,r,!1);return gf.set(this,n),n}resolveInner(e,r=0){let n=Zo(bk.get(this)||this.topNode,e,r,!0);return bk.set(this,n),n}iterate(e){let{enter:r,leave:n,from:i=0,to:o=this.length}=e;for(let s=this.cursor((e.mode||0)|Xe.IncludeAnonymous);;){let a=!1;if(s.from<=o&&s.to>=i&&(s.type.isAnonymous||r(s)!==!1)){if(s.firstChild())continue;a=!0}for(;a&&n&&!s.type.isAnonymous&&n(s),!s.nextSibling();){if(!s.parent())return;a=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let r in this.props)e.push([+r,this.props[r]]);return e}balance(e={}){return this.children.length<=8?this:kp(bt.none,this.children,this.positions,0,this.children.length,0,this.length,(r,n,i)=>new Fe(this.type,r,n,i,this.propValues),e.makeTree||((r,n,i)=>new Fe(bt.none,r,n,i)))}static build(e){return V2(e)}};Fe.empty=new Fe(bt.none,[],[],0);var Pa=class{constructor(e,r){this.buffer=e,this.index=r}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Pa(this.buffer,this.index)}},gn=class{constructor(e,r,n){this.buffer=e,this.length=r,this.set=n}get type(){return bt.none}toString(){let e=[];for(let r=0;r<this.buffer.length;)e.push(this.childString(r)),r=this.buffer[r+3];return e.join(",")}childString(e){let r=this.buffer[e],n=this.buffer[e+3],i=this.set.types[r],o=i.name;if(/\W/.test(o)&&!i.isError&&(o=JSON.stringify(o)),e+=4,n==e)return o;let s=[];for(;e<n;)s.push(this.childString(e)),e=this.buffer[e+3];return o+"("+s.join(",")+")"}findChild(e,r,n,i,o){let{buffer:s}=this,a=-1;for(let l=e;l!=r&&!(vk(o,i,s[l+1],s[l+2])&&(a=l,n>0));l=s[l+3]);return a}slice(e,r,n,i){let o=this.buffer,s=new Uint16Array(r-e);for(let a=e,l=0;a<r;)s[l++]=o[a++],s[l++]=o[a++]-n,s[l++]=o[a++]-n,s[l++]=o[a++]-e;return new gn(s,i-n,this.set)}};function vk(t,e,r,n){switch(t){case-2:return r<e;case-1:return n>=e&&r<e;case 0:return r<e&&n>e;case 1:return r<=e&&n>e;case 2:return n>e;case 4:return!0}}function wk(t,e){let r=t.childBefore(e);for(;r;){let n=r.lastChild;if(!n||n.to!=r.to)break;n.type.isError&&n.from==n.to?(t=r,r=n.prevSibling):r=n}return t}function Zo(t,e,r,n){for(var i;t.from==t.to||(r<1?t.from>=e:t.from>e)||(r>-1?t.to<=e:t.to<e);){let s=!n&&t instanceof wr&&t.index<0?null:t.parent;if(!s)return t;t=s}let o=n?0:Xe.IgnoreOverlays;if(n)for(let s=t,a=s.parent;a;s=a,a=s.parent)s instanceof wr&&s.index<0&&((i=a.enter(e,r,o))===null||i===void 0?void 0:i.from)!=s.from&&(t=a);for(;;){let s=t.enter(e,r,o);if(!s)return t;t=s}}var wr=class{constructor(e,r,n,i){this._tree=e,this.from=r,this.index=n,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,r,n,i,o=0){for(let s=this;;){for(let{children:a,positions:l}=s._tree,c=r>0?a.length:-1;e!=c;e+=r){let f=a[e],u=l[e]+s.from;if(vk(i,n,u,u+f.length)){if(f instanceof gn){if(o&Xe.ExcludeBuffers)continue;let h=f.findChild(0,f.buffer.length,r,n-u,i);if(h>-1)return new Vr(new gp(s,f,e,u),null,h)}else if(o&Xe.IncludeAnonymous||!f.type.isAnonymous||bp(f)){let h;if(!(o&Xe.IgnoreMounts)&&f.props&&(h=f.prop(Z.mounted))&&!h.overlay)return new wr(h.tree,u,e,s);let d=new wr(f,u,e,s);return o&Xe.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(r<0?f.children.length-1:0,r,n,i)}}}if(o&Xe.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+r:e=r<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,r,n=0){let i;if(!(n&Xe.IgnoreOverlays)&&(i=this._tree.prop(Z.mounted))&&i.overlay){let o=e-this.from;for(let{from:s,to:a}of i.overlay)if((r>0?s<=o:s<o)&&(r<0?a>=o:a>o))return new wr(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,r,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new Jo(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,r=0){return Zo(this,e,r,!1)}resolveInner(e,r=0){return Zo(this,e,r,!0)}enterUnfinishedNodesBefore(e){return wk(this,e)}getChild(e,r=null,n=null){let i=bf(this,e,r,n);return i.length?i[0]:null}getChildren(e,r=null,n=null){return bf(this,e,r,n)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return kf(this,e)}};function bf(t,e,r,n){let i=t.cursor(),o=[];if(!i.firstChild())return o;if(r!=null){for(;!i.type.is(r);)if(!i.nextSibling())return o}for(;;){if(n!=null&&i.type.is(n))return o;if(i.type.is(e)&&o.push(i.node),!i.nextSibling())return n==null?o:[]}}function kf(t,e,r=e.length-1){for(let n=t.parent;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[r]&&e[r]!=n.name)return!1;r--}}return!0}var gp=class{constructor(e,r,n,i){this.parent=e,this.buffer=r,this.index=n,this.start=i}},Vr=class{constructor(e,r,n){this.context=e,this._parent=r,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,r,n){let{buffer:i}=this.context,o=i.findChild(this.index+4,i.buffer[this.index+3],e,r-this.context.start,n);return o<0?null:new Vr(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,r,n=0){if(n&Xe.ExcludeBuffers)return null;let{buffer:i}=this.context,o=i.findChild(this.index+4,i.buffer[this.index+3],r>0?1:-1,e-this.context.start,r);return o<0?null:new Vr(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,r=e.buffer[this.index+3];return r<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Vr(this.context,this._parent,r):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,r=this._parent?this._parent.index+4:0;return this.index==r?this.externalSibling(-1):new Vr(this.context,this._parent,e.findChild(r,this.index,-1,0,4))}cursor(e=0){return new Jo(this,e)}get tree(){return null}toTree(){let e=[],r=[],{buffer:n}=this.context,i=this.index+4,o=n.buffer[this.index+3];if(o>i){let s=n.buffer[this.index+1],a=n.buffer[this.index+2];e.push(n.slice(i,o,s,a)),r.push(0)}return new Fe(this.type,e,r,this.to-this.from)}resolve(e,r=0){return Zo(this,e,r,!1)}resolveInner(e,r=0){return Zo(this,e,r,!0)}enterUnfinishedNodesBefore(e){return wk(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,r=null,n=null){let i=bf(this,e,r,n);return i.length?i[0]:null}getChildren(e,r=null,n=null){return bf(this,e,r,n)}get node(){return this}matchContext(e){return kf(this,e)}},Jo=class{constructor(e,r=0){if(this.mode=r,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof wr)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,r){this.index=e;let{start:n,buffer:i}=this.buffer;return this.type=r||i.set.types[i.buffer[e]],this.from=n+i.buffer[e+1],this.to=n+i.buffer[e+2],!0}yield(e){return e?e instanceof wr?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,r,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,r,n,this.mode));let{buffer:i}=this.buffer,o=i.findChild(this.index+4,i.buffer[this.index+3],e,r-this.buffer.start,n);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,r,n=this.mode){return this.buffer?n&Xe.ExcludeBuffers?!1:this.enterChild(1,e,r):this.yield(this._tree.enter(e,r,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Xe.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Xe.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:r}=this.buffer,n=this.stack.length-1;if(e<0){let i=n<0?0:this.stack[n]+4;if(this.index!=i)return this.yieldBuf(r.findChild(i,this.index,-1,0,4))}else{let i=r.buffer[this.index+3];if(i<(n<0?r.buffer.length:r.buffer[this.stack[n]+3]))return this.yieldBuf(i)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let r,n,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(i.buffer.buffer[o+3]<this.index)return!1;({index:r,parent:n}=i)}else({index:r,_parent:n}=this._tree);for(;n;{index:r,_parent:n}=n)if(r>-1)for(let o=r+e,s=e<0?-1:n._tree.children.length;o!=s;o+=e){let a=n._tree.children[o];if(this.mode&Xe.IncludeAnonymous||a instanceof gn||!a.type.isAnonymous||bp(a))return!1}return!0}move(e,r){if(r&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,r=0){for(;(this.from==this.to||(r<1?this.from>=e:this.from>e)||(r>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,r););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,r=null,n=0;if(e&&e.context==this.buffer)e:for(let i=this.index,o=this.stack.length;o>=0;){for(let s=e;s;s=s._parent)if(s.index==i){if(i==this.index)return s;r=s,n=o+1;break e}i=this.stack[--o]}for(let i=n;i<this.stack.length;i++)r=new Vr(this.buffer,r,this.stack[i]);return this.bufferNode=new Vr(this.buffer,r,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,r){for(let n=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(i=!0)}for(;i&&r&&r(this),i=this.type.isAnonymous,!this.nextSibling();){if(!n)return;this.parent(),n--,i=!0}}}matchContext(e){if(!this.buffer)return kf(this.node,e);let{buffer:r}=this.buffer,{types:n}=r.set;for(let i=e.length-1,o=this.stack.length-1;i>=0;o--){if(o<0)return kf(this.node,e,i);let s=n[r.buffer[this.stack[o]]];if(!s.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}};function bp(t){return t.children.some(e=>e instanceof gn||!e.type.isAnonymous||bp(e))}function V2(t){var e;let{buffer:r,nodeSet:n,maxBufferLength:i=1024,reused:o=[],minRepeatType:s=n.types.length}=t,a=Array.isArray(r)?new Pa(r,r.length):r,l=n.types,c=0,f=0;function u(w,C,E,x,T){let{id:O,start:M,end:I,size:ae}=a,me=f;for(;ae<0;)if(a.next(),ae==-1){let Ze=o[O];E.push(Ze),x.push(M-w);return}else if(ae==-3){c=O;return}else if(ae==-4){f=O;return}else throw new RangeError(`Unrecognized record size: ${ae}`);let ot=l[O],Ie,Re,st=M-w;if(I-M<=i&&(Re=b(a.pos-C,T))){let Ze=new Uint16Array(Re.size-Re.skip),gr=a.pos-Re.size,un=Ze.length;for(;a.pos>gr;)un=m(Re.start,Ze,un);Ie=new gn(Ze,I-Re.start,n),st=Re.start-w}else{let Ze=a.pos-ae;a.next();let gr=[],un=[],Oi=O>=s?O:-1,No=0,Ec=I;for(;a.pos>Ze;)Oi>=0&&a.id==Oi&&a.size>=0?(a.end<=Ec-i&&(d(gr,un,M,No,a.end,Ec,Oi,me),No=gr.length,Ec=a.end),a.next()):u(M,Ze,gr,un,Oi);if(Oi>=0&&No>0&&No<gr.length&&d(gr,un,M,No,M,Ec,Oi,me),gr.reverse(),un.reverse(),Oi>-1&&No>0){let Jy=h(ot);Ie=kp(ot,gr,un,0,gr.length,0,I-M,Jy,Jy)}else Ie=p(ot,gr,un,I-M,me-I)}E.push(Ie),x.push(st)}function h(w){return(C,E,x)=>{let T=0,O=C.length-1,M,I;if(O>=0&&(M=C[O])instanceof Fe){if(!O&&M.type==w&&M.length==x)return M;(I=M.prop(Z.lookAhead))&&(T=E[O]+M.length+I)}return p(w,C,E,x,T)}}function d(w,C,E,x,T,O,M,I){let ae=[],me=[];for(;w.length>x;)ae.push(w.pop()),me.push(C.pop()+E-T);w.push(p(n.types[M],ae,me,O-T,I-O)),C.push(T-E)}function p(w,C,E,x,T=0,O){if(c){let M=[Z.contextHash,c];O=O?[M].concat(O):[M]}if(T>25){let M=[Z.lookAhead,T];O=O?[M].concat(O):[M]}return new Fe(w,C,E,x,O)}function b(w,C){let E=a.fork(),x=0,T=0,O=0,M=E.end-i,I={size:0,start:0,skip:0};e:for(let ae=E.pos-w;E.pos>ae;){let me=E.size;if(E.id==C&&me>=0){I.size=x,I.start=T,I.skip=O,O+=4,x+=4,E.next();continue}let ot=E.pos-me;if(me<0||ot<ae||E.start<M)break;let Ie=E.id>=s?4:0,Re=E.start;for(E.next();E.pos>ot;){if(E.size<0)if(E.size==-3)Ie+=4;else break e;else E.id>=s&&(Ie+=4);E.next()}T=Re,x+=me,O+=Ie}return(C<0||x==w)&&(I.size=x,I.start=T,I.skip=O),I.size>4?I:void 0}function m(w,C,E){let{id:x,start:T,end:O,size:M}=a;if(a.next(),M>=0&&x<s){let I=E;if(M>4){let ae=a.pos-(M-4);for(;a.pos>ae;)E=m(w,C,E)}C[--E]=I,C[--E]=O-w,C[--E]=T-w,C[--E]=x}else M==-3?c=x:M==-4&&(f=x);return E}let k=[],S=[];for(;a.pos>0;)u(t.start||0,t.bufferStart||0,k,S,-1);let _=(e=t.length)!==null&&e!==void 0?e:k.length?S[0]+k[0].length:0;return new Fe(l[t.topID],k.reverse(),S.reverse(),_)}var kk=new WeakMap;function yf(t,e){if(!t.isAnonymous||e instanceof gn||e.type!=t)return 1;let r=kk.get(e);if(r==null){r=1;for(let n of e.children){if(n.type!=t||!(n instanceof Fe)){r=1;break}r+=yf(t,n)}kk.set(e,r)}return r}function kp(t,e,r,n,i,o,s,a,l){let c=0;for(let p=n;p<i;p++)c+=yf(t,e[p]);let f=Math.ceil(c*1.5/8),u=[],h=[];function d(p,b,m,k,S){for(let _=m;_<k;){let w=_,C=b[_],E=yf(t,p[_]);for(_++;_<k;_++){let x=yf(t,p[_]);if(E+x>=f)break;E+=x}if(_==w+1){if(E>f){let x=p[w];d(x.children,x.positions,0,x.children.length,b[w]+S);continue}u.push(p[w])}else{let x=b[_-1]+p[_-1].length-C;u.push(kp(t,p,b,w,_,C,x,null,l))}h.push(C+S-o)}}return d(e,r,n,i,0),(a||l)(u,h,s)}var Ur=class{constructor(e,r,n,i,o=!1,s=!1){this.from=e,this.to=r,this.tree=n,this.offset=i,this.open=(o?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,r=[],n=!1){let i=[new Ur(0,e.length,e,0,!1,n)];for(let o of r)o.to>e.length&&i.push(o);return i}static applyChanges(e,r,n=128){if(!r.length)return e;let i=[],o=1,s=e.length?e[0]:null;for(let a=0,l=0,c=0;;a++){let f=a<r.length?r[a]:null,u=f?f.fromA:1e9;if(u-l>=n)for(;s&&s.from<u;){let h=s;if(l>=h.from||u<=h.to||c){let d=Math.max(h.from,l)-c,p=Math.min(h.to,u)-c;h=d>=p?null:new Ur(d,p,h.tree,h.offset+c,a>0,!!f)}if(h&&i.push(h),s.to>u)break;s=o<e.length?e[o++]:null}if(!f)break;l=f.toA,c=f.toA-f.toB}return i}},vf=class{startParse(e,r,n){return typeof e=="string"&&(e=new yp(e)),n=n?n.length?n.map(i=>new Na(i.from,i.to)):[new Na(0,0)]:[new Na(0,e.length)],this.createParse(e,r||[],n)}parse(e,r,n){let i=this.startParse(e,r,n);for(;;){let o=i.advance();if(o)return o}}},yp=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,r){return this.string.slice(e,r)}};var nB=new Z({perNode:!0});var U2=0,Jt=class{constructor(e,r,n){this.set=e,this.base=r,this.modified=n,this.id=U2++}static define(e){if(e?.base)throw new Error("Can not derive from a modified tag");let r=new Jt([],null,[]);if(r.set.push(r),e)for(let n of e.set)r.set.push(n);return r}static defineModifier(){let e=new Yo;return r=>r.modified.indexOf(e)>-1?r:Yo.get(r.base||r,r.modified.concat(e).sort((n,i)=>n.id-i.id))}},H2=0,Yo=class{constructor(){this.instances=[],this.id=H2++}static get(e,r){if(!r.length)return e;let n=r[0].instances.find(a=>a.base==e&&W2(r,a.modified));if(n)return n;let i=[],o=new Jt(i,e,r);for(let a of r)a.instances.push(o);let s=_k(r);for(let a of e.set)for(let l of s)i.push(Yo.get(a,l));return o}};function W2(t,e){return t.length==e.length&&t.every((r,n)=>r==e[n])}function _k(t){let e=[t];for(let r=0;r<t.length;r++)for(let n of _k(t.slice(0,r).concat(t.slice(r+1))))e.push(n);return e}function Ck(t){let e=Object.create(null);for(let r in t){let n=t[r];Array.isArray(n)||(n=[n]);for(let i of r.split(" "))if(i){let o=[],s=2,a=i;for(let u=0;;){if(a=="..."&&u>0&&u+3==i.length){s=1;break}let h=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!h)throw new RangeError("Invalid path: "+i);if(o.push(h[0]=="*"?"":h[0][0]=='"'?JSON.parse(h[0]):h[0]),u+=h[0].length,u==i.length)break;let d=i[u++];if(u==i.length&&d=="!"){s=0;break}if(d!="/")throw new RangeError("Invalid path: "+i);a=i.slice(u)}let l=o.length-1,c=o[l];if(!c)throw new RangeError("Invalid path: "+i);let f=new wp(n,s,l>0?o.slice(0,l):null);e[c]=f.sort(e[c])}}return Ak.add(e)}var Ak=new Z,wp=class{constructor(e,r,n,i){this.tags=e,this.mode=r,this.context=n,this.next=i}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}};function _p(t,e){let r=Object.create(null);for(let o of t)if(!Array.isArray(o.tag))r[o.tag.id]=o.class;else for(let s of o.tag)r[s.id]=o.class;let{scope:n,all:i=null}=e||{};return{style:o=>{let s=i;for(let a of o)for(let l of a.set){let c=r[l.id];if(c){s=s?s+" "+c:c;break}}return s},scope:n}}function q2(t,e){let r=null;for(let n of t){let i=n.style(e);i&&(r=r?r+" "+i:i)}return r}function Tk(t,e,r,n=0,i=t.length){let o=new xp(n,Array.isArray(e)?e:[e],r);o.highlightRange(t.cursor(),n,i,"",o.highlighters),o.flush(i)}var xp=class{constructor(e,r,n){this.at=e,this.highlighters=r,this.span=n,this.class=""}startSpan(e,r){r!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=r)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,r,n,i,o){let{type:s,from:a,to:l}=e;if(a>=n||l<=r)return;s.isTop&&(o=this.highlighters.filter(d=>!d.scope||d.scope(s)));let c=i,f=s.prop(Ak),u=!1;for(;f;){if(!f.context||e.matchContext(f.context)){let d=q2(o,f.tags);d&&(c&&(c+=" "),c+=d,f.mode==1?i+=(i?" ":"")+d:f.mode==0&&(u=!0));break}f=f.next}if(this.startSpan(e.from,c),u)return;let h=e.tree&&e.tree.prop(Z.mounted);if(h&&h.overlay){let d=e.node.enter(h.overlay[0].from+a,1),p=this.highlighters.filter(m=>!m.scope||m.scope(h.tree.type)),b=e.firstChild();for(let m=0,k=a;;m++){let S=m<h.overlay.length?h.overlay[m]:null,_=S?S.from+a:l,w=Math.max(r,k),C=Math.min(n,_);if(w<C&&b)for(;e.from<C&&(this.highlightRange(e,w,C,i,o),this.startSpan(Math.min(n,e.to),c),!(e.to>=_||!e.nextSibling())););if(!S||_>n)break;k=S.to+a,k>r&&(this.highlightRange(d.cursor(),Math.max(r,S.from+a),Math.min(n,k),i,p),this.startSpan(k,c))}b&&e.parent()}else if(e.firstChild()){do if(!(e.to<=r)){if(e.from>=n)break;this.highlightRange(e,r,n,i,o),this.startSpan(Math.min(n,e.to),c)}while(e.nextSibling());e.parent()}}},D=Jt.define,wf=D(),$n=D(),xk=D($n),Sk=D($n),zn=D(),xf=D(zn),vp=D(zn),qr=D(),ji=D(qr),Hr=D(),Wr=D(),Sp=D(),La=D(Sp),Sf=D(),N={comment:wf,lineComment:D(wf),blockComment:D(wf),docComment:D(wf),name:$n,variableName:D($n),typeName:xk,tagName:D(xk),propertyName:Sk,attributeName:D(Sk),className:D($n),labelName:D($n),namespace:D($n),macroName:D($n),literal:zn,string:xf,docString:D(xf),character:D(xf),attributeValue:D(xf),number:vp,integer:D(vp),float:D(vp),bool:D(zn),regexp:D(zn),escape:D(zn),color:D(zn),url:D(zn),keyword:Hr,self:D(Hr),null:D(Hr),atom:D(Hr),unit:D(Hr),modifier:D(Hr),operatorKeyword:D(Hr),controlKeyword:D(Hr),definitionKeyword:D(Hr),moduleKeyword:D(Hr),operator:Wr,derefOperator:D(Wr),arithmeticOperator:D(Wr),logicOperator:D(Wr),bitwiseOperator:D(Wr),compareOperator:D(Wr),updateOperator:D(Wr),definitionOperator:D(Wr),typeOperator:D(Wr),controlOperator:D(Wr),punctuation:Sp,separator:D(Sp),bracket:La,angleBracket:D(La),squareBracket:D(La),paren:D(La),brace:D(La),content:qr,heading:ji,heading1:D(ji),heading2:D(ji),heading3:D(ji),heading4:D(ji),heading5:D(ji),heading6:D(ji),contentSeparator:D(qr),list:D(qr),quote:D(qr),emphasis:D(qr),strong:D(qr),link:D(qr),monospace:D(qr),strikethrough:D(qr),inserted:D(),deleted:D(),changed:D(),invalid:D(),meta:Sf,documentMeta:D(Sf),annotation:D(Sf),processingInstruction:D(Sf),definition:Jt.defineModifier(),constant:Jt.defineModifier(),function:Jt.defineModifier(),standard:Jt.defineModifier(),local:Jt.defineModifier(),special:Jt.defineModifier()},sB=_p([{tag:N.link,class:"tok-link"},{tag:N.heading,class:"tok-heading"},{tag:N.emphasis,class:"tok-emphasis"},{tag:N.strong,class:"tok-strong"},{tag:N.keyword,class:"tok-keyword"},{tag:N.atom,class:"tok-atom"},{tag:N.bool,class:"tok-bool"},{tag:N.url,class:"tok-url"},{tag:N.labelName,class:"tok-labelName"},{tag:N.inserted,class:"tok-inserted"},{tag:N.deleted,class:"tok-deleted"},{tag:N.literal,class:"tok-literal"},{tag:N.string,class:"tok-string"},{tag:N.number,class:"tok-number"},{tag:[N.regexp,N.escape,N.special(N.string)],class:"tok-string2"},{tag:N.variableName,class:"tok-variableName"},{tag:N.local(N.variableName),class:"tok-variableName tok-local"},{tag:N.definition(N.variableName),class:"tok-variableName tok-definition"},{tag:N.special(N.variableName),class:"tok-variableName2"},{tag:N.definition(N.propertyName),class:"tok-propertyName tok-definition"},{tag:N.typeName,class:"tok-typeName"},{tag:N.namespace,class:"tok-namespace"},{tag:N.className,class:"tok-className"},{tag:N.macroName,class:"tok-macroName"},{tag:N.propertyName,class:"tok-propertyName"},{tag:N.operator,class:"tok-operator"},{tag:N.comment,class:"tok-comment"},{tag:N.meta,class:"tok-meta"},{tag:N.invalid,class:"tok-invalid"},{tag:N.punctuation,class:"tok-punctuation"}]);var Cp,_f=new Z;var Yt=class{constructor(e,r,n=[]){this.data=e,G.prototype.hasOwnProperty("tree")||Object.defineProperty(G.prototype,"tree",{get(){return qe(this)}}),this.parser=r,this.extension=[Vn.of(this),G.languageData.of((i,o,s)=>i.facet(Ok(i,o,s)))].concat(n)}isActiveAt(e,r,n=-1){return Ok(e,r,n)==this.data}findRegions(e){let r=e.facet(Vn);if(r?.data==this.data)return[{from:0,to:e.doc.length}];if(!r||!r.allowsNesting)return[];let n=[],i=(o,s)=>{if(o.prop(_f)==this.data){n.push({from:s,to:s+o.length});return}let a=o.prop(Z.mounted);if(a){if(a.tree.prop(_f)==this.data){if(a.overlay)for(let l of a.overlay)n.push({from:l.from+s,to:l.to+s});else n.push({from:s,to:s+o.length});return}else if(a.overlay){let l=n.length;if(i(a.tree,a.overlay[0].from+s),n.length>l)return}}for(let l=0;l<o.children.length;l++){let c=o.children[l];c instanceof Fe&&i(c,o.positions[l]+s)}};return i(qe(e),0),n}get allowsNesting(){return!0}};Yt.setState=W.define();function Ok(t,e,r){let n=t.facet(Vn);if(!n)return null;let i=n.data;if(n.allowsNesting)for(let o=qe(t).topNode;o;o=o.enter(e,r,Xe.ExcludeBuffers))i=o.type.prop(_f)||i;return i}function qe(t){let e=t.field(Yt.state,!1);return e?e.tree:Fe.empty}var Ep=class{constructor(e,r=e.length){this.doc=e,this.length=r,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,r){let n=this.cursorPos-this.string.length;return e<n||r>=this.cursorPos?this.doc.sliceString(e,r):this.string.slice(e-n,r-n)}},Ia=null,Xo=class{constructor(e,r,n=[],i,o,s,a,l){this.parser=e,this.state=r,this.fragments=n,this.tree=i,this.treeLen=o,this.viewport=s,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,r,n){return new Xo(e,r,[],Fe.empty,0,n,[],null)}startParse(){return this.parser.startParse(new Ep(this.state.doc),this.fragments)}work(e,r){return r!=null&&r>=this.state.doc.length&&(r=void 0),this.tree!=Fe.empty&&this.isDone(r??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),r!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>r)&&r<this.state.doc.length&&this.parse.stopAt(r);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(Ur.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(r??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,r;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(r=this.parse.advance()););}),this.treeLen=e,this.tree=r,this.fragments=this.withoutTempSkipped(Ur.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let r=Ia;Ia=this;try{return e()}finally{Ia=r}}withoutTempSkipped(e){for(let r;r=this.tempSkipped.pop();)e=Ek(e,r.from,r.to);return e}changes(e,r){let{fragments:n,tree:i,treeLen:o,viewport:s,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,f,u,h)=>l.push({fromA:c,toA:f,fromB:u,toB:h})),n=Ur.applyChanges(n,l),i=Fe.empty,o=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){a=[];for(let c of this.skipped){let f=e.mapPos(c.from,1),u=e.mapPos(c.to,-1);f<u&&a.push({from:f,to:u})}}}return new Xo(this.parser,r,n,i,o,s,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let r=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:i,to:o}=this.skipped[n];i<e.to&&o>e.from&&(this.fragments=Ek(this.fragments,i,o),this.skipped.splice(n--,1))}return this.skipped.length>=r?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,r){this.skipped.push({from:e,to:r})}static getSkippingParser(e){return new class extends vf{createParse(r,n,i){let o=i[0].from,s=i[i.length-1].to;return{parsedPos:o,advance(){let l=Ia;if(l){for(let c of i)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=s,new Fe(bt.none,[],[],s-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let r=this.fragments;return this.treeLen>=e&&r.length&&r[0].from==0&&r[0].to>=e}static get(){return Ia}};function Ek(t,e,r){return Ur.applyChanges(t,[{fromA:e,toA:r,fromB:e,toB:r}])}var Fn=class{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let r=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),r.viewport.to);return r.work(20,n)||r.takeTree(),new Fn(r)}static init(e){let r=Math.min(3e3,e.doc.length),n=Xo.create(e.facet(Vn).parser,e,{from:0,to:r});return n.work(20,r)||n.takeTree(),new Fn(n)}};Yt.state=ce.define({create:Fn.init,update(t,e){for(let r of e.effects)if(r.is(Yt.setState))return r.value;return e.startState.facet(Vn)!=e.state.facet(Vn)?Fn.init(e.state):t.apply(e)}});var Dk=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(Dk=t=>{let e=-1,r=setTimeout(()=>{e=requestIdleCallback(t,{timeout:500-100})},100);return()=>e<0?clearTimeout(r):cancelIdleCallback(e)});var Ap=typeof navigator<"u"&&(!((Cp=navigator.scheduling)===null||Cp===void 0)&&Cp.isInputPending)?()=>navigator.scheduling.isInputPending():null,K2=de.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let r=this.view.state.field(Yt.state).context;(r.updateViewport(e.view.viewport)||this.view.viewport.to>r.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(r)}scheduleWork(){if(this.working)return;let{state:e}=this.view,r=e.field(Yt.state);(r.tree!=r.context.tree||!r.context.isDone(e.doc.length))&&(this.working=Dk(this.work))}work(e){this.working=null;let r=Date.now();if(this.chunkEnd<r&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=r+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:i}}=this.view,o=n.field(Yt.state);if(o.tree==o.context.tree&&o.context.isDone(i+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!Ap?Math.max(25,e.timeRemaining()-5):1e9),a=o.context.treeLen<i&&n.doc.length>i+1e3,l=o.context.work(()=>Ap&&Ap()||Date.now()>s,i+(a?0:1e5));this.chunkBudget-=Date.now()-r,(l||this.chunkBudget<=0)&&(o.context.takeTree(),this.view.dispatch({effects:Yt.setState.of(new Fn(o.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(o.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(r=>at(this.view.state,r)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Vn=j.define({combine(t){return t.length?t[0]:null},enables:[Yt.state,K2]});var G2=j.define(),$a=j.define({combine:t=>{if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function za(t){let e=t.facet($a);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function es(t,e){let r="",n=t.tabSize;if(t.facet($a).charCodeAt(0)==9)for(;e>=n;)r+="	",e-=n;for(let i=0;i<e;i++)r+=" ";return r}function Tf(t,e){t instanceof G&&(t=new $i(t));for(let n of t.state.facet(G2)){let i=n(t,e);if(i!=null)return i}let r=qe(t.state);return r?J2(t,r,e):null}var $i=class{constructor(e,r={}){this.state=e,this.options=r,this.unit=za(e)}lineAt(e,r=1){let n=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:o}=this.options;return i!=null&&i>=n.from&&i<=n.to?o&&i==e?{text:"",from:e}:(r<0?i<e:i<=e)?{text:n.text.slice(i-n.from),from:i}:{text:n.text.slice(0,i-n.from),from:n.from}:n}textAfterPos(e,r=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:i}=this.lineAt(e,r);return n.slice(e-i,Math.min(n.length,e+100-i))}column(e,r=1){let{text:n,from:i}=this.lineAt(e,r),o=this.countColumn(n,e-i),s=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return s>-1&&(o+=s-this.countColumn(n,n.search(/\S|$/))),o}countColumn(e,r=e.length){return Pn(e,this.state.tabSize,r)}lineIndent(e,r=1){let{text:n,from:i}=this.lineAt(e,r),o=this.options.overrideIndentation;if(o){let s=o(i);if(s>-1)return s}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}},Z2=new Z;function J2(t,e,r){return Nk(e.resolveInner(r).enterUnfinishedNodesBefore(r),r,t)}function Y2(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function X2(t){let e=t.type.prop(Z2);if(e)return e;let r=t.firstChild,n;if(r&&(n=r.type.prop(Z.closedBy))){let i=t.lastChild,o=i&&n.indexOf(i.name)>-1;return s=>rT(s,!0,1,void 0,o&&!Y2(s)?i.from:void 0)}return t.parent==null?Q2:null}function Nk(t,e,r){for(;t;t=t.parent){let n=X2(t);if(n)return n(ja.create(r,e,t))}return null}function Q2(){return 0}var ja=class extends $i{constructor(e,r,n){super(e.state,e.options),this.base=e,this.pos=r,this.node=n}static create(e,r,n){return new ja(e,r,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let r=this.node.resolve(e.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(eT(r,this.node))break;e=this.state.doc.lineAt(r.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?Nk(e,this.pos,this.base):0}};function eT(t,e){for(let r=e;r;r=r.parent)if(t==r)return!0;return!1}function tT(t){let e=t.node,r=e.childAfter(e.from),n=e.lastChild;if(!r)return null;let i=t.options.simulateBreak,o=t.state.doc.lineAt(r.from),s=i==null||i<=o.from?o.to:Math.min(o.to,i);for(let a=r.to;;){let l=e.childAfter(a);if(!l||l==n)return null;if(!l.type.isSkipped)return l.from<s?r:null;a=l.to}}function rT(t,e,r,n,i){let o=t.textAfter,s=o.match(/^\s*/)[0].length,a=n&&o.slice(s,s+n.length)==n||i==t.pos+s,l=e?tT(t):null;return l?a?t.column(l.from):t.column(l.to):t.baseIndent+(a?0:t.unit*r)}var nT=200;function Pk(){return G.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let r=t.newDoc,{head:n}=t.newSelection.main,i=r.lineAt(n);if(n>i.from+nT)return t;let o=r.sliceString(i.from,n);if(!e.some(c=>c.test(o)))return t;let{state:s}=t,a=-1,l=[];for(let{head:c}of s.selection.ranges){let f=s.doc.lineAt(c);if(f.from==a)continue;a=f.from;let u=Tf(s,f.from);if(u==null)continue;let h=/^\s*/.exec(f.text)[0],d=es(s,u);h!=d&&l.push({from:f.from,to:f.from+h.length,insert:d})}return l.length?[t,{changes:l,sequential:!0}]:t})}var iT=j.define(),oT=new Z;function sT(t,e,r){let n=qe(t);if(n.length<r)return null;let i=n.resolveInner(r),o=null;for(let s=i;s;s=s.parent){if(s.to<=r||s.from>r)continue;if(o&&s.from<e)break;let a=s.type.prop(oT);if(a&&(s.to<n.length-50||n.length==t.doc.length||!aT(s))){let l=a(s,t);l&&l.from<=r&&l.from>=e&&l.to>r&&(o=l)}}return o}function aT(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function Cf(t,e,r){for(let n of t.facet(iT)){let i=n(t,e,r);if(i)return i}return sT(t,e,r)}function Lk(t,e){let r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);return r>=n?void 0:{from:r,to:n}}var Of=W.define({map:Lk}),Fa=W.define({map:Lk});function Ik(t){let e=[];for(let{head:r}of t.state.selection.ranges)e.some(n=>n.from<=r&&n.to>=r)||e.push(t.lineBlockAt(r));return e}var zi=ce.define({create(){return $.none},update(t,e){t=t.map(e.changes);for(let r of e.effects)r.is(Of)&&!lT(t,r.value.from,r.value.to)?t=t.update({add:[pT.range(r.value.from,r.value.to)]}):r.is(Fa)&&(t=t.update({filter:(n,i)=>r.value.from!=n||r.value.to!=i,filterFrom:r.value.from,filterTo:r.value.to}));if(e.selection){let r=!1,{head:n}=e.selection.main;t.between(n,n,(i,o)=>{i<n&&o>n&&(r=!0)}),r&&(t=t.update({filterFrom:n,filterTo:n,filter:(i,o)=>o<=n||i>=n}))}return t},provide:t=>B.decorations.from(t)});function Af(t,e,r){var n;let i=null;return(n=t.field(zi,!1))===null||n===void 0||n.between(e,r,(o,s)=>{(!i||i.from>o)&&(i={from:o,to:s})}),i}function lT(t,e,r){let n=!1;return t.between(e,e,(i,o)=>{i==e&&o==r&&(n=!0)}),n}function Bk(t,e){return t.field(zi,!1)?e:e.concat(W.appendConfig.of(Fk()))}var cT=t=>{for(let e of Ik(t)){let r=Cf(t.state,e.from,e.to);if(r)return t.dispatch({effects:Bk(t.state,[Of.of(r),jk(t,r)])}),!0}return!1},fT=t=>{if(!t.state.field(zi,!1))return!1;let e=[];for(let r of Ik(t)){let n=Af(t.state,r.from,r.to);n&&e.push(Fa.of(n),jk(t,n,!1))}return e.length&&t.dispatch({effects:e}),e.length>0};function jk(t,e,r=!0){let n=t.state.doc.lineAt(e.from).number,i=t.state.doc.lineAt(e.to).number;return B.announce.of(`${t.state.phrase(r?"Folded lines":"Unfolded lines")} ${n} ${t.state.phrase("to")} ${i}.`)}var uT=t=>{let{state:e}=t,r=[];for(let n=0;n<e.doc.length;){let i=t.lineBlockAt(n),o=Cf(e,i.from,i.to);o&&r.push(Of.of(o)),n=(o?t.lineBlockAt(o.to):i).to+1}return r.length&&t.dispatch({effects:Bk(t.state,r)}),!!r.length},hT=t=>{let e=t.state.field(zi,!1);if(!e||!e.size)return!1;let r=[];return e.between(0,t.state.doc.length,(n,i)=>{r.push(Fa.of({from:n,to:i}))}),t.dispatch({effects:r}),!0},$k=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:cT},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:fT},{key:"Ctrl-Alt-[",run:uT},{key:"Ctrl-Alt-]",run:hT}],dT={placeholderDOM:null,placeholderText:"\u2026"},zk=j.define({combine(t){return gt(t,dT)}});function Fk(t){let e=[zi,gT];return t&&e.push(zk.of(t)),e}var pT=$.replace({widget:new class extends Nt{toDOM(t){let{state:e}=t,r=e.facet(zk),n=o=>{let s=t.lineBlockAt(t.posAtDOM(o.target)),a=Af(t.state,s.from,s.to);a&&t.dispatch({effects:Fa.of(a)}),o.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(t,n);let i=document.createElement("span");return i.textContent=r.placeholderText,i.setAttribute("aria-label",e.phrase("folded code")),i.title=e.phrase("unfold"),i.className="cm-foldPlaceholder",i.onclick=n,i}}}),mT={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{}},Ba=class extends Pt{constructor(e,r){super(),this.config=e,this.open=r}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let r=document.createElement("span");return r.textContent=this.open?this.config.openText:this.config.closedText,r.title=e.state.phrase(this.open?"Fold line":"Unfold line"),r}};function Vk(t={}){let e=Object.assign(Object.assign({},mT),t),r=new Ba(e,!0),n=new Ba(e,!1),i=de.fromClass(class{constructor(s){this.from=s.viewport.from,this.markers=this.buildMarkers(s)}update(s){(s.docChanged||s.viewportChanged||s.startState.facet(Vn)!=s.state.facet(Vn)||s.startState.field(zi,!1)!=s.state.field(zi,!1)||qe(s.startState)!=qe(s.state))&&(this.markers=this.buildMarkers(s.view))}buildMarkers(s){let a=new Mt;for(let l of s.viewportLineBlocks){let c=Af(s.state,l.from,l.to)?n:Cf(s.state,l.from,l.to)?r:null;c&&a.add(l.from,l.from,c)}return a.finish()}}),{domEventHandlers:o}=e;return[i,mp({class:"cm-foldGutter",markers(s){var a;return((a=s.plugin(i))===null||a===void 0?void 0:a.markers)||te.empty},initialSpacer(){return new Ba(e,!1)},domEventHandlers:Object.assign(Object.assign({},o),{click:(s,a,l)=>{if(o.click&&o.click(s,a,l))return!0;let c=Af(s.state,a.from,a.to);if(c)return s.dispatch({effects:Fa.of(c)}),!0;let f=Cf(s.state,a.from,a.to);return f?(s.dispatch({effects:Of.of(f)}),!0):!1}})}),Fk()]}var gT=B.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),Qo=class{constructor(e,r){let n;function i(a){let l=Gt.newName();return(n||(n=Object.create(null)))["."+l]=a,l}let o=typeof r.all=="string"?r.all:r.all?i(r.all):void 0,s=r.scope;this.scope=s instanceof Yt?a=>a.prop(_f)==s.data:s?a=>a==s:void 0,this.style=_p(e.map(a=>({tag:a.tag,class:a.class||i(Object.assign({},a,{tag:null}))})),{all:o}).style,this.module=n?new Gt(n):null,this.themeType=r.themeType}static define(e,r){return new Qo(e,r||{})}},Rp=j.define(),Uk=j.define({combine(t){return t.length?[t[0]]:null}});function Tp(t){let e=t.facet(Rp);return e.length?e:t.facet(Uk)}function Hk(t,e){let r=[yT],n;return t instanceof Qo&&(t.module&&r.push(B.styleModule.of(t.module)),n=t.themeType),e?.fallback?r.push(Uk.of(t)):n?r.push(Rp.computeN([B.darkTheme],i=>i.facet(B.darkTheme)==(n=="dark")?[t]:[])):r.push(Rp.of(t)),r}var Mp=class{constructor(e){this.markCache=Object.create(null),this.tree=qe(e.state),this.decorations=this.buildDeco(e,Tp(e.state))}update(e){let r=qe(e.state),n=Tp(e.state),i=n!=Tp(e.startState);r.length<e.view.viewport.to&&!i&&r.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(r!=this.tree||e.viewportChanged||i)&&(this.tree=r,this.decorations=this.buildDeco(e.view,n))}buildDeco(e,r){if(!r||!this.tree.length)return $.none;let n=new Mt;for(let{from:i,to:o}of e.visibleRanges)Tk(this.tree,r,(s,a,l)=>{n.add(s,a,this.markCache[l]||(this.markCache[l]=$.mark({class:l})))},i,o);return n.finish()}},yT=hn.high(de.fromClass(Mp,{decorations:t=>t.decorations})),Wk=Qo.define([{tag:N.meta,color:"#7a757a"},{tag:N.link,textDecoration:"underline"},{tag:N.heading,textDecoration:"underline",fontWeight:"bold"},{tag:N.emphasis,fontStyle:"italic"},{tag:N.strong,fontWeight:"bold"},{tag:N.strikethrough,textDecoration:"line-through"},{tag:N.keyword,color:"#708"},{tag:[N.atom,N.bool,N.url,N.contentSeparator,N.labelName],color:"#219"},{tag:[N.literal,N.inserted],color:"#164"},{tag:[N.string,N.deleted],color:"#a11"},{tag:[N.regexp,N.escape,N.special(N.string)],color:"#e40"},{tag:N.definition(N.variableName),color:"#00f"},{tag:N.local(N.variableName),color:"#30a"},{tag:[N.typeName,N.namespace],color:"#085"},{tag:N.className,color:"#167"},{tag:[N.special(N.variableName),N.macroName],color:"#256"},{tag:N.definition(N.propertyName),color:"#00c"},{tag:N.comment,color:"#940"},{tag:N.invalid,color:"#f00"}]),bT=B.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),qk=1e4,Kk="()[]{}",Gk=j.define({combine(t){return gt(t,{afterCursor:!0,brackets:Kk,maxScanDistance:qk,renderMatch:wT})}}),kT=$.mark({class:"cm-matchingBracket"}),vT=$.mark({class:"cm-nonmatchingBracket"});function wT(t){let e=[],r=t.matched?kT:vT;return e.push(r.range(t.start.from,t.start.to)),t.end&&e.push(r.range(t.end.from,t.end.to)),e}var xT=ce.define({create(){return $.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let r=[],n=e.state.facet(Gk);for(let i of e.state.selection.ranges){if(!i.empty)continue;let o=xr(e.state,i.head,-1,n)||i.head>0&&xr(e.state,i.head-1,1,n)||n.afterCursor&&(xr(e.state,i.head,1,n)||i.head<e.state.doc.length&&xr(e.state,i.head+1,-1,n));o&&(r=r.concat(n.renderMatch(o,e.state)))}return $.set(r,!0)},provide:t=>B.decorations.from(t)}),ST=[xT,bT];function Zk(t={}){return[Gk.of(t),ST]}function Dp(t,e,r){let n=t.prop(e<0?Z.openedBy:Z.closedBy);if(n)return n;if(t.name.length==1){let i=r.indexOf(t.name);if(i>-1&&i%2==(e<0?1:0))return[r[i+e]]}return null}function xr(t,e,r,n={}){let i=n.maxScanDistance||qk,o=n.brackets||Kk,s=qe(t),a=s.resolveInner(e,r);for(let l=a;l;l=l.parent){let c=Dp(l.type,r,o);if(c&&l.from<l.to)return _T(t,e,r,l,c,o)}return CT(t,e,r,s,a.type,i,o)}function _T(t,e,r,n,i,o){let s=n.parent,a={from:n.from,to:n.to},l=0,c=s?.cursor();if(c&&(r<0?c.childBefore(n.from):c.childAfter(n.to)))do if(r<0?c.to<=n.from:c.from>=n.to){if(l==0&&i.indexOf(c.type.name)>-1&&c.from<c.to)return{start:a,end:{from:c.from,to:c.to},matched:!0};if(Dp(c.type,r,o))l++;else if(Dp(c.type,-r,o)&&(l--,l==0))return{start:a,end:c.from==c.to?void 0:{from:c.from,to:c.to},matched:!1}}while(r<0?c.prevSibling():c.nextSibling());return{start:a,matched:!1}}function CT(t,e,r,n,i,o,s){let a=r<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),l=s.indexOf(a);if(l<0||l%2==0!=r>0)return null;let c={from:r<0?e-1:e,to:r>0?e+1:e},f=t.doc.iterRange(e,r>0?t.doc.length:0),u=0;for(let h=0;!f.next().done&&h<=o;){let d=f.value;r<0&&(h+=d.length);let p=e+h*r;for(let b=r>0?0:d.length-1,m=r>0?d.length:-1;b!=m;b+=r){let k=s.indexOf(d[b]);if(!(k<0||n.resolve(p+b,1).type!=i))if(k%2==0==r>0)u++;else{if(u==1)return{start:c,end:{from:p+b,to:p+b+1},matched:k>>1==l>>1};u--}}r>0&&(h+=d.length)}return f.done?{start:c,matched:!1}:null}var AT=Object.create(null),Rk=[bt.none];var Mk=[],TT=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])TT[t]=OT(AT,e);function Op(t,e){Mk.indexOf(t)>-1||(Mk.push(t),console.warn(e))}function OT(t,e){let r=null;for(let o of e.split(".")){let s=t[o]||N[o];s?typeof s=="function"?r?r=s(r):Op(o,`Modifier ${o} used at start of tag`):r?Op(o,`Tag ${o} used as modifier`):r=s:Op(o,`Unknown highlighting tag ${o}`)}if(!r)return 0;let n=e.replace(/ /g,"_"),i=bt.define({id:Rk.length,name:n,props:[Ck({[n]:r})]});return Rk.push(i),i.id}var Rf=class{constructor(e,r,n){this.state=e,this.pos=r,this.explicit=n,this.abortListeners=[]}tokenBefore(e){let r=qe(this.state).resolveInner(this.pos,-1);for(;r&&e.indexOf(r.name)<0;)r=r.parent;return r?{from:r.from,to:this.pos,text:this.state.sliceDoc(r.from,this.pos),type:r.type}:null}matchBefore(e){let r=this.state.doc.lineAt(this.pos),n=Math.max(r.from,this.pos-250),i=r.text.slice(n-r.from,this.pos-r.from),o=i.search(nv(e,!1));return o<0?null:{from:n+o,to:this.pos,text:i.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(e,r){e=="abort"&&this.abortListeners&&this.abortListeners.push(r)}};function Jk(t){let e=Object.keys(t).join(""),r=/\w/.test(e);return r&&(e=e.replace(/\w/g,"")),`[${r?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function ET(t){let e=Object.create(null),r=Object.create(null);for(let{label:i}of t){e[i[0]]=!0;for(let o=1;o<i.length;o++)r[i[o]]=!0}let n=Jk(e)+Jk(r)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function RT(t){let e=t.map(i=>typeof i=="string"?{label:i}:i),[r,n]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:ET(e);return i=>{let o=i.matchBefore(n);return o||i.explicit?{from:o?o.from:i.pos,options:e,validFor:r}:null}}var Mf=class{constructor(e,r,n){this.completion=e,this.source=r,this.match=n}};function Un(t){return t.selection.main.head}function nv(t,e){var r;let{source:n}=t,i=e&&n[0]!="^",o=n[n.length-1]!="$";return!i&&!o?t:new RegExp(`${i?"^":""}(?:${n})${o?"$":""}`,(r=t.flags)!==null&&r!==void 0?r:t.ignoreCase?"i":"")}function MT(t,e,r,n){return t.changeByRange(i=>{if(i==t.selection.main)return{changes:{from:r,to:n,insert:e},range:A.cursor(r+e.length)};let o=n-r;return!i.empty||o&&t.sliceDoc(i.from-o,i.from)!=t.sliceDoc(r,n)?{range:i}:{changes:{from:i.from-o,to:i.from,insert:e},range:A.cursor(i.from-o+e.length)}})}function iv(t,e){let r=e.completion.apply||e.completion.label,n=e.source;typeof r=="string"?t.dispatch(MT(t.state,r,n.from,n.to)):r(t,e.completion,n.from,n.to)}var Yk=new WeakMap;function DT(t){if(!Array.isArray(t))return t;let e=Yk.get(t);return e||Yk.set(t,e=RT(t)),e}var Pp=class{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let r=0;r<e.length;){let n=je(e,r),i=xt(n);this.chars.push(n);let o=e.slice(r,r+i),s=o.toUpperCase();this.folded.push(je(s==o?o.toLowerCase():s,0)),r+=i}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:r,folded:n,any:i,precise:o,byWord:s}=this;if(r.length==1){let S=je(e,0);return S==r[0]?[0,0,xt(S)]:S==n[0]?[-200,0,xt(S)]:null}let a=e.indexOf(this.pattern);if(a==0)return[0,0,this.pattern.length];let l=r.length,c=0;if(a<0){for(let S=0,_=Math.min(e.length,200);S<_&&c<l;){let w=je(e,S);(w==r[c]||w==n[c])&&(i[c++]=S),S+=xt(w)}if(c<l)return null}let f=0,u=0,h=!1,d=0,p=-1,b=-1,m=/[a-z]/.test(e),k=!0;for(let S=0,_=Math.min(e.length,200),w=0;S<_&&u<l;){let C=je(e,S);a<0&&(f<l&&C==r[f]&&(o[f++]=S),d<l&&(C==r[d]||C==n[d]?(d==0&&(p=S),b=S+1,d++):d=0));let E,x=C<255?C>=48&&C<=57||C>=97&&C<=122?2:C>=65&&C<=90?1:0:(E=pa(C))!=E.toLowerCase()?1:E!=E.toUpperCase()?2:0;(!S||x==1&&m||w==0&&x!=0)&&(r[u]==C||n[u]==C&&(h=!0)?s[u++]=S:s.length&&(k=!1)),w=x,S+=xt(C)}return u==l&&s[0]==0&&k?this.result(-100+(h?-200:0),s,e):d==l&&p==0?[-200-e.length,0,b]:a>-1?[-700-e.length,a,a+this.pattern.length]:d==l?[-200+-700-e.length,p,b]:u==l?this.result(-100+(h?-200:0)+-700+(k?0:-1100),s,e):r.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,e)}result(e,r,n){let i=[e-n.length],o=1;for(let s of r){let a=s+(this.astral?xt(je(n,s)):1);o>1&&i[o-1]==s?i[o-1]=a:(i[o++]=s,i[o++]=a)}return i}},Hn=j.define({combine(t){return gt(t,{activateOnTyping:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,r)=>e&&r,closeOnBlur:(e,r)=>e&&r,icons:(e,r)=>e&&r,optionClass:(e,r)=>n=>NT(e(n),r(n)),addToOptions:(e,r)=>e.concat(r)})}});function NT(t,e){return t?e?t+" "+e:t:e}function PT(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(r){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),r.type&&n.classList.add(...r.type.split(/\s+/g).map(i=>"cm-completionIcon-"+i)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(r,n,i){let o=document.createElement("span");o.className="cm-completionLabel";let{label:s}=r,a=0;for(let l=1;l<i.length;){let c=i[l++],f=i[l++];c>a&&o.appendChild(document.createTextNode(s.slice(a,c)));let u=o.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(s.slice(c,f))),u.className="cm-completionMatchedText",a=f}return a<s.length&&o.appendChild(document.createTextNode(s.slice(a))),o},position:50},{render(r){if(!r.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=r.detail,n},position:80}),e.sort((r,n)=>r.position-n.position).map(r=>r.render)}function Xk(t,e,r){if(t<=r)return{from:0,to:t};if(e<=t>>1){let i=Math.floor(e/r);return{from:i*r,to:(i+1)*r}}let n=Math.floor((t-e)/r);return{from:t-(n+1)*r,to:t-n*r}}var Lp=class{constructor(e,r){this.view=e,this.stateField=r,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:a=>this.positionInfo(a),key:this};let n=e.state.field(r),{options:i,selected:o}=n.open,s=e.state.facet(Hn);this.optionContent=PT(s),this.optionClass=s.optionClass,this.range=Xk(i.length,o,s.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",a=>{for(let l=a.target,c;l&&l!=this.dom;l=l.parentNode)if(l.nodeName=="LI"&&(c=/-(\d+)$/.exec(l.id))&&+c[1]<i.length){iv(e,i[+c[1]]),a.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(i,n.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),r=e.open;if((r.selected<this.range.from||r.selected>=this.range.to)&&(this.range=Xk(r.options.length,r.selected,this.view.state.facet(Hn).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(r.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(r.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:n}=r.options[r.selected],{info:i}=n;if(!i)return;let o=typeof i=="string"?document.createTextNode(i):i(n);if(!o)return;"then"in o?o.then(s=>{s&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(s)}).catch(s=>at(this.view.state,s,"completion info")):this.addInfoPane(o)}}addInfoPane(e){let r=this.info=document.createElement("div");r.className="cm-tooltip cm-completionInfo",r.appendChild(e),this.dom.appendChild(r),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let r=null;for(let n=this.list.firstChild,i=this.range.from;n;n=n.nextSibling,i++)i==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),r=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return r&&IT(this.list,r),r}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let r=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),i=e.getBoundingClientRect();if(i.top>Math.min(innerHeight,r.bottom)-10||i.bottom<Math.max(0,r.top)+10)return null;let o=Math.max(0,Math.min(i.top,innerHeight-n.height))-r.top,s=this.view.textDirection==ye.RTL,a=r.left,l=innerWidth-r.right;return s&&a<Math.min(n.width,l)?s=!1:!s&&l<Math.min(n.width,a)&&(s=!0),{top:o,left:s}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,r,n){let i=document.createElement("ul");i.id=r,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true");for(let o=n.from;o<n.to;o++){let{completion:s,match:a}=e[o],l=i.appendChild(document.createElement("li"));l.id=r+"-"+o,l.setAttribute("role","option");let c=this.optionClass(s);c&&(l.className=c);for(let f of this.optionContent){let u=f(s,this.view.state,a);u&&l.appendChild(u)}}return n.from&&i.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&i.classList.add("cm-completionListIncompleteBottom"),i}};function LT(t){return e=>new Lp(e,t)}function IT(t,e){let r=t.getBoundingClientRect(),n=e.getBoundingClientRect();n.top<r.top?t.scrollTop-=r.top-n.top:n.bottom>r.bottom&&(t.scrollTop+=n.bottom-r.bottom)}function Qk(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function BT(t,e){let r=[],n=0;for(let s of t)if(s.hasResult())if(s.result.filter===!1){let a=s.result.getMatch;for(let l of s.result.options){let c=[1e9-n++];if(a)for(let f of a(l))c.push(f);r.push(new Mf(l,s,c))}}else{let a=new Pp(e.sliceDoc(s.from,s.to)),l;for(let c of s.result.options)(l=a.match(c.label))&&(c.boost!=null&&(l[0]+=c.boost),r.push(new Mf(c,s,l)))}let i=[],o=null;for(let s of r.sort(FT))!o||o.label!=s.completion.label||o.detail!=s.completion.detail||o.type!=null&&s.completion.type!=null&&o.type!=s.completion.type||o.apply!=s.completion.apply?i.push(s):Qk(s.completion)>Qk(o)&&(i[i.length-1]=s),o=s.completion;return i}var Vi=class{constructor(e,r,n,i,o){this.options=e,this.attrs=r,this.tooltip=n,this.timestamp=i,this.selected=o}setSelected(e,r){return e==this.selected||e>=this.options.length?this:new Vi(this.options,ev(r,e),this.tooltip,this.timestamp,e)}static build(e,r,n,i,o){let s=BT(e,r);if(!s.length)return null;let a=0;if(i&&i.selected){let l=i.options[i.selected].completion;for(let c=0;c<s.length;c++)if(s[c].completion==l){a=c;break}}return new Vi(s,ev(n,a),{pos:e.reduce((l,c)=>c.hasResult()?Math.min(l,c.from):l,1e8),create:LT(Xt),above:o.aboveCursor},i?i.timestamp:Date.now(),a)}map(e){return new Vi(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}},ts=class{constructor(e,r,n){this.active=e,this.id=r,this.open=n}static start(){return new ts(zT,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:r}=e,n=r.facet(Hn),o=(n.override||r.languageDataAt("autocomplete",Un(r)).map(DT)).map(a=>(this.active.find(c=>c.source==a)||new ct(a,this.active.some(c=>c.state!=0)?1:0)).update(e,n));o.length==this.active.length&&o.every((a,l)=>a==this.active[l])&&(o=this.active);let s=e.selection||o.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!jT(o,this.active)?Vi.build(o,r,this.id,this.open,n):this.open&&e.docChanged?this.open.map(e.changes):this.open;!s&&o.every(a=>a.state!=1)&&o.some(a=>a.hasResult())&&(o=o.map(a=>a.hasResult()?new ct(a.source,0):a));for(let a of e.effects)a.is(sv)&&(s=s&&s.setSelected(a.value,this.id));return o==this.active&&s==this.open?this:new ts(o,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:$T}};function jT(t,e){if(t==e)return!0;for(let r=0,n=0;;){for(;r<t.length&&!t[r].hasResult;)r++;for(;n<e.length&&!e[n].hasResult;)n++;let i=r==t.length,o=n==e.length;if(i||o)return i==o;if(t[r++].result!=e[n++].result)return!1}}var $T={"aria-autocomplete":"list"};function ev(t,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":t+"-"+e,"aria-controls":t}}var zT=[];function FT(t,e){let r=e.match[0]-t.match[0];return r||t.completion.label.localeCompare(e.completion.label)}function Ip(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}var ct=class{constructor(e,r,n=-1){this.source=e,this.state=r,this.explicitPos=n}hasResult(){return!1}update(e,r){let n=Ip(e),i=this;n?i=i.handleUserEvent(e,n,r):e.docChanged?i=i.handleChange(e):e.selection&&i.state!=0&&(i=new ct(i.source,0));for(let o of e.effects)if(o.is(jp))i=new ct(i.source,1,o.value?Un(e.state):-1);else if(o.is(Df))i=new ct(i.source,0);else if(o.is(ov))for(let s of o.value)s.source==i.source&&(i=s);return i}handleUserEvent(e,r,n){return r=="delete"||!n.activateOnTyping?this.map(e.changes):new ct(this.source,1)}handleChange(e){return e.changes.touchesRange(Un(e.startState))?new ct(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new ct(this.source,this.state,e.mapPos(this.explicitPos))}},Ui=class extends ct{constructor(e,r,n,i,o){super(e,2,r),this.result=n,this.from=i,this.to=o}hasResult(){return!0}handleUserEvent(e,r,n){var i;let o=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),a=Un(e.state);if((this.explicitPos<0?a<=o:a<this.from)||a>s||r=="delete"&&Un(e.startState)==this.from)return new ct(this.source,r=="input"&&n.activateOnTyping?1:0);let l=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),c;return VT(this.result.validFor,e.state,o,s)?new Ui(this.source,l,this.result,o,s):this.result.update&&(c=this.result.update(this.result,o,s,new Rf(e.state,a,l>=0)))?new Ui(this.source,l,c,c.from,(i=c.to)!==null&&i!==void 0?i:Un(e.state)):new ct(this.source,1,l)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new ct(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Ui(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}};function VT(t,e,r,n){if(!t)return!1;let i=e.sliceDoc(r,n);return typeof t=="function"?t(i,r,n,e):nv(t,!0).test(i)}var jp=W.define(),Df=W.define(),ov=W.define({map(t,e){return t.map(r=>r.map(e))}}),sv=W.define(),Xt=ce.define({create(){return ts.start()},update(t,e){return t.update(e)},provide:t=>[Da.from(t,e=>e.tooltip),B.contentAttributes.from(t,e=>e.attrs)]}),av=75;function Ef(t,e="option"){return r=>{let n=r.state.field(Xt,!1);if(!n||!n.open||Date.now()-n.open.timestamp<av)return!1;let i=1,o;e=="page"&&(o=hk(r,n.open.tooltip))&&(i=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1));let s=n.open.selected+i*(t?1:-1),{length:a}=n.open.options;return s<0?s=e=="page"?0:a-1:s>=a&&(s=e=="page"?a-1:0),r.dispatch({effects:sv.of(s)}),!0}}var UT=t=>{let e=t.state.field(Xt,!1);return t.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<av?!1:(iv(t,e.open.options[e.open.selected]),!0)},HT=t=>t.state.field(Xt,!1)?(t.dispatch({effects:jp.of(!0)}),!0):!1,WT=t=>{let e=t.state.field(Xt,!1);return!e||!e.active.some(r=>r.state!=0)?!1:(t.dispatch({effects:Df.of(null)}),!0)},Bp=class{constructor(e,r){this.active=e,this.context=r,this.time=Date.now(),this.updates=[],this.done=void 0}},tv=50,qT=50,KT=1e3,GT=de.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of t.state.field(Xt).active)e.state==1&&this.startQuery(e)}update(t){let e=t.state.field(Xt);if(!t.selectionSet&&!t.docChanged&&t.startState.field(Xt)==e)return;let r=t.transactions.some(n=>(n.selection||n.docChanged)&&!Ip(n));for(let n=0;n<this.running.length;n++){let i=this.running[n];if(r||i.updates.length+t.transactions.length>qT&&Date.now()-i.time>KT){for(let o of i.context.abortListeners)try{o()}catch(s){at(this.view.state,s)}i.context.abortListeners=null,this.running.splice(n--,1)}else i.updates.push(...t.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(n=>n.state==1&&!this.running.some(i=>i.active.source==n.source))?setTimeout(()=>this.startUpdate(),tv):-1,this.composing!=0)for(let n of t.transactions)Ip(n)=="input"?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:t}=this.view,e=t.field(Xt);for(let r of e.active)r.state==1&&!this.running.some(n=>n.active.source==r.source)&&this.startQuery(r)}startQuery(t){let{state:e}=this.view,r=Un(e),n=new Rf(e,r,t.explicitPos==r),i=new Bp(t,n);this.running.push(i),Promise.resolve(t.source(n)).then(o=>{i.context.aborted||(i.done=o||null,this.scheduleAccept())},o=>{this.view.dispatch({effects:Df.of(null)}),at(this.view.state,o)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),tv))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],r=this.view.state.facet(Hn);for(let n=0;n<this.running.length;n++){let i=this.running[n];if(i.done===void 0)continue;if(this.running.splice(n--,1),i.done){let s=new Ui(i.active.source,i.active.explicitPos,i.done,i.done.from,(t=i.done.to)!==null&&t!==void 0?t:Un(i.updates.length?i.updates[0].startState:this.view.state));for(let a of i.updates)s=s.update(a,r);if(s.hasResult()){e.push(s);continue}}let o=this.view.state.field(Xt).active.find(s=>s.source==i.active.source);if(o&&o.state==1)if(i.done==null){let s=new ct(i.active.source,0);for(let a of i.updates)s=s.update(a,r);s.state!=1&&e.push(s)}else this.startQuery(o)}e.length&&this.view.dispatch({effects:ov.of(e)})}},{eventHandlers:{blur(){let t=this.view.state.field(Xt,!1);t&&t.tooltip&&this.view.state.facet(Hn).closeOnBlur&&this.view.dispatch({effects:Df.of(null)})},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:jp.of(!1)}),20),this.composing=0}}}),ZT=B.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var Nf={brackets:["(","[","{","'",'"'],before:")]}:;>"},Fi=W.define({map(t,e){let r=e.mapPos(t,-1,Je.TrackAfter);return r??void 0}}),$p=W.define({map(t,e){return e.mapPos(t)}}),zp=new class extends kr{};zp.startSide=1;zp.endSide=-1;var lv=ce.define({create(){return te.empty},update(t,e){if(e.selection){let r=e.state.doc.lineAt(e.selection.main.head).from,n=e.startState.doc.lineAt(e.startState.selection.main.head).from;r!=e.changes.mapPos(n,-1)&&(t=te.empty)}t=t.map(e.changes);for(let r of e.effects)r.is(Fi)?t=t.update({add:[zp.range(r.value,r.value+1)]}):r.is($p)&&(t=t.update({filter:n=>n!=r.value}));return t}});function cv(){return[YT,lv]}var Np="()[]{}<>";function fv(t){for(let e=0;e<Np.length;e+=2)if(Np.charCodeAt(e)==t)return Np.charAt(e+1);return pa(t<128?t:t+1)}function uv(t,e){return t.languageDataAt("closeBrackets",e)[0]||Nf}var JT=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),YT=B.inputHandler.of((t,e,r,n)=>{if((JT?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let i=t.state.selection.main;if(n.length>2||n.length==2&&xt(je(n,0))==1||e!=i.from||r!=i.to)return!1;let o=QT(t.state,n);return o?(t.dispatch(o),!0):!1}),XT=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=uv(t,t.selection.main.head).brackets||Nf.brackets,i=null,o=t.changeByRange(s=>{if(s.empty){let a=eO(t.doc,s.head);for(let l of n)if(l==a&&Pf(t.doc,s.head)==fv(je(l,0)))return{changes:{from:s.head-l.length,to:s.head+l.length},range:A.cursor(s.head-l.length),userEvent:"delete.backward"}}return{range:i=s}});return i||e(t.update(o,{scrollIntoView:!0})),!i},hv=[{key:"Backspace",run:XT}];function QT(t,e){let r=uv(t,t.selection.main.head),n=r.brackets||Nf.brackets;for(let i of n){let o=fv(je(i,0));if(e==i)return o==i?nO(t,i,n.indexOf(i+i+i)>-1):tO(t,i,o,r.before||Nf.before);if(e==o&&dv(t,t.selection.main.from))return rO(t,i,o)}return null}function dv(t,e){let r=!1;return t.field(lv).between(0,t.doc.length,n=>{n==e&&(r=!0)}),r}function Pf(t,e){let r=t.sliceString(e,e+2);return r.slice(0,xt(je(r,0)))}function eO(t,e){let r=t.sliceString(e-2,e);return xt(je(r,0))==r.length?r:r.slice(1)}function tO(t,e,r,n){let i=null,o=t.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:r,from:s.to}],effects:Fi.of(s.to+e.length),range:A.range(s.anchor+e.length,s.head+e.length)};let a=Pf(t.doc,s.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:e+r,from:s.head},effects:Fi.of(s.head+e.length),range:A.cursor(s.head+e.length)}:{range:i=s}});return i?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function rO(t,e,r){let n=null,i=t.selection.ranges.map(o=>o.empty&&Pf(t.doc,o.head)==r?A.cursor(o.head+r.length):n=o);return n?null:t.update({selection:A.create(i,t.selection.mainIndex),scrollIntoView:!0,effects:t.selection.ranges.map(({from:o})=>$p.of(o))})}function nO(t,e,r){let n=null,i=t.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:Fi.of(o.to+e.length),range:A.range(o.anchor+e.length,o.head+e.length)};let s=o.head,a=Pf(t.doc,s);if(a==e){if(rv(t,s))return{changes:{insert:e+e,from:s},effects:Fi.of(s+e.length),range:A.cursor(s+e.length)};if(dv(t,s)){let l=r&&t.sliceDoc(s,s+e.length*3)==e+e+e;return{range:A.cursor(s+e.length*(l?3:1)),effects:$p.of(s)}}}else{if(r&&t.sliceDoc(s-2*e.length,s)==e+e&&rv(t,s-2*e.length))return{changes:{insert:e+e+e+e,from:s},effects:Fi.of(s+e.length),range:A.cursor(s+e.length)};if(t.charCategorizer(s)(a)!=Be.Word){let l=t.sliceDoc(s-1,s);if(l!=e&&t.charCategorizer(s)(l)!=Be.Word&&!iO(t,s,e))return{changes:{insert:e+e,from:s},effects:Fi.of(s+e.length),range:A.cursor(s+e.length)}}}return{range:n=o}});return n?null:t.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function rv(t,e){let r=qe(t).resolveInner(e+1);return r.parent&&r.from==e}function iO(t,e,r){let n=qe(t).resolveInner(e,-1);for(let i=0;i<5;i++){if(t.sliceDoc(n.from,n.from+r.length)==r)return!0;let o=n.to==e&&n.parent;if(!o)break;n=o}return!1}function Lf(t={}){return[Xt,Hn.of(t),GT,oO,ZT]}var Fp=[{key:"Ctrl-Space",run:HT},{key:"Escape",run:WT},{key:"ArrowDown",run:Ef(!0)},{key:"ArrowUp",run:Ef(!1)},{key:"PageDown",run:Ef(!0,"page")},{key:"PageUp",run:Ef(!1,"page")},{key:"Enter",run:UT}],oO=hn.highest(Ii.computeN([Hn],t=>t.facet(Hn).defaultKeymap?[Fp]:[]));var sO=t=>{let e=Kp(t.state);return e.line?aO(t):e.block?cO(t):!1};function qp(t,e){return({state:r,dispatch:n})=>{if(r.readOnly)return!1;let i=t(e,r);return i?(n(r.update(i)),!0):!1}}var aO=qp(hO,0);var lO=qp(Cv,0);var cO=qp((t,e)=>Cv(t,e,uO(e)),0);function Kp(t,e=t.selection.main.head){let r=t.languageDataAt("commentTokens",e);return r.length?r[0]:{}}var Va=50;function fO(t,{open:e,close:r},n,i){let o=t.sliceDoc(n-Va,n),s=t.sliceDoc(i,i+Va),a=/\s*$/.exec(o)[0].length,l=/^\s*/.exec(s)[0].length,c=o.length-a;if(o.slice(c-e.length,c)==e&&s.slice(l,l+r.length)==r)return{open:{pos:n-a,margin:a&&1},close:{pos:i+l,margin:l&&1}};let f,u;i-n<=2*Va?f=u=t.sliceDoc(n,i):(f=t.sliceDoc(n,n+Va),u=t.sliceDoc(i-Va,i));let h=/^\s*/.exec(f)[0].length,d=/\s*$/.exec(u)[0].length,p=u.length-d-r.length;return f.slice(h,h+e.length)==e&&u.slice(p,p+r.length)==r?{open:{pos:n+h+e.length,margin:/\s/.test(f.charAt(h+e.length))?1:0},close:{pos:i-d-r.length,margin:/\s/.test(u.charAt(p-1))?1:0}}:null}function uO(t){let e=[];for(let r of t.selection.ranges){let n=t.doc.lineAt(r.from),i=r.to<=n.to?n:t.doc.lineAt(r.to),o=e.length-1;o>=0&&e[o].to>n.from?e[o].to=i.to:e.push({from:n.from,to:i.to})}return e}function Cv(t,e,r=e.selection.ranges){let n=r.map(o=>Kp(e,o.from).block);if(!n.every(o=>o))return null;let i=r.map((o,s)=>fO(e,n[s],o.from,o.to));if(t!=2&&!i.every(o=>o))return{changes:e.changes(r.map((o,s)=>i[s]?[]:[{from:o.from,insert:n[s].open+" "},{from:o.to,insert:" "+n[s].close}]))};if(t!=1&&i.some(o=>o)){let o=[];for(let s=0,a;s<i.length;s++)if(a=i[s]){let l=n[s],{open:c,close:f}=a;o.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:f.pos-f.margin,to:f.pos+l.close.length})}return{changes:o}}return null}function hO(t,e,r=e.selection.ranges){let n=[],i=-1;for(let{from:o,to:s}of r){let a=n.length,l=1e9;for(let c=o;c<=s;){let f=e.doc.lineAt(c);if(f.from>i&&(o==s||s>f.from)){i=f.from;let u=Kp(e,c).line;if(!u)continue;let h=/^\s*/.exec(f.text)[0].length,d=h==f.length,p=f.text.slice(h,h+u.length)==u?h:-1;h<f.text.length&&h<l&&(l=h),n.push({line:f,comment:p,token:u,indent:h,empty:d,single:!1})}c=f.to+1}if(l<1e9)for(let c=a;c<n.length;c++)n[c].indent<n[c].line.text.length&&(n[c].indent=l);n.length==a+1&&(n[a].single=!0)}if(t!=2&&n.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:a,token:l,indent:c,empty:f,single:u}of n)(u||!f)&&o.push({from:a.from+c,insert:l+" "});let s=e.changes(o);return{changes:s,selection:e.selection.map(s,1)}}else if(t!=1&&n.some(o=>o.comment>=0)){let o=[];for(let{line:s,comment:a,token:l}of n)if(a>=0){let c=s.from+a,f=c+l.length;s.text[f-s.from]==" "&&f++,o.push({from:c,to:f})}return{changes:o}}return null}var Up=br.define(),dO=br.define(),pO=j.define(),Av=j.define({combine(t){return gt(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function mO(t){let e=0;return t.iterChangedRanges((r,n)=>e=n),e}var Tv=ce.define({create(){return er.empty},update(t,e){let r=e.state.facet(Av),n=e.annotation(Up);if(n){let l=e.docChanged?A.single(mO(e.changes)):void 0,c=ft.fromTransaction(e,l),f=n.side,u=f==0?t.undone:t.done;return c?u=If(u,u.length,r.minDepth,c):u=Dv(u,e.startState.selection),new er(f==0?n.rest:u,f==0?u:n.rest)}let i=e.annotation(dO);if((i=="full"||i=="before")&&(t=t.isolate()),e.annotation(Ae.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let o=ft.fromTransaction(e),s=e.annotation(Ae.time),a=e.annotation(Ae.userEvent);return o?t=t.addChanges(o,s,a,r.newGroupDelay,r.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,s,a,r.newGroupDelay)),(i=="full"||i=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new er(t.done.map(ft.fromJSON),t.undone.map(ft.fromJSON))}});function Ov(t={}){return[Tv,Av.of(t),B.domEventHandlers({beforeinput(e,r){let n=e.inputType=="historyUndo"?Ev:e.inputType=="historyRedo"?Rv:null;return n?(e.preventDefault(),n(r)):!1}})]}function Bf(t,e){return function({state:r,dispatch:n}){if(!e&&r.readOnly)return!1;let i=r.field(Tv,!1);if(!i)return!1;let o=i.pop(t,r,e);return o?(n(o),!0):!1}}var Ev=Bf(0,!1),Rv=Bf(1,!1),gO=Bf(0,!0),yO=Bf(1,!0);var ft=class{constructor(e,r,n,i,o){this.changes=e,this.effects=r,this.mapped=n,this.startSelection=i,this.selectionsAfter=o}setSelAfter(e){return new ft(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,r,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(r=this.mapped)===null||r===void 0?void 0:r.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(i=>i.toJSON())}}static fromJSON(e){return new ft(e.changes&&Ce.fromJSON(e.changes),[],e.mapped&&Kt.fromJSON(e.mapped),e.startSelection&&A.fromJSON(e.startSelection),e.selectionsAfter.map(A.fromJSON))}static fromTransaction(e,r){let n=Qt;for(let i of e.startState.facet(pO)){let o=i(e);o.length&&(n=n.concat(o))}return!n.length&&e.changes.empty?null:new ft(e.changes.invert(e.startState.doc),n,void 0,r||e.startState.selection,Qt)}static selection(e){return new ft(void 0,Qt,void 0,void 0,e)}};function If(t,e,r,n){let i=e+1>r+20?e-r-1:0,o=t.slice(i,e);return o.push(n),o}function bO(t,e){let r=[],n=!1;return t.iterChangedRanges((i,o)=>r.push(i,o)),e.iterChangedRanges((i,o,s,a)=>{for(let l=0;l<r.length;){let c=r[l++],f=r[l++];a>=c&&s<=f&&(n=!0)}}),n}function kO(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((r,n)=>r.empty!=e.ranges[n].empty).length===0}function Mv(t,e){return t.length?e.length?t.concat(e):t:e}var Qt=[],vO=200;function Dv(t,e){if(t.length){let r=t[t.length-1],n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-vO));return n.length&&n[n.length-1].eq(e)?t:(n.push(e),If(t,t.length-1,1e9,r.setSelAfter(n)))}else return[ft.selection([e])]}function wO(t){let e=t[t.length-1],r=t.slice();return r[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),r}function Vp(t,e){if(!t.length)return t;let r=t.length,n=Qt;for(;r;){let i=xO(t[r-1],e,n);if(i.changes&&!i.changes.empty||i.effects.length){let o=t.slice(0,r);return o[r-1]=i,o}else e=i.mapped,r--,n=i.selectionsAfter}return n.length?[ft.selection(n)]:Qt}function xO(t,e,r){let n=Mv(t.selectionsAfter.length?t.selectionsAfter.map(a=>a.map(e)):Qt,r);if(!t.changes)return ft.selection(n);let i=t.changes.map(e),o=e.mapDesc(t.changes,!0),s=t.mapped?t.mapped.composeDesc(o):o;return new ft(i,W.mapEffects(t.effects,e),s,t.startSelection.map(o),n)}var SO=/^(input\.type|delete)($|\.)/,er=class{constructor(e,r,n=0,i=void 0){this.done=e,this.undone=r,this.prevTime=n,this.prevUserEvent=i}isolate(){return this.prevTime?new er(this.done,this.undone):this}addChanges(e,r,n,i,o){let s=this.done,a=s[s.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!n||SO.test(n))&&(!a.selectionsAfter.length&&r-this.prevTime<i&&bO(a.changes,e.changes)||n=="input.type.compose")?s=If(s,s.length-1,o,new ft(e.changes.compose(a.changes),Mv(e.effects,a.effects),a.mapped,a.startSelection,Qt)):s=If(s,s.length,o,e),new er(s,Qt,r,n)}addSelection(e,r,n,i){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:Qt;return o.length>0&&r-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&kO(o[o.length-1],e)?this:new er(Dv(this.done,e),this.undone,r,n)}addMapping(e){return new er(Vp(this.done,e),Vp(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,r,n){let i=e==0?this.done:this.undone;if(i.length==0)return null;let o=i[i.length-1];if(n&&o.selectionsAfter.length)return r.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:Up.of({side:e,rest:wO(i)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let s=i.length==1?Qt:i.slice(0,i.length-1);return o.mapped&&(s=Vp(s,o.mapped)),r.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:Up.of({side:e,rest:s}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};er.empty=new er(Qt,Qt);var Nv=[{key:"Mod-z",run:Ev,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Rv,preventDefault:!0},{key:"Mod-u",run:gO,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:yO,preventDefault:!0}];function rs(t,e){return A.create(t.ranges.map(e),t.mainIndex)}function Kr(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function yn({state:t,dispatch:e},r){let n=rs(t.selection,r);return n.eq(t.selection)?!1:(e(Kr(t,n)),!0)}function jf(t,e){return A.cursor(e?t.to:t.from)}function Pv(t,e){return yn(t,r=>r.empty?t.moveByChar(r,e):jf(r,e))}function tr(t){return t.textDirectionAt(t.state.selection.main.head)==ye.LTR}var Lv=t=>Pv(t,!tr(t)),Iv=t=>Pv(t,tr(t));function Bv(t,e){return yn(t,r=>r.empty?t.moveByGroup(r,e):jf(r,e))}var _O=t=>Bv(t,!tr(t)),CO=t=>Bv(t,tr(t));function AO(t,e,r){if(e.type.prop(r))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function $f(t,e,r){let n=qe(t).resolveInner(e.head),i=r?Z.closedBy:Z.openedBy;for(let l=e.head;;){let c=r?n.childAfter(l):n.childBefore(l);if(!c)break;AO(t,c,i)?n=c:l=r?c.to:c.from}let o=n.type.prop(i),s,a;return o&&(s=r?xr(t,n.from,1):xr(t,n.to,-1))&&s.matched?a=r?s.end.to:s.end.from:a=r?n.to:n.from,A.cursor(a,r?-1:1)}var TO=t=>yn(t,e=>$f(t.state,e,!tr(t))),OO=t=>yn(t,e=>$f(t.state,e,tr(t)));function jv(t,e){return yn(t,r=>{if(!r.empty)return jf(r,e);let n=t.moveVertically(r,e);return n.head!=r.head?n:t.moveToLineBoundary(r,e)})}var $v=t=>jv(t,!1),zv=t=>jv(t,!0);function Fv(t,e){let{state:r}=t,n=rs(r.selection,a=>a.empty?t.moveVertically(a,e,Math.min(t.dom.clientHeight,innerHeight)):jf(a,e));if(n.eq(r.selection))return!1;let i=t.coordsAtPos(r.selection.main.head),o=t.scrollDOM.getBoundingClientRect(),s;return i&&i.top>o.top&&i.bottom<o.bottom&&i.top-o.top<=t.scrollDOM.scrollHeight-t.scrollDOM.scrollTop-t.scrollDOM.clientHeight&&(s=B.scrollIntoView(n.main.head,{y:"start",yMargin:i.top-o.top})),t.dispatch(Kr(r,n),{effects:s}),!0}var pv=t=>Fv(t,!1),Hp=t=>Fv(t,!0);function zf(t,e,r){let n=t.lineBlockAt(e.head),i=t.moveToLineBoundary(e,r);if(i.head==e.head&&i.head!=(r?n.to:n.from)&&(i=t.moveToLineBoundary(e,r,!1)),!r&&i.head==n.from&&n.length){let o=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;o&&e.head!=n.from+o&&(i=A.cursor(n.from+o))}return i}var mv=t=>yn(t,e=>zf(t,e,!0)),gv=t=>yn(t,e=>zf(t,e,!1)),EO=t=>yn(t,e=>A.cursor(t.lineBlockAt(e.head).from,1)),RO=t=>yn(t,e=>A.cursor(t.lineBlockAt(e.head).to,-1));function MO(t,e,r){let n=!1,i=rs(t.selection,o=>{let s=xr(t,o.head,-1)||xr(t,o.head,1)||o.head>0&&xr(t,o.head-1,1)||o.head<t.doc.length&&xr(t,o.head+1,-1);if(!s||!s.end)return o;n=!0;let a=s.start.from==o.head?s.end.to:s.end.from;return r?A.range(o.anchor,a):A.cursor(a)});return n?(e(Kr(t,i)),!0):!1}var DO=({state:t,dispatch:e})=>MO(t,e,!1);function Gr(t,e){let r=rs(t.state.selection,n=>{let i=e(n);return A.range(n.anchor,i.head,i.goalColumn)});return r.eq(t.state.selection)?!1:(t.dispatch(Kr(t.state,r)),!0)}function Vv(t,e){return Gr(t,r=>t.moveByChar(r,e))}var Uv=t=>Vv(t,!tr(t)),Hv=t=>Vv(t,tr(t));function Wv(t,e){return Gr(t,r=>t.moveByGroup(r,e))}var NO=t=>Wv(t,!tr(t)),PO=t=>Wv(t,tr(t));var LO=t=>Gr(t,e=>$f(t.state,e,!tr(t))),IO=t=>Gr(t,e=>$f(t.state,e,tr(t)));function qv(t,e){return Gr(t,r=>t.moveVertically(r,e))}var Kv=t=>qv(t,!1),Gv=t=>qv(t,!0);function Zv(t,e){return Gr(t,r=>t.moveVertically(r,e,Math.min(t.dom.clientHeight,innerHeight)))}var yv=t=>Zv(t,!1),bv=t=>Zv(t,!0),kv=t=>Gr(t,e=>zf(t,e,!0)),vv=t=>Gr(t,e=>zf(t,e,!1)),BO=t=>Gr(t,e=>A.cursor(t.lineBlockAt(e.head).from)),jO=t=>Gr(t,e=>A.cursor(t.lineBlockAt(e.head).to)),wv=({state:t,dispatch:e})=>(e(Kr(t,{anchor:0})),!0),xv=({state:t,dispatch:e})=>(e(Kr(t,{anchor:t.doc.length})),!0),Sv=({state:t,dispatch:e})=>(e(Kr(t,{anchor:t.selection.main.anchor,head:0})),!0),_v=({state:t,dispatch:e})=>(e(Kr(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),$O=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),zO=({state:t,dispatch:e})=>{let r=Uf(t).map(({from:n,to:i})=>A.range(n,Math.min(i+1,t.doc.length)));return e(t.update({selection:A.create(r),userEvent:"select"})),!0},FO=({state:t,dispatch:e})=>{let r=rs(t.selection,n=>{var i;let o=qe(t).resolveInner(n.head,1);for(;!(o.from<n.from&&o.to>=n.to||o.to>n.to&&o.from<=n.from||!(!((i=o.parent)===null||i===void 0)&&i.parent));)o=o.parent;return A.range(o.to,o.from)});return e(Kr(t,r)),!0},VO=({state:t,dispatch:e})=>{let r=t.selection,n=null;return r.ranges.length>1?n=A.create([r.main]):r.main.empty||(n=A.create([A.cursor(r.main.head)])),n?(e(Kr(t,n)),!0):!1};function Ff({state:t,dispatch:e},r){if(t.readOnly)return!1;let n="delete.selection",i=t.changeByRange(o=>{let{from:s,to:a}=o;if(s==a){let l=r(s);l<s?n="delete.backward":l>s&&(n="delete.forward"),s=Math.min(s,l),a=Math.max(a,l)}return s==a?{range:o}:{changes:{from:s,to:a},range:A.cursor(s)}});return i.changes.empty?!1:(e(t.update(i,{scrollIntoView:!0,userEvent:n})),!0)}function Vf(t,e,r){if(t instanceof B)for(let n of t.state.facet(B.atomicRanges).map(i=>i(t)))n.between(e,e,(i,o)=>{i<e&&o>e&&(e=r?o:i)});return e}var Jv=(t,e)=>Ff(t,r=>{let{state:n}=t,i=n.doc.lineAt(r),o,s;if(!e&&r>i.from&&r<i.from+200&&!/[^ \t]/.test(o=i.text.slice(0,r-i.from))){if(o[o.length-1]=="	")return r-1;let a=Pn(o,n.tabSize),l=a%za(n)||za(n);for(let c=0;c<l&&o[o.length-1-c]==" ";c++)r--;s=r}else s=mt(i.text,r-i.from,e,e)+i.from,s==r&&i.number!=(e?n.doc.lines:1)&&(s+=e?1:-1);return Vf(t,s,e)}),Wp=t=>Jv(t,!1),Yv=t=>Jv(t,!0),Xv=(t,e)=>Ff(t,r=>{let n=r,{state:i}=t,o=i.doc.lineAt(n),s=i.charCategorizer(n);for(let a=null;;){if(n==(e?o.to:o.from)){n==r&&o.number!=(e?i.doc.lines:1)&&(n+=e?1:-1);break}let l=mt(o.text,n-o.from,e)+o.from,c=o.text.slice(Math.min(n,l)-o.from,Math.max(n,l)-o.from),f=s(c);if(a!=null&&f!=a)break;(c!=" "||n!=r)&&(a=f),n=l}return Vf(t,n,e)}),Qv=t=>Xv(t,!1),UO=t=>Xv(t,!0),ew=t=>Ff(t,e=>{let r=t.lineBlockAt(e).to;return Vf(t,e<r?r:Math.min(t.state.doc.length,e+1),!0)}),HO=t=>Ff(t,e=>{let r=t.lineBlockAt(e).from;return Vf(t,e>r?r:Math.max(0,e-1),!1)});var WO=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:ee.of(["",""])},range:A.cursor(n.from)}));return e(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0},qO=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>{if(!n.empty||n.from==0||n.from==t.doc.length)return{range:n};let i=n.from,o=t.doc.lineAt(i),s=i==o.from?i-1:mt(o.text,i-o.from,!1)+o.from,a=i==o.to?i+1:mt(o.text,i-o.from,!0)+o.from;return{changes:{from:s,to:a,insert:t.doc.slice(i,a).append(t.doc.slice(s,i))},range:A.cursor(a)}});return r.changes.empty?!1:(e(t.update(r,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Uf(t){let e=[],r=-1;for(let n of t.selection.ranges){let i=t.doc.lineAt(n.from),o=t.doc.lineAt(n.to);if(!n.empty&&n.to==o.from&&(o=t.doc.lineAt(n.to-1)),r>=i.number){let s=e[e.length-1];s.to=o.to,s.ranges.push(n)}else e.push({from:i.from,to:o.to,ranges:[n]});r=o.number+1}return e}function tw(t,e,r){if(t.readOnly)return!1;let n=[],i=[];for(let o of Uf(t)){if(r?o.to==t.doc.length:o.from==0)continue;let s=t.doc.lineAt(r?o.to+1:o.from-1),a=s.length+1;if(r){n.push({from:o.to,to:s.to},{from:o.from,insert:s.text+t.lineBreak});for(let l of o.ranges)i.push(A.range(Math.min(t.doc.length,l.anchor+a),Math.min(t.doc.length,l.head+a)))}else{n.push({from:s.from,to:o.from},{from:o.to,insert:t.lineBreak+s.text});for(let l of o.ranges)i.push(A.range(l.anchor-a,l.head-a))}}return n.length?(e(t.update({changes:n,scrollIntoView:!0,selection:A.create(i,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}var KO=({state:t,dispatch:e})=>tw(t,e,!1),GO=({state:t,dispatch:e})=>tw(t,e,!0);function rw(t,e,r){if(t.readOnly)return!1;let n=[];for(let i of Uf(t))r?n.push({from:i.from,insert:t.doc.slice(i.from,i.to)+t.lineBreak}):n.push({from:i.to,insert:t.lineBreak+t.doc.slice(i.from,i.to)});return e(t.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var ZO=({state:t,dispatch:e})=>rw(t,e,!1),JO=({state:t,dispatch:e})=>rw(t,e,!0),YO=t=>{if(t.state.readOnly)return!1;let{state:e}=t,r=e.changes(Uf(e).map(({from:i,to:o})=>(i>0?i--:o<e.doc.length&&o++,{from:i,to:o}))),n=rs(e.selection,i=>t.moveVertically(i,!0)).map(r);return t.dispatch({changes:r,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function XO(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let r=qe(t).resolveInner(e),n=r.childBefore(e),i=r.childAfter(e),o;return n&&i&&n.to<=e&&i.from>=e&&(o=n.type.prop(Z.closedBy))&&o.indexOf(i.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(i.from).from?{from:n.to,to:i.from}:null}var QO=nw(!1),eE=nw(!0);function nw(t){return({state:e,dispatch:r})=>{if(e.readOnly)return!1;let n=e.changeByRange(i=>{let{from:o,to:s}=i,a=e.doc.lineAt(o),l=!t&&o==s&&XO(e,o);t&&(o=s=(s<=a.to?a:e.doc.lineAt(s)).to);let c=new $i(e,{simulateBreak:o,simulateDoubleBreak:!!l}),f=Tf(c,o);for(f==null&&(f=/^\s*/.exec(e.doc.lineAt(o).text)[0].length);s<a.to&&/\s/.test(a.text[s-a.from]);)s++;l?{from:o,to:s}=l:o>a.from&&o<a.from+100&&!/\S/.test(a.text.slice(0,o))&&(o=a.from);let u=["",es(e,f)];return l&&u.push(es(e,c.lineIndent(a.from,-1))),{changes:{from:o,to:s,insert:ee.of(u)},range:A.cursor(o+1+u[1].length)}});return r(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function Gp(t,e){let r=-1;return t.changeByRange(n=>{let i=[];for(let s=n.from;s<=n.to;){let a=t.doc.lineAt(s);a.number>r&&(n.empty||n.to>a.from)&&(e(a,i,n),r=a.number),s=a.to+1}let o=t.changes(i);return{changes:i,range:A.range(o.mapPos(n.anchor,1),o.mapPos(n.head,1))}})}var tE=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=Object.create(null),n=new $i(t,{overrideIndentation:o=>{let s=r[o];return s??-1}}),i=Gp(t,(o,s,a)=>{let l=Tf(n,o.from);if(l==null)return;/\S/.test(o.text)||(l=0);let c=/^\s*/.exec(o.text)[0],f=es(t,l);(c!=f||a.from<o.from+c.length)&&(r[o.from]=l,s.push({from:o.from,to:o.from+c.length,insert:f}))});return i.changes.empty||e(t.update(i,{userEvent:"indent"})),!0},iw=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(Gp(t,(r,n)=>{n.push({from:r.from,insert:t.facet($a)})}),{userEvent:"input.indent"})),!0),ow=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(Gp(t,(r,n)=>{let i=/^\s*/.exec(r.text)[0];if(!i)return;let o=Pn(i,t.tabSize),s=0,a=es(t,Math.max(0,o-za(t)));for(;s<i.length&&s<a.length&&i.charCodeAt(s)==a.charCodeAt(s);)s++;n.push({from:r.from+s,to:r.from+i.length,insert:a.slice(s)})}),{userEvent:"delete.dedent"})),!0);var rE=[{key:"Ctrl-b",run:Lv,shift:Uv,preventDefault:!0},{key:"Ctrl-f",run:Iv,shift:Hv},{key:"Ctrl-p",run:$v,shift:Kv},{key:"Ctrl-n",run:zv,shift:Gv},{key:"Ctrl-a",run:EO,shift:BO},{key:"Ctrl-e",run:RO,shift:jO},{key:"Ctrl-d",run:Yv},{key:"Ctrl-h",run:Wp},{key:"Ctrl-k",run:ew},{key:"Ctrl-Alt-h",run:Qv},{key:"Ctrl-o",run:WO},{key:"Ctrl-t",run:qO},{key:"Ctrl-v",run:Hp}],nE=[{key:"ArrowLeft",run:Lv,shift:Uv,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:_O,shift:NO},{mac:"Cmd-ArrowLeft",run:gv,shift:vv},{key:"ArrowRight",run:Iv,shift:Hv,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:CO,shift:PO},{mac:"Cmd-ArrowRight",run:mv,shift:kv},{key:"ArrowUp",run:$v,shift:Kv,preventDefault:!0},{mac:"Cmd-ArrowUp",run:wv,shift:Sv},{mac:"Ctrl-ArrowUp",run:pv,shift:yv},{key:"ArrowDown",run:zv,shift:Gv,preventDefault:!0},{mac:"Cmd-ArrowDown",run:xv,shift:_v},{mac:"Ctrl-ArrowDown",run:Hp,shift:bv},{key:"PageUp",run:pv,shift:yv},{key:"PageDown",run:Hp,shift:bv},{key:"Home",run:gv,shift:vv,preventDefault:!0},{key:"Mod-Home",run:wv,shift:Sv},{key:"End",run:mv,shift:kv,preventDefault:!0},{key:"Mod-End",run:xv,shift:_v},{key:"Enter",run:QO},{key:"Mod-a",run:$O},{key:"Backspace",run:Wp,shift:Wp},{key:"Delete",run:Yv},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Qv},{key:"Mod-Delete",mac:"Alt-Delete",run:UO},{mac:"Mod-Backspace",run:HO},{mac:"Mod-Delete",run:ew}].concat(rE.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),sw=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:TO,shift:LO},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:OO,shift:IO},{key:"Alt-ArrowUp",run:KO},{key:"Shift-Alt-ArrowUp",run:ZO},{key:"Alt-ArrowDown",run:GO},{key:"Shift-Alt-ArrowDown",run:JO},{key:"Escape",run:VO},{key:"Mod-Enter",run:eE},{key:"Alt-l",mac:"Ctrl-l",run:zO},{key:"Mod-i",run:FO,preventDefault:!0},{key:"Mod-[",run:ow},{key:"Mod-]",run:iw},{key:"Mod-Alt-\\",run:tE},{key:"Shift-Mod-k",run:YO},{key:"Shift-Mod-\\",run:DO},{key:"Mod-/",run:sO},{key:"Alt-A",run:lO}].concat(nE),aw={key:"Tab",run:iw,shift:ow};function ue(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var i=r[n];typeof i=="string"?t.setAttribute(n,i):i!=null&&(t[n]=i)}e++}for(;e<arguments.length;e++)lw(t,arguments[e]);return t}function lw(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var r=0;r<e.length;r++)lw(t,e[r]);else throw new RangeError("Unsupported child node: "+e)}var cw=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t,Kn=class{constructor(e,r,n=0,i=e.length,o){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,i),this.bufferStart=n,this.normalize=o?s=>o(cw(s)):cw,this.query=this.normalize(r)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return je(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let r=pa(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=xt(e);let i=this.normalize(r);for(let o=0,s=n;;o++){let a=i.charCodeAt(o),l=this.match(a,s);if(l)return this.value=l,this;if(o==i.length-1)break;s==n&&o<r.length&&r.charCodeAt(o)==a&&s++}}}match(e,r){let n=null;for(let i=0;i<this.matches.length;i+=2){let o=this.matches[i],s=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?n={from:this.matches[i+1],to:r+1}:(this.matches[i]++,s=!0)),s||(this.matches.splice(i,2),i-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:r,to:r+1}:this.matches.push(1,r)),n}};typeof Symbol<"u"&&(Kn.prototype[Symbol.iterator]=function(){return this});var dw={from:-1,to:-1,match:/.*/.exec("")},tm="gm"+(/x/.unicode==null?"":"u"),qf=class{constructor(e,r,n,i=0,o=e.length){if(this.to=o,this.curLine="",this.done=!1,this.value=dw,/\\[sWDnr]|\n|\r|\[\^/.test(r))return new Kf(e,r,n,i,o);this.re=new RegExp(r,tm+(n?.ignoreCase?"i":"")),this.iter=e.iter();let s=e.lineAt(i);this.curLineStart=s.from,this.matchPos=i,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let r=this.matchPos<=this.to&&this.re.exec(this.curLine);if(r){let n=this.curLineStart+r.index,i=n+r[0].length;if(this.matchPos=i+(n==i?1:0),n==this.curLine.length&&this.nextLine(),n<i||n>this.value.to)return this.value={from:n,to:i,match:r},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},Zp=new WeakMap,Wn=class{constructor(e,r){this.from=e,this.text=r}get to(){return this.from+this.text.length}static get(e,r,n){let i=Zp.get(e);if(!i||i.from>=n||i.to<=r){let a=new Wn(r,e.sliceString(r,n));return Zp.set(e,a),a}if(i.from==r&&i.to==n)return i;let{text:o,from:s}=i;return s>r&&(o=e.sliceString(r,s)+o,s=r),i.to<n&&(o+=e.sliceString(i.to,n)),Zp.set(e,new Wn(s,o)),new Wn(r,o.slice(r-s,n-s))}},Kf=class{constructor(e,r,n,i,o){this.text=e,this.to=o,this.done=!1,this.value=dw,this.matchPos=i,this.re=new RegExp(r,tm+(n?.ignoreCase?"i":"")),this.flat=Wn.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,r=this.re.exec(this.flat.text);if(r&&!r[0]&&r.index==e&&(this.re.lastIndex=e+1,r=this.re.exec(this.flat.text)),r&&this.flat.to<this.to&&r.index+r[0].length>this.flat.text.length-10&&(r=null),r){let n=this.flat.from+r.index,i=n+r[0].length;return this.value={from:n,to:i,match:r},this.matchPos=i+(n==i?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=Wn.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}};typeof Symbol<"u"&&(qf.prototype[Symbol.iterator]=Kf.prototype[Symbol.iterator]=function(){return this});function iE(t){try{return new RegExp(t,tm),!0}catch{return!1}}function Jp(t){let e=ue("input",{class:"cm-textfield",name:"line"}),r=ue("form",{class:"cm-gotoLine",onkeydown:i=>{i.keyCode==27?(i.preventDefault(),t.dispatch({effects:Gf.of(!1)}),t.focus()):i.keyCode==13&&(i.preventDefault(),n())},onsubmit:i=>{i.preventDefault(),n()}},ue("label",t.state.phrase("Go to line"),": ",e)," ",ue("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function n(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!i)return;let{state:o}=t,s=o.doc.lineAt(o.selection.main.head),[,a,l,c,f]=i,u=c?+c.slice(1):0,h=l?+l:s.number;if(l&&f){let p=h/100;a&&(p=p*(a=="-"?-1:1)+s.number/o.doc.lines),h=Math.round(o.doc.lines*p)}else l&&a&&(h=h*(a=="-"?-1:1)+s.number);let d=o.doc.line(Math.max(1,Math.min(o.doc.lines,h)));t.dispatch({effects:Gf.of(!1),selection:A.cursor(d.from+Math.max(0,Math.min(u,d.length))),scrollIntoView:!0}),t.focus()}return{dom:r}}var Gf=W.define(),fw=ce.define({create(){return!0},update(t,e){for(let r of e.effects)r.is(Gf)&&(t=r.value);return t},provide:t=>Li.from(t,e=>e?Jp:null)}),oE=t=>{let e=Bi(t,Jp);if(!e){let r=[Gf.of(!0)];t.state.field(fw,!1)==null&&r.push(W.appendConfig.of([fw,sE])),t.dispatch({effects:r}),e=Bi(t,Jp)}return e&&e.dom.querySelector("input").focus(),!0},sE=B.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),aE={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},pw=j.define({combine(t){return gt(t,aE,{highlightWordAroundCursor:(e,r)=>e||r,minSelectionLength:Math.min,maxMatches:Math.min})}});function mw(t){let e=[hE,uE];return t&&e.push(pw.of(t)),e}var lE=$.mark({class:"cm-selectionMatch"}),cE=$.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function uw(t,e,r,n){return(r==0||t(e.sliceDoc(r-1,r))!=Be.Word)&&(n==e.doc.length||t(e.sliceDoc(n,n+1))!=Be.Word)}function fE(t,e,r,n){return t(e.sliceDoc(r,r+1))==Be.Word&&t(e.sliceDoc(n-1,n))==Be.Word}var uE=de.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(pw),{state:r}=t,n=r.selection;if(n.ranges.length>1)return $.none;let i=n.main,o,s=null;if(i.empty){if(!e.highlightWordAroundCursor)return $.none;let l=r.wordAt(i.head);if(!l)return $.none;s=r.charCategorizer(i.head),o=r.sliceDoc(l.from,l.to)}else{let l=i.to-i.from;if(l<e.minSelectionLength||l>200)return $.none;if(e.wholeWords){if(o=r.sliceDoc(i.from,i.to),s=r.charCategorizer(i.head),!(uw(s,r,i.from,i.to)&&fE(s,r,i.from,i.to)))return $.none}else if(o=r.sliceDoc(i.from,i.to).trim(),!o)return $.none}let a=[];for(let l of t.visibleRanges){let c=new Kn(r.doc,o,l.from,l.to);for(;!c.next().done;){let{from:f,to:u}=c.value;if((!s||uw(s,r,f,u))&&(i.empty&&f<=i.from&&u>=i.to?a.push(cE.range(f,u)):(f>=i.to||u<=i.from)&&a.push(lE.range(f,u)),a.length>e.maxMatches))return $.none}}return $.set(a)}},{decorations:t=>t.decorations}),hE=B.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),dE=({state:t,dispatch:e})=>{let{selection:r}=t,n=A.create(r.ranges.map(i=>t.wordAt(i.head)||A.cursor(i.head)),r.mainIndex);return n.eq(r)?!1:(e(t.update({selection:n})),!0)};function pE(t,e){let{main:r,ranges:n}=t.selection,i=t.wordAt(r.head),o=i&&i.from==r.from&&i.to==r.to;for(let s=!1,a=new Kn(t.doc,e,n[n.length-1].to);;)if(a.next(),a.done){if(s)return null;a=new Kn(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),s=!0}else{if(s&&n.some(l=>l.from==a.value.from))continue;if(o){let l=t.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}var mE=({state:t,dispatch:e})=>{let{ranges:r}=t.selection;if(r.some(o=>o.from===o.to))return dE({state:t,dispatch:e});let n=t.sliceDoc(r[0].from,r[0].to);if(t.selection.ranges.some(o=>t.sliceDoc(o.from,o.to)!=n))return!1;let i=pE(t,n);return i?(e(t.update({selection:t.selection.addRange(A.range(i.from,i.to),!1),effects:B.scrollIntoView(i.to)})),!0):!1},rm=j.define({combine(t){var e;return{top:t.reduce((r,n)=>r??n.top,void 0)||!1,caseSensitive:t.reduce((r,n)=>r??n.caseSensitive,void 0)||!1,createPanel:((e=t.find(r=>r.createPanel))===null||e===void 0?void 0:e.createPanel)||(r=>new em(r))}}});var Zf=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||iE(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,(r,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new Xp(this):new Yp(this)}getCursor(e,r=0,n=e.length){return this.regexp?is(this,e,r,n):ns(this,e,r,n)}},Jf=class{constructor(e){this.spec=e}};function ns(t,e,r,n){return new Kn(e,t.unquoted,r,n,t.caseSensitive?void 0:i=>i.toLowerCase())}var Yp=class extends Jf{constructor(e){super(e)}nextMatch(e,r,n){let i=ns(this.spec,e,n,e.length).nextOverlapping();return i.done&&(i=ns(this.spec,e,0,r).nextOverlapping()),i.done?null:i.value}prevMatchInRange(e,r,n){for(let i=n;;){let o=Math.max(r,i-1e4-this.spec.unquoted.length),s=ns(this.spec,e,o,i),a=null;for(;!s.nextOverlapping().done;)a=s.value;if(a)return a;if(o==r)return null;i-=1e4}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,r){let n=ns(this.spec,e,0,e.length),i=[];for(;!n.next().done;){if(i.length>=r)return null;i.push(n.value)}return i}highlight(e,r,n,i){let o=ns(this.spec,e,Math.max(0,r-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.length));for(;!o.next().done;)i(o.value.from,o.value.to)}};function is(t,e,r,n){return new qf(e,t.search,t.caseSensitive?void 0:{ignoreCase:!0},r,n)}var Xp=class extends Jf{nextMatch(e,r,n){let i=is(this.spec,e,n,e.length).next();return i.done&&(i=is(this.spec,e,0,r).next()),i.done?null:i.value}prevMatchInRange(e,r,n){for(let i=1;;i++){let o=Math.max(r,n-i*1e4),s=is(this.spec,e,o,n),a=null;for(;!s.next().done;)a=s.value;if(a&&(o==r||a.from>o+10))return a;if(o==r)return null}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(r,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:r)}matchAll(e,r){let n=is(this.spec,e,0,e.length),i=[];for(;!n.next().done;){if(i.length>=r)return null;i.push(n.value)}return i}highlight(e,r,n,i){let o=is(this.spec,e,Math.max(0,r-250),Math.min(n+250,e.length));for(;!o.next().done;)i(o.value.from,o.value.to)}},Ha=W.define(),nm=W.define(),qn=ce.define({create(t){return new Ua(Qp(t).create(),null)},update(t,e){for(let r of e.effects)r.is(Ha)?t=new Ua(r.value.create(),t.panel):r.is(nm)&&(t=new Ua(t.query,r.value?im:null));return t},provide:t=>Li.from(t,e=>e.panel)});var Ua=class{constructor(e,r){this.query=e,this.panel=r}},gE=$.mark({class:"cm-searchMatch"}),yE=$.mark({class:"cm-searchMatch cm-searchMatch-selected"}),bE=de.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(qn))}update(t){let e=t.state.field(qn);(e!=t.startState.field(qn)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return $.none;let{view:r}=this,n=new Mt;for(let i=0,o=r.visibleRanges,s=o.length;i<s;i++){let{from:a,to:l}=o[i];for(;i<s-1&&l>o[i+1].from-2*250;)l=o[++i].to;t.highlight(r.state.doc,a,l,(c,f)=>{let u=r.state.selection.ranges.some(h=>h.from==c&&h.to==f);n.add(c,f,u?yE:gE)})}return n.finish()}},{decorations:t=>t.decorations});function Wa(t){return e=>{let r=e.state.field(qn,!1);return r&&r.query.spec.valid?t(e,r):gw(e)}}var Yf=Wa((t,{query:e})=>{let{from:r,to:n}=t.state.selection.main,i=e.nextMatch(t.state.doc,r,n);return!i||i.from==r&&i.to==n?!1:(t.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:om(t,i),userEvent:"select.search"}),!0)}),Xf=Wa((t,{query:e})=>{let{state:r}=t,{from:n,to:i}=r.selection.main,o=e.prevMatch(r.doc,n,i);return o?(t.dispatch({selection:{anchor:o.from,head:o.to},scrollIntoView:!0,effects:om(t,o),userEvent:"select.search"}),!0):!1}),kE=Wa((t,{query:e})=>{let r=e.matchAll(t.state.doc,1e3);return!r||!r.length?!1:(t.dispatch({selection:A.create(r.map(n=>A.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),vE=({state:t,dispatch:e})=>{let r=t.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:n,to:i}=r.main,o=[],s=0;for(let a=new Kn(t.doc,t.sliceDoc(n,i));!a.next().done;){if(o.length>1e3)return!1;a.value.from==n&&(s=o.length),o.push(A.range(a.value.from,a.value.to))}return e(t.update({selection:A.create(o,s),userEvent:"select.search.matches"})),!0},hw=Wa((t,{query:e})=>{let{state:r}=t,{from:n,to:i}=r.selection.main;if(r.readOnly)return!1;let o=e.nextMatch(r.doc,n,n);if(!o)return!1;let s=[],a,l;if(o.from==n&&o.to==i&&(l=r.toText(e.getReplacement(o)),s.push({from:o.from,to:o.to,insert:l}),o=e.nextMatch(r.doc,o.from,o.to)),o){let c=s.length==0||s[0].from>=o.to?0:o.to-o.from-l.length;a={anchor:o.from-c,head:o.to-c}}return t.dispatch({changes:s,selection:a,scrollIntoView:!!a,effects:o?om(t,o):void 0,userEvent:"input.replace"}),!0}),wE=Wa((t,{query:e})=>{if(t.state.readOnly)return!1;let r=e.matchAll(t.state.doc,1e9).map(n=>{let{from:i,to:o}=n;return{from:i,to:o,insert:e.getReplacement(n)}});return r.length?(t.dispatch({changes:r,userEvent:"input.replace.all"}),!0):!1});function im(t){return t.state.facet(rm).createPanel(t)}function Qp(t,e){var r;let n=t.selection.main,i=n.empty||n.to>n.from+100?"":t.sliceDoc(n.from,n.to),o=(r=e?.caseSensitive)!==null&&r!==void 0?r:t.facet(rm).caseSensitive;return e&&!i?e:new Zf({search:i.replace(/\n/g,"\\n"),caseSensitive:o})}var gw=t=>{let e=t.state.field(qn,!1);if(e&&e.panel){let r=Bi(t,im);if(!r)return!1;let n=r.dom.querySelector("[name=search]");if(n!=t.root.activeElement){let i=Qp(t.state,e.query.spec);i.valid&&t.dispatch({effects:Ha.of(i)}),n.focus(),n.select()}}else t.dispatch({effects:[nm.of(!0),e?Ha.of(Qp(t.state,e.query.spec)):W.appendConfig.of(SE)]});return!0},yw=t=>{let e=t.state.field(qn,!1);if(!e||!e.panel)return!1;let r=Bi(t,im);return r&&r.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:nm.of(!1)}),!0},bw=[{key:"Mod-f",run:gw,scope:"editor search-panel"},{key:"F3",run:Yf,shift:Xf,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Yf,shift:Xf,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:yw,scope:"editor search-panel"},{key:"Mod-Shift-l",run:vE},{key:"Alt-g",run:oE},{key:"Mod-d",run:mE,preventDefault:!0}],em=class{constructor(e){this.view=e;let r=this.query=e.state.field(qn).query.spec;this.commit=this.commit.bind(this),this.searchField=ue("input",{value:r.search,placeholder:rr(e,"Find"),"aria-label":rr(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=ue("input",{value:r.replace,placeholder:rr(e,"Replace"),"aria-label":rr(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=ue("input",{type:"checkbox",name:"case",checked:r.caseSensitive,onchange:this.commit}),this.reField=ue("input",{type:"checkbox",name:"re",checked:r.regexp,onchange:this.commit});function n(i,o,s){return ue("button",{class:"cm-button",name:i,onclick:o,type:"button"},s)}this.dom=ue("div",{onkeydown:i=>this.keydown(i),class:"cm-search"},[this.searchField,n("next",()=>Yf(e),[rr(e,"next")]),n("prev",()=>Xf(e),[rr(e,"previous")]),n("select",()=>kE(e),[rr(e,"all")]),ue("label",null,[this.caseField,rr(e,"match case")]),ue("label",null,[this.reField,rr(e,"regexp")]),...e.state.readOnly?[]:[ue("br"),this.replaceField,n("replace",()=>hw(e),[rr(e,"replace")]),n("replaceAll",()=>wE(e),[rr(e,"replace all")]),ue("button",{name:"close",onclick:()=>yw(e),"aria-label":rr(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new Zf({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Ha.of(e)}))}keydown(e){Xb(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Xf:Yf)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),hw(this.view))}update(e){for(let r of e.transactions)for(let n of r.effects)n.is(Ha)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(rm).top}};function rr(t,e){return t.state.phrase(e)}var Hf=30,Wf=/[\s\.,:;?!]/;function om(t,{from:e,to:r}){let n=t.state.doc.lineAt(e).from,i=t.state.doc.lineAt(r).to,o=Math.max(n,e-Hf),s=Math.min(i,r+Hf),a=t.state.sliceDoc(o,s);if(o!=n){for(let l=0;l<Hf;l++)if(!Wf.test(a[l+1])&&Wf.test(a[l])){a=a.slice(l);break}}if(s!=i){for(let l=a.length-1;l>a.length-Hf;l--)if(!Wf.test(a[l-1])&&Wf.test(a[l])){a=a.slice(0,l);break}}return B.announce.of(`${t.state.phrase("current match")}. ${a} ${t.state.phrase("on line")} ${t.state.doc.lineAt(e).number}`)}var xE=B.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),SE=[qn,hn.lowest(bE),xE];var am=class{constructor(e,r,n){this.from=e,this.to=r,this.diagnostic=n}},bn=class{constructor(e,r,n){this.diagnostics=e,this.panel=r,this.selected=n}static init(e,r,n){let i=e,o=n.facet(os).markerFilter;o&&(i=o(i));let s=$.set(i.map(a=>a.from==a.to||a.from==a.to-1&&n.doc.lineAt(a.from).to==a.from?$.widget({widget:new lm(a),diagnostic:a}).range(a.from):$.mark({attributes:{class:"cm-lintRange cm-lintRange-"+a.severity},diagnostic:a}).range(a.from,a.to)),!0);return new bn(s,r,ss(s))}};function ss(t,e=null,r=0){let n=null;return t.between(r,1e9,(i,o,{spec:s})=>{if(!(e&&s.diagnostic!=e))return n=new am(i,o,s.diagnostic),!1}),n}function _E(t,e){return!!(t.effects.some(r=>r.is(cm))||t.changes.touchesRange(e.pos))}function vw(t,e){return t.field(Lt,!1)?e:e.concat(W.appendConfig.of([Lt,B.decorations.compute([Lt],r=>{let{selected:n,panel:i}=r.field(Lt);return!n||!i||n.from==n.to?$.none:$.set([AE.range(n.from,n.to)])}),uk(TE,{hideOn:_E}),NE]))}function CE(t,e){return{effects:vw(t,[cm.of(e)])}}var cm=W.define(),fm=W.define(),ww=W.define(),Lt=ce.define({create(){return new bn($.none,null,null)},update(t,e){if(e.docChanged){let r=t.diagnostics.map(e.changes),n=null;if(t.selected){let i=e.changes.mapPos(t.selected.from,1);n=ss(r,t.selected.diagnostic,i)||ss(r,null,i)}t=new bn(r,t.panel,n)}for(let r of e.effects)r.is(cm)?t=bn.init(r.value,t.panel,e.state):r.is(fm)?t=new bn(t.diagnostics,r.value?as.open:null,t.selected):r.is(ww)&&(t=new bn(t.diagnostics,t.panel,r.value));return t},provide:t=>[Li.from(t,e=>e.panel),B.decorations.from(t,e=>e.diagnostics)]});var AE=$.mark({class:"cm-lintRange cm-lintRange-active"});function TE(t,e,r){let{diagnostics:n}=t.state.field(Lt),i=[],o=2e8,s=0;n.between(e-(r<0?1:0),e+(r>0?1:0),(l,c,{spec:f})=>{e>=l&&e<=c&&(l==c||(e>l||r>0)&&(e<c||r<0))&&(i.push(f.diagnostic),o=Math.min(l,o),s=Math.max(c,s))});let a=t.state.facet(os).tooltipFilter;return a&&(i=a(i)),i.length?{pos:o,end:s,above:t.state.doc.lineAt(o).to<s,create(){return{dom:OE(t,i)}}}:null}function OE(t,e){return ue("ul",{class:"cm-tooltip-lint"},e.map(r=>_w(t,r,!1)))}var EE=t=>{let e=t.state.field(Lt,!1);(!e||!e.panel)&&t.dispatch({effects:vw(t.state,[fm.of(!0)])});let r=Bi(t,as.open);return r&&r.dom.querySelector(".cm-panel-lint ul").focus(),!0},kw=t=>{let e=t.state.field(Lt,!1);return!e||!e.panel?!1:(t.dispatch({effects:fm.of(!1)}),!0)},RE=t=>{let e=t.state.field(Lt,!1);if(!e)return!1;let r=t.state.selection.main,n=e.diagnostics.iter(r.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==r.from&&n.to==r.to)?!1:(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},xw=[{key:"Mod-Shift-m",run:EE},{key:"F8",run:RE}],ME=de.fromClass(class{constructor(t){this.view=t,this.timeout=-1,this.set=!0;let{delay:e}=t.state.facet(os);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let t=Date.now();if(t<this.lintTime-10)setTimeout(this.run,this.lintTime-t);else{this.set=!1;let{state:e}=this.view,{sources:r}=e.facet(os);Promise.all(r.map(n=>Promise.resolve(n(this.view)))).then(n=>{let i=n.reduce((o,s)=>o.concat(s));this.view.state.doc==e.doc&&this.view.dispatch(CE(this.view.state,i))},n=>{at(this.view.state,n)})}}update(t){let e=t.state.facet(os);(t.docChanged||e!=t.startState.facet(os))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),os=j.define({combine(t){return Object.assign({sources:t.map(e=>e.source)},gt(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:ME});function Sw(t){let e=[];if(t)e:for(let{name:r}of t){for(let n=0;n<r.length;n++){let i=r[n];if(/[a-zA-Z]/.test(i)&&!e.some(o=>o.toLowerCase()==i.toLowerCase())){e.push(i);continue e}}e.push("")}return e}function _w(t,e,r){var n;let i=r?Sw(e.actions):[];return ue("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},ue("span",{class:"cm-diagnosticText"},e.message),(n=e.actions)===null||n===void 0?void 0:n.map((o,s)=>{let a=u=>{u.preventDefault();let h=ss(t.state.field(Lt).diagnostics,e);h&&o.apply(t,h.from,h.to)},{name:l}=o,c=i[s]?l.indexOf(i[s]):-1,f=c<0?l:[l.slice(0,c),ue("u",l.slice(c,c+1)),l.slice(c+1)];return ue("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${l}${c<0?"":` (access key "${i[s]})"`}.`},f)}),e.source&&ue("div",{class:"cm-diagnosticSource"},e.source))}var lm=class extends Nt{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return ue("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}},Qf=class{constructor(e,r){this.diagnostic=r,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=_w(e,r,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}},as=class{constructor(e){this.view=e,this.items=[];let r=i=>{if(i.keyCode==27)kw(this.view),this.view.focus();else if(i.keyCode==38||i.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(i.keyCode==40||i.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(i.keyCode==36)this.moveSelection(0);else if(i.keyCode==35)this.moveSelection(this.items.length-1);else if(i.keyCode==13)this.view.focus();else if(i.keyCode>=65&&i.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:o}=this.items[this.selectedIndex],s=Sw(o.actions);for(let a=0;a<s.length;a++)if(s[a].toUpperCase().charCodeAt(0)==i.keyCode){let l=ss(this.view.state.field(Lt).diagnostics,o);l&&o.actions[a].apply(e,l.from,l.to)}}else return;i.preventDefault()},n=i=>{for(let o=0;o<this.items.length;o++)this.items[o].dom.contains(i.target)&&this.moveSelection(o)};this.list=ue("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:r,onclick:n}),this.dom=ue("div",{class:"cm-panel-lint"},this.list,ue("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>kw(this.view)},"\xD7")),this.update()}get selectedIndex(){let e=this.view.state.field(Lt).selected;if(!e)return-1;for(let r=0;r<this.items.length;r++)if(this.items[r].diagnostic==e.diagnostic)return r;return-1}update(){let{diagnostics:e,selected:r}=this.view.state.field(Lt),n=0,i=!1,o=null;for(e.between(0,this.view.state.doc.length,(s,a,{spec:l})=>{let c=-1,f;for(let u=n;u<this.items.length;u++)if(this.items[u].diagnostic==l.diagnostic){c=u;break}c<0?(f=new Qf(this.view,l.diagnostic),this.items.splice(n,0,f),i=!0):(f=this.items[c],c>n&&(this.items.splice(n,c-n),i=!0)),r&&f.diagnostic==r.diagnostic?f.dom.hasAttribute("aria-selected")||(f.dom.setAttribute("aria-selected","true"),o=f):f.dom.hasAttribute("aria-selected")&&f.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)i=!0,this.items.pop();this.items.length==0&&(this.items.push(new Qf(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),i=!0),o?(this.list.setAttribute("aria-activedescendant",o.id),this.view.requestMeasure({key:this,read:()=>({sel:o.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:s,panel:a})=>{s.top<a.top?this.list.scrollTop-=a.top-s.top:s.bottom>a.bottom&&(this.list.scrollTop+=s.bottom-a.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),i&&this.sync()}sync(){let e=this.list.firstChild;function r(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)r();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)r()}moveSelection(e){if(this.selectedIndex<0)return;let r=this.view.state.field(Lt),n=ss(r.diagnostics,this.items[e].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:ww.of(n)})}static open(e){return new as(e)}};function DE(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function sm(t){return DE(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}var NE=B.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:sm("#d11")},".cm-lintRange-warning":{backgroundImage:sm("orange")},".cm-lintRange-info":{backgroundImage:sm("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});var Cw=[gk(),yk(),sk(),Ov(),Vk(),tk(),ok(),G.allowMultipleSelections.of(!0),Pk(),Hk(Wk,{fallback:!0}),Zk(),cv(),Lf(),lk(),ck(),ak(),mw(),Ii.of([...hv,...sw,...bw,...Nv,...$k,...Fp,...xw])];var nr=Object.freeze({assertDefined(t){if(t===void 0)throw new Error(`'${nr.stringify(t)}' is 'undefined'`)},assertNever(t){throw new Error(`'${nr.stringify(t)}' is not of type 'never'`)},assertTrue(t,e){if(!t)throw new Error(`Assertion failed: ${e}. '${nr.stringify(t)}' should be true.`)},estimateMemoryUsage(t){let n=0,i=new Set,o=[t];for(;o.length;){let s=o.pop();switch(typeof s){case"bigint":{let a=Math.ceil(Math.log2(Number(s)));n+=(2+Math.ceil(a/64))*8;break}case"boolean":n+=8;break;case"number":n+=8;break;case"object":if(n+=8,!s||i.has(s))break;n+=8;for(let a of Object.values(s))o.push(a),n+=8;i.add(s);break;case"string":n+=s.length*2;break;case"symbol":n+=8;break;default:break}}return n},stringify(t){if(t&&typeof t=="object")try{let e=new Set;return JSON.stringify(t,(r,n)=>n&&typeof n=="object"?e.has(n)?"[Circular]":(e.add(n),n):n)}catch{return`{ ${Object.entries(t).map(([r,n])=>`'${r}': '${String(n)}'`).join(", ")} }`}else return typeof t=="symbol"?String(t):`${t}`}});var Aw=Object.freeze({is(t){return t.startsWith("http:")||t.startsWith("https:")}}),QB=Object.freeze({mock(t){return new um(t)}}),um=class{options;constructor(e){this.options=e}async get(e){if(!this.options.fixtures[e])throw new Error(`404 not found: ${e}`);let r=this.options.fixtures[e];return r instanceof Uint8Array?r:typeof r=="string"?new TextEncoder().encode(r):new TextEncoder().encode(JSON.stringify(r))}};var ls;(function(t){function e(){return console}t.create=e;function r(){return new hm}t.noop=r})(ls||(ls={}));var hm=class{error(){}info(){}log(){}warn(){}};var qa=class{parent;constructor(e){this.parent=e}undoOps=[];redoOps=[];addUndoOp(e){this.undoOps.push(e),this.parent?.addUndoOp(e)}addRedoOp(e){this.redoOps.push(e),this.parent?.addRedoOp(e)}set(e,r,n,i=e){let o=Reflect.get(e,r,i),s=()=>{Reflect.set(e,r,n,i)},a=()=>{Reflect.set(e,r,o,i)};this.addRedoOp(s),this.addUndoOp(a),s()}undo(){for(let e=this.undoOps.length-1;e>=0;e--)this.undoOps[e]()}redo(){this.redoOps.forEach(e=>e())}};var Rw=Br(eu(),1),Mw=Br(tu(),1),It=URL;function ru(t=e=>e[0]){return(e,r,n)=>{let i=new Map,o=n.value;return n.value=function(...s){let a=t(s);if(i.has(a))return i.get(a);let l=o.apply(this,s).then(c=>(i.delete(a),c),c=>(i.delete(a),Promise.reject(c)));return i.set(a,l),l},n}}var q;(function(t){t.TagPrefix="#",t.NamespacePathSep=":",t.PathSep="/",t.DefaultNamespace="minecraft";function e(n){switch(n.indexOf(t.NamespacePathSep)){case-1:return`${t.DefaultNamespace}${t.NamespacePathSep}${n}`;case 0:return`${t.DefaultNamespace}${n}`;default:return n}}t.lengthen=e;function r(n){return n.replace(/^(?:minecraft)?:/,"")}t.shorten=r})(q||(q={}));function ir(t){return new TextDecoder().decode(t)}var Ve;(function(t){function e(n,i){return Array.isArray(n)?n.every(o=>i(o)):i(n)}t.is=e;function r(n){return Array.isArray(n)?n:[n]}t.toArray=r})(Ve||(Ve={}));var Gn;(function(t){function e(r){return typeof r=="string"}t.isString=e})(Gn||(Gn={}));async function dm(t,e){return JSON.parse(ir(await t.archive.gunzip(e)))}function Ew(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function Ka(t,e){let r=(0,Mw.default)()(t);for(let[n,i]of Object.entries(e))Ew(r[n])&&Ew(i)?r[n]=Ka(r[n],i):i===void 0?delete r[n]:r[n]=i;return r}var Zn;(function(t){let e=Symbol("LazyDiscriminator");function r(s){return{discriminator:e,getter:s}}t.create=r;function n(s){return s?.discriminator===e}t.isComplex=n;function i(s){return n(s)&&!("value"in s)}t.isUnresolved=i;function o(s){return i(s)?s.value=s.getter():s}t.resolve=o})(Zn||(Zn={}));function Ga(t,e,r){let n={};e=e.map(q.lengthen);for(let i of e)r.symbols.query(r.doc,t,i).forEachMember((o,s)=>{let a=Object.keys(s.visibleMembers),l=n[o]??=new Set,c=s.symbol?.relations?.default;c&&l.add(c.path[c.path.length-1]);for(let f of a)l.add(f)});return Object.fromEntries(Object.entries(n).map(([i,o])=>[i,[...o]]))}var Dw=Rw.default;function Nw(t){return!!t[Symbol.iterator]}function Za(t,e){return e>=0?t?.[e]:t?.[t.length+e]}function nu(t,e,r){if(t.has(e)){let n=t.get(e);return r.update&&(n=r.update(n,e,t),t.set(e,n)),n}else if(r.insert){let n=r.insert(e,t);return t.set(e,n),n}else throw new Error(`No key ${e} in map and no insert handler provided`)}function iu(t){return typeof t=="function"||!!t&&typeof t=="object"}function Pw(t){let e=new It(t);return e.pathname=e.pathname.replace(/%3A/gi,":"),e.toString()}var IE=Object.freeze({create(t){return new Proxy(t,new pm)}}),pm=class{map=new Map;get(e,r,n){let i=Reflect.get(e,r,n);return r!=="prototype"&&iu(i)?nu(this.map,r,{insert:()=>IE.create(i)}):i}set(e,r,n,i){throw new TypeError(`Cannot set property '${String(r)}' on a readonly proxy`)}deleteProperty(e,r){throw new TypeError(`Cannot delete property '${String(r)}' on a readonly proxy`)}};var mm=Symbol("StateBranchOff"),gm=Symbol("IsStateProxy"),ym=Symbol("OriginState"),bm=Symbol("RedoStateChanges"),km=Symbol("UndoStateChanges"),Qe=Object.freeze({branchOff(t){return t[mm]()},create(t){if(Qe.is(t))throw new TypeError("Cannot create a proxy over a proxy. You might want to use branchOff instead.");return wm(t,new qa)},dereference(t){return Qe.is(t)?t[ym]:t},is(t){return t?.[gm]},redoChanges(t){t[bm]()},undoChanges(t){t[km]()}}),ou,Lw,vm=class{constructor(e){R(this,ou);H(this,"rootOps");H(this,"map",new Map);this.rootOps=e}get(e,r,n){switch(r){case mm:return()=>Qy(this,ou,Lw).call(this,e);case gm:return!0;case ym:return e;case bm:return()=>this.rootOps.redo();case km:return()=>this.rootOps.undo()}let i=Reflect.get(e,r,n);return r!=="prototype"&&iu(i)?nu(this.map,r,{insert:()=>wm(i,this.rootOps)}):i}set(e,r,n,i){if(r===mm||r===gm||r===ym||r===bm||r===km)throw new TypeError(`Cannot set ${String(r)}`);return this.rootOps.set(e,r,Qe.dereference(n),i),!0}};ou=new WeakSet,Lw=function(e){return wm(e,new qa(this.rootOps))};function wm(t,e){return new Proxy(t,new vm(e))}var su=class{_map=new Map;_reversedMap=new Map;constructor(e=[]){for(let[r,n]of e)this._map.set(r,n),this._reversedMap.set(n,r)}get size(){return this._map.size}clear(){this._map.clear(),this._reversedMap.clear()}delete(e){let r=this._map.get(e),n=this._map.delete(e);return r!==void 0&&this._reversedMap.delete(r),n}deleteValue(e){let r=this._reversedMap.get(e),n=this._reversedMap.delete(e);return r!==void 0&&this._map.delete(r),n}get(e){return this._map.get(e)}getKey(e){return this._reversedMap.get(e)}has(e){return this._map.has(e)}hasValue(e){return this._reversedMap.has(e)}set(e,r){return this._map.set(e,r),this._reversedMap.set(r,e),this}forEach(e,r){for(let[n,i]of this._map)e.apply(r,[i,n,this])}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.values()}[Symbol.iterator](){return this._map.entries()}[Symbol.toStringTag]="TwoWayMap"};var Bw=Br(eu(),1);var BE=`\r
`,Hi="\r",Wi=`
`,Iw=Object.freeze([" ",`
`,"\r","	"]),qi=class{string;indexMap;innerCursor=0;constructor(e,r=[]){this.string=e,this.indexMap=r}get cursor(){return Zr.toOuterOffset(this.indexMap,this.innerCursor)}getCharRange(e=0){return Zr.toOuterRange(this.indexMap,v.create(this.innerCursor+e,this.innerCursor+e+1))}peek(e=1,r=0){return this.string.slice(this.innerCursor+r,this.innerCursor+r+e)}tryPeek(e,r=0){return this.peek(e.length,r)===e}tryPeekAfterWhitespace(e){let r=this.string.length-this.innerCursor,n=0;for(;n<r&&_e.isWhitespace(this.peek(1,n));)n++;return this.tryPeek(e,n)}peekUntil(...e){let r="";for(let n=this.innerCursor;n<this.string.length;n++){let i=this.string.charAt(n);if(e.includes(i))return r;r+=i}return r}peekLine(){return this.peekUntil(Hi,Wi)}peekRemaining(){return this.string.slice(this.innerCursor)}matchPattern(e){return e.test(this.peekRemaining())}hasNonSpaceAheadInLine(){for(let e=this.innerCursor;e<this.string.length;e++){let r=this.string.charAt(e);if(r===Hi||r===Wi)break;if(!(r===" "||r==="	"))return!0}return!1}slice(e,r){if(typeof e=="number"){let i=Zr.toInnerOffset(this.indexMap,e),o=r!==void 0?Zr.toInnerOffset(this.indexMap,r):void 0;return this.string.slice(i,o)}let n=Zr.toInnerRange(this.indexMap,v.get(e));return this.string.slice(n.start,n.end)}sliceToCursor(e){let r=Zr.toInnerOffset(this.indexMap,e);return this.string.slice(r,this.innerCursor)}},_e=class extends qi{string;indexMap;constructor(e,r=[]){super(e,r),this.string=e,this.indexMap=r}get cursor(){return super.cursor}set cursor(e){this.innerCursor=Zr.toInnerOffset(this.indexMap,e)}clone(){let e=new _e(this.string,this.indexMap);return e.innerCursor=this.innerCursor,e}canRead(e=1){return this.innerCursor+e<=this.string.length}canReadInLine(){return this.canRead()&&this.peek()!==Hi&&this.peek()!==Wi}read(){return this.string.charAt(this.innerCursor++)}skip(e=1){return this.innerCursor+=e,this}trySkip(e){return this.peek(e.length)===e?(this.skip(e.length),!0):!1}readLine(){return this.readUntil(Hi,Wi)}skipLine(){return this.readLine(),this}nextLine(){return this.skipLine(),this.peek(2)===BE?this.skip(2):(this.peek()===Hi||this.peek()===Wi)&&this.skip(),this}readSpace(){let e=this.innerCursor;return this.skipSpace(),this.string.slice(e,this.innerCursor)}skipSpace(){for(;this.canRead()&&_e.isSpace(this.peek());)this.skip();return this}readWhitespace(){let e=this.innerCursor;return this.skipWhitespace(),this.string.slice(e,this.innerCursor)}skipWhitespace(){for(;this.canRead()&&_e.isWhitespace(this.peek());)this.skip();return this}readIf(e){let r="";for(;this.canRead();){let n=this.peek();if(e(n))this.skip(),r+=n;else break}return r}skipIf(e){return this.readIf(e),this}readUntil(...e){let r="";for(;this.canRead();){let n=this.peek();if(e.includes(n))return r;r+=n,this.skip()}return r}skipUntilOrEnd(...e){return this.readUntil(...e),this}readUntilLineEnd(){return this.readUntil(Hi,Wi)}skipUntilLineEnd(){return this.skipUntilOrEnd(Hi,Wi)}readRemaining(){let e=this.innerCursor;return this.innerCursor=this.string.length,this.string.slice(e)}skipRemaining(){return this.readRemaining(),this}static isDigit(e){return e>="0"&&e<="9"}static isBrigadierQuote(e){return e==='"'||e==="'"}static isNewline(e){return e===`\r
`||e==="\r"||e===`
`}static isSpace(e){return e===" "||e==="	"}static isWhitespace(e){return _e.isSpace(e)||_e.isNewline(e)}};var Ja;(function(t){function e(r){return typeof r=="function"&&(r=r()),r instanceof qi&&(r=r.cursor),r}t.get=e})(Ja||(Ja={}));var v;(function(t){function e(m){let k=typeof m=="function"?m():m;return t.is(k)?t.create(k.start,k.end):xm.is(k)?t.create(k.range.start,k.range.end):t.create(k)}t.get=e;function r(m,k){return m=Ja.get(m),{start:m,end:k!==void 0?Ja.get(k):m}}t.create=r;function n(m,k){return{start:t.get(m).start,end:t.get(k).end}}t.span=n;function i(m){return!!m&&typeof m=="object"&&typeof m.start=="number"&&typeof m.end=="number"}t.is=i,t.Beginning=Object.freeze(t.create(0,1)),t.Full=Object.freeze(t.create(0,Number.POSITIVE_INFINITY));function o(m){return`[${m.start}, ${m.end})`}t.toString=o;function s(m,k,S=!1){return m=e(m),m.start<=k&&(S?k<=m.end:k<m.end)}t.contains=s;function a(m,k,S=!1){return m=e(m),k=e(k),s(m,k.start,S)&&s(m,k.end,!0)}t.containsRange=a;function l(m,k){return t.contains(m,k.start)||t.contains(k,m.start)}t.intersects=l;function c(m,k){return m.start===k.start&&m.end===k.end}t.equals=c;function f(m,k,S=!1){return S?m.end<t.get(k).start:m.end<=t.get(k).start}t.endsBefore=f;function u(m){return m=e(m),m.start===m.end}t.isEmpty=u;function h(m){return m.end-m.start}t.length=h;function d(m,k,S=!1){return(S?m.end<k.start:m.end<=k.start)?-1:(S?m.start>k.end:m.start>=k.end)?1:0}t.compare=d;function p(m,k,S=!1){return(S?m.end<k:m.end<=k)?-1:m.start>k?1:0}t.compareOffset=p;function b(m,k,S=k){return m=e(m),{start:m.start+k,end:m.end+S}}t.translate=b})(v||(v={}));var xm;(function(t){function e(r){return!!r&&typeof r=="object"&&v.is(r.range)}t.is=e})(xm||(xm={}));var Zr;(function(t){function e(a,l,c,f,u){let h=l;for(let d of a){if(v.contains(d[c],l,u))return u?d[f].end:d[f].start;if(v.endsBefore(d[c],l))h=l-d[c].end+d[f].end;else break}return h}function r(a,l){return e(a,l,"outer","inner",!1)}t.toInnerOffset=r;function n(a,l){return v.create(r(a,l.start),e(a,l.end,"outer","inner",!0))}t.toInnerRange=n;function i(a,l){return e(a,l,"inner","outer",!1)}t.toOuterOffset=i;function o(a,l){return v.create(i(a,l.start),e(a,l.end,"inner","outer",!0))}t.toOuterRange=o;function s(a,l){return l.map(c=>({inner:c.inner,outer:o(a,c.outer)}))}t.merge=s})(Zr||(Zr={}));var kt;(function(t){function e(s,a){return typeof s=="object"?r(s):n(s,a)}t.create=e;function r(s){return{line:s.line??0,character:s.character??0}}function n(s,a){return r({line:s,character:a})}t.Beginning=t.create(0,0),t.Infinity=t.create(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);function i(s){return`<${s.line}, ${s.character}>`}t.toString=i;function o(s,a){return s.line<a.line||s.line===a.line&&s.character<a.character}t.isBefore=o})(kt||(kt={}));var Jn;(function(t){function e(s,a,l,c){if(typeof s=="number")return{start:kt.create(s,a),end:kt.create(l,c)};if(a!==void 0)return{start:kt.create(s),end:kt.create(a)};{let f=s;return{start:kt.create(f.start??{}),end:kt.create(f.end??{})}}}t.create=e;function r(s,a){let l=v.get(s);return{start:a.positionAt(l.start),end:a.positionAt(l.end)}}t.from=r,t.Beginning=Object.freeze(t.create(0,0,0,1)),t.Full=Object.freeze(t.create(kt.Beginning,kt.Infinity));function n(s){return`[${kt.toString(s.start)}, ${kt.toString(s.end)})`}t.toString=n;function i(s,a){let{start:l,end:c}=s;return a.line<l.line||a.line>c.line?!1:l.line<a.line&&a.line<c.line?!0:(a.line===l.line?a.character>=l.character:!0)&&(a.line===c.line?a.character<c.character:!0)}t.contains=i;function o(s,a){return kt.isBefore(kt.create(s.end.line,s.end.character-1),a)}t.endsBefore=o})(Jn||(Jn={}));var au=Object.freeze({create(t,e,r=3,n){let i={range:e,message:t,severity:r};return n&&(i.info=n),i},withPosRange(t,e){return{posRange:Jn.from(t.range,e),message:t.message,severity:t.severity,...t.info&&{info:t.info}}}});var lu;(function(t){function e(n){return{uri:n.uri??"",range:v.get(n.range??{start:0,end:0}),posRange:n.posRange??{start:{line:0,character:0},end:{line:0,character:0}}}}t.get=e;function r(n,i){return t.get({uri:n.uri,range:i,posRange:Jn.from(i,n)})}t.create=r})(lu||(lu={}));var Ke;(function(t){function e(u){return!!u&&typeof u=="object"&&typeof u.type=="string"&&v.is(u.range)}t.is=e;function r(u){for(let h of u.children??[])h.parent=u,r(h)}t.setParents=r;function n(u,h,d=!1){if(!u.children)return-1;let p=typeof h=="number"?v.compareOffset:v.compare;return(0,Bw.default)(u.children,h,(b,m)=>p(b.range,m,d))}t.findChildIndex=n;function i(u,h,d=!1){return u.children?.[n(u,h,d)]}t.findChild=i;function o(u,h,d=!1){if(!u.children)return-1;let p=-1;for(let[b,m]of u.children.entries())if(v.endsBefore(m.range,h,d))p=b;else break;return p}t.findLastChildIndex=o;function s(u,h,d=!1){return u.children?.[o(u,h,d)]}t.findLastChild=s;function a({node:u,needle:h,endInclusive:d=!1,predicate:p=()=>!0}){let b,m=v.contains(u,h,d)?u:void 0;for(;m&&p(m);)b=m,m=i(m,h,d);return b}t.findDeepestChild=a;function l({node:u,needle:h,endInclusive:d=!1,predicate:p=()=>!0}){let b=v.contains(u,h,d)?u:void 0;for(;b&&!p(b);)b=i(b,h,d);return b}t.findShallowestChild=l;function*c(u){let h=u;for(;h;)h.locals&&(yield h.locals),h=u.parent}t.getLocalsToRoot=c;function*f(u){u.locals&&(yield u.locals);for(let h of u.children??[])yield*f(h)}t.getLocalsToLeaves=f})(Ke||(Ke={}));var cu;(function(t){function e(n){return n.type==="boolean"}t.is=e;function r(n){return{type:"boolean",range:v.get(n)}}t.mock=r})(cu||(cu={}));var Ya=Object.freeze({is(t){return t?.type==="comment"}});var jw;(function(t){function e(r){return r.type==="error"}t.is=e})(jw||(jw={}));var fs;(function(t){function e(r){return[...r.parserErrors,...r.binderErrors??[],...r.checkerErrors??[],...r.linterErrors??[]]}t.getErrors=e})(fs||(fs={}));var Sr;(function(t){function e(n){return n.type==="float"}t.is=e;function r(n){return{type:"float",range:v.get(n),value:0}}t.mock=r})(Sr||(Sr={}));var Ki;(function(t){function e(n){return n.type==="integer"}t.is=e;function r(n){return{type:"integer",range:v.get(n),value:0}}t.mock=r})(Ki||(Ki={}));var fu;(function(t){function e(r){return r?.type==="item"}t.is=e})(fu||(fu={}));var Ue;(function(t){function e(n){return n?.type==="literal"}t.is=e;function r(n,i){return{type:"literal",range:v.get(n),options:i,value:""}}t.mock=r})(Ue||(Ue={}));var $w;(function(t){function e(n){return n.type==="long"}t.is=e;function r(n){return{type:"long",range:v.get(n),value:0n}}t.mock=r})($w||($w={}));var kn;(function(t){function e(r){return r?.type==="pair"}t.is=e})(kn||(kn={}));var U;(function(t){let e=q.TagPrefix,r=q.NamespacePathSep,n=q.PathSep,i=q.DefaultNamespace;function o(l){return l?.type==="resource_location"}t.is=o;function s(l,c){return{type:"resource_location",range:v.get(l),options:c}}t.mock=s;function a(l,c="origin",f=!1){let u=l.path?l.path.join(n):"",h;switch(c){case"origin":h=l.namespace!==void 0?`${l.namespace}${r}${u}`:u;break;case"full":h=`${l.namespace||i}${r}${u}`;break;case"short":h=l.namespace&&l.namespace!==i?`${l.namespace}${r}${u}`:u;break}return f&&l.isTag?`${e}${h}`:h}t.toString=a})(U||(U={}));var Qa=Symbol("SequenceUtilDiscriminator"),Xa;(function(t){function e(r){return!!r&&r[Qa]}t.is=e})(Xa||(Xa={}));var uu;(function(t){function e(r,n){return r?r.includes(n):!1}t.is=e})(uu||(uu={}));var zw=new Map([['"','"'],["'","'"],["\\","\\"],["b","\b"],["f","\f"],["n",`
`],["r","\r"],["t","	"]]),et;(function(t){function e(n){return n?.type==="string"}t.is=e;function r(n,i){return n=v.get(n),{type:"string",range:n,options:i,value:"",valueMap:[{inner:v.create(0),outer:v.create(n.start)}]}}t.mock=r})(et||(et={}));var or;(function(t){function e(n){return n?.type==="symbol"}t.is=e;function r(n,i){return{type:"symbol",range:v.get(n),options:i,value:""}}t.mock=r})(or||(or={}));var Fw={array:"an array",boolean:"a boolean","bug-of-mc":"Due to a bug of Minecraft (%0%), %1%. Please Mojang, fix your game","code-action.block-state-sort-keys":"Sort block state","code-action.command-replaceitem":"Update this command to /item \u2026 replace","code-action.fix-file":"Fix all auto-fixable problems in this file","code-action.fix-workspace":"Fix all auto-fixable problems in the workspace","code-action.id-attribute-datafix":"Update this attribute name to 1.16","code-action.id-complete-default-namespace":"Complete default namespace","code-action.id-create-file":"Create %0% in the same data pack","code-action.id-omit-default-namespace":"Omit default namespace","code-action.id-zombified-piglin-datafix":"Change this ID to Zombified Piglin's","code-action.nbt-compound-sort-keys":"Sort NBT compound tag","code-action.nbt-type-to-byte":"Convert to an NBT byte tag","code-action.nbt-type-to-double":"Convert to an NBT double tag","code-action.nbt-type-to-float":"Convert to an NBT float tag","code-action.nbt-type-to-int":"Convert to an NBT int tag","code-action.nbt-type-to-long":"Convert to an NBT long tag","code-action.nbt-type-to-short":"Convert to an NBT short tag","code-action.nbt-uuid-datafix":"Update this UUID to 1.16","code-action.selector-sort-keys":"Sort selector argument","code-action.string-double-quote":"Quote this string with double quotation marks","code-action.string-single-quote":"Quote this string with single quotation marks","code-action.string-unquote":"Unquote this string","code-action.vector-align-0.0":"Align this vector to block origin","code-action.vector-align-0.5":"Align this vector to block center",comment:"a comment starting with %0%","conjunction.and_2":" and ","conjunction.and_3+_1":", ","conjunction.and_3+_2":", and ","conjunction.or_2":" or ","conjunction.or_3+_1":", ","conjunction.or_3+_2":", or ","datafix.error.command-replaceitem":"/replaceitem was removed in 20w46a (the second snapshot of 1.17) in favour of /item","duplicate-key":"Duplicate key %0%","ending-quote":"an ending quote %0%",entity:"an entity","error.unparseable-content":"Encountered unparseable content",expected:"Expected %0%","expected-got":"Expected %0% but got %1%",float:"a float","float.between":"a float between %0% and %1%",integer:"an integer","integer.between":"an integer between %0% and %1%","json.doc.advancement.display":"Advancement display settings. If present, the advancement will be visible in the advancement tabs.","json.checker.array.length-between":"%0% with length between %1% and %2%","json.checker.object.field.union-empty-members":"Disallowed property","json.checker.item.duplicate":"Duplicate list item","json.checker.property.deprecated":"Property %0% is deprecated","json.checker.property.missing":"Missing property %0%","json.checker.property.unknown":"Unknown property %0%","json.checker.string.hex-color":"a 6-digit hexadecimal number","json.checker.tag-entry.duplicate":"Duplicate tag entry","json.node.array":"an array","json.node.boolean":"a boolean","json.node.null":"a null","json.node.number":"a number","json.node.object":"an object","json.node.string":"a string","key-not-following-convention":"Invalid key %0% which doesn't follow %1% convention","linter.diagnostic-message-wrapper":"%0% (rule: %1%)","linter.name-convention.illegal":"Name %0% doesn't match %1%","linter.undeclared-symbol.message":"Cannot find %0% %1%","linter-config-validator.name-convention.type":"Expects a string that contains a regular expression describing the name","linter-config-validator.wrapper":"%0%. See [the documentation](%1) for more information",long:"a long","mcfunction.checker.command.data-modify-unapplicable-operation":"Operation %0% can only be used on %1%; the target path has type %2% instead","mcfunction.completer.block.states.default-value":"Default: %0%","mcfunction.parser.entity-selector.arguments.not-applicable":"%0% is not applicable here","mcfunction.parser.entity-selector.arguments.unknown":"Unknown entity selector argument %0%","mcfunction.parser.entity-selector.entities-disallowed":"The selector contains non-player entities","mcfunction.parser.entity-selector.multiple-disallowed":"The selector contains multiple entities","mcfunction.parser.entity-selector.player-name.too-long":"Player names cannot be longer than %0% characters","mcfunction.parser.eoc-unexpected":"Expected more arguments","mcfunction.parser.leading-slash":"a leading slash %0%","mcfunction.parser.no-permission":"Permission level %0% is required, which is higher than %1% defined in config","mcfunction.parser.objective.too-long":"Objective names cannot be longer than %0% characters","mcfunction.parser.range.min>max":"The minimum value %0% is larger than the maximum value %1%","mcfunction.parser.score_holder.fake-name.too-long":"Fake names cannot be longer than %0% characters","mcfunction.parser.sep":"a space (%0%)","mcfunction.parser.trailing":"Trailing data encountered: %0%","mcfunction.parser.unknown-parser":"Parser %0% hasn't been supported yet","mcfunction.parser.uuid.invalid":"Invalid UUID format","mcfunction.parser.vector.local-disallowed":"Local coordinates disallowed","mcfunction.parser.vector.mixed":"Cannot mix local coordinates and world coordinates together","mcfunction.signature-help.command-documentation":"[Minecraft Wiki: `%0%` command](https://minecraft.fandom.com/wiki/Commands/%0%)","mcfunction.signature-help.argument-parser-documentation":"[Minecraft Wiki: `%0%` argument parser](https://minecraft.fandom.com/wiki/Argument_types#%0%)","missing-key":"Missing key %0%","nbt.checker.block-states.fake-boolean":"Boolean block state values should be quoted","nbt.checker.block-states.unexpected-value-type":"Block state values should be either a string or an int","nbt.checker.block-states.unknown-state":"Unknown block state %0% for the following block(s): %1%","nbt.checker.boolean.out-of-range":"A boolean value should be either %0% or %1%","nbt.checker.collection.length-between":"%0% with length between %1% and %2%","nbt.checker.compound.field.union-empty-members":"Disallowed property","nbt.checker.path.index-out-of-bound":"The provided index %0% is out of bound, as the collection can only have at most %1% elements","nbt.checker.path.unexpected-filter":"Compound filters can only be used on compound tags","nbt.checker.path.unexpected-index":"Indices can only be used on array or list tags","nbt.checker.path.unexpected-key":"String keys can only be specified for compound tags","nbt.node":"a tag","nbt.node.byte":"a byte tag","nbt.node.byte_array":"a byte array tag","nbt.node.compound":"a compound tag","nbt.node.double":"a double tag","nbt.node.float":"a float tag","nbt.node.int":"an int tag","nbt.node.int_array":"an int array tag","nbt.node.list":"a list tag","nbt.node.long":"a long tag","nbt.node.long_array":"a long array tag","nbt.node.path.end":"the end of path","nbt.node.path.filter":"a compound filter","nbt.node.path.index":"an index","nbt.node.path.key":"a key","nbt.node.short":"a short tag","nbt.node.string":"a string tag","nbt.parser.number.out-of-range":"This looks like %0%, but it is actually %1% due to the numeral value being out of [%2%, %3%]","mcdoc.binder.dispatcher-statement.duplicated-key":"Duplicated dispatcher case %0%","mcdoc.binder.dispatcher-statement.duplicated-key.related":"%0% has already been dispatched here","mcdoc.binder.duplicated-declaration":"Duplicated declaration for %0%","mcdoc.binder.duplicated-declaration.related":"%0% is already declared here","mcdoc.binder.out-of-root":"File %0% is not under the root directory of any mcdoc project; semantic checking will be skipped","mcdoc.binder.path.super-from-root":"Cannot access super of the project root","mcdoc.binder.path.unknown-identifier":"Identifier %0% does not exist in module %1%","mcdoc.binder.path.unknown-module":"Module %0% does not exist","mcdoc.node.compound-definition":"a compound definition","mcdoc.node.enum-definition":"an enum definition","mcdoc.node.identifier":"an identifier","mcdoc.checker.entry.empty-mod-seg":"You cannot put \u201Cmod.mcdoc\u201D under a root directly","mcdoc.checker.inject-clause.unmatched-injection":"Cannot inject %0% with %1%","mcdoc.checker.type-not-assignable":"Type %0% is not assignable to type %1%","mcdoc.parser.compound-definition.field-type":"a field type","mcdoc.parser.float.illegal":"Encountered illegal float number","mcdoc.parser.identifier.reserved-word":"%0% is a reserved word and cannot be used as an identifier name","mcdoc.parser.identifier.illegal":"%0% doesn't follow the format of %1%","mcdoc.parser.index-body.dynamic-index-not-allowed":"Dynamic indexing is not allowed","mcdoc.parser.inject-clause.definition-expected":"Expected either an enum inject or a compound inject","mcdoc.parser.keyword.separation":"a separation","mcdoc.parser.resource-location.colon-expected":"Expected the colon (%0%) of resource locations","mcdoc.parser.syntax.doc-comment-unexpected":"Doc comments are not allowed here; you might want to replace the three slashes with two slashes","not-matching-any-child":"Invalid argument type",nothing:"nothing",number:"a number","number-range":"a number range","number-range.missing-min-and-max":"Expected either a minimum value or a maximum value","number.<=":"a number smaller than or equal to %0%","number.>=":"a number greater than or equal to %0%","number.between":"a number between %0% and %1%",object:"an object",objective:"an objective","objective-not-following-convention":"Invalid objective %0% which doesn't follow %1% convention","parser.float.illegal":"Illegal float numeral that doesn't follow %0%","parser.integer.illegal":"Illegal integer that doesn't follow %0%","parser.list.value":"a value","parser.list.trailing-sep":"Trailing separation","parser.record.key":"a key","parser.record.trailing-end":"Trailing separation","parser.record.unexpected-char":"Unexpected character %0%","parser.record.value":"a value","parser.resource-location.illegal":"Illegal character(s): %0%","parser.resource-location.namespace-expected":"Namespaces cannot be omitted here","parser.resource-location.tag-diallowed":"Tags are not allowed here","parser.string.illegal-brigadier":"Encountered non-[0-9A-Za-z_.+-] characters in %0%","parser.string.illegal-escape":"Unexpected escape character %0%","parser.string.illegal-quote":"Only %0% can be used to quote strings here","parser.string.illegal-unicode-escape":"Hexadecimal digit expected","punc.period":".","punc.quote":"\u201C%0%\u201D",quote:`a quote (\u201C'\u201D or \u201C"\u201D)`,quote_prefer_double:'Double quote (\u201C"\u201D) is preferable here',quote_prefer_single:"Single quote (\u201C'\u201D) is preferable here","resource-location":"a resource location","score-holder":"a score holder","scoreholder-not-following-convention":"Invalid score_holder %0% which doesn't follow %1% convention","server.new-version":"The Data-pack Language Server has been updated to a newer version: %0%","server.progress.fixing-workspace.begin":"Fixing all auto-fixable problems in the workspace","server.progress.fixing-workspace.report":"fixing %0%","server.progress.preparing.title":"Preparing Spyglass language features","server.remove-cache-file":"The cache file of DHP was moved to a storage location provided by VSCode. You can safely delete the ugly \u201C.datapack\u201D folder in your workspace root.","server.show-release-notes":"Show Release Notes",string:"a string",tag:"a tag","tag-not-following-convention":"Invalid tag %0% which doesn't follow %1% convention",team:"a team","team-not-following-convention":"Invalid team %0% which doesn't follow %1% convention","time-unit":"a time unit","too-many-block-affected":"Too many blocks in the specified area (maximum %0%, specified %1%)","too-many-chunk-affected":"Too many chunks in the specified area (maximum %0%, specified %1%)","unexpected-character":"Found non [a-z0-9/._-] character(s)","unexpected-datapack-tag":"Tags are not allowed here","unexpected-default-namespace":"Default namespace should be omitted here","unexpected-leading-slash":"Unexpected leading slash \u201C/\u201D","unexpected-local-coordinate":"Local coordinate %0% is not allowed","unexpected-nbt":"This tag doesn't exist here","unexpected-nbt-array-type":"Invalid array type %0%. Should be one of \u201CB\u201D, \u201CI\u201D, and \u201CL\u201D","unexpected-nbt-path-filter":"Compound filters are only used for compound tags","unexpected-nbt-path-index":"Indices are only used for lists/arrays tags","unexpected-nbt-path-key":"Keys are only used for compound tags","unexpected-nbt-path-sub":"The current tag doesn't have extra items","unexpected-omitted-default-namespace":"Default namespace shouldn't be omitted here","unexpected-relative-coordinate":"Relative coordinate %0% is not allowed","unexpected-scoreboard-sub-slot":"Only \u201Csidebar\u201D has sub slots","unknown-command":"Unknown command %0%","unknown-escape":"Unexpected escape character %0%","unknown-key":"Unknown key %0%","unquoted-string":"an unquoted string","unsorted-keys":"Unsorted keys",uuid:"a UUID",vector:"a vector"};var Vw={en:Fw},jE="en";function y(t,...e){let r=Vw[jE][t]??Vw.en[t];return $E(r,e)??""}function P(t){return y("punc.quote",t)}function $E(t,e){return t?.replace(/%\d+%/g,r=>{let n=parseInt(r.slice(1,-1)),i=e[n];return typeof i!="string"&&i?.[Symbol.iterator]&&(i=vn(i)),`${i??r}`})}function vn(t,e=!0,r="or"){let n=o=>e?P(o):o,i=(typeof t=="string"?[t]:Array.from(t)).map(n);switch(i.length){case 0:return y("nothing");case 1:return i[0];case 2:return i[0]+y(`conjunction.${r}_2`)+i[1];default:return`${i.slice(0,-1).join(y(`conjunction.${r}_3+_1`))}${y(`conjunction.${r}_3+_2`)}${i[i.length-1]}`}}function De(...t){let e=zE(t);return(r,n)=>{let i={type:"literal",range:v.create(r),options:e,value:""};for(let o of e.pool)if(r.trySkip(o))return i.value=o,i.range.end=r.cursor,i;return n.err.report(y("expected",e.pool),i),i}}function zE(t){let e;return typeof t[0]=="object"?e=t[0]:e={pool:t},e.pool=e.pool.sort((r,n)=>n.length-r.length),e}var Sm=Br(tu(),1);var _m=Object.freeze(["mcdoc","mcdoc/dispatcher"]),Gi=Object.freeze(["activity","attribute","block","block_entity_type","block_predicate_type","chunk_status","custom_stat","enchantment","entity_type","float_provider_type","fluid","game_event","height_provider_type","int_provider_type","item","loot_condition_type","loot_function_type","loot_nbt_provider_type","loot_number_provider_type","loot_pool_entry_type","loot_score_provider_type","memory_module_type","menu","mob_effect","motive","particle_type","point_of_interest_type","pos_rule_test","position_source_type","potion","recipe_serializer","recipe_type","rule_test","schedule","sensor_type","sound_event","stat_type","villager_profession","villager_type","worldgen/biome_source","worldgen/block_placer_type","worldgen/block_state_provider_type","worldgen/carver","worldgen/chunk_generator","worldgen/decorator","worldgen/feature","worldgen/feature_size_type","worldgen/foliage_placer_type","worldgen/material_condition","worldgen/material_rule","worldgen/placement_modifier_type","worldgen/structure_feature","worldgen/structure_piece","worldgen/structure_pool_element","worldgen/structure_processor","worldgen/surface_builder","worldgen/tree_decorator_type","worldgen/trunk_placer_type"]),qw=Object.freeze(["worldgen/biome","worldgen/configured_carver","worldgen/configured_feature","worldgen/configured_structure_feature","worldgen/configured_surface_builder","worldgen/density_function","worldgen/noise","worldgen/noise_settings","worldgen/placed_feature","worldgen/processor_list","worldgen/template_pool"]),Cm=Object.freeze(["function",...Gi,...qw]),FE=Object.freeze(Cm.map(t=>`tag/${t}`)),hs=Object.freeze(["advancement","dimension","dimension_type","function","item_modifier","loot_table","predicate","recipe","structure",...FE,...qw]),VE=Object.freeze(["attribute_modifier_uuid","bossbar","objective","score_holder","storage","tag","team"]),UE=Object.freeze([...hs,...VE]),q$=Object.freeze([...UE,..._m,...Gi]),HE=Object.freeze(["bossbar","storage","mcdoc/dispatcher",...hs,...Gi]),Uw;(function(t){function e(r){return HE.includes(r)}t.is=e})(Uw||(Uw={}));var St;(function(t){function e(i){return i?{category:i.category,path:i.path}:void 0}t.fromSymbol=e;function r(i){return JSON.stringify({category:i.category,path:i.path})}t.toString=r;function n(i){return JSON.parse(i)}t.fromString=n})(St||(St={}));var us,Hw=class{constructor(){R(this,us,new Set)}add(e){e&&g(this,us).add(St.toString(e))}has(e){return g(this,us).has(St.toString(e))}collect(){return[...g(this,us)].map(St.fromString)}};us=new WeakMap;var Zi=Object.freeze(["definition","declaration","implementation","reference","typeDefinition"]),el;(function(t){function e(r){return Zi.includes(r)}t.is=e})(el||(el={}));var Ww;(function(t){function e(r,n,...i){if(Nw(r)){for(let s of r){let a=e(s,n,...i);if(a)return a}return}let o=r[n];for(let s of i);}t.get=e})(Ww||(Ww={}));var hu;(function(t){function e(r,n,i,o,s){return{...lu.create(r,n),...i?{fullRange:v.get(i),fullPosRange:Jn.from(i,r)}:{},...o?{contributor:o}:{},...s||{}}}t.create=e})(hu||(hu={}));var tl;(function(t){function e(o){let s=(c,f,u,h,d)=>{c.category=h,c.identifier=d[d.length-1],c.path=d,c.parentMap=f,u&&(c.parentSymbol=u),c.members&&a(c.members,c,h,d)},a=(c,f,u,h)=>{for(let[d,p]of Object.entries(c))s(p,c,f,u,[...h,d])},l=(0,Sm.default)()(o);for(let[c,f]of Object.entries(l))a(f,void 0,c,[]);return l}t.link=e;function r(o){let s=c=>{delete c.category,delete c.identifier,delete c.parentMap,delete c.parentSymbol,delete c.path,c.members&&a(c.members)},a=c=>{for(let f of Object.values(c))s(f)},l=(0,Sm.default)({circles:!0})(o);for(let c of Object.values(l))a(c);return l}t.unlink=r;function n(o){return JSON.stringify(r(o))}t.serialize=n;function i(o){return e(JSON.parse(o))}t.deserialize=i})(tl||(tl={}));var Gw=Br(pu(),1);var gu=function(t,e,r,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(i<3?s(o):i>3?s(e,r,o):s(e,r))||o);return i>3&&o&&Object.defineProperty(e,r,o),o},Xn,Ji,rl,Qn,Yi,sr,_t=class{constructor(e,r,n,i=!1){R(this,Xn,void 0);R(this,Ji,void 0);R(this,rl,void 0);R(this,Qn,new Set);R(this,Yi,Object.create(null));R(this,sr,void 0);H(this,"_delayedOps",[]);H(this,"_inDelayMode");L(this,Ji,new r),L(this,rl,r),L(this,Xn,e),L(this,sr,n),this._inDelayMode=i,this.on("symbolCreated",({symbol:o})=>{g(this,Qn).add(St.toString(o))}).on("symbolRemoved",({symbol:o})=>{g(this,Qn).delete(St.toString(o))}).on("symbolLocationCreated",({symbol:o,location:s})=>{let a=g(this,Yi)[s.contributor??"undefined"]??=Object.create(null),l=a[s.uri]??=new Set,c=St.toString(o);l.add(c),g(this,Qn).delete(c)}).on("symbolLocationRemoved",({symbol:o})=>{let s=St.toString(o);g(this,Qn).add(s)})}get global(){return g(this,Xn)}on(e,r){return g(this,Ji).on(e,r),this}once(e,r){return g(this,Ji).once(e,r),this}emit(e,...r){return g(this,Ji).emit(e,...r)}buildCache(){_t.forEachSymbol(this.global,e=>{this.emit("symbolCreated",{symbol:e}),_t.forEachLocationOfSymbol(e,({type:r,location:n})=>{this.emit("symbolLocationCreated",{symbol:e,type:r,location:n})})})}clone(){return new _t(g(this,Xn),g(this,rl),g(this,sr),!0)}applyDelayedEdits(){this._delayedOps.forEach(e=>e()),this._delayedOps=[],this._inDelayMode=!1}contributeAs(e,r){let n=g(this,sr);L(this,sr,e);try{r()}finally{L(this,sr,n)}return this}async contributeAsAsync(e,r){let n=g(this,sr);L(this,sr,e);try{await r()}finally{L(this,sr,n)}return this}clear({uri:e,contributor:r,predicate:n=()=>!0}){let i=()=>r?g(this,Yi)[r]?[g(this,Yi)[r]]:[]:Object.values(g(this,Yi)),o=()=>{let c=i();return(e?c.map(u=>u[e]??new Set):c.map(u=>Object.values(u)).flat()).map(u=>[...u]).flat().map(St.fromString)},s=()=>e?[g(this,Xn)]:[g(this,Xn)],a=o(),l=s();for(let c of l){for(let f of a){let{symbol:u}=_t.lookupTable(c,f.category,f.path);u&&this.removeLocationsFromSymbol(u,e?h=>h.location.uri===e&&n(h):n)}this.trim(c)}}lookup(e,r,n){for(;n;){if(n.locals){let i=_t.lookupTable(n.locals,e,r);if(i.symbol)return i}n=n.parent}return _t.lookupTable(this.global,e,r)}query(e,r,...n){let i=_t.toUri(e),{parentSymbol:o,parentMap:s,symbol:a}=this.lookup(r,n,Om(e)?e.node:void 0),l=a?_t.isVisible(a,i):!0;return new mu({category:r,doc:e,contributor:g(this,sr),map:l?s:void 0,parentSymbol:o,path:n,symbol:l?a:void 0,util:this})}getVisibleSymbols(e,r){let n=this.lookup(e,[],void 0).parentMap??void 0;return _t.filterVisibleSymbols(r,n)}static toUri(e){return typeof e=="string"?e:Om(e)?e.doc.uri:e.uri}trim(e){let r=n=>{n&&_t.isTrimmable(n)&&(delete n.parentMap[n.identifier],this.emit("symbolRemoved",{symbol:n}),r(n.parentSymbol))};for(let n of g(this,Qn)){let i=St.fromString(n),{symbol:o}=_t.lookupTable(e,i.category,i.path);r(o)}}removeLocationsFromSymbol(e,r){for(let n of Zi)e[n]&&(e[n]=e[n].reduce((i,o)=>(r({location:o,symbol:e,type:n})?this.emit("symbolLocationRemoved",{symbol:e,type:n,location:o}):i.push(o),i),[]))}enterMap(e,r,n,i,o,s,a,l){let c=r[o];return c?this.amendSymbol(c,s,a,l):c=this.createSymbol(n,e,r,i,o,s,a,l),this.emit("symbolAmended",{symbol:c}),c}static lookupTable(e,r,n){let i=e[r],o,s;for(let a=0;a<n.length;a++){if(s=i?.[n[a]],!s){a!==n.length-1&&(o=void 0,i=void 0);break}if(a===n.length-1)break;o=s,i=s.members}return{parentSymbol:o,parentMap:i,symbol:s}}static lookupTables(e,r,n){let i,o;for(let s=e.length-1;s>=0;s--){let a=e[s],l=this.lookupTable(a,r,n);if(l.symbol)return l;!o&&!i&&(l.parentSymbol||l.parentMap)&&(o=l.parentSymbol,i=l.parentMap)}return{parentSymbol:o,parentMap:i,symbol:void 0}}createSymbol(e,r,n,i,o,s,a,l){let c=n[o]={category:e,identifier:o,...r?{parentSymbol:r}:{},parentMap:n,path:i,...s.data};return this.emit("symbolCreated",{symbol:c}),this.amendSymbolUsage(c,s.usage,a,l),c}amendSymbol(e,r,n,i){this.amendSymbolMetadata(e,r.data),this.amendSymbolUsage(e,r.usage,n,i)}amendSymbolMetadata(e,r){if(r){if("data"in r&&(e.data=r.data),"desc"in r&&(e.desc=r.desc),r.relations&&Object.keys(r.relations).length){e.relations??={};for(let n of Object.keys(r.relations))e.relations[n]=r.relations[n]}if("subcategory"in r&&(e.subcategory=r.subcategory),"visibility"in r){let n=i=>i===void 0||i===2||i===3;if(e.visibility===r.visibility||n(e.visibility)&&n(r.visibility))e.visibility=r.visibility;else throw new Error(`Cannot change visibility from ${e.visibility} to ${r.visibility}: ${JSON.stringify(St.fromSymbol(e))}`)}r.visibilityRestriction?.length&&(e.visibilityRestriction=(e.visibilityRestriction??[]).concat(r.visibilityRestriction))}}amendSymbolUsage(e,r,n,i){if(r){let o=r.type??"reference",s=e[o]??=[],a=v.get((Tm.is(r)?r.node:r.range)??0),l=hu.create(n,a,r.fullRange,i,{accessType:r.accessType,skipRenaming:r.skipRenaming});n.uri.startsWith("file:")||(delete l.range,delete l.posRange,delete l.fullRange,delete l.fullPosRange),s.push(l),this.emit("symbolLocationCreated",{symbol:e,type:o,location:l})}}resolveAlias(e){return e?.relations?.aliasOf?this.resolveAlias(this.lookup(e.relations.aliasOf.category,e.relations.aliasOf.path).symbol):e}static filterVisibleSymbols(e,r={}){let n={};for(let[i,o]of Object.entries(r))_t.isVisible(o,e)&&(n[i]=o);return n}static isTrimmable(e){return!Object.keys(e.members??{}).length&&!e.declaration?.length&&!e.definition?.length&&!e.implementation?.length&&!e.reference?.length&&!e.typeDefinition?.length}static isVisible(e,r){switch(e.visibility){case 3:return!1;case 0:case 1:case 2:default:return!0}}static isDeclared(e){return!!(e?.declaration?.length||e?.definition?.length)}static isDefined(e){return!!(e?.definition?.length||e?.definition?.length&&e?.implementation?.length)}static isImplemented(e){return!!(e?.implementation?.length||e?.definition?.length)}static isReferenced(e){return!!e?.reference?.length}static isTypeDefined(e){return!!e?.typeDefinition?.length}static getDeclaredLocation(e){return e.declaration?.[0]??e.definition?.[0]??(()=>{throw new Error(`Cannot get declared location of ${JSON.stringify(St.fromSymbol(e))}`)})()}static forEachSymbolInMap(e,r){for(let n of Object.values(e))r(n),n.members&&this.forEachSymbolInMap(n.members,r)}static forEachSymbol(e,r){for(let n of Object.values(e))this.forEachSymbolInMap(n,r)}static forEachLocationOfSymbol(e,r){for(let n of Zi)e[n]?.forEach(i=>r({type:n,location:i}))}static isVisibilityInGlobal(e){return e===void 0||e===2||e===3}static areVisibilitiesCompatible(e,r){return this.isVisibilityInGlobal(e)&&this.isVisibilityInGlobal(r)||e===0&&r===0||e===1&&r===1}},Pe=_t;Xn=new WeakMap,Ji=new WeakMap,rl=new WeakMap,Qn=new WeakMap,Yi=new WeakMap,sr=new WeakMap;gu([yu()],Pe.prototype,"clear",null);gu([yu()],Pe.prototype,"trim",null);gu([yu()],Pe.prototype,"removeLocationsFromSymbol",null);var Am;(function(t){function e(r){return!!r?.range}t.is=e})(Am||(Am={}));var Tm;(function(t){function e(r){return!!r?.node}t.is=e})(Tm||(Tm={}));var Jr,ei,Xi,ds,nl,Yr,wn,Ne,Em=class{constructor({category:e,contributor:r,doc:n,map:i,parentSymbol:o,path:s,symbol:a,util:l}){H(this,"category");H(this,"path");R(this,Jr,void 0);R(this,ei,void 0);R(this,Xi,void 0);R(this,ds,void 0);R(this,nl,!1);R(this,Yr,void 0);R(this,wn,void 0);R(this,Ne,void 0);H(this,"util");this.category=e,this.path=s,typeof n=="string"?(n=Gw.TextDocument.create(n,"",0,""),L(this,Xi,!0)):Om(n)&&(L(this,ei,n.node),n=n.doc),L(this,Jr,n),L(this,ds,r),L(this,Yr,i),L(this,wn,o),L(this,Ne,a),this.util=l}get symbol(){return g(this,Ne)}get visibleMembers(){return Pe.filterVisibleSymbols(g(this,Jr).uri,this.path.length===0?g(this,Yr):g(this,Ne)?.members)}heyGimmeDaSymbol(){return g(this,Ne)}getData(e){let r=g(this,Ne)?.data;return e(r)?r:void 0}with(e){return e(this),this}if(e,r){return e.call(this,g(this,Ne),this)&&(r.call(this,g(this,Ne),this),L(this,nl,!0)),this}ifUnknown(e){return this.if(r=>r===void 0,e)}ifKnown(e){return this.if(r=>r!==void 0,e)}ifDeclared(e){return this.if(r=>Pe.isDeclared(r),e)}ifDefined(e){return this.if(Pe.isDefined,e)}ifImplemented(e){return this.if(Pe.isImplemented,e)}ifReferenced(e){return this.if(Pe.isReferenced,e)}ifTypeDefined(e){return this.if(Pe.isTypeDefined,e)}else(e){return g(this,nl)||e.call(this,g(this,Ne),this),this}elseEnter(e){return this.else(()=>this.enter(e))}elseResolveAlias(){return this.else(()=>this.resolveAlias())}_enter(e){let r=i=>i.data?.visibility??this.symbol?.visibility??2,n=i=>{let o=r(i);if(g(this,Yr)&&Pe.areVisibilitiesCompatible(o,g(this,Ne)?.visibility))return g(this,Yr);if(this.path.length>1){if(g(this,wn)){if(!Pe.areVisibilitiesCompatible(o,g(this,wn).visibility))throw new Error(`Cannot enter member \u201C${this.getPath()}\u201D of ${Yn.stringifyVisibility(o)} visibility to parent of ${Yn.stringifyVisibility(g(this,wn).visibility)} visibility`);return g(this,wn).members??={}}}else{let s;if(Pe.isVisibilityInGlobal(o))s=this.util.global;else if(o===1){if(!g(this,ei))throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Yn.stringifyVisibility(o)} visibility as no node is supplied`);let a=g(this,ei);for(;a;){if(a.type==="file"){s=a.locals;break}a=a.parent}if(!s)throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Yn.stringifyVisibility(o)} visibility as no file node is supplied`)}else{if(!g(this,ei))throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Yn.stringifyVisibility(o)} visibility as no node is supplied`);let a=g(this,ei);for(;a;){if(a.locals){s=a.locals;break}a=a.parent}if(!s)throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Yn.stringifyVisibility(o)} visibility as no node with locals is supplied`)}return s[this.category]??={}}throw new Error(`Cannot create the symbol map for \u201C${this.getPath()}\u201D`)};g(this,Xi)&&Am.is(e.usage)&&(e.usage.range=v.create(0,0)),L(this,Yr,n(e)),L(this,Ne,this.util.enterMap(g(this,wn),g(this,Yr),this.category,this.path,this.path[this.path.length-1],e,g(this,Jr),g(this,ds))),e.usage?.node&&(e.usage.node.symbol=g(this,Ne))}enter(e){return this._enter(e),this}amend(e){return this.ifKnown(()=>this.enter(e))}resolveAlias(){if(g(this,Ne)){let e=this.util.resolveAlias(g(this,Ne));if(!e)throw new Error("The current symbol points to an non-existent symbol.");L(this,Ne,e),L(this,Yr,e.parentMap)}return this}member(){let e,r,n;if(arguments.length===2?(e=g(this,Xi)?g(this,Jr).uri:g(this,Jr),r=arguments[0],n=arguments[1]):(e=arguments[0],r=arguments[1],n=arguments[2]),g(this,Ne)===void 0)throw new Error(`Tried to query member symbol \u201C${r}\u201D from an undefined symbol (path \u201C${this.path.join(".")}\u201D)`);let i=typeof e=="string"&&e===g(this,Jr).uri&&!g(this,Xi)?g(this,Jr):e,o=g(this,Ne).members,s=o?.[r],a=new Em({category:this.category,doc:i,contributor:g(this,ds),map:o,parentSymbol:g(this,Ne),path:[...this.path,r],symbol:s,util:this.util});return n(a),this}onEach(e,r){for(let n of e)r.call(this,n,this);return this}forEachMember(e){return this.onEach(Object.keys(this.visibleMembers),r=>this.member(r,n=>e(r,n)))}getPath(){return`${this.category}.${this.path.join("/")}`}},mu=Em;Jr=new WeakMap,ei=new WeakMap,Xi=new WeakMap,ds=new WeakMap,nl=new WeakMap,Yr=new WeakMap,wn=new WeakMap,Ne=new WeakMap;gu([yu(t=>t.util)],mu.prototype,"_enter",null);var Yn;(function(t){let e="+ ";function r(c,f){if(c!==f)throw new Error(`Assertion error: ${c} !== ${f}`)}function n(c){return c.map(f=>i(f)).join(`
------------
`)}t.stringifySymbolStack=n;function i(c,f=""){let u=[];for(let h of Object.keys(c)){let d=c[h];u.push([h,o(d,`${f}${e}`)])}return u.map(h=>`CATEGORY ${h[0]}
${h[1]}`).join(`
${f}------------
`)||"EMPTY TABLE"}t.stringifySymbolTable=i;function o(c,f=""){if(!c)return"undefined";let u=[];for(let h of Object.keys(c)){let d=c[h];r(h,d.identifier),u.push(s(d,f))}return u.join(`
${f}------------
`)}t.stringifySymbolMap=o;function s(c,f=""){if(!c)return"undefined";let u=[];r(c.path[c.path.length-1],c.identifier),u.push(`SYMBOL ${c.path.join(".")} {${c.category}${c.subcategory?` (${c.subcategory})`:""}} [${a(c.visibility,c.visibilityRestriction)}]`),c.data&&u.push(`${e}data: ${JSON.stringify(c.data)}`),c.desc&&u.push(`${e}description: ${c.desc}`);for(let h of Zi)c[h]&&u.push(`${e}${h}:
${c[h].map(d=>`${f}${e.repeat(2)}${JSON.stringify(d)}`).join(`
${f}${e.repeat(2)}------------
`)}`);return c.relations&&u.push(`${e}relations: ${JSON.stringify(c.relations)}`),c.members&&u.push(`${e}members:
${o(c.members,`${f}${e.repeat(2)}`)}`),u.map(h=>`${f}${h}`).join(`
`)}t.stringifySymbol=s;function a(c,f){let u;switch(c){case 0:u="Block";break;case 1:u="File";break;case 3:u="Restricted";break;default:u="Public";break}return`${u}${f?` ${f.map(h=>`\u201C${h}\u201D`).join(", ")}`:""}`}t.stringifyVisibility=a;function l(c){return`parentSymbol:
${s(c.parentSymbol,e)}
parentMap:
${o(c.parentMap,e)}
symbol:
${s(c.symbol,e)}`}t.stringifyLookupResult=l})(Yn||(Yn={}));function yu(t=e=>e){return(e,r,n)=>{let i=n.value;return n.value=function(...o){let s=t(this);s._inDelayMode?s._delayedOps.push(i.bind(this,...o)):i.apply(this,o)},n}}function Om(t){return!!t.doc}var Y;(function(t){function*e(x,T){for(let O of T)x.startsWith(O)&&(yield decodeURIComponent(x.slice(O.length)))}t.getRels=e;function r(x,T){return e(x,T).next().value}t.getRel=r;function n(x){return x.endsWith("/")}t.isRootUri=n;function i(x){return n(x)?x:`${x}/`}t.ensureEndingSlash=i;function o(x,T){return i(x)+(T.startsWith("/")?T.slice(1):T)}t.join=o;function s(x){return x.startsWith("file:")}t.isFileUri=s;function a(x){let T=x.lastIndexOf(".");return T>=0?x.slice(T):void 0}t.extname=a;function l(x){let T=x.lastIndexOf("/");return T>=0?x.slice(T+1):x}t.basename=l;function c(x,T){return new It(".",T)}t.getParentOfFile=c;async function f(x,T,O=511){try{await x.fs.mkdir(T,{mode:O,recursive:!0})}catch(M){if(!x.error.isKind(M,"EEXIST"))throw M}}t.ensureDir=f;async function u(x,T,O=511){return f(x,c(x,T),O)}t.ensureParentOfFile=u;async function h(x,T,O){return x.fs.chmod(T,O)}t.chmod=h;async function d(x,T){try{await h(x,T,438)}catch(O){if(!x.error.isKind(O,"ENOENT"))throw O}}t.ensureWritable=d;async function p(x,T){return h(x,T,292)}t.markReadOnly=p;async function b(x,T){return x.fs.readFile(T)}t.readFile=b;async function m(x,T,O,M=438){return await u(x,T),await d(x,T),x.fs.writeFile(T,O,{mode:M})}t.writeFile=m;async function k(x,T){return JSON.parse(ir(await b(x,T)))}t.readJson=k;async function S(x,T,O){return m(x,T,JSON.stringify(O))}t.writeJson=S;async function _(x,T){return x.archive.gunzip(await b(x,T))}t.readGzippedFile=_;async function w(x,T,O){return typeof O=="string"&&(O=new TextEncoder().encode(O)),m(x,T,await x.archive.gzip(O))}t.writeGzippedFile=w;async function C(x,T){return JSON.parse(ir(await _(x,T)))}t.readGzippedJson=C;async function E(x,T,O){return w(x,T,JSON.stringify(O))}t.writeGzippedJson=E})(Y||(Y={}));var Rm=2,bu;(function(t){function e(){return{files:{},roots:{},symbolRegistrars:{}}}t.create=e})(bu||(bu={}));var Qi,vu,ku=class{constructor(e,r){H(this,"cacheRoot");H(this,"project");H(this,"checksums",bu.create());H(this,"errors",{});R(this,Qi,!1);R(this,vu,void 0);this.cacheRoot=e,this.project=r,this.project.on("documentUpdated",async({doc:n})=>{if(g(this,Qi))try{this.checksums.files[n.uri]=await this.project.externals.crypto.getSha1(n.getText())}catch(i){this.project.externals.error.isKind(i,"EISDIR")||this.project.logger.error(`[CacheService#hash-file] ${n.uri}`)}}),this.project.on("rootsUpdated",async({roots:n})=>{if(g(this,Qi))for(let i of n)try{this.checksums.roots[i]=await this.project.fs.hash(i)}catch(o){this.project.externals.error.isKind(o,"EISDIR")||this.project.logger.error(`[CacheService#hash-root] ${i}`)}}),this.project.on("symbolRegistrarExecuted",({id:n,checksum:i})=>{i!==void 0&&(this.checksums.symbolRegistrars[n]=i)}),this.project.on("documentErrored",({uri:n,errors:i})=>{this.errors[n]=i})}async getCacheFileUri(){return g(this,vu)??L(this,vu,new It(`symbols/${await this.project.externals.crypto.getSha1(this.project.projectRoot)}.json.gz`,this.cacheRoot).toString())}async load(){let e=this.project.profilers.get("cache#load"),r={symbols:{}},n;try{n=await this.getCacheFileUri(),this.project.logger.info(`[CacheService#load] symbolCachePath = \u201C${n}\u201D`);let i=await Y.readGzippedJson(this.project.externals,n);e.task("Read File"),i.version===Rm?(this.checksums=i.checksums,this.errors=i.errors,r.symbols=tl.link(i.symbols),e.task("Link Symbols")):this.project.logger.info(`[CacheService#load] Unsupported cache format ${i.version}; expected ${Rm}`)}catch(i){this.project.externals.error.isKind(i,"ENOENT")||this.project.logger.error("[CacheService#load] ",i)}return e.finalize(),r}async validate(){let e={addedFiles:[],changedFiles:[],removedFiles:[],unchangedFiles:[]},r=[];for(let[n,i]of Object.entries(this.checksums.roots))try{await this.project.fs.hash(n)===i&&r.push(n)}catch(o){this.project.externals.error.isKind(o,"EISDIR")||this.project.logger.error(`[CacheService#hash-file] ${n}`)}for(let[n,i]of Object.entries(this.checksums.files)){if(r.some(o=>n.startsWith(o))){e.unchangedFiles.push(n);continue}try{await this.project.fs.hash(n)===i?e.unchangedFiles.push(n):e.changedFiles.push(n)}catch(o){this.project.externals.error.isKind(o,"ENOENT")||this.project.externals.error.isKind(o,"EISDIR")?e.removedFiles.push(n):(this.project.logger.error(`[CacheService#validate] ${n}`,o),e.changedFiles.push(n))}}for(let n of this.project.getTrackedFiles())n in this.checksums.files||e.addedFiles.push(n);return L(this,Qi,!0),e}async save(){let e=this.project.profilers.get("cache#save"),r;try{r=await this.getCacheFileUri();let n={version:Rm,projectRoot:this.project.projectRoot,checksums:this.checksums,symbols:tl.unlink(this.project.symbols.global),errors:this.errors};return e.task("Unlink Symbols"),await Y.writeGzippedJson(this.project.externals,r,n),e.task("Write File").finalize(),!0}catch(n){this.project.logger.error(`[CacheService#save] path = \u201C${r}\u201D`,n)}return!1}async hasFileChangedSinceCache(e){return this.checksums.files[e.uri]!==await this.project.externals.crypto.getSha1(e.getText())}reset(){return L(this,Qi,!1),this.checksums=bu.create(),this.errors={},{symbols:{}}}};Qi=new WeakMap,vu=new WeakMap;var Zw=Br(tu(),1);var ps;(function(t){function e(n){return n==="hint"||n==="information"||n==="warning"||n==="error"}t.is=e;function r(n){switch(n){case"error":return 3;case"hint":return 0;case"information":return 1;case"warning":return 2}}t.toErrorSeverity=r})(ps||(ps={}));var gs;(function(t){function e(r){if(r!=null)return ps.is(r)?{ruleSeverity:ps.toErrorSeverity(r),ruleValue:!0}:Array.isArray(r)&&ps.is(r[0])?{ruleSeverity:ps.toErrorSeverity(r[0]),ruleValue:r[1]}:{ruleSeverity:2,ruleValue:r}}t.destruct=e})(gs||(gs={}));var il;(function(t){function e(o){return Ve.is(o,r.is)||i.is(o)}t.is=e;let r;(function(o){function s(a){if(!a||typeof a!="object")return!1;let l=a;return(l.if===void 0||Ve.is(l.if,n.is))&&(l.then===void 0||i.is(l.then))&&(l.override===void 0||Ve.is(l.override,o.is))}o.is=s})(r=t.Complex||(t.Complex={}));let n;(function(o){function s(a){if(!a||typeof a!="object")return!1;let l=a;return(l.category===void 0||Ve.is(l.category,Gn.isString))&&(l.pattern===void 0||Ve.is(l.pattern,Gn.isString))&&(l.excludePattern===void 0||Ve.is(l.excludePattern,Gn.isString))&&(l.namespace===void 0||Ve.is(l.namespace,Gn.isString))&&(l.excludeNamespace===void 0||Ve.is(l.excludeNamespace,Gn.isString))}o.is=s})(n=t.Condition||(t.Condition={}));let i;(function(o){function s(c){return c!==void 0&&["block","file","public"].includes(c.declare)}o.isDeclare=s;function a(c){return c!==void 0&&["inherit","hint","information","warning","error"].includes(c.report)}o.isReport=a;function l(c){if(!c||typeof c!="object")return!1;let f=c;return s(f)||a(f)}o.is=l})(i=t.Action||(t.Action={}))})(il||(il={}));var Mm={env:{dataSource:"GitHub",dependencies:["@vanilla-mcdoc"],feature:{codeActions:!0,colors:!0,completions:!0,documentHighlighting:!0,documentLinks:!0,foldingRanges:!0,formatting:!0,hover:!0,inlayHint:{enabledNodes:["mcfunction:command_child/unknown"]},semanticColoring:!0,selectionRanges:!0,signatures:!0},gameVersion:"Auto",language:"Default",permissionLevel:2,plugins:[],mcmetaSummaryOverrides:{}},format:{blockStateBracketSpacing:{inside:0},blockStateCommaSpacing:{before:0,after:1},blockStateEqualSpacing:{before:0,after:0},blockStateTrailingComma:!1,eol:"auto",nbtArrayBracketSpacing:{inside:0},nbtArrayCommaSpacing:{before:0,after:1},nbtArraySemicolonSpacing:{after:1},nbtArrayTrailingComma:!1,nbtByteSuffix:"b",nbtCompoundBracketSpacing:{inside:0},nbtCompoundColonSpacing:{before:0,after:1},nbtCompoundCommaSpacing:{before:0,after:1},nbtCompoundTrailingComma:!1,nbtDoubleOmitSuffix:!1,nbtDoubleSuffix:"d",nbtFloatSuffix:"f",nbtListBracketSpacing:{inside:0},nbtListCommaSpacing:{before:0,after:1},nbtListTrailingComma:!1,nbtLongSuffix:"L",nbtShortSuffix:"s",selectorBracketSpacing:{inside:0},selectorCommaSpacing:{before:0,after:1},selectorEqualSpacing:{before:0,after:0},selectorTrailingComma:!1,timeOmitTickUnit:!1},lint:{blockStateSortKeys:null,nbtCompoundSortKeys:null,selectorSortKeys:null,commandStringQuote:null,nbtKeyQuote:null,nbtPathQuote:null,nbtStringQuote:null,selectorKeyQuote:null,idOmitDefaultNamespace:null,nameOfNbtKey:null,nameOfObjective:null,nameOfScoreHolder:null,nameOfTag:null,nameOfTeam:null,nbtArrayLengthCheck:!0,nbtBoolean:null,nbtListLengthCheck:null,nbtTypeCheck:"loosely",undeclaredSymbol:[{if:[{category:Gi,namespace:"minecraft"},{category:[...hs,"bossbar","objective","team"]}],then:{report:"warning"}},{then:{declare:"block"}}]},snippet:{executeIfScoreSet:"execute if score ${1:score_holder} ${2:objective} = ${1:score_holder} ${2:objective} $0",summonAec:'summon minecraft:area_effect_cloud ~ ~ ~ {Age: -2147483648, Duration: -1, WaitTime: -2147483648, Tags: ["${1:tag}"]}'}},eo,ms=class{constructor(e,r=Mm){H(this,"project");H(this,"defaultConfig");R(this,eo,void 0);this.project=e,this.defaultConfig=r,L(this,eo,new e.externals.event.EventEmitter);let n=async({uri:i})=>{ms.isConfigFile(i)&&this.emit("changed",{config:await this.load()})};e.on("fileCreated",n),e.on("fileModified",n),e.on("fileDeleted",n)}on(e,r){return g(this,eo).on(e,r),this}once(e,r){return g(this,eo).once(e,r),this}emit(e,...r){return g(this,eo).emit(e,...r)}async load(){let e=this.defaultConfig;for(let r of ms.ConfigFileNames){let n=this.project.projectRoot+r;try{e=JSON.parse(ir(await this.project.externals.fs.readFile(n)))}catch(i){if(this.project.externals.error.isKind(i,"ENOENT"))continue;this.emit("error",{error:i,uri:n})}break}return ms.merge(this.defaultConfig,e)}static isConfigFile(e){return ms.ConfigFileNames.some(r=>e.endsWith(`/${r}`))}static merge(e,...r){let n=(0,Zw.default)()(e);for(let i of r)for(let o of["env","format","lint","snippet"])n[o]={...n[o],...i[o]};return n}},to=ms;eo=new WeakMap,H(to,"ConfigFileNames",Object.freeze(["spyglass.json",".spyglassrc.json"]));var Dm=Symbol("IsAsyncBinder"),ti=Object.freeze({create(t){return t},is(t){return!t[Dm]}}),ol=Object.freeze({create(t){return Object.assign(t,{[Dm]:!0})},is(t){return t[Dm]}});var sl={};yr(sl,{any:()=>WE,attempt:()=>Nm,dispatchSync:()=>GE,fallback:()=>KE,noop:()=>qE,registerBinders:()=>ZE,resourceLocation:()=>Yw,symbol:()=>Xw});function Ct(t,e,r,n){Jw(t,e,r,n,[])}function Jw(t,e,r,n,i){if(r(t,i)&&n(t,i),!(!t.children||!e(t,i)))for(let o of t.children??[])i.unshift(t),Jw(o,e,r,n,i),i.shift()}function Nm(t,e,r){let n={...r,err:new ut,symbols:r.symbols.clone()},i=()=>{Qe.undoChanges(e);let o=n.err.errors.map(s=>s.range.end-s.range.start).reduce((s,a)=>s+a,0);return{errorAmount:n.err.errors.length,totalErrorSpan:o,updateNodeAndCtx:()=>{r.err.absorb(n.err),Qe.redoChanges(e),n.symbols.applyDelayedEdits()}}};return ti.is(t)?(t(e,n),i()):(async()=>(await t(e,n),i()))()}function WE(t){if(t.length===0)throw new Error("Expected at least one binder");let e=(r,n)=>r.errorAmount-n.errorAmount||r.totalErrorSpan-n.totalErrorSpan;return t.every(ti.is)?ti.create((r,n)=>{t.map(o=>Nm(o,r,n)).sort(e)[0].updateNodeAndCtx()}):ol.create(async(r,n)=>{(await Promise.all(t.map(o=>Nm(o,r,n)))).sort(e)[0].updateNodeAndCtx()})}var qE=ti.create(()=>{}),KE=ol.create(async(t,e)=>{let r=[];Ct(t,n=>!e.meta.hasBinder(n.type),n=>e.meta.hasBinder(n.type),n=>{let o=e.meta.getBinder(n.type)(n,e);o instanceof Promise&&r.push(o)}),await Promise.all(r)}),GE=ti.create((t,e)=>{for(let r of t.children??[])e.meta.hasBinder(r.type)&&e.meta.getBinder(r.type)(r,e)}),Yw=ti.create((t,e)=>{let r=U.toString(t,"full"),n=q.lengthen(t.options.namespacePathSep==="."?r.replace(/\./g,q.NamespacePathSep):r);if(t.options.category&&e.symbols.query(e.doc,t.isTag?`tag/${t.options.category}`:t.options.category,n).enter({usage:{type:t.options.usageType,node:t,accessType:t.options.accessType}}),t.options.pool&&!t.options.allowUnknown){t.options.pool.includes(n)||e.err.report(y("expected",t.options.pool),t,3);return}}),Xw=ti.create((t,e)=>{if(t.value){let r=t.options.parentPath?[...t.options.parentPath,t.value]:[t.value];e.symbols.query(e.doc,t.options.category,...r).enter({usage:{type:t.options.usageType,node:t,accessType:t.options.accessType}})}});function ZE(t){t.registerBinder("resource_location",Yw),t.registerBinder("symbol",Xw)}var tt={};yr(tt,{any:()=>JE,attempt:()=>Qw,dispatchSync:()=>QE,fallback:()=>XE,noop:()=>YE,registerCheckers:()=>eR,resourceLocation:()=>ex,symbol:()=>tx});function Qw(t,e,r){let n={...r,err:new ut,symbols:r.symbols.clone()};t(e,n),Qe.undoChanges(e);let i=n.err.errors.map(o=>o.range.end-o.range.start).reduce((o,s)=>o+s,0);return{errorAmount:n.err.errors.length,totalErrorSpan:i,updateNodeAndCtx:()=>{r.err.absorb(n.err),Qe.redoChanges(e),n.symbols.applyDelayedEdits()}}}function JE(t){if(t.length===0)throw new Error("Expected at least one checker");return(e,r)=>{t.map(i=>Qw(i,e,r)).sort((i,o)=>i.errorAmount-o.errorAmount||i.totalErrorSpan-o.totalErrorSpan)[0].updateNodeAndCtx()}}var YE=()=>{},XE=async(t,e)=>{let r=[];Ct(t,n=>!e.meta.hasChecker(n.type),n=>e.meta.hasChecker(n.type),n=>{let o=e.meta.getChecker(n.type)(n,e);o instanceof Promise&&r.push(o)}),await Promise.all(r)},QE=(t,e)=>{for(let r of t.children??[])e.meta.hasChecker(r.type)&&e.meta.getChecker(r.type)(r,e)},ex=(t,e)=>{},tx=(t,e)=>{};function eR(t){t.registerChecker("resource_location",ex),t.registerChecker("symbol",tx)}var ht;(function(t){t.NamedColors=new Map([["aqua",5636095],["black",0],["blue",5592575],["dark_aqua",43690],["dark_blue",170],["dark_gray",5592405],["dark_green",43520],["dark_purple",11141290],["dark_red",11141120],["gold",16755200],["gray",11184810],["green",5635925],["light_purple",16733695],["red",16733525],["white",16777215],["yellow",16777045]]),t.ColorNames=[...t.NamedColors.keys()];function e(s,a,l,c){return[s,a,l,c]}t.fromDecRGBA=e;function r(s,a,l){return e(s,a,l,1)}t.fromDecRGB=r;function n(s,a,l,c){return e(s/255,a/255,l/255,c/255)}t.fromIntRGBA=n;function i(s,a,l){return n(s,a,l,255)}t.fromIntRGB=i;function o(s){if(s<0)return r(1,1,1);let a=s%256;s>>=8;let l=s%256;s>>=8;let c=s%256;return i(c,l,a)}t.fromCompositeInt=o})(ht||(ht={}));var Bt;(function(t){t[t.DecRGBA=0]="DecRGBA",t[t.DecRGB=1]="DecRGB",t[t.IntRGBA=2]="IntRGBA",t[t.IntRGB=3]="IntRGB",t[t.HexRGBA=4]="HexRGBA",t[t.HexRGB=5]="HexRGB",t[t.CompositeInt=6]="CompositeInt"})(Bt||(Bt={}));var wu;(function(t){function e(n,i,o){let s=r(n,i);return{label:s,text:s,range:o}}t.fromColorFormat=e;function r(n,i){let o=s=>parseFloat(s.toFixed(3));switch(n){case Bt.DecRGBA:return i.map(s=>o(s)).join(" ");case Bt.DecRGB:return i.slice(0,3).map(s=>o(s)).join(" ");case Bt.IntRGBA:return i.map(s=>Math.round(s*255)).join(" ");case Bt.IntRGB:return i.slice(0,3).map(s=>Math.round(s*255)).join(" ");case Bt.HexRGBA:return`#${Math.round((i[0]*255<<24)+(i[1]*255<<16)+i[2]*255<<8+i[3]*255).toString(16).padStart(8,"0")}`;case Bt.HexRGB:return`#${Math.round((i[0]*255<<16)+(i[1]*255<<8)+i[2]*255).toString(16).padStart(6,"0")}`;case Bt.CompositeInt:return`${Math.round((i[0]*255<<16)+(i[1]*255<<8)+i[2]*255)}`}}})(wu||(wu={}));var Le={};yr(Le,{boolean:()=>rx,comment:()=>nx,error:()=>ix,fallback:()=>tR,literal:()=>ox,number:()=>xu,registerColorizers:()=>rR,resourceLocation:()=>sx,string:()=>ax,symbol:()=>lx});var Te;(function(t){function e(n,i,o){return{range:v.get(n),type:i,modifiers:o}}t.create=e;function r(n,i,o,s){let a=[],l=Math.min(i.start,n[0]?.range.start??1/0);for(let c of n)c.range.start>l&&a.push(t.create(v.create(l,c.range.start),o,s)),a.push(c),l=c.range.end;return l<i.end&&a.push(t.create(v.create(l,i.end),o,s)),a}t.fillGap=r})(Te||(Te={}));var Dz=Object.freeze(["comment","enum","enumMember","function","keyword","modifier","number","operator","property","string","struct","type","type","variable","error","literal","operator","resourceLocation","vector"]),Nz=Object.freeze(["declaration","defaultLibrary","definition","deprecated","documentation","modification","readonly"]);var tR=(t,e)=>{let r=[];return Ct(t,n=>!e.meta.hasColorizer(n.type)&&(!e.range||v.intersects(n.range,e.range)),n=>e.meta.hasColorizer(n.type),n=>{let o=e.meta.getColorizer(n.type)(n,e);r.push(...o)}),Object.freeze(r)},rx=t=>[Te.create(t,"literal")],nx=t=>[Te.create(t,"comment")],ix=t=>[],ox=t=>[Te.create(t,t.options.colorTokenType??"literal")],xu=t=>[Te.create(t,"number")],sx=(t,e)=>{let r;switch(t.options.category){case"function":case"tag/function":r="function";break;default:r="resourceLocation";break}return[Te.create(t,r)]},ax=(t,e)=>{if(t.children){let n=e.meta.getColorizer(t.children[0].type)(t.children[0],e);return Te.fillGap(n,t.range,t.options.colorTokenType??"string")}else return[Te.create(t,t.options.colorTokenType??"string")]},lx=t=>[Te.create(t,"variable")];function rR(t){t.registerColorizer("boolean",rx),t.registerColorizer("comment",nx),t.registerColorizer("error",ix),t.registerColorizer("float",xu),t.registerColorizer("integer",xu),t.registerColorizer("long",xu),t.registerColorizer("literal",ox),t.registerColorizer("resource_location",sx),t.registerColorizer("string",ax),t.registerColorizer("symbol",lx)}var re={};yr(re,{boolean:()=>fx,dispatch:()=>Pm,fallback:()=>nR,file:()=>iR,literal:()=>ux,noop:()=>ll,record:()=>oR,registerCompleters:()=>sR,resourceLocation:()=>hx,string:()=>dx,symbol:()=>px});var cx=Br(eu(),1);var pe;(function(t){function e(i,o,s){let a=s?.insertText===void 0&&r(i);return{...s,label:i,range:v.get(o),...a?{insertText:n(i)}:{}}}t.create=e;function r(i){return/[\\$}]/.test(i)}t.needsEscape=r;function n(i){return i.replace(/([\\$}])/g,"\\$1")}t.escape=n})(pe||(pe={}));var xn,ro,al=class{constructor(){R(this,xn,"");R(this,ro,1)}literal(e){return L(this,xn,g(this,xn)+pe.escape(e)),this}placeholder(...e){return e.length===0?L(this,xn,g(this,xn)+`\${${g(this,ro)}}`):e.length===1?L(this,xn,g(this,xn)+`\${${g(this,ro)}:${pe.escape(e[0])}}`):L(this,xn,g(this,xn)+`\${${g(this,ro)}|${e.map(r=>r.replace(/([\\$},|])/g,"\\$1")).join(",")}|}`),L(this,ro,g(this,ro)+1),this}exitPlace(){return L(this,xn,g(this,xn)+"$0"),this}build(){return g(this,xn)}if(e,r){return e&&r(this),this}};xn=new WeakMap,ro=new WeakMap;var Pm=(t,e)=>{let r=Ke.findShallowestChild({node:t,needle:e.offset,endInclusive:!0,predicate:n=>e.meta.hasCompleter(n.type)});return r?e.meta.getCompleter(r.type)(r,e):[]},nR=Pm,fx=(t,e)=>[pe.create("false",t,{kind:21}),pe.create("true",t,{kind:21})],iR=(t,e)=>e.meta.getCompleterForLanguageID(e.doc.languageId)(t.children[0],e),ux=t=>{let e=new Map([["enum",13],["enumMember",20],["function",3],["keyword",14],["literal",14],["number",21],["operator",24],["property",10],["resourceLocation",17],["variable",6]]).get(t.options.colorTokenType??"keyword")??14;return t.options.pool.map(r=>pe.create(r,t,{kind:e}))??[]},ll=()=>[];function oR(t){return(e,r)=>{if(!v.contains(v.translate(e,1,-1),r.offset,!0))return[];let n=h=>t.key(e,h,r,h?.key??r.offset,!1,!1,o),i=h=>t.key(e,h,r,h??r.offset,!0,l||!!h?.end,o),o=e.children.filter(h=>!!h.key).map(h=>h.key),s=(0,cx.default)(e.children,r.offset,(h,d)=>h.end?v.compareOffset(v.translate(h,0,-1),d,!0):v.compareOffset(h.range,d,!0)),a=s>=0?e.children[s]:void 0,l=!!e.children.find(h=>h.range.start>r.offset);if(!a)return i(void 0);let{key:c,sep:f,value:u}=a;return!c&&!f&&!u?i(void 0):c&&v.contains(c,r.offset,!0)||f&&r.offset<=f.start||u&&r.offset<u.range.start?!u||v.isEmpty(u.range)?i(a):n(a):u&&v.contains(u,r.offset,!0)||f&&r.offset>=f.end||c&&r.offset>c.range.end?t.value(e,a,r):[]}}var hx=(t,e)=>{let r=gs.destruct(e.config.lint.idOmitDefaultNamespace),n=!t.options.isPredicate&&t.namespace==="",i=t.options.isPredicate||r?.ruleValue!==!0,o=!t.options.isPredicate&&r?.ruleValue!==!1,s=c=>a(Object.keys(e.symbols.getVisibleSymbols(c,e.doc.uri))),a=c=>{let f=`${q.DefaultNamespace}${q.NamespacePathSep}`,u=[],h=[];for(let p of c)p.startsWith(f)?u.push(p):h.push(p);let d=[...h,...i?u:[],...o?u.map(p=>p.slice(f.length)):[],...n?u.map(p=>p.slice(q.DefaultNamespace.length)):[]];return t.options.namespacePathSep==="."?d.map(p=>p.replace(q.NamespacePathSep,".")):d};return(t.options.pool?a(t.options.pool):[...s(t.options.category),...t.options.allowTag?s(`tag/${t.options.category}`).map(c=>`${q.TagPrefix}${c}`):[]]).map(c=>pe.create(c,t,{kind:3}))},dx=(t,e)=>t.children?.length?Pm(t.children[0],e):t.options.quotes&&t.value===""?t.options.quotes.map(r=>pe.create(`${r}${r}`,t,{insertText:`${r}$1${r}`,kind:12})):[],px=(t,e)=>Object.keys(e.symbols.query(e.doc,t.options.category,...t.options.parentPath??[]).visibleMembers).map(r=>pe.create(r,t,{kind:6}));function sR(t){t.registerCompleter("boolean",fx),t.registerCompleter("comment",ll),t.registerCompleter("float",ll),t.registerCompleter("integer",ll),t.registerCompleter("long",ll),t.registerCompleter("literal",ux),t.registerCompleter("resource_location",hx),t.registerCompleter("string",dx),t.registerCompleter("symbol",px)}var Xr={};yr(Xr,{boolean:()=>gx,comment:()=>yx,fallback:()=>aR,file:()=>mx,float:()=>bx,integer:()=>kx,literal:()=>vx,long:()=>wx,registerFormatters:()=>lR,resourceLocation:()=>xx,string:()=>Sx});var aR=t=>{throw new Error(`No formatter registered for type ${t.type}`)},mx=(t,e)=>t.children.map(r=>e.meta.getFormatter(r.type)(r,e)).join(""),gx=t=>t.value?"true":"false",yx=t=>"#"+t.comment,bx=t=>t.value.toString(),kx=t=>t.value.toFixed(),vx=t=>t.value,wx=t=>t.value.toString(),xx=t=>U.toString(t,"origin",!0),Sx=t=>`"${t.value}"`;function lR(t){t.registerFormatter("file",mx),t.registerFormatter("boolean",gx),t.registerFormatter("comment",yx),t.registerFormatter("float",bx),t.registerFormatter("integer",kx),t.registerFormatter("long",wx),t.registerFormatter("literal",vx),t.registerFormatter("resource_location",xx),t.registerFormatter("string",Sx)}function Lm(t,e=0){let r=t.indentLevel+e;return t.insertSpaces?" ".repeat(r*t.tabSize):"	".repeat(r)}function Im(t,e=1){return{...t,indentLevel:t.indentLevel+e,indent(r){return Lm(this,r)}}}var ni={};yr(ni,{configValidator:()=>ri,nameConvention:()=>cl,noop:()=>cR,quote:()=>fR,registerLinters:()=>uR});var _x=(t,e)=>{};var cR=()=>{};function cl(t){return(e,r)=>{if(typeof e[t]!="string")throw new Error(`Trying to access property "${t}" of node type "${e.type}"`);let n=e[t];try{let i=new RegExp(r.ruleValue);n.match(i)||r.err.lint(y("linter.name-convention.illegal",P(n),P(r.ruleValue)),e)}catch(i){r.logger.error(`[nameConvention linter] The value \u201C${r.ruleValue}\u201D set for rule \u201C${r.ruleName}\u201D is not a valid regular expression.`,i)}}}var fR=(t,e)=>{let r=e.ruleValue,n=t.options.unquotable?[...t.value].some(l=>!Bm(l,t.options.unquotable)):!0,i=r.always||n,o=r.always===!1&&!n,s=e.src.slice(t.range.start,t.range.start+1),a=!!t.options.quotes?.includes(s);i&&a&&(r.avoidEscape,r.type)},ri;(function(t){function e(o){return`https://spyglassmc.com/user/lint/${o}`}function r(o,s){return`[Invalid Linter Config] [${o}] ${y("linter-config-validator.wrapper",s,e(o))}`}function n(o,s,a){if(typeof s!="string")return a.error(r(o,y("linter-config-validator.name-convention.type"))),!1;try{new RegExp(s)}catch(l){return a.error(r(o,y("")),l),!1}return!0}t.nameConvention=n;function i(o,s,a){return il.is(s)}t.symbolLinterConfig=i})(ri||(ri={}));function uR(t){t.registerLinter("nameOfObjective",{configValidator:ri.nameConvention,linter:cl("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="objective"}),t.registerLinter("nameOfScoreHolder",{configValidator:ri.nameConvention,linter:cl("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="score_holder"}),t.registerLinter("nameOfTag",{configValidator:ri.nameConvention,linter:cl("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="tag"}),t.registerLinter("nameOfTeam",{configValidator:ri.nameConvention,linter:cl("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="team"}),t.registerLinter("undeclaredSymbol",{configValidator:ri.symbolLinterConfig,linter:_x,nodePredicate:e=>e.symbol&&!_m.includes(e.symbol.category)})}var ut=class{errors=[];constructor(){}report(e,r,n=3,i){this.errors.push(au.create(e,v.get(r),n,i))}dump(){let e=Object.freeze(this.errors);return this.errors=[],e}absorb(e){this.errors.push(...e.errors)}},ys=class extends ut{ruleName;ruleSeverity;constructor(e,r){super(),this.ruleName=e,this.ruleSeverity=r}lint(e,r,n,i){return this.report(y("linter.diagnostic-message-wrapper",e,this.ruleName),r,i??this.ruleSeverity,n)}static fromErrorReporter(e,r,n){let i=new ys(r,n);return i.errors=e.errors,i}};var fl;(function(t){function e(r){return{fs:r.fs,logger:r.logger,meta:r.meta,profilers:r.profilers,roots:r.roots,project:r.ctx}}t.create=e})(fl||(fl={}));var Su;(function(t){function e(r,n){return{...fl.create(r),config:r.config,doc:n.doc,err:n.err??new ut}}t.create=e})(Su||(Su={}));var _r;(function(t){function e(r,n){return{...fl.create(r),config:r.config,doc:n.doc,src:n.src??new qi(n.doc.getText()),symbols:r.symbols}}t.create=e})(_r||(_r={}));var jm;(function(t){function e(r,n){return{..._r.create(r,n),range:n.range}}t.create=e})(jm||(jm={}));var $m;(function(t){function e(r,n){return{..._r.create(r,n),offset:n.offset}}t.create=e})($m||($m={}));var _u;(function(t){function e(r,n){return{..._r.create(r,n),err:n.err??new ut,ensureBindingStarted:r.ensureBindingStarted?.bind(r)}}t.create=e})(_u||(_u={}));var Cu;(function(t){function e(r,n){return{..._r.create(r,n),err:n.err??new ut,ensureBindingStarted:r.ensureBindingStarted?.bind(r)}}t.create=e})(Cu||(Cu={}));var Au;(function(t){function e(r,n){return{..._r.create(r,n),err:n.err,ruleName:n.ruleName,ruleValue:n.ruleValue}}t.create=e})(Au||(Au={}));var Tu;(function(t){function e(r,n){return{..._r.create(r,n),...n,indentLevel:0,indent(i){return Lm(this,i)}}}t.create=e})(Tu||(Tu={}));var Ou;(function(t){function e(r,n){return jm.create(r,n)}t.create=e})(Ou||(Ou={}));var Eu;(function(t){function e(r,n){return{..._r.create(r,n),offset:n.offset,triggerCharacter:n.triggerCharacter}}t.create=e})(Eu||(Eu={}));var Ru;(function(t){function e(r,n){return $m.create(r,n)}t.create=e})(Ru||(Ru={}));var Mu;(function(t){function e(r){return{...fl.create(r),symbols:r.symbols}}t.create=e})(Mu||(Mu={}));var Du;(function(t){function e(r){return r.startsWith("@")}t.is=e})(Du||(Du={}));var ii,Nu=class{constructor(e,r,n){H(this,"cacheRoot");H(this,"externals");H(this,"logger");R(this,ii,new Map);this.cacheRoot=e,this.externals=r,this.logger=n}async download(e,r={}){let{id:n,cache:i,uri:o,options:s,transformer:a,ttl:l}=e;if(l&&g(this,ii).has(o)){let{buffer:h,time:d}=g(this,ii).get(o);if(d<=performance.now()+l)return this.logger.info(`[Downloader] [${n}] Skipped thanks to valid cache in memory`),await a(h);g(this,ii).delete(o)}let c,f,u;if(i){let{checksumJob:h,checksumExtension:d}=i;r.cacheUri=f=new It(`downloader/${n}`,this.cacheRoot).toString(),u=new It(`downloader/${n}${d}`,this.cacheRoot).toString();try{r.checksum=c=await this.download({...h,id:n+d});try{let p=ir(await Y.readFile(this.externals,u)).slice(0,-1);if(c===p)try{let b=await Y.readFile(this.externals,f);l&&g(this,ii).set(o,{buffer:b,time:performance.now()});let m=i.deserializer??(S=>S),k=await a(m(b));return this.logger.info(`[Downloader] [${n}] Skipped downloading thanks to cache ${p}`),k}catch(b){if(this.logger.error(`[Downloader] [${n}] Loading cached file \u201C${f}\u201D`,b),this.externals.error.isKind(b,"ENOENT"))try{await this.externals.fs.unlink(u)}catch(m){this.logger.error(`[Downloader] [${n}] Removing invalid cache checksum \u201C${u}\u201D`,m)}}}catch(p){this.externals.error.isKind(p,"ENOENT")||this.logger.error(`[Downloader] [${n}] Loading cache checksum \u201C${u}\u201D`,p)}}catch(p){this.logger.error(`[Downloader] [${n}] Fetching latest checksum \u201C${h.uri}\u201D`,p)}}try{let h=await this.externals.downloader.get(o,s);if(l&&g(this,ii).set(o,{buffer:h,time:performance.now()}),i&&f&&u){if(c)try{await Y.writeFile(this.externals,u,`${c}
`)}catch(d){this.logger.error(`[Downloader] [${n}] Saving cache checksum \u201C${u}\u201D`,d)}try{let d=i.serializer??(p=>p);await Y.writeFile(this.externals,f,d(h))}catch(d){this.logger.error(`[Downloader] [${n}] Caching file \u201C${f}\u201D`,d)}}return this.logger.info(`[Downloader] [${n}] Downloaded from \u201C${o}\u201D`),await a(h)}catch(h){if(this.logger.error(`[Downloader] [${n}] Downloading \u201C${o}\u201D`,h),i&&f)try{let d=await Y.readFile(this.externals,f),p=i.deserializer??(m=>m),b=await a(p(d));return this.logger.warn(`[Downloader] [${n}] Fell back to cached file \u201C${f}\u201D`),b}catch(d){this.logger.error(`[Downloader] [${n}] Fallback: loading cached file \u201C${f}\u201D`,d)}}}};ii=new WeakMap;var ul;(function(t){function e(r,n){let i=Y.ensureEndingSlash(new It("virtual-uris/",n).toString());return new zm(r,i)}t.create=e})(ul||(ul={}));var zm=class{externals;virtualUrisRoot;supporters=new Map;map=new su;constructor(e,r){this.externals=e,this.virtualUrisRoot=r}register(e,r,n=!1){if(!n&&this.supporters.has(e))throw new Error(`The protocol \u201C${e}\u201D is already associated with another supporter.`);this.supporters.set(e,r)}unregister(e){this.supporters.delete(e)}getSupportedProtocol(e){let r=new It(e).protocol;if(!this.supporters.has(r))throw new Error(`The protocol \u201C${r}\u201D is unsupported.`);return r}async hash(e){let r=this.getSupportedProtocol(e);return this.supporters.get(r).hash(e)}readFile(e){let r=this.getSupportedProtocol(e);return this.supporters.get(r).readFile(e)}*listFiles(){for(let e of this.supporters.values())yield*e.listFiles()}*listRoots(){for(let e of this.supporters.values())yield*e.listRoots()}async mapToDisk(e){if(Y.isFileUri(e))return e;if(this.virtualUrisRoot)try{let r=this.map.getKey(e);if(r===void 0){r=`${this.virtualUrisRoot}${await this.externals.crypto.getSha1(e)}/${Y.basename(e)}`;let n=await this.readFile(e);await Y.writeFile(this.externals,r,n,292),this.map.set(r,e)}return r}catch{}}mapFromDisk(e){return this.virtualUrisRoot?this.map.get(e)??e:e}},bs=class{externals;roots;files;protocol="file:";constructor(e,r,n){this.externals=e,this.roots=r,this.files=n}async hash(e){return Fm(this.externals,e)}readFile(e){return this.externals.fs.readFile(e)}*listFiles(){for(let e of this.files.values())yield*e}listRoots(){return this.roots}async mapToDisk(e){return e}static async create(e,r,n){let i=[],o=new Map;for(let{uri:s}of e)try{Y.isFileUri(s)&&(await r.fs.stat(s)).isDirectory()&&(s=Y.ensureEndingSlash(s),i.push(s),o.set(s,await r.fs.getAllFiles(s)))}catch(a){n.error(`[FileUriSupporter#create] Bad dependency \u201C${s}\u201D`,a)}return new bs(r,i,o)}},jt=class{externals;entries;protocol=jt.Protocol;constructor(e,r){this.externals=e,this.entries=r}async hash(e){let{archiveUri:r,pathInArchive:n}=jt.decodeUri(new It(e));return n?this.externals.crypto.getSha1(this.getDataInArchive(r,n)):Fm(this.externals,r)}async readFile(e){let{archiveUri:r,pathInArchive:n}=jt.decodeUri(new It(e));return this.getDataInArchive(r,n)}getDataInArchive(e,r){let n=this.entries.get(e);if(!n)throw new Error(`Archive \u201C${e}\u201D has not been loaded into the memory`);let i=n.get(r);if(!i)throw new Error(`Path \u201C${r}\u201D does not exist in archive \u201C${e}\u201D`);if(i.type!=="file")throw new Error(`Path \u201C${r}\u201D in archive \u201C${e}\u201D is not a file`);return i.data}*listFiles(){for(let[e,r]of this.entries.entries())for(let n of r.values())yield jt.getUri(e,n.path)}*listRoots(){for(let e of this.entries.keys())yield jt.getUri(e)}static getUri(e,r=""){return`${jt.Protocol}${encodeURIComponent(e)}?path=${encodeURIComponent(r.replace(/\\/g,"/"))}`}static decodeUri(e){if(e.protocol!==jt.Protocol)throw new Error(`Expected protocol \u201C${jt.Protocol}\u201D in \u201C${e}\u201D`);let r=e.searchParams.get("path");if(!r)throw new Error(`Missing path in archive uri \u201C${e.toString()}\u201D`);return{archiveUri:decodeURIComponent(e.pathname),pathInArchive:r.charAt(0)==="/"?r.slice(1):r}}static async create(e,r,n,i){let o=new Map;for(let{uri:s,info:a}of e)try{if(s.startsWith("file:")&&jt.SupportedArchiveExtnames.some(l=>s.endsWith(l))&&(await r.fs.stat(s)).isFile()){let l=jt.getUri(s),c=i[l];if(c!==void 0){let u=await Fm(r,s);if(c===u){n.info(`[SpyglassUriSupporter#create] Skipped decompressing \u201C${s}\u201D thanks to cache ${u}`);continue}}let f=await r.archive.decompressBall(await r.fs.readFile(s),{stripLevel:typeof a?.startDepth=="number"?a.startDepth:0});o.set(s,new Map(f.map(u=>[u.path.replace(/\\/g,"/"),u])))}}catch(l){n.error(`[SpyglassUriSupporter#create] Bad dependency \u201C${s}\u201D`,l)}return new jt(r,o)}},no=jt;H(no,"Protocol","archive:"),H(no,"SupportedArchiveExtnames",[".tar",".tar.bz2",".tar.gz",".zip"]);async function Fm(t,e){return t.crypto.getSha1(await t.fs.readFile(e))}var hl;(function(t){function e(r,n){return{range:v.get(r),markdown:n}}t.create=e})(hl||(hl={}));var $t,ks,vs,ws,xs,dl,Ss,pl,ml,_s,gl,yl,bl,Cs,Pu=class{constructor(){R(this,$t,new Map);R(this,ks,new Map);R(this,vs,new Map);R(this,ws,new Map);R(this,xs,new Map);R(this,dl,new Map);R(this,Ss,new Map);R(this,pl,new Set);R(this,ml,new Map);R(this,_s,new Map);R(this,gl,new Set);R(this,yl,new Map);R(this,bl,new Set);R(this,Cs,()=>0);sl.registerBinders(this),tt.registerCheckers(this),Le.registerColorizers(this),re.registerCompleters(this),Xr.registerFormatters(this),ni.registerLinters(this)}registerLanguage(e,r){g(this,$t).set(e,r)}getLanguages(){return Array.from(g(this,$t).keys())}isSupportedLanguage(e){return g(this,$t).has(e)}getSupportedFileExtensions(){return[...g(this,$t).values()].flatMap(e=>e.extensions)}getTriggerCharacters(){return Array.from(g(this,$t).values()).flatMap(e=>e.triggerCharacters??[])}getLanguageID(e){for(let[r,{extensions:n}]of g(this,$t))if(n.includes(e))return r}hasBinder(e){return g(this,ks).has(e)}getBinder(e){return g(this,ks).get(e)??sl.fallback}registerBinder(e,r){g(this,ks).set(e,r)}hasChecker(e){return g(this,vs).has(e)}getChecker(e){return g(this,vs).get(e)??tt.fallback}registerChecker(e,r){g(this,vs).set(e,r)}hasColorizer(e){return g(this,ws).has(e)}getColorizer(e){return g(this,ws).get(e)??Le.fallback}registerColorizer(e,r){g(this,ws).set(e,r)}hasCompleter(e){return g(this,xs).has(e)}getCompleter(e){return g(this,xs).get(e)??re.fallback}registerCompleter(e,r){g(this,xs).set(e,r)}shouldComplete(e,r){let n=g(this,$t).get(e);return!r||!!n?.triggerCharacters?.includes(r)}getCompleterForLanguageID(e){return g(this,$t).get(e)?.completer??re.fallback}getDependencyProvider(e){return g(this,dl).get(e)}registerDependencyProvider(e,r){g(this,dl).set(e,r)}hasFormatter(e){return g(this,Ss).has(e)}getFormatter(e){return g(this,Ss).get(e)??Xr.fallback}registerFormatter(e,r){g(this,Ss).set(e,r)}registerInlayHintProvider(e){g(this,pl).add(e)}get inlayHintProviders(){return g(this,pl)}getLinter(e){return g(this,ml).get(e)??{configValidator:()=>!1,linter:ni.noop,nodePredicate:()=>!1}}registerLinter(e,r){g(this,ml).set(e,r)}hasParser(e){return g(this,_s).has(e)}getParser(e){let r=g(this,_s).get(e);if(!r)throw new Error(`There is no parser '${e}'`);return r}getParserLazily(e){return Zn.create(()=>this.getParser(e))}registerParser(e,r){g(this,_s).set(e,r)}getParserForLanguageId(e){if(g(this,$t).has(e))return g(this,$t).get(e).parser;throw new Error(`There is no parser registered for language ID '${e}'`)}registerSignatureHelpProvider(e){g(this,gl).add(e)}get signatureHelpProviders(){return g(this,gl)}registerSymbolRegistrar(e,r){g(this,yl).set(e,r)}get symbolRegistrars(){return g(this,yl)}registerUriBinder(e){g(this,bl).add(e)}get uriBinders(){return g(this,bl)}setUriSorter(e){let r=g(this,Cs);L(this,Cs,(n,i)=>e(n,i,r))}get uriSorter(){return g(this,Cs)}};$t=new WeakMap,ks=new WeakMap,vs=new WeakMap,ws=new WeakMap,xs=new WeakMap,dl=new WeakMap,Ss=new WeakMap,pl=new WeakMap,ml=new WeakMap,_s=new WeakMap,gl=new WeakMap,yl=new WeakMap,bl=new WeakMap,Cs=new WeakMap;var kl,vl,io,As,Cr,Ts,Os,Vm=class{constructor(e,r,n){H(this,"id");H(this,"logger");H(this,"n");R(this,kl,!1);R(this,vl,void 0);R(this,io,void 0);R(this,As,0);R(this,Cr,[]);R(this,Ts,1/0);R(this,Os,0);this.id=e,this.logger=r,this.n=n,L(this,vl,L(this,io,performance.now()))}task(e){if(g(this,kl))throw new Error("The profiler has already been finalized");Xy(this,As)._++;let r=performance.now(),n=r-g(this,io);return L(this,io,r),L(this,Ts,Math.min(g(this,Ts),n)),L(this,Os,Math.max(g(this,Os),n)),g(this,Cr).push([e,n]),g(this,Cr).sort((i,o)=>o[1]-i[1]),g(this,Cr).length>this.n&&L(this,Cr,g(this,Cr).slice(0,-1)),this}finalize(){L(this,kl,!0);let e=g(this,Cr).reduce((n,[i])=>Math.max(n,i.length),0),r=g(this,io)-g(this,vl);this.logger.info(`[Profiler: ${this.id}] == Summary ==`),this.logger.info(`[Profiler: ${this.id}] Total tasks: ${g(this,As)} done in ${r} ms`),this.logger.info(`[Profiler: ${this.id}] Min/Avg/Max: ${g(this,Ts)} / ${r/g(this,As)} / ${g(this,Os)} ms`),this.logger.info(`[Profiler: ${this.id}] Top ${Math.min(this.n,g(this,Cr).length)} task(s):`);for(let[n,i]of g(this,Cr))this.logger.info(`[Profiler: ${this.id}] ${n}${" ".repeat(e-n.length)} - ${i} ms (${i/r*100}%)`)}};kl=new WeakMap,vl=new WeakMap,io=new WeakMap,As=new WeakMap,Cr=new WeakMap,Ts=new WeakMap,Os=new WeakMap;var Cx="Total",wl,xl,oo,Es,oi,Um=class{constructor(e,r){H(this,"id");H(this,"logger");R(this,wl,!1);R(this,xl,void 0);R(this,oo,void 0);R(this,Es,[]);R(this,oi,0);this.id=e,this.logger=r,L(this,xl,L(this,oo,performance.now()))}task(e){if(g(this,wl))throw new Error("The profiler is finalized.");let r=performance.now(),n=r-g(this,oo);return L(this,oo,r),g(this,Es).push([e,n]),L(this,oi,Math.max(g(this,oi),e.length)),this.logger.info(`[Profiler: ${this.id}] Done: ${e} in ${n} ms`),this}finalize(){L(this,wl,!0),g(this,Es).push([Cx,g(this,oo)-g(this,xl)]),L(this,oi,Math.max(g(this,oi),Cx.length)),this.logger.info(`[Profiler: ${this.id}] == Summary ==`);for(let[e,r]of g(this,Es))this.logger.info(`[Profiler: ${this.id}] ${e}${" ".repeat(g(this,oi)-e.length)} - ${r} ms`)}};wl=new WeakMap,xl=new WeakMap,oo=new WeakMap,Es=new WeakMap,oi=new WeakMap;var Hm=class{task(){return this}finalize(){}},Sl,Wm=class{constructor(e,r){H(this,"logger");R(this,Sl,void 0);this.logger=e,L(this,Sl,new Set(r))}get(e,r="total",n){if(g(this,Sl).has(e))switch(r){case"top-n":return new Vm(e,this.logger,n);case"total":return new Um(e,this.logger);default:return nr.assertNever(r)}else return new Hm}static noop(){return new Wm(ls.noop(),[])}},si=Wm;Sl=new WeakMap;var Lu=Br(pu(),1);var qm=function(t,e,r,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(i<3?s(o):i>3?s(e,r,o):s(e,r))||o);return i>3&&o&&Object.defineProperty(e,r,o),o},hR=6e5,ai,_l,li,Qr,Rs,Sn,ao,Ms,Cl,Al,_n,Ds,ci,Cn,Tl,lo,Ns,Ps,co,At,fo,so=class{constructor({cacheRoot:e,defaultConfig:r,downloader:n,externals:i,fs:o=ul.create(i,e),initializers:s=[],logger:a=ls.create(),profilers:l=si.noop(),projectRoot:c}){R(this,ai,new Set);R(this,_l,void 0);H(this,"cacheService");R(this,li,new Set);R(this,Qr,new Map);R(this,Rs,void 0);R(this,Sn,new Set);R(this,ao,void 0);R(this,Ms,void 0);R(this,Cl,void 0);R(this,Al,void 0);R(this,_n,new Set);R(this,Ds,void 0);R(this,ci,!1);R(this,Cn,!1);H(this,"config");H(this,"downloader");H(this,"externals");H(this,"fs");H(this,"logger");H(this,"meta",new Pu);H(this,"profilers");H(this,"projectRoot");H(this,"symbols");R(this,Tl,void 0);R(this,lo,void 0);R(this,Ns,[]);R(this,Ps,void 0);R(this,co,void 0);R(this,At,new Map);R(this,fo,0);L(this,co,e),L(this,ao,new i.event.EventEmitter),this.externals=i,this.fs=o,L(this,Ms,s),this.logger=a,this.profilers=l,this.projectRoot=c,this.cacheService=new ku(e,this),L(this,Rs,new to(this,r)),this.downloader=n??new Nu(e,i,a),this.symbols=new Pe({},i.event.EventEmitter),L(this,Ps,{}),this.logger.info(`[Project] [init] cacheRoot = \u201C${e}\u201D`),g(this,Rs).on("changed",({config:f})=>{this.config=f,this.logger.info("[Project] [Config] Changed")}).on("error",({error:f,uri:u})=>this.logger.error(`[Project] [Config] Failed loading \u201C${u}\u201D`,f)),this.setInitPromise(),this.setReadyPromise(),L(this,_l,setInterval(()=>this.cacheService.save(),hR)),this.on("documentUpdated",({doc:f,node:u})=>{this.emit("documentErrored",{errors:fs.getErrors(u).map(h=>au.withPosRange(h,f)),uri:f.uri,version:f.version})}).on("documentRemoved",({uri:f})=>{this.emit("documentErrored",{errors:[],uri:f})}).on("fileCreated",async({uri:f})=>(f.endsWith(so.RootSuffix)&&this.updateRoots(),this.bindUri(f),this.ensureBindingStarted(f))).on("fileModified",async({uri:f})=>{g(this,Sn).delete(f),this.isOnlyWatched(f)&&await this.ensureBindingStarted(f)}).on("fileDeleted",({uri:f})=>{f.endsWith(so.RootSuffix)&&this.updateRoots(),g(this,Sn).delete(f),this.symbols.clear({uri:f}),this.tryClearingCache(f)}).on("ready",()=>{L(this,Cn,!0)})}get isReady(){return g(this,Cn)}get roots(){return g(this,Ns)}get ctx(){return g(this,Ps)}get cacheRoot(){return g(this,co)}updateRoots(){let e=[...g(this,Tl),this.projectRoot],r=new Set(e);for(let n of this.getTrackedFiles())n.endsWith(so.RootSuffix)&&e.some(i=>n.startsWith(i))&&r.add(n.slice(0,1-so.RootSuffix.length));L(this,Ns,[...r].sort((n,i)=>i.length-n.length)),this.emit("rootsUpdated",{roots:g(this,Ns)})}on(e,r){return g(this,ao).on(e,r),this}once(e,r){return g(this,ao).once(e,r),this}emit(e,...r){return g(this,ao).emit(e,...r)}getTrackedFiles(){let e=this.meta.getSupportedFileExtensions();return[...g(this,lo),...g(this,_n)].filter(r=>e.includes(Y.extname(r)??""))}setInitPromise(){let e=async()=>{this.config=await g(this,Rs).load()},r=async()=>{let i={cacheRoot:this.cacheRoot,config:this.config,downloader:this.downloader,externals:this.externals,logger:this.logger,meta:this.meta,projectRoot:this.projectRoot},o=await Promise.allSettled(g(this,Ms).map(a=>a(i))),s={};o.forEach(async(a,l)=>{a.status==="rejected"?this.logger.error(`[Project] [callInitializers] [${l}] \u201C${g(this,Ms)[l].name}\u201D`,a.reason):a.value&&(s={...s,...a.value})}),L(this,Ps,s)};L(this,Cl,(async()=>{let i=this.profilers.get("project#init"),{symbols:o}=await this.cacheService.load();this.symbols=new Pe(o,this.externals.event.EventEmitter),this.symbols.buildCache(),i.task("Load Cache"),await e(),i.task("Load Config"),await r(),i.task("Initialize").finalize()})())}setReadyPromise(){let e=async()=>{let o=[];for(let s of this.config.env.dependencies)if(Du.is(s)){let a=this.meta.getDependencyProvider(s);if(a)try{o.push(await a()),this.logger.info(`[Project] [getDependencies] Executed provider \u201C${s}\u201D`)}catch(l){this.logger.error(`[Project] [getDependencies] Bad provider \u201C${s}\u201D`,l)}else this.logger.error(`[Project] [getDependencies] Bad dependency \u201C${s}\u201D: no associated provider`)}else o.push({uri:s});return o},r=async()=>{let o=await e(),s=await bs.create(o,this.externals,this.logger),a=await no.create(o,this.externals,this.logger,this.cacheService.checksums.roots);this.fs.register("file:",s,!0),this.fs.register(no.Protocol,a,!0)},n=()=>new Promise(o=>{g(this,_n).clear(),L(this,ci,!1),L(this,Ds,this.externals.fs.watch(this.projectRoot).once("ready",()=>{L(this,ci,!0),o()}).on("add",s=>{g(this,_n).add(s),g(this,ci)&&this.emit("fileCreated",{uri:s})}).on("change",s=>{g(this,ci)&&this.emit("fileModified",{uri:s})}).on("unlink",s=>{g(this,_n).delete(s),g(this,ci)&&this.emit("fileDeleted",{uri:s})}).on("error",s=>{this.logger.error("[Project] [chokidar]",s)}))}),i=async()=>{await this.init();let o=this.profilers.get("project#ready");await Promise.all([r(),n()]),L(this,lo,new Set(this.fs.listFiles())),L(this,Tl,new Set(this.fs.listRoots())),this.updateRoots(),o.task("List URIs");for(let[u,{checksum:h,registrar:d}]of this.meta.symbolRegistrars){let p=this.cacheService.checksums.symbolRegistrars[u];p===void 0||h!==p?(this.symbols.clear({contributor:`symbol_registrar/${u}`}),this.symbols.contributeAs(`symbol_registrar/${u}`,()=>{d(this.symbols,{logger:this.logger})}),this.emit("symbolRegistrarExecuted",{id:u,checksum:h})):this.logger.info(`[SymbolRegistrar] Skipped \u201C${u}\u201D thanks to cache ${h}`)}o.task("Register Symbols");for(let[u,h]of Object.entries(this.cacheService.errors))this.emit("documentErrored",{errors:h,uri:u});o.task("Pop Errors");let{addedFiles:s,changedFiles:a,removedFiles:l}=await this.cacheService.validate();for(let u of l)this.emit("fileDeleted",{uri:u});o.task("Validate Cache"),s.length>0&&this.bindUri(s),o.task("Bind URIs");let c=[...s,...a].sort(this.meta.uriSorter);o.task("Sort URIs");let f=this.profilers.get("project#ready#bind","top-n",50);for(let u of c)await this.ensureBindingStarted(u),f.task(u);f.finalize(),o.task("Bind Files"),o.finalize(),this.emit("ready",{})};L(this,Cn,!1),L(this,Al,i())}async init(){return await g(this,Cl),this}async ready(){return await g(this,Al),this}async close(){clearInterval(g(this,_l)),await g(this,Ds).close(),await this.cacheService.save()}async restart(){try{await g(this,Ds).close(),g(this,ai).clear(),g(this,Sn).clear(),this.setReadyPromise(),await this.ready()}catch(e){this.logger.error("[Project#reset]",e)}}resetCache(){this.logger.info("[Project#resetCache] Initiated...");for(let r of Object.keys(this.cacheService.errors))this.emit("documentErrored",{errors:[],uri:r});let{symbols:e}=this.cacheService.reset();return this.symbols=new Pe(e,this.externals.event.EventEmitter),this.symbols.buildCache(),this.restart()}normalizeUri(e){return this.fs.mapFromDisk(Pw(e))}removeCachedTextDocument(e){let r=g(this,At).get(e);r&&!(r instanceof Promise)&&L(this,fo,g(this,fo)-r.getText().length),g(this,At).delete(e)}async read(e){let r=s=>{let a=Y.extname(s)??".plaintext";return this.meta.getLanguageID(a)??a.slice(1)},n=async s=>{let a=r(s);if(this.meta.isSupportedLanguage(a))try{let l=ir(await this.fs.readFile(s));return Lu.TextDocument.create(s,a,-1,l)}catch(l){this.logger.warn(`[Project] [read] Failed creating TextDocument for \u201C${s}\u201D`,l);return}},i=()=>{let s=g(this,At).keys();for(;g(this,fo)>so.TextDocumentCacheMaxLength;){let a=s.next();if(a.done)throw new Error(`[Project] [read] Cache is too large with length ${g(this,fo)} even though it's empty; make sure to call 'removeCachedTextDocument()' instead of 'this.#textDocumentCache.delete()'`);this.removeCachedTextDocument(a.value)}},o=async s=>{if(g(this,At).has(s)){let a=g(this,At).get(s);return g(this,At).delete(s),g(this,At).set(s,a),a}else{let a=n(s);g(this,At).set(s,a);let l=await a;return g(this,At).get(s)===a&&(l?(g(this,At).set(s,l),L(this,fo,g(this,fo)+l.getText().length),i()):g(this,At).delete(s)),l}};if(e=this.normalizeUri(e),g(this,li).has(e)){let s=g(this,Qr).get(e);if(s)return s.doc;throw new Error(`[Project] [read] Client-managed URI \u201C${e}\u201D does not have a TextDocument in the cache`)}return o(e)}parse(e){let r=Su.create(this,{doc:e}),n=new _e(e.getText());return Ax()(n,r)}async bind(e,r){if(!r.binderErrors)try{g(this,ai).add(e.uri);let n=this.meta.getBinder(r.type),i=_u.create(this,{doc:e});i.symbols.clear({contributor:"binder",uri:e.uri}),await i.symbols.contributeAsAsync("binder",async()=>{let o=Qe.create(r);await n(o,i),r.binderErrors=i.err.dump()}),g(this,ai).delete(e.uri),g(this,Sn).add(e.uri)}catch(n){this.logger.error(`[Project] [bind] Failed for \u201C${e.uri}\u201D #${e.version}`,n)}}async check(e,r){if(!r.checkerErrors)try{let n=this.meta.getChecker(r.type),i=Cu.create(this,{doc:e});i.symbols.clear({contributor:"checker",uri:e.uri}),await i.symbols.contributeAsAsync("checker",async()=>{await n(Qe.create(r),i),r.checkerErrors=i.err.dump(),this.lint(e,r)})}catch(n){this.logger.error(`[Project] [check] Failed for \u201C${e.uri}\u201D #${e.version}`,n)}}lint(e,r){if(!r.linterErrors){r.linterErrors=[];try{for(let[n,i]of Object.entries(this.config.lint)){let o=gs.destruct(i);if(!o)continue;let{ruleSeverity:s,ruleValue:a}=o,{configValidator:l,linter:c,nodePredicate:f}=this.meta.getLinter(n);if(!l(n,a,this.logger))continue;let u=Au.create(this,{doc:e,err:new ys(n,s),ruleName:n,ruleValue:a});Ct(r,()=>!0,()=>!0,h=>{if(f(h)){let d=Qe.create(h);c(d,u)}}),r.linterErrors.push(...u.err.dump())}}catch(n){this.logger.error(`[Project] [lint] Failed for \u201C${e.uri}\u201D #${e.version}`,n)}}}async ensureBindingStarted(e){if(e=this.normalizeUri(e),g(this,Sn).has(e)||g(this,ai).has(e))return;g(this,ai).add(e);let r=await this.read(e);if(!r||!await this.cacheService.hasFileChangedSinceCache(r))return;let n=this.parse(r);await this.bind(r,n),this.emit("documentUpdated",{doc:r,node:n})}bindUri(e){let r=Mu.create(this);typeof e=="string"&&r.symbols.clear({contributor:"uri_binder",uri:e}),r.symbols.contributeAs("uri_binder",()=>{let n=Array.isArray(e)?e:[e];for(let i of this.meta.uriBinders)i(n,r)})}async onDidOpen(e,r,n,i){if(e=this.normalizeUri(e),!Y.isFileUri(e))return;let o=Lu.TextDocument.create(e,r,n,i),s=this.parse(o);g(this,li).add(e),g(this,Qr).set(e,{doc:o,node:s}),g(this,Cn)&&(await this.bind(o,s),await this.check(o,s))}async onDidChange(e,r,n){if(e=this.normalizeUri(e),g(this,Sn).delete(e),!Y.isFileUri(e))return;let i=g(this,Qr).get(e)?.doc;if(!i)throw new Error(`TextDocument for \u201C${e}\u201D is ${i?"a Promise":"not cached"}. This should not happen. Did the language client send a didChange notification without sending a didOpen one, or is there a logic error on our side resulting the 'read' function overriding the 'TextDocument' created in the 'didOpen' notification handler?`);Lu.TextDocument.update(i,r,n);let o=this.parse(i);g(this,Qr).set(e,{doc:i,node:o}),g(this,Cn)&&(await this.bind(i,o),await this.check(i,o))}onDidClose(e){e=this.normalizeUri(e),Y.isFileUri(e)&&(g(this,li).delete(e),g(this,Qr).delete(e),this.tryClearingCache(e))}async ensureClientManagedChecked(e){e=this.normalizeUri(e);let r=g(this,Qr).get(e);if(r){let{doc:n,node:i}=r;return g(this,Cn)&&(await this.bind(n,i),await this.check(n,i),this.emit("documentUpdated",r)),r}}getClientManaged(e){return e=this.normalizeUri(e),g(this,Qr).get(e)}async showCacheRoot(){if(g(this,co))try{await this.externals.fs.showFile(g(this,co))}catch(e){this.logger.error("[Service#showCacheRoot]",e)}}tryClearingCache(e){this.shouldRemove(e)&&(this.removeCachedTextDocument(e),this.emit("documentRemoved",{uri:e}))}shouldRemove(e){return!g(this,li).has(e)&&!g(this,lo).has(e)&&!g(this,_n).has(e)}isOnlyWatched(e){return g(this,_n).has(e)&&!g(this,li).has(e)&&!g(this,lo).has(e)}},An=so;ai=new WeakMap,_l=new WeakMap,li=new WeakMap,Qr=new WeakMap,Rs=new WeakMap,Sn=new WeakMap,ao=new WeakMap,Ms=new WeakMap,Cl=new WeakMap,Al=new WeakMap,_n=new WeakMap,Ds=new WeakMap,ci=new WeakMap,Cn=new WeakMap,Tl=new WeakMap,lo=new WeakMap,Ns=new WeakMap,Ps=new WeakMap,co=new WeakMap,At=new WeakMap,fo=new WeakMap,H(An,"RootSuffix","/pack.mcmeta"),H(An,"TextDocumentCacheMaxLength",268435456);qm([ru()],An.prototype,"bind",null);qm([ru()],An.prototype,"check",null);qm([ru()],An.prototype,"ensureClientManagedChecked",null);var Iu;(function(t){function e(r,n){return{range:v.get(r),locations:n}}t.create=e})(Iu||(Iu={}));var Bu=class{isDebugging;logger;profilers;project;constructor({isDebugging:e=!1,logger:r,profilers:n=si.noop(),project:i}){this.isDebugging=e,this.logger=r,this.profilers=n,this.project=new An({logger:r,profilers:n,...i})}debug(e){this.isDebugging&&this.logger.info(`[DEBUG] ${e}`)}colorize(e,r,n){try{return this.debug(`Colorizing '${r.uri}' # ${r.version}`),this.project.meta.getColorizer(e.type)(e,Ou.create(this.project,{doc:r,range:n}))}catch(i){this.logger.error(`[Service] [colorize] Failed for \u201C${r.uri}\u201D #${r.version}`,i)}return[]}getColorInfo(e,r){try{this.debug(`Getting color info for '${r.uri}' # ${r.version}`);let n=[];return Ct(e,i=>!0,i=>i.color,i=>n.push({color:Array.isArray(i.color)?i.color:i.color.value,range:Array.isArray(i.color)?i.range:i.color.range??i.range})),n}catch(n){this.logger.error(`[Service] [getColorInfo] Failed for \u201C${r.uri}\u201D #${r.version}`,n)}return[]}getColorPresentation(e,r,n,i){try{this.debug(`Getting color presentation for '${r.uri}' # ${r.version} @ ${v.toString(n)}`);let o=Ke.findDeepestChild({node:e,needle:n.start});for(;o;){let s=o.color;if(s&&!Array.isArray(s)){let a=s.range??o.range;return s.format.map(l=>wu.fromColorFormat(l,i,a))}o=o.parent}}catch(o){this.logger.error(`[Service] [getColorPresentation] Failed for \u201C${r.uri}\u201D #${r.version}`,o)}return[]}complete(e,r,n,i){try{if(this.debug(`Getting completion for '${r.uri}' # ${r.version} @ ${n}`),this.project.meta.shouldComplete(r.languageId,i))return re.file(e,Eu.create(this.project,{doc:r,offset:n,triggerCharacter:i}))}catch(o){this.logger.error(`[Service] [complete] Failed for \u201C${r.uri}\u201D #${r.version}`,o)}return[]}dataHackPubify(e){let r=[["ata","ack","ub","elper","lus"],["ah","uh","ew","elpa","lush"]],n=r[Math.floor(Math.random()*r.length)];return[...e].map((i,o)=>`${i.toUpperCase()}${n[o%n.length]}`).join(" ")}format(e,r,n,i){try{return this.debug(`Formatting '${r.uri}' # ${r.version}`),this.project.meta.getFormatter(e.type)(e,Tu.create(this.project,{doc:r,tabSize:n,insertSpaces:i}))}catch(o){throw this.logger.error(`[Service] [format] Failed for \u201C${r.uri}\u201D #${r.version}`,o),o}}getHover(e,r,n){try{this.debug(`Getting hover for '${r.uri}' # ${r.version} @ ${n}`);let i=Ke.findDeepestChild({node:e,needle:n});for(;i;){let o=this.project.symbols.resolveAlias(i.symbol);if(o){let s=`\`\`\`typescript
(${o.category}${o.subcategory?`/${o.subcategory}`:""}) ${o.identifier}
\`\`\``+(o.desc?`
******
${o.desc}`:"");return hl.create(i.range,s)}if(i.hover)return hl.create(i.range,i.hover);i=i.parent}}catch(i){this.logger.error(`[Service] [getHover] Failed for \u201C${r.uri}\u201D #${r.version}`,i)}}getInlayHints(e,r,n){try{this.debug(`Getting inlay hints for '${r.uri}' # ${r.version}`);let i=[],o=_r.create(this.project,{doc:r});for(let s of this.project.meta.inlayHintProviders)i.push(...s(e,o));return i}catch(i){this.logger.error(`[Service] [getInlayHints] Failed for \u201C${r.uri}\u201D #${r.version}`,i)}return[]}getSignatureHelp(e,r,n){try{this.debug(`Getting signature help for '${r.uri}' # ${r.version} @ ${n}`);let i=Ru.create(this.project,{doc:r,offset:n});for(let o of this.project.meta.signatureHelpProviders){let s=o(e,i);if(s)return s}}catch(i){this.logger.error(`[Service] [getSignatureHelp] Failed for \u201C${r.uri}\u201D #${r.version}`,i)}}async getSymbolLocations(e,r,n,i=Zi,o=!1){try{this.debug(`Getting symbol locations of usage '${i.join(",")}' for '${r.uri}' # ${r.version} @ ${n} with currentFileOnly=${o}`);let s=Ke.findDeepestChild({node:e,needle:n});for(;s;){let a=this.project.symbols.resolveAlias(s.symbol);if(a){let l=[];for(let f of i){let u=a[f]??[];o&&(u=u.filter(h=>h.uri===r.uri)),l.push(...u)}let c=[];for(let f of l){let u=Y.isFileUri(f.uri)?f.uri:await this.project.fs.mapToDisk(f.uri);u&&c.push({...f,uri:u})}return Iu.create(s.range,c.length?c:void 0)}s=s.parent}}catch(s){this.logger.error(`[Service] [getSymbolLocations] Failed for \u201C${r.uri}\u201D #${r.version}`,s)}}};var V=Symbol("Failure");function zt(t,e,r){let n=e.clone(),i={...r,err:new ut};return{result:t(n,i),endCursor:n.cursor,errorAmount:i.err.errors.length,updateSrcAndCtx:()=>{e.innerCursor=n.innerCursor,r.err.absorb(i.err)}}}function be(t,e){return(r,n)=>{let i={[Qa]:!0,children:[],range:v.create(r)};for(let[o,s]of t.entries()){let a=typeof s=="function"?s:s.get(i);if(a===void 0)continue;o>0&&e&&i.children.push(...e(r,n));let l=a(r,n);if(l===V)return V;if(l===void 0)continue;Xa.is(l)?i.children.push(...l.children):i.children.push(l)}return i.range.end=r.cursor,i}}function Ls(t,e){return(r,n)=>{let i={[Qa]:!0,children:[],range:v.create(r)};for(;r.canRead();){e&&i.children.push(...e(r,n));let{result:o,updateSrcAndCtx:s}=zt(t,r,n);if(o===V)break;s(),Xa.is(o)?i.children.push(...o.children):i.children.push(o)}return i.range.end=r.cursor,i}}function ar(t,e){return(r,n)=>{let i=t.map((o,s)=>({attempt:zt(o,r,n),index:s})).filter(({attempt:o})=>o.result!==V).sort((o,s)=>s.attempt.endCursor-o.attempt.endCursor||o.attempt.errorAmount-s.attempt.errorAmount);return i.length===0?(e&&(e.index=-1),V):(i[0].attempt.updateSrcAndCtx(),e&&(e.index=i[0].index),i[0].attempt.result)}}function oe(t){return(e,r)=>{let n=e.cursor,{endCursor:i,updateSrcAndCtx:o,result:s}=zt(t,e,r);return i-n>0?(o(),s):V}}function Ol(t){return(e,r)=>{let n=e.cursor,{errorAmount:i,updateSrcAndCtx:o,result:s}=zt(t,e,r);return i?V:(o(),s)}}function ke(t){return(e,r)=>{let{result:n,updateSrcAndCtx:i}=zt(t,e,r);if(n!==V)return i(),n}}function ne(t){return(e,r)=>{for(let{predicate:n,prefix:i,parser:o,regex:s}of t)if(n?.(e)??(i!==void 0?e.tryPeek(i):void 0)??(s&&e.matchPattern(s))??!0)return(typeof o=="object"?o.get():o)(e,r);throw new Error("The select parser util was called with non-exhaustive cases")}}function J(t,e){return(r,n)=>{let i=t(r,n);return i===V?V:e(i,r,n)}}function se(t,e){return J(e,r=>{let{type:n,...i}=r,o={type:t,...i};return delete o[Qa],o})}function Is(t,e,r,n){return J(t,(i,o,s)=>(e(i,o,s)||s.err.report(r,i.range,n),i))}function Tn(t,...e){let r=e.flat();return(n,i)=>{let o=n.clone();o.string=o.string.slice(0,r.reduce((a,l)=>{let c=o.string.indexOf(l,o.innerCursor);return Math.min(a,c===-1?1/0:c)},1/0));let s=t(o,i);return n.cursor=o.cursor,s}}var ju=J(De("false","true"),t=>({type:"boolean",range:t.range,value:t.value===""?void 0:t.value==="true"}));function El({singleLinePrefixes:t,includesEol:e}){return(r,n)=>{let i=r.cursor,o={type:"comment",range:v.create(i),comment:""};for(let s of t)if(r.peek(s.length)===s)return e?r.nextLine():r.skipLine(),o.range.end=r.cursor,o.comment=r.sliceToCursor(i+s.length),o;return V}}var Tx=(t,e)=>{if(!t.canRead())return;let r={type:"error",range:v.create(t,()=>t.skipRemaining())};return e.err.report(y("error.unparseable-content"),r),r};function Ax(){return(t,e)=>{let n={type:"file",range:v.create(t,t.string.length),children:[],locals:Object.create(null),parserErrors:[]};t.skipWhitespace();let o=e.meta.getParserForLanguageId(e.doc.languageId)(t,e);return o&&o!==V&&n.children.push(o),t.skipWhitespace().canRead()&&n.children.push(Tx(t,e)),Ke.setParents(n),n.parserErrors=e.err.dump(),n}}var dR=(t,e,r,n)=>{r.err.report(y("expected",y("float.between",n.min??"-\u221E",n.max??"+\u221E")),t,3)};function en(t){return(e,r)=>{let n={type:"float",range:v.create(e),value:0};for((e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&_e.isDigit(e.peek());)e.skip();if(e.trySkip("."))for(;e.canRead()&&_e.isDigit(e.peek());)e.skip();if(e.peek().toLowerCase()==="e")for(e.skip(),(e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&_e.isDigit(e.peek());)e.skip();n.range.end=e.cursor;let i=e.sliceToCursor(n.range.start);if(n.value=parseFloat(i)||0,i)t.pattern.test(i)?(t.min&&n.value<t.min||t.max&&n.value>t.max)&&(t.onOutOfRange??dR)(n,e,r,t):r.err.report(y("parser.float.illegal",t.pattern),n);else{if(t.failsOnEmpty)return V;r.err.report(y("expected",y("float")),n)}return n}}var pR=(t,e,r,n)=>{r.err.report(y("expected",y("integer.between",n.min??"-\u221E",n.max??"+\u221E")),t,3)};function Ar(t){return(e,r)=>{let n={type:"integer",range:v.create(e),value:0};for((e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&_e.isDigit(e.peek());)e.skip();n.range.end=e.cursor;let i=e.sliceToCursor(n.range.start),o=i==="-"||i==="+";if(o||(n.value=Number(i)),i)!t.pattern.test(i)||o?r.err.report(y("parser.integer.illegal",t.pattern),n):(t.min!==void 0&&n.value<t.min||t.max!==void 0&&n.value>t.max)&&(t.onOutOfRange??pR)(n,e,r,t);else{if(t.failsOnEmpty)return V;r.err.report(y("expected",y("integer")),n)}return n}}function fi({start:t,value:e,sep:r,trailingSep:n,end:i}){return(o,s)=>{let a={type:"list",range:v.create(o),children:[]};if(o.trySkip(t)){o.skipWhitespace();let l=!1,c=!1;for(;o.canRead()&&o.peek(i.length)!==i;){let f=o.cursor,u;l&&!c&&s.err.report(y("expected",P(r)),o),o.skipWhitespace();let{result:h,endCursor:d,updateSrcAndCtx:p}=zt(e,o,s);h===V||d===o.cursor?s.err.report(y("expected",y("parser.list.value")),v.create(o,()=>o.skipUntilOrEnd(r,i,"\r",`
`))):(p(),u=h);let b;o.skipWhitespace(),l=!0,(c=o.peek(r.length)===r)&&(b=v.create(o,()=>o.skip(r.length))),a.children.push({type:"item",range:v.create(f,o),...u?{children:[u]}:{},value:u,sep:b}),o.skipWhitespace()}c&&!n&&s.err.report(y("parser.list.trailing-sep"),a.children[a.children.length-1].sep),o.trySkip(i)||s.err.report(y("expected",P(i)),o)}else s.err.report(y("expected",P(t)),o);return a.range.end=o.cursor,a}}var mR=(t,e,r,n)=>{r.err.report(y("expected",y("long.between",n.min??"-\u221E",n.max??"+\u221E")),t,3)};function Rl(t){return(e,r)=>{let n={type:"long",range:v.create(e),value:0n};for((e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&_e.isDigit(e.peek());)e.skip();n.range.end=e.cursor;let i=e.sliceToCursor(n.range.start),o=!1;try{n.value=BigInt(i)}catch{o=!0}if(i)!t.pattern.test(i)||o?r.err.report(y("parser.long.illegal",t.pattern),n):(t.min&&n.value<t.min||t.max&&n.value>t.max)&&(t.onOutOfRange??mR)(n,e,r,t);else{if(t.failsOnEmpty)return V;r.err.report(y("expected",y("long")),n)}return n}}function Tr({start:t,pair:e,end:r}){return(n,i)=>{let o={type:"record",range:v.create(n),children:[]};if(n.trySkip(t)){n.skipWhitespace();let s=!1,a=!1;for(;n.canRead()&&n.peek(r.length)!==r;){let l=n.cursor,c,f;s&&!a&&i.err.report(y("expected",P(e.end)),n);let u=n.cursor,{result:h,updateSrcAndCtx:d,endCursor:p}=zt(e.key,n,i);h===V||p-u===0&&![e.sep,e.end,r,"\r",`
`,"	"," "].includes(n.peek())?i.err.report(y("expected",y("parser.record.key")),v.create(n,()=>n.skipUntilOrEnd(e.sep,e.end,r,"\r",`
`))):(d(),c=h);let b;n.skipWhitespace(),n.peek(e.sep.length)===e.sep?b=v.create(n,()=>n.skip(e.sep.length)):i.err.report(y("expected",P(e.sep)),n),n.skipWhitespace();let m=typeof e.value=="function"?e.value:e.value.get(o,c),k=n.cursor,{result:S,updateSrcAndCtx:_,endCursor:w}=zt(m,n,i);S===V||w-k===0&&![e.sep,e.end,r,"\r",`
`,"	"," "].includes(n.peek())?i.err.report(y("expected",y("parser.record.value")),v.create(n,()=>n.skipUntilOrEnd(e.sep,e.end,r,"\r",`
`))):(_(),f=S);let C;n.skipWhitespace(),s=!0,(a=n.peek(e.end.length)===e.end)&&(C=v.create(n,()=>n.skip(e.end.length))),o.children.push({type:"pair",range:v.create(l,n),...c||f?{children:[c,f].filter(E=>!!E)}:{},key:c,sep:b,value:f,end:C}),n.skipWhitespace()}a&&!e.trailingEnd&&i.err.report(y("parser.record.trailing-end"),o.children[o.children.length-1].end),n.trySkip(r)||i.err.report(y("expected",P(r)),n)}else i.err.report(y("expected",P(t)),n);return o.range.end=n.cursor,o}}var gR=new Set([" ","\r",`
`,"=",",",'"',"'","{","}","[","]","(",")",";"]),Ox=new Set(["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","_","-","."]);function Oe(t){return(e,r)=>{let n={type:"resource_location",range:v.create(e),options:t};e.trySkip(q.TagPrefix)&&(n.isTag=!0);let i=e.cursor;for(;e.canReadInLine()&&!gR.has(e.peek());)e.skip();let o=e.sliceToCursor(i);if(n.range.end=e.cursor,o.length===0)r.err.report(y("expected",y("resource-location")),n);else{let s=o.indexOf(t.namespacePathSep??q.NamespacePathSep);s>=0&&(n.namespace=o.slice(0,s));let a=o.slice(s+1);n.path=a.split(q.PathSep);let l=[...new Set([...[...n.namespace??[]].filter(c=>!Ox.has(c)),...[...a].filter(c=>c!=="/"&&!Ox.has(c))])];l.length&&r.err.report(y("parser.resource-location.illegal",vn(l,!0,"and")),n),n.isTag&&!t.allowTag&&r.err.report(y("parser.resource-location.tag-diallowed"),n),!n.namespace&&t.isPredicate&&r.err.report(y("parser.resource-location.namespace-expected"),n)}return n}}var Ex=Br(pu(),1);function dt(t){return(e,r)=>{let n={type:"string",range:v.create(e),options:t,value:"",valueMap:[]},i=e.cursor;if(t.quotes?.length&&(e.peek()==='"'||e.peek()==="'")){let o=e.read(),s=e.cursor;for(;e.canRead()&&e.peek()!==o;){let a=e.peek();if(t.escapable&&a==="\\"){let l=e.cursor;e.skip();let c=e.read();if(c==="\\"||c===o||uu.is(t.escapable.characters,c))n.valueMap.push({inner:v.create(n.value.length,n.value.length+1),outer:v.create(l,e)}),n.value+=zw.get(c);else if(t.escapable.unicode&&c==="u"){let f=e.peek(4);/^[0-9a-f]{4}$/i.test(f)?(e.skip(4),n.valueMap.push({inner:v.create(n.value.length,n.value.length+1),outer:v.create(l,e)}),n.value+=String.fromCharCode(parseInt(f,16))):(r.err.report(y("parser.string.illegal-unicode-escape"),v.create(e,e.getCharRange(3).end)),n.valueMap.push({inner:v.create(n.value.length,n.value.length+1),outer:v.create(l,e)}),n.value+=c)}else t.escapable.allowUnknown||r.err.report(y("parser.string.illegal-escape",P(c)),e.getCharRange(-1)),n.valueMap.push({inner:v.create(n.value.length,n.value.length+1),outer:v.create(l,e)}),n.value+=c}else e.skip(),n.value+=a}e.trySkip(o)||r.err.report(y("expected",P(o)),e),t.quotes.includes(o)||r.err.report(y("parser.string.illegal-quote",t.quotes),n),i=s}else if(t.unquotable){for(;e.canRead()&&Bm(e.peek(),t.unquotable);)n.value+=e.read();!n.value&&!t.unquotable.allowEmpty&&r.err.report(y("expected",y("string")),e)}else r.err.report(y("expected",t.quotes),e);if(n.valueMap.unshift({inner:v.create(0),outer:v.create(i)}),t.value?.parser){let o=uo(t.value.parser,n.value,n.valueMap,r);o!==V&&(n.children=[o])}return n.range.end=e.cursor,n}}function uo(t,e,r,n){let i=new _e(e,r),o={...n,doc:Ex.TextDocument.create(n.doc.uri,n.doc.languageId,n.doc.version,e)};return t(i,o)}var yR=Object.freeze(["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","_",".","+","-"]),bR=new Set(yR),Rx=/^[0-9A-Za-z_\.\+\-]*$/,Ml={allowEmpty:!0,allowList:bR},ui={escapable:{},quotes:['"',"'"],unquotable:Ml},ho=dt(ui);function Bm(t,e){return e.allowList?.has(t)??!e.blockList?.has(t)}function Bs(t){let e=kR(t);return(r,n)=>{let i={type:"symbol",range:v.create(r),options:e,value:r.readRemaining()};return i.range.end=r.cursor,i}}function kR(t){return typeof t=="string"?{category:t}:t}var nh=Br(Dx(),1);function Fs(t){let e=t.length;for(;--e>=0;)t[e]=0}var vR=0,y1=1,wR=2,xR=3,SR=258,ug=29,ql=256,jl=ql+1+ug,zs=30,hg=19,b1=2*jl+1,po=15,Km=16,_R=7,dg=256,k1=16,v1=17,w1=18,ag=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Wu=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),CR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),x1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AR=512,En=new Array((jl+2)*2);Fs(En);var Ll=new Array(zs*2);Fs(Ll);var $l=new Array(AR);Fs($l);var zl=new Array(SR-xR+1);Fs(zl);var pg=new Array(ug);Fs(pg);var Zu=new Array(zs);Fs(Zu);function Gm(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}var S1,_1,C1;function Zm(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}var A1=t=>t<256?$l[t]:$l[256+(t>>>7)],Fl=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Tt=(t,e,r)=>{t.bi_valid>Km-r?(t.bi_buf|=e<<t.bi_valid&65535,Fl(t,t.bi_buf),t.bi_buf=e>>Km-t.bi_valid,t.bi_valid+=r-Km):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},rn=(t,e,r)=>{Tt(t,r[e*2],r[e*2+1])},T1=(t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},TR=t=>{t.bi_valid===16?(Fl(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},OR=(t,e)=>{let r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length,c,f,u,h,d,p,b=0;for(h=0;h<=po;h++)t.bl_count[h]=0;for(r[t.heap[t.heap_max]*2+1]=0,c=t.heap_max+1;c<b1;c++)f=t.heap[c],h=r[r[f*2+1]*2+1]+1,h>l&&(h=l,b++),r[f*2+1]=h,!(f>n)&&(t.bl_count[h]++,d=0,f>=a&&(d=s[f-a]),p=r[f*2],t.opt_len+=p*(h+d),o&&(t.static_len+=p*(i[f*2+1]+d)));if(b!==0){do{for(h=l-1;t.bl_count[h]===0;)h--;t.bl_count[h]--,t.bl_count[h+1]+=2,t.bl_count[l]--,b-=2}while(b>0);for(h=l;h!==0;h--)for(f=t.bl_count[h];f!==0;)u=t.heap[--c],!(u>n)&&(r[u*2+1]!==h&&(t.opt_len+=(h-r[u*2+1])*r[u*2],r[u*2+1]=h),f--)}},O1=(t,e,r)=>{let n=new Array(po+1),i=0,o,s;for(o=1;o<=po;o++)n[o]=i=i+r[o-1]<<1;for(s=0;s<=e;s++){let a=t[s*2+1];a!==0&&(t[s*2]=T1(n[a]++,a))}},ER=()=>{let t,e,r,n,i,o=new Array(po+1);for(r=0,n=0;n<ug-1;n++)for(pg[n]=r,t=0;t<1<<ag[n];t++)zl[r++]=n;for(zl[r-1]=n,i=0,n=0;n<16;n++)for(Zu[n]=i,t=0;t<1<<Wu[n];t++)$l[i++]=n;for(i>>=7;n<zs;n++)for(Zu[n]=i<<7,t=0;t<1<<Wu[n]-7;t++)$l[256+i++]=n;for(e=0;e<=po;e++)o[e]=0;for(t=0;t<=143;)En[t*2+1]=8,t++,o[8]++;for(;t<=255;)En[t*2+1]=9,t++,o[9]++;for(;t<=279;)En[t*2+1]=7,t++,o[7]++;for(;t<=287;)En[t*2+1]=8,t++,o[8]++;for(O1(En,jl+1,o),t=0;t<zs;t++)Ll[t*2+1]=5,Ll[t*2]=T1(t,5);S1=new Gm(En,ag,ql+1,jl,po),_1=new Gm(Ll,Wu,0,zs,po),C1=new Gm(new Array(0),CR,0,hg,_R)},E1=t=>{let e;for(e=0;e<jl;e++)t.dyn_ltree[e*2]=0;for(e=0;e<zs;e++)t.dyn_dtree[e*2]=0;for(e=0;e<hg;e++)t.bl_tree[e*2]=0;t.dyn_ltree[dg*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},R1=t=>{t.bi_valid>8?Fl(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},RR=(t,e,r,n)=>{R1(t),n&&(Fl(t,r),Fl(t,~r)),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},Nx=(t,e,r,n)=>{let i=e*2,o=r*2;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]},Jm=(t,e,r)=>{let n=t.heap[r],i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Nx(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Nx(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},Px=(t,e,r)=>{let n,i,o=0,s,a;if(t.last_lit!==0)do n=t.pending_buf[t.d_buf+o*2]<<8|t.pending_buf[t.d_buf+o*2+1],i=t.pending_buf[t.l_buf+o],o++,n===0?rn(t,i,e):(s=zl[i],rn(t,s+ql+1,e),a=ag[s],a!==0&&(i-=pg[s],Tt(t,i,a)),n--,s=A1(n),rn(t,s,r),a=Wu[s],a!==0&&(n-=Zu[s],Tt(t,n,a)));while(o<t.last_lit);rn(t,dg,e)},lg=(t,e)=>{let r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems,s,a,l=-1,c;for(t.heap_len=0,t.heap_max=b1,s=0;s<o;s++)r[s*2]!==0?(t.heap[++t.heap_len]=l=s,t.depth[s]=0):r[s*2+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=l<2?++l:0,r[c*2]=1,t.depth[c]=0,t.opt_len--,i&&(t.static_len-=n[c*2+1]);for(e.max_code=l,s=t.heap_len>>1;s>=1;s--)Jm(t,r,s);c=o;do s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Jm(t,r,1),a=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=a,r[c*2]=r[s*2]+r[a*2],t.depth[c]=(t.depth[s]>=t.depth[a]?t.depth[s]:t.depth[a])+1,r[s*2+1]=r[a*2+1]=c,t.heap[1]=c++,Jm(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],OR(t,e),O1(r,l,t.bl_count)},Lx=(t,e,r)=>{let n,i=-1,o,s=e[0*2+1],a=0,l=7,c=4;for(s===0&&(l=138,c=3),e[(r+1)*2+1]=65535,n=0;n<=r;n++)o=s,s=e[(n+1)*2+1],!(++a<l&&o===s)&&(a<c?t.bl_tree[o*2]+=a:o!==0?(o!==i&&t.bl_tree[o*2]++,t.bl_tree[k1*2]++):a<=10?t.bl_tree[v1*2]++:t.bl_tree[w1*2]++,a=0,i=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4))},Ix=(t,e,r)=>{let n,i=-1,o,s=e[0*2+1],a=0,l=7,c=4;for(s===0&&(l=138,c=3),n=0;n<=r;n++)if(o=s,s=e[(n+1)*2+1],!(++a<l&&o===s)){if(a<c)do rn(t,o,t.bl_tree);while(--a!==0);else o!==0?(o!==i&&(rn(t,o,t.bl_tree),a--),rn(t,k1,t.bl_tree),Tt(t,a-3,2)):a<=10?(rn(t,v1,t.bl_tree),Tt(t,a-3,3)):(rn(t,w1,t.bl_tree),Tt(t,a-11,7));a=0,i=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4)}},MR=t=>{let e;for(Lx(t,t.dyn_ltree,t.l_desc.max_code),Lx(t,t.dyn_dtree,t.d_desc.max_code),lg(t,t.bl_desc),e=hg-1;e>=3&&t.bl_tree[x1[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},DR=(t,e,r,n)=>{let i;for(Tt(t,e-257,5),Tt(t,r-1,5),Tt(t,n-4,4),i=0;i<n;i++)Tt(t,t.bl_tree[x1[i]*2+1],3);Ix(t,t.dyn_ltree,e-1),Ix(t,t.dyn_dtree,r-1)},NR=t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<ql;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},Bx=!1,PR=t=>{Bx||(ER(),Bx=!0),t.l_desc=new Zm(t.dyn_ltree,S1),t.d_desc=new Zm(t.dyn_dtree,_1),t.bl_desc=new Zm(t.bl_tree,C1),t.bi_buf=0,t.bi_valid=0,E1(t)},M1=(t,e,r,n)=>{Tt(t,(vR<<1)+(n?1:0),3),RR(t,e,r,!0)},LR=t=>{Tt(t,y1<<1,3),rn(t,dg,En),TR(t)},IR=(t,e,r,n)=>{let i,o,s=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=NR(t)),lg(t,t.l_desc),lg(t,t.d_desc),s=MR(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&e!==-1?M1(t,e,r,n):t.strategy===4||o===i?(Tt(t,(y1<<1)+(n?1:0),3),Px(t,En,Ll)):(Tt(t,(wR<<1)+(n?1:0),3),DR(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),Px(t,t.dyn_ltree,t.dyn_dtree)),E1(t),n&&R1(t)},BR=(t,e,r)=>(t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=r&255,t.last_lit++,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(zl[r]+ql+1)*2]++,t.dyn_dtree[A1(e)*2]++),t.last_lit===t.lit_bufsize-1),jR=PR,$R=M1,zR=IR,FR=BR,VR=LR,UR={_tr_init:jR,_tr_stored_block:$R,_tr_flush_block:zR,_tr_tally:FR,_tr_align:VR},HR=(t,e,r,n)=>{let i=t&65535|0,o=t>>>16&65535|0,s=0;for(;r!==0;){s=r>2e3?2e3:r,r-=s;do i=i+e[n++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0},Vl=HR,WR=()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},qR=new Uint32Array(WR()),KR=(t,e,r,n)=>{let i=qR,o=n+r;t^=-1;for(let s=n;s<o;s++)t=t>>>8^i[(t^e[s])&255];return t^-1},Ge=KR,go={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},vo={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:GR,_tr_stored_block:ZR,_tr_flush_block:JR,_tr_tally:gi,_tr_align:YR}=UR,{Z_NO_FLUSH:wo,Z_PARTIAL_FLUSH:XR,Z_FULL_FLUSH:QR,Z_FINISH:yi,Z_BLOCK:jx,Z_OK:nn,Z_STREAM_END:$x,Z_STREAM_ERROR:lr,Z_DATA_ERROR:eM,Z_BUF_ERROR:Ym,Z_DEFAULT_COMPRESSION:tM,Z_FILTERED:rM,Z_HUFFMAN_ONLY:zu,Z_RLE:nM,Z_FIXED:iM,Z_DEFAULT_STRATEGY:oM,Z_UNKNOWN:sM,Z_DEFLATED:Xu}=vo,aM=9,lM=15,cM=8,fM=29,uM=256,cg=uM+1+fM,hM=30,dM=19,pM=2*cg+1,mM=15,X=3,pi=258,Or=pi+X+1,gM=32,Qu=42,fg=69,qu=73,Ku=91,Gu=103,mo=113,Nl=666,He=1,Kl=2,yo=3,Vs=4,yM=3,mi=(t,e)=>(t.msg=go[e],e),zx=t=>(t<<1)-(t>4?9:0),di=t=>{let e=t.length;for(;--e>=0;)t[e]=0},bM=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,bi=bM,hi=t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},rt=(t,e)=>{JR(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,hi(t.strm)},ie=(t,e)=>{t.pending_buf[t.pending++]=e},Dl=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},kM=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),t.state.wrap===1?t.adler=Vl(t.adler,e,i,r):t.state.wrap===2&&(t.adler=Ge(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},D1=(t,e)=>{let r=t.max_chain_length,n=t.strstart,i,o,s=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-Or?t.strstart-(t.w_size-Or):0,c=t.window,f=t.w_mask,u=t.prev,h=t.strstart+pi,d=c[n+s-1],p=c[n+s];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(c[i+s]!==p||c[i+s-1]!==d||c[i]!==c[n]||c[++i]!==c[n+1])){n+=2,i++;do;while(c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&n<h);if(o=pi-(h-n),n=h-pi,o>s){if(t.match_start=e,s=o,o>=a)break;d=c[n+s-1],p=c[n+s]}}while((e=u[e&f])>l&&--r!==0);return s<=t.lookahead?s:t.lookahead},bo=t=>{let e=t.w_size,r,n,i,o,s;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Or)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,n=t.hash_size,r=n;do i=t.head[--r],t.head[r]=i>=e?i-e:0;while(--n);n=e,r=n;do i=t.prev[--r],t.prev[r]=i>=e?i-e:0;while(--n);o+=e}if(t.strm.avail_in===0)break;if(n=kM(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=n,t.lookahead+t.insert>=X)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=bi(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=bi(t,t.ins_h,t.window[s+X-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<X)););}while(t.lookahead<Or&&t.strm.avail_in!==0)},vM=(t,e)=>{let r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(bo(t),t.lookahead===0&&e===wo)return He;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;let n=t.block_start+r;if((t.strstart===0||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,rt(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-Or&&(rt(t,!1),t.strm.avail_out===0))return He}return t.insert=0,e===yi?(rt(t,!0),t.strm.avail_out===0?yo:Vs):(t.strstart>t.block_start&&(rt(t,!1),t.strm.avail_out===0),He)},Xm=(t,e)=>{let r,n;for(;;){if(t.lookahead<Or){if(bo(t),t.lookahead<Or&&e===wo)return He;if(t.lookahead===0)break}if(r=0,t.lookahead>=X&&(t.ins_h=bi(t,t.ins_h,t.window[t.strstart+X-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-Or&&(t.match_length=D1(t,r)),t.match_length>=X)if(n=gi(t,t.strstart-t.match_start,t.match_length-X),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=X){t.match_length--;do t.strstart++,t.ins_h=bi(t,t.ins_h,t.window[t.strstart+X-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=bi(t,t.ins_h,t.window[t.strstart+1]);else n=gi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(rt(t,!1),t.strm.avail_out===0))return He}return t.insert=t.strstart<X-1?t.strstart:X-1,e===yi?(rt(t,!0),t.strm.avail_out===0?yo:Vs):t.last_lit&&(rt(t,!1),t.strm.avail_out===0)?He:Kl},js=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<Or){if(bo(t),t.lookahead<Or&&e===wo)return He;if(t.lookahead===0)break}if(r=0,t.lookahead>=X&&(t.ins_h=bi(t,t.ins_h,t.window[t.strstart+X-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=X-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-Or&&(t.match_length=D1(t,r),t.match_length<=5&&(t.strategy===rM||t.match_length===X&&t.strstart-t.match_start>4096)&&(t.match_length=X-1)),t.prev_length>=X&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-X,n=gi(t,t.strstart-1-t.prev_match,t.prev_length-X),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=bi(t,t.ins_h,t.window[t.strstart+X-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=X-1,t.strstart++,n&&(rt(t,!1),t.strm.avail_out===0))return He}else if(t.match_available){if(n=gi(t,0,t.window[t.strstart-1]),n&&rt(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return He}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=gi(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<X-1?t.strstart:X-1,e===yi?(rt(t,!0),t.strm.avail_out===0?yo:Vs):t.last_lit&&(rt(t,!1),t.strm.avail_out===0)?He:Kl},wM=(t,e)=>{let r,n,i,o,s=t.window;for(;;){if(t.lookahead<=pi){if(bo(t),t.lookahead<=pi&&e===wo)return He;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=X&&t.strstart>0&&(i=t.strstart-1,n=s[i],n===s[++i]&&n===s[++i]&&n===s[++i])){o=t.strstart+pi;do;while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);t.match_length=pi-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=X?(r=gi(t,1,t.match_length-X),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=gi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(rt(t,!1),t.strm.avail_out===0))return He}return t.insert=0,e===yi?(rt(t,!0),t.strm.avail_out===0?yo:Vs):t.last_lit&&(rt(t,!1),t.strm.avail_out===0)?He:Kl},xM=(t,e)=>{let r;for(;;){if(t.lookahead===0&&(bo(t),t.lookahead===0)){if(e===wo)return He;break}if(t.match_length=0,r=gi(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(rt(t,!1),t.strm.avail_out===0))return He}return t.insert=0,e===yi?(rt(t,!0),t.strm.avail_out===0?yo:Vs):t.last_lit&&(rt(t,!1),t.strm.avail_out===0)?He:Kl};function tn(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}var Pl=[new tn(0,0,0,0,vM),new tn(4,4,8,4,Xm),new tn(4,5,16,8,Xm),new tn(4,6,32,32,Xm),new tn(4,4,16,16,js),new tn(8,16,32,32,js),new tn(8,16,128,128,js),new tn(8,32,128,256,js),new tn(32,128,258,1024,js),new tn(32,258,258,4096,js)],SM=t=>{t.window_size=2*t.w_size,di(t.head),t.max_lazy_match=Pl[t.level].max_lazy,t.good_match=Pl[t.level].good_length,t.nice_match=Pl[t.level].nice_length,t.max_chain_length=Pl[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=X-1,t.match_available=0,t.ins_h=0};function _M(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Xu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(pM*2),this.dyn_dtree=new Uint16Array((2*hM+1)*2),this.bl_tree=new Uint16Array((2*dM+1)*2),di(this.dyn_ltree),di(this.dyn_dtree),di(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(mM+1),this.heap=new Uint16Array(2*cg+1),di(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*cg+1),di(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var N1=t=>{if(!t||!t.state)return mi(t,lr);t.total_in=t.total_out=0,t.data_type=sM;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Qu:mo,t.adler=e.wrap===2?0:1,e.last_flush=wo,GR(e),nn},P1=t=>{let e=N1(t);return e===nn&&SM(t.state),e},CM=(t,e)=>!t||!t.state||t.state.wrap!==2?lr:(t.state.gzhead=e,nn),L1=(t,e,r,n,i,o)=>{if(!t)return lr;let s=1;if(e===tM&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>aM||r!==Xu||n<8||n>15||e<0||e>9||o<0||o>iM)return mi(t,lr);n===8&&(n=9);let a=new _M;return t.state=a,a.strm=t,a.wrap=s,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+X-1)/X),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=(1+2)*a.lit_bufsize,a.level=e,a.strategy=o,a.method=r,P1(t)},AM=(t,e)=>L1(t,e,Xu,lM,cM,oM),TM=(t,e)=>{let r,n;if(!t||!t.state||e>jx||e<0)return t?mi(t,lr):lr;let i=t.state;if(!t.output||!t.input&&t.avail_in!==0||i.status===Nl&&e!==yi)return mi(t,t.avail_out===0?Ym:lr);i.strm=t;let o=i.last_flush;if(i.last_flush=e,i.status===Qu)if(i.wrap===2)t.adler=0,ie(i,31),ie(i,139),ie(i,8),i.gzhead?(ie(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ie(i,i.gzhead.time&255),ie(i,i.gzhead.time>>8&255),ie(i,i.gzhead.time>>16&255),ie(i,i.gzhead.time>>24&255),ie(i,i.level===9?2:i.strategy>=zu||i.level<2?4:0),ie(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(ie(i,i.gzhead.extra.length&255),ie(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Ge(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=fg):(ie(i,0),ie(i,0),ie(i,0),ie(i,0),ie(i,0),ie(i,i.level===9?2:i.strategy>=zu||i.level<2?4:0),ie(i,yM),i.status=mo);else{let s=Xu+(i.w_bits-8<<4)<<8,a=-1;i.strategy>=zu||i.level<2?a=0:i.level<6?a=1:i.level===6?a=2:a=3,s|=a<<6,i.strstart!==0&&(s|=gM),s+=31-s%31,i.status=mo,Dl(i,s),i.strstart!==0&&(Dl(i,t.adler>>>16),Dl(i,t.adler&65535)),t.adler=1}if(i.status===fg)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Ge(t.adler,i.pending_buf,i.pending-r,r)),hi(t),r=i.pending,i.pending===i.pending_buf_size));)ie(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=Ge(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=qu)}else i.status=qu;if(i.status===qu)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Ge(t.adler,i.pending_buf,i.pending-r,r)),hi(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,ie(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=Ge(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.gzindex=0,i.status=Ku)}else i.status=Ku;if(i.status===Ku)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Ge(t.adler,i.pending_buf,i.pending-r,r)),hi(t),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,ie(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>r&&(t.adler=Ge(t.adler,i.pending_buf,i.pending-r,r)),n===0&&(i.status=Gu)}else i.status=Gu;if(i.status===Gu&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&hi(t),i.pending+2<=i.pending_buf_size&&(ie(i,t.adler&255),ie(i,t.adler>>8&255),t.adler=0,i.status=mo)):i.status=mo),i.pending!==0){if(hi(t),t.avail_out===0)return i.last_flush=-1,nn}else if(t.avail_in===0&&zx(e)<=zx(o)&&e!==yi)return mi(t,Ym);if(i.status===Nl&&t.avail_in!==0)return mi(t,Ym);if(t.avail_in!==0||i.lookahead!==0||e!==wo&&i.status!==Nl){let s=i.strategy===zu?xM(i,e):i.strategy===nM?wM(i,e):Pl[i.level].func(i,e);if((s===yo||s===Vs)&&(i.status=Nl),s===He||s===yo)return t.avail_out===0&&(i.last_flush=-1),nn;if(s===Kl&&(e===XR?YR(i):e!==jx&&(ZR(i,0,0,!1),e===QR&&(di(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),hi(t),t.avail_out===0))return i.last_flush=-1,nn}return e!==yi?nn:i.wrap<=0?$x:(i.wrap===2?(ie(i,t.adler&255),ie(i,t.adler>>8&255),ie(i,t.adler>>16&255),ie(i,t.adler>>24&255),ie(i,t.total_in&255),ie(i,t.total_in>>8&255),ie(i,t.total_in>>16&255),ie(i,t.total_in>>24&255)):(Dl(i,t.adler>>>16),Dl(i,t.adler&65535)),hi(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?nn:$x)},OM=t=>{if(!t||!t.state)return lr;let e=t.state.status;return e!==Qu&&e!==fg&&e!==qu&&e!==Ku&&e!==Gu&&e!==mo&&e!==Nl?mi(t,lr):(t.state=null,e===mo?mi(t,eM):nn)},EM=(t,e)=>{let r=e.length;if(!t||!t.state)return lr;let n=t.state,i=n.wrap;if(i===2||i===1&&n.status!==Qu||n.lookahead)return lr;if(i===1&&(t.adler=Vl(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){i===0&&(di(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(r-n.w_size,r),0),e=l,r=n.w_size}let o=t.avail_in,s=t.next_in,a=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,bo(n);n.lookahead>=X;){let l=n.strstart,c=n.lookahead-(X-1);do n.ins_h=bi(n,n.ins_h,n.window[l+X-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--c);n.strstart=l,n.lookahead=X-1,bo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=X-1,n.match_available=0,t.next_in=s,t.input=a,t.avail_in=o,n.wrap=i,nn},RM=AM,MM=L1,DM=P1,NM=N1,PM=CM,LM=TM,IM=OM,BM=EM,jM="pako deflate (from Nodeca project)",Il={deflateInit:RM,deflateInit2:MM,deflateReset:DM,deflateResetKeep:NM,deflateSetHeader:PM,deflate:LM,deflateEnd:IM,deflateSetDictionary:BM,deflateInfo:jM},$M=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),zM=function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let n in r)$M(r,n)&&(t[n]=r[n])}}return t},FM=t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;let r=new Uint8Array(e);for(let n=0,i=0,o=t.length;n<o;n++){let s=t[n];r.set(s,i),i+=s.length}return r},eh={assign:zM,flattenChunks:FM},I1=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{I1=!1}var Ul=new Uint8Array(256);for(let t=0;t<256;t++)Ul[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ul[254]=Ul[254]=1;var VM=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,n,i,o,s=t.length,a=0;for(i=0;i<s;i++)r=t.charCodeAt(i),(r&64512)===55296&&i+1<s&&(n=t.charCodeAt(i+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)r=t.charCodeAt(i),(r&64512)===55296&&i+1<s&&(n=t.charCodeAt(i+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[o++]=r:r<2048?(e[o++]=192|r>>>6,e[o++]=128|r&63):r<65536?(e[o++]=224|r>>>12,e[o++]=128|r>>>6&63,e[o++]=128|r&63):(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63,e[o++]=128|r>>>6&63,e[o++]=128|r&63);return e},UM=(t,e)=>{if(e<65534&&t.subarray&&I1)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r},HM=(t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let n,i,o=new Array(r*2);for(i=0,n=0;n<r;){let s=t[n++];if(s<128){o[i++]=s;continue}let a=Ul[s];if(a>4){o[i++]=65533,n+=a-1;continue}for(s&=a===2?31:a===3?15:7;a>1&&n<r;)s=s<<6|t[n++]&63,a--;if(a>1){o[i++]=65533;continue}s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|s&1023)}return UM(o,i)},WM=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+Ul[t[r]]>e?r:e},Hl={string2buf:VM,buf2string:HM,utf8border:WM};function qM(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var B1=qM,j1=Object.prototype.toString,{Z_NO_FLUSH:KM,Z_SYNC_FLUSH:GM,Z_FULL_FLUSH:ZM,Z_FINISH:JM,Z_OK:Ju,Z_STREAM_END:YM,Z_DEFAULT_COMPRESSION:XM,Z_DEFAULT_STRATEGY:QM,Z_DEFLATED:eD}=vo;function Gl(t){this.options=eh.assign({level:XM,method:eD,chunkSize:16384,windowBits:15,memLevel:8,strategy:QM},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new B1,this.strm.avail_out=0;let r=Il.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Ju)throw new Error(go[r]);if(e.header&&Il.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Hl.string2buf(e.dictionary):j1.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,r=Il.deflateSetDictionary(this.strm,n),r!==Ju)throw new Error(go[r]);this._dict_set=!0}}Gl.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,i,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?JM:KM,typeof t=="string"?r.input=Hl.string2buf(t):j1.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===GM||o===ZM)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(i=Il.deflate(r,o),i===YM)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Il.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ju;if(r.avail_out===0){this.onData(r.output);continue}if(o>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};Gl.prototype.onData=function(t){this.chunks.push(t)};Gl.prototype.onEnd=function(t){t===Ju&&(this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function mg(t,e){let r=new Gl(e);if(r.push(t,!0),r.err)throw r.msg||go[r.err];return r.result}function tD(t,e){return e=e||{},e.raw=!0,mg(t,e)}function rD(t,e){return e=e||{},e.gzip=!0,mg(t,e)}var nD=Gl,iD=mg,oD=tD,sD=rD,aD=vo,lD={Deflate:nD,deflate:iD,deflateRaw:oD,gzip:sD,constants:aD},Fu=30,cD=12,fD=function(e,r){let n,i,o,s,a,l,c,f,u,h,d,p,b,m,k,S,_,w,C,E,x,T,O,M,I=e.state;n=e.next_in,O=e.input,i=n+(e.avail_in-5),o=e.next_out,M=e.output,s=o-(r-e.avail_out),a=o+(e.avail_out-257),l=I.dmax,c=I.wsize,f=I.whave,u=I.wnext,h=I.window,d=I.hold,p=I.bits,b=I.lencode,m=I.distcode,k=(1<<I.lenbits)-1,S=(1<<I.distbits)-1;e:do{p<15&&(d+=O[n++]<<p,p+=8,d+=O[n++]<<p,p+=8),_=b[d&k];t:for(;;){if(w=_>>>24,d>>>=w,p-=w,w=_>>>16&255,w===0)M[o++]=_&65535;else if(w&16){C=_&65535,w&=15,w&&(p<w&&(d+=O[n++]<<p,p+=8),C+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=O[n++]<<p,p+=8,d+=O[n++]<<p,p+=8),_=m[d&S];r:for(;;){if(w=_>>>24,d>>>=w,p-=w,w=_>>>16&255,w&16){if(E=_&65535,w&=15,p<w&&(d+=O[n++]<<p,p+=8,p<w&&(d+=O[n++]<<p,p+=8)),E+=d&(1<<w)-1,E>l){e.msg="invalid distance too far back",I.mode=Fu;break e}if(d>>>=w,p-=w,w=o-s,E>w){if(w=E-w,w>f&&I.sane){e.msg="invalid distance too far back",I.mode=Fu;break e}if(x=0,T=h,u===0){if(x+=c-w,w<C){C-=w;do M[o++]=h[x++];while(--w);x=o-E,T=M}}else if(u<w){if(x+=c+u-w,w-=u,w<C){C-=w;do M[o++]=h[x++];while(--w);if(x=0,u<C){w=u,C-=w;do M[o++]=h[x++];while(--w);x=o-E,T=M}}}else if(x+=u-w,w<C){C-=w;do M[o++]=h[x++];while(--w);x=o-E,T=M}for(;C>2;)M[o++]=T[x++],M[o++]=T[x++],M[o++]=T[x++],C-=3;C&&(M[o++]=T[x++],C>1&&(M[o++]=T[x++]))}else{x=o-E;do M[o++]=M[x++],M[o++]=M[x++],M[o++]=M[x++],C-=3;while(C>2);C&&(M[o++]=M[x++],C>1&&(M[o++]=M[x++]))}}else if(w&64){e.msg="invalid distance code",I.mode=Fu;break e}else{_=m[(_&65535)+(d&(1<<w)-1)];continue r}break}}else if(w&64)if(w&32){I.mode=cD;break e}else{e.msg="invalid literal/length code",I.mode=Fu;break e}else{_=b[(_&65535)+(d&(1<<w)-1)];continue t}break}}while(n<i&&o<a);C=p>>3,n-=C,p-=C<<3,d&=(1<<p)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=o<a?257+(a-o):257-(o-a),I.hold=d,I.bits=p},$s=15,Fx=852,Vx=592,Ux=0,Qm=1,Hx=2,uD=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hD=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dD=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pD=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),mD=(t,e,r,n,i,o,s,a)=>{let l=a.bits,c=0,f=0,u=0,h=0,d=0,p=0,b=0,m=0,k=0,S=0,_,w,C,E,x,T=null,O=0,M,I=new Uint16Array($s+1),ae=new Uint16Array($s+1),me=null,ot=0,Ie,Re,st;for(c=0;c<=$s;c++)I[c]=0;for(f=0;f<n;f++)I[e[r+f]]++;for(d=l,h=$s;h>=1&&I[h]===0;h--);if(d>h&&(d=h),h===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<h&&I[u]===0;u++);for(d<u&&(d=u),m=1,c=1;c<=$s;c++)if(m<<=1,m-=I[c],m<0)return-1;if(m>0&&(t===Ux||h!==1))return-1;for(ae[1]=0,c=1;c<$s;c++)ae[c+1]=ae[c]+I[c];for(f=0;f<n;f++)e[r+f]!==0&&(s[ae[e[r+f]]++]=f);if(t===Ux?(T=me=s,M=19):t===Qm?(T=uD,O-=257,me=hD,ot-=257,M=256):(T=dD,me=pD,M=-1),S=0,f=0,c=u,x=o,p=d,b=0,C=-1,k=1<<d,E=k-1,t===Qm&&k>Fx||t===Hx&&k>Vx)return 1;for(;;){Ie=c-b,s[f]<M?(Re=0,st=s[f]):s[f]>M?(Re=me[ot+s[f]],st=T[O+s[f]]):(Re=32+64,st=0),_=1<<c-b,w=1<<p,u=w;do w-=_,i[x+(S>>b)+w]=Ie<<24|Re<<16|st|0;while(w!==0);for(_=1<<c-1;S&_;)_>>=1;if(_!==0?(S&=_-1,S+=_):S=0,f++,--I[c]===0){if(c===h)break;c=e[r+s[f]]}if(c>d&&(S&E)!==C){for(b===0&&(b=d),x+=u,p=c-b,m=1<<p;p+b<h&&(m-=I[p+b],!(m<=0));)p++,m<<=1;if(k+=1<<p,t===Qm&&k>Fx||t===Hx&&k>Vx)return 1;C=S&E,i[C]=d<<24|p<<16|x-o|0}}return S!==0&&(i[x+S]=c-b<<24|64<<16|0),a.bits=d,0},Bl=mD,gD=0,$1=1,z1=2,{Z_FINISH:Wx,Z_BLOCK:yD,Z_TREES:Vu,Z_OK:ko,Z_STREAM_END:bD,Z_NEED_DICT:kD,Z_STREAM_ERROR:cr,Z_DATA_ERROR:F1,Z_MEM_ERROR:V1,Z_BUF_ERROR:vD,Z_DEFLATED:qx}=vo,U1=1,Kx=2,Gx=3,Zx=4,Jx=5,Yx=6,Xx=7,Qx=8,e1=9,t1=10,Yu=11,On=12,eg=13,r1=14,tg=15,n1=16,i1=17,o1=18,s1=19,Uu=20,Hu=21,a1=22,l1=23,c1=24,f1=25,u1=26,rg=27,h1=28,d1=29,we=30,H1=31,wD=32,xD=852,SD=592,_D=15,CD=_D,p1=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function AD(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var W1=t=>{if(!t||!t.state)return cr;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=U1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(xD),e.distcode=e.distdyn=new Int32Array(SD),e.sane=1,e.back=-1,ko},q1=t=>{if(!t||!t.state)return cr;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,W1(t)},K1=(t,e)=>{let r;if(!t||!t.state)return cr;let n=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?cr:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,q1(t))},G1=(t,e)=>{if(!t)return cr;let r=new AD;t.state=r,r.window=null;let n=K1(t,e);return n!==ko&&(t.state=null),n},TD=t=>G1(t,CD),m1=!0,ng,ig,OD=t=>{if(m1){ng=new Int32Array(512),ig=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Bl($1,t.lens,0,288,ng,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Bl(z1,t.lens,0,32,ig,0,t.work,{bits:5}),m1=!1}t.lencode=ng,t.lenbits=9,t.distcode=ig,t.distbits=5},Z1=(t,e,r,n)=>{let i,o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(r-n,r-n+i),o.wnext),n-=i,n?(o.window.set(e.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},ED=(t,e)=>{let r,n,i,o,s,a,l,c,f,u,h,d,p,b,m=0,k,S,_,w,C,E,x,T,O=new Uint8Array(4),M,I,ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return cr;r=t.state,r.mode===On&&(r.mode=eg),s=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=r.hold,f=r.bits,u=a,h=l,T=ko;e:for(;;)switch(r.mode){case U1:if(r.wrap===0){r.mode=eg;break}for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(r.wrap&2&&c===35615){r.check=0,O[0]=c&255,O[1]=c>>>8&255,r.check=Ge(r.check,O,2,0),c=0,f=0,r.mode=Kx;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((c&255)<<8)+(c>>8))%31){t.msg="incorrect header check",r.mode=we;break}if((c&15)!==qx){t.msg="unknown compression method",r.mode=we;break}if(c>>>=4,f-=4,x=(c&15)+8,r.wbits===0)r.wbits=x;else if(x>r.wbits){t.msg="invalid window size",r.mode=we;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=c&512?t1:On,c=0,f=0;break;case Kx:for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(r.flags=c,(r.flags&255)!==qx){t.msg="unknown compression method",r.mode=we;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=we;break}r.head&&(r.head.text=c>>8&1),r.flags&512&&(O[0]=c&255,O[1]=c>>>8&255,r.check=Ge(r.check,O,2,0)),c=0,f=0,r.mode=Gx;case Gx:for(;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.head&&(r.head.time=c),r.flags&512&&(O[0]=c&255,O[1]=c>>>8&255,O[2]=c>>>16&255,O[3]=c>>>24&255,r.check=Ge(r.check,O,4,0)),c=0,f=0,r.mode=Zx;case Zx:for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.head&&(r.head.xflags=c&255,r.head.os=c>>8),r.flags&512&&(O[0]=c&255,O[1]=c>>>8&255,r.check=Ge(r.check,O,2,0)),c=0,f=0,r.mode=Jx;case Jx:if(r.flags&1024){for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.length=c,r.head&&(r.head.extra_len=c),r.flags&512&&(O[0]=c&255,O[1]=c>>>8&255,r.check=Ge(r.check,O,2,0)),c=0,f=0}else r.head&&(r.head.extra=null);r.mode=Yx;case Yx:if(r.flags&1024&&(d=r.length,d>a&&(d=a),d&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+d),x)),r.flags&512&&(r.check=Ge(r.check,n,d,o)),a-=d,o+=d,r.length-=d),r.length))break e;r.length=0,r.mode=Xx;case Xx:if(r.flags&2048){if(a===0)break e;d=0;do x=n[o+d++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x));while(x&&d<a);if(r.flags&512&&(r.check=Ge(r.check,n,d,o)),a-=d,o+=d,x)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Qx;case Qx:if(r.flags&4096){if(a===0)break e;d=0;do x=n[o+d++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x));while(x&&d<a);if(r.flags&512&&(r.check=Ge(r.check,n,d,o)),a-=d,o+=d,x)break e}else r.head&&(r.head.comment=null);r.mode=e1;case e1:if(r.flags&512){for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(c!==(r.check&65535)){t.msg="header crc mismatch",r.mode=we;break}c=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=On;break;case t1:for(;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.adler=r.check=p1(c),c=0,f=0,r.mode=Yu;case Yu:if(r.havedict===0)return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,r.hold=c,r.bits=f,kD;t.adler=r.check=1,r.mode=On;case On:if(e===yD||e===Vu)break e;case eg:if(r.last){c>>>=f&7,f-=f&7,r.mode=rg;break}for(;f<3;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}switch(r.last=c&1,c>>>=1,f-=1,c&3){case 0:r.mode=r1;break;case 1:if(OD(r),r.mode=Uu,e===Vu){c>>>=2,f-=2;break e}break;case 2:r.mode=i1;break;case 3:t.msg="invalid block type",r.mode=we}c>>>=2,f-=2;break;case r1:for(c>>>=f&7,f-=f&7;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if((c&65535)!==(c>>>16^65535)){t.msg="invalid stored block lengths",r.mode=we;break}if(r.length=c&65535,c=0,f=0,r.mode=tg,e===Vu)break e;case tg:r.mode=n1;case n1:if(d=r.length,d){if(d>a&&(d=a),d>l&&(d=l),d===0)break e;i.set(n.subarray(o,o+d),s),a-=d,o+=d,l-=d,s+=d,r.length-=d;break}r.mode=On;break;case i1:for(;f<14;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(r.nlen=(c&31)+257,c>>>=5,f-=5,r.ndist=(c&31)+1,c>>>=5,f-=5,r.ncode=(c&15)+4,c>>>=4,f-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=we;break}r.have=0,r.mode=o1;case o1:for(;r.have<r.ncode;){for(;f<3;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.lens[ae[r.have++]]=c&7,c>>>=3,f-=3}for(;r.have<19;)r.lens[ae[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,M={bits:r.lenbits},T=Bl(gD,r.lens,0,19,r.lencode,0,r.work,M),r.lenbits=M.bits,T){t.msg="invalid code lengths set",r.mode=we;break}r.have=0,r.mode=s1;case s1:for(;r.have<r.nlen+r.ndist;){for(;m=r.lencode[c&(1<<r.lenbits)-1],k=m>>>24,S=m>>>16&255,_=m&65535,!(k<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(_<16)c>>>=k,f-=k,r.lens[r.have++]=_;else{if(_===16){for(I=k+2;f<I;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(c>>>=k,f-=k,r.have===0){t.msg="invalid bit length repeat",r.mode=we;break}x=r.lens[r.have-1],d=3+(c&3),c>>>=2,f-=2}else if(_===17){for(I=k+3;f<I;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=k,f-=k,x=0,d=3+(c&7),c>>>=3,f-=3}else{for(I=k+7;f<I;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=k,f-=k,x=0,d=11+(c&127),c>>>=7,f-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=we;break}for(;d--;)r.lens[r.have++]=x}}if(r.mode===we)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=we;break}if(r.lenbits=9,M={bits:r.lenbits},T=Bl($1,r.lens,0,r.nlen,r.lencode,0,r.work,M),r.lenbits=M.bits,T){t.msg="invalid literal/lengths set",r.mode=we;break}if(r.distbits=6,r.distcode=r.distdyn,M={bits:r.distbits},T=Bl(z1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,M),r.distbits=M.bits,T){t.msg="invalid distances set",r.mode=we;break}if(r.mode=Uu,e===Vu)break e;case Uu:r.mode=Hu;case Hu:if(a>=6&&l>=258){t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,r.hold=c,r.bits=f,fD(t,h),s=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=r.hold,f=r.bits,r.mode===On&&(r.back=-1);break}for(r.back=0;m=r.lencode[c&(1<<r.lenbits)-1],k=m>>>24,S=m>>>16&255,_=m&65535,!(k<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(S&&!(S&240)){for(w=k,C=S,E=_;m=r.lencode[E+((c&(1<<w+C)-1)>>w)],k=m>>>24,S=m>>>16&255,_=m&65535,!(w+k<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=w,f-=w,r.back+=w}if(c>>>=k,f-=k,r.back+=k,r.length=_,S===0){r.mode=u1;break}if(S&32){r.back=-1,r.mode=On;break}if(S&64){t.msg="invalid literal/length code",r.mode=we;break}r.extra=S&15,r.mode=a1;case a1:if(r.extra){for(I=r.extra;f<I;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=l1;case l1:for(;m=r.distcode[c&(1<<r.distbits)-1],k=m>>>24,S=m>>>16&255,_=m&65535,!(k<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(!(S&240)){for(w=k,C=S,E=_;m=r.distcode[E+((c&(1<<w+C)-1)>>w)],k=m>>>24,S=m>>>16&255,_=m&65535,!(w+k<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=w,f-=w,r.back+=w}if(c>>>=k,f-=k,r.back+=k,S&64){t.msg="invalid distance code",r.mode=we;break}r.offset=_,r.extra=S&15,r.mode=c1;case c1:if(r.extra){for(I=r.extra;f<I;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=we;break}r.mode=f1;case f1:if(l===0)break e;if(d=h-l,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=we;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),b=r.window}else b=i,p=s-r.offset,d=r.length;d>l&&(d=l),l-=d,r.length-=d;do i[s++]=b[p++];while(--d);r.length===0&&(r.mode=Hu);break;case u1:if(l===0)break e;i[s++]=r.length,l--,r.mode=Hu;break;case rg:if(r.wrap){for(;f<32;){if(a===0)break e;a--,c|=n[o++]<<f,f+=8}if(h-=l,t.total_out+=h,r.total+=h,h&&(t.adler=r.check=r.flags?Ge(r.check,i,h,s-h):Vl(r.check,i,h,s-h)),h=l,(r.flags?c:p1(c))!==r.check){t.msg="incorrect data check",r.mode=we;break}c=0,f=0}r.mode=h1;case h1:if(r.wrap&&r.flags){for(;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(c!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=we;break}c=0,f=0}r.mode=d1;case d1:T=bD;break e;case we:T=F1;break e;case H1:return V1;case wD:default:return cr}return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,r.hold=c,r.bits=f,(r.wsize||h!==t.avail_out&&r.mode<we&&(r.mode<rg||e!==Wx))&&Z1(t,t.output,t.next_out,h-t.avail_out),u-=t.avail_in,h-=t.avail_out,t.total_in+=u,t.total_out+=h,r.total+=h,r.wrap&&h&&(t.adler=r.check=r.flags?Ge(r.check,i,h,t.next_out-h):Vl(r.check,i,h,t.next_out-h)),t.data_type=r.bits+(r.last?64:0)+(r.mode===On?128:0)+(r.mode===Uu||r.mode===tg?256:0),(u===0&&h===0||e===Wx)&&T===ko&&(T=vD),T},RD=t=>{if(!t||!t.state)return cr;let e=t.state;return e.window&&(e.window=null),t.state=null,ko},MD=(t,e)=>{if(!t||!t.state)return cr;let r=t.state;return r.wrap&2?(r.head=e,e.done=!1,ko):cr},DD=(t,e)=>{let r=e.length,n,i,o;return!t||!t.state||(n=t.state,n.wrap!==0&&n.mode!==Yu)?cr:n.mode===Yu&&(i=1,i=Vl(i,e,r,0),i!==n.check)?F1:(o=Z1(t,e,r,r),o?(n.mode=H1,V1):(n.havedict=1,ko))},ND=q1,PD=K1,LD=W1,ID=TD,BD=G1,jD=ED,$D=RD,zD=MD,FD=DD,VD="pako inflate (from Nodeca project)",Rn={inflateReset:ND,inflateReset2:PD,inflateResetKeep:LD,inflateInit:ID,inflateInit2:BD,inflate:jD,inflateEnd:$D,inflateGetHeader:zD,inflateSetDictionary:FD,inflateInfo:VD};function UD(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var HD=UD,J1=Object.prototype.toString,{Z_NO_FLUSH:WD,Z_FINISH:qD,Z_OK:Wl,Z_STREAM_END:og,Z_NEED_DICT:sg,Z_STREAM_ERROR:KD,Z_DATA_ERROR:g1,Z_MEM_ERROR:GD}=vo;function Zl(t){this.options=eh.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new B1,this.strm.avail_out=0;let r=Rn.inflateInit2(this.strm,e.windowBits);if(r!==Wl)throw new Error(go[r]);if(this.header=new HD,Rn.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Hl.string2buf(e.dictionary):J1.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=Rn.inflateSetDictionary(this.strm,e.dictionary),r!==Wl)))throw new Error(go[r])}Zl.prototype.push=function(t,e){let r=this.strm,n=this.options.chunkSize,i=this.options.dictionary,o,s,a;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?qD:WD,J1.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=Rn.inflate(r,s),o===sg&&i&&(o=Rn.inflateSetDictionary(r,i),o===Wl?o=Rn.inflate(r,s):o===g1&&(o=sg));r.avail_in>0&&o===og&&r.state.wrap>0&&t[r.next_in]!==0;)Rn.inflateReset(r),o=Rn.inflate(r,s);switch(o){case KD:case g1:case sg:case GD:return this.onEnd(o),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(r.avail_out===0||o===og))if(this.options.to==="string"){let l=Hl.utf8border(r.output,r.next_out),c=r.next_out-l,f=Hl.buf2string(r.output,l);r.next_out=c,r.avail_out=n-c,c&&r.output.set(r.output.subarray(l,l+c),0),this.onData(f)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(o===Wl&&a===0)){if(o===og)return o=Rn.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Zl.prototype.onData=function(t){this.chunks.push(t)};Zl.prototype.onEnd=function(t){t===Wl&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function gg(t,e){let r=new Zl(e);if(r.push(t),r.err)throw r.msg||go[r.err];return r.result}function ZD(t,e){return e=e||{},e.raw=!0,gg(t,e)}var JD=Zl,YD=gg,XD=ZD,QD=gg,eN=vo,tN={Inflate:JD,inflate:YD,inflateRaw:XD,ungzip:QD,constants:eN},{Deflate:rN,deflate:nN,deflateRaw:iN,gzip:oN}=lD,{Inflate:sN,inflate:aN,inflateRaw:lN,ungzip:cN}=tN,fN=rN,uN=nN,hN=iN,dN=oN,pN=sN,mN=aN,gN=lN,yN=cN,bN=vo,yg={Deflate:fN,deflate:uN,deflateRaw:hN,gzip:dN,Inflate:pN,inflate:mN,inflateRaw:gN,ungzip:yN,constants:bN};var on,bg=class{constructor(){R(this,on,new Map)}emit(e,...r){let n=g(this,on).get(e);if(!n?.all?.size)return!1;for(let i of n.all)i(...r),n.once.has(i)&&(n.all.delete(i),n.once.delete(i));return!1}on(e,r){return g(this,on).has(e)||g(this,on).set(e,{all:new Set,once:new Set}),g(this,on).get(e).all.add(r),this}once(e,r){g(this,on).has(e)||g(this,on).set(e,{all:new Set,once:new Set});let n=g(this,on).get(e);return n.all.add(r),n.once.add(r),this}};on=new WeakMap;var kg=class{async get(e,r={}){let n=new Headers;for(let[o,s]of Object.entries(r?.headers??{})){let a=typeof s=="string"?[s]:s;for(let l of a)n.append(o,l)}let i=await fetch(e,{headers:n,redirect:"follow"});if(i.ok)return new Uint8Array(await i.arrayBuffer());throw new Error(`Status code ${i.status}: ${i.ok}`)}},vg=class{on(e,r){return e==="ready"&&r(),this}once(e,r){return e==="ready"&&r(),this}async close(){}},rh=class{states;constructor(){this.states=JSON.parse(localStorage.getItem(rh.LocalStorageKey)??"{}")}saveStates(){localStorage.setItem(rh.LocalStorageKey,JSON.stringify(this.states))}async chmod(e,r){}async getAllFiles(e){return[]}async mkdir(e,r){if(e=Y.ensureEndingSlash(e.toString()),this.states[e])throw new Error(`EEXIST: ${e}`);this.states[e]={type:"directory"},this.saveStates()}async readFile(e){e=e.toString();let r=this.states[e];if(r){if(r.type==="directory")throw new Error(`EISDIR: ${e}`)}else throw new Error(`ENOENT: ${e}`);return new Uint8Array((0,nh.decode)(r.content))}async showFile(e){throw new Error("showFile not supported on browser")}async stat(e){e=e.toString();let r=this.states[e];if(!r)throw new Error(`ENOENT: ${e}`);return{isDirectory:()=>r.type==="directory",isFile:()=>r.type==="file"}}async unlink(e){if(e=e.toString(),!this.states[e])throw new Error(`ENOENT: ${e}`);delete this.states[e],this.saveStates()}watch(e){return new vg}async writeFile(e,r,n){e=e.toString(),typeof r=="string"&&(r=new TextEncoder().encode(r)),r=(0,nh.encode)(r),this.states[e]={type:"file",content:r},this.saveStates()}},th=rh;H(th,"LocalStorageKey","spyglassmc-browser-fs");var wg={archive:{decompressBall(t,e){throw new Error("decompressBall not supported on browser.")},async gunzip(t){return yg.inflate(t)},async gzip(t){return yg.gzip(t)}},crypto:{async getSha1(t){typeof t=="string"&&(t=new TextEncoder().encode(t));let e=await crypto.subtle.digest("SHA-1",t);return kN(new Uint8Array(e))}},downloader:new kg,error:{isKind(t,e){return t instanceof Error&&t.message.startsWith(e)}},event:{EventEmitter:bg},fs:new th};function kN(t){let e="";for(let r of t)e+=r.toString(16).padStart(2,"0");return e}Object.freeze(wg);var Co={};yr(Co,{TypeDefSymbolData:()=>jg,fileModule:()=>rS,module_:()=>nS,registerMcdocBinders:()=>$g});var k5=Object.freeze({is(t){return t?.type==="mcdoc:module"}}),X1=Object.freeze({is(t){return Ya.is(t)||xg.is(t)||So.is(t)||Lg.is(t)||_o.is(t)||oc.is(t)||fh.is(t)}}),xg=Object.freeze({destruct(t){return{attributes:t.children.filter(Mn.is),location:t.children.find(U.is),index:t.children.find(ki.is),target:t.children.find(sn.is),typeParams:t.children.find(ah.is)}},is(t){return t?.type==="mcdoc:dispatch_statement"}}),vt=Object.freeze({is(t){return t?.type==="mcdoc:literal"}}),ki=Object.freeze({destruct(t){return{parallelIndices:t.children.filter(vN.is)}},is(t){return t?.type==="mcdoc:index_body"}}),vN=Object.freeze({is(t){return Sg.is(t)||Jl.is(t)}}),Sg=Object.freeze({is(t){return vt.is(t)||fr.is(t)||et.is(t)||U.is(t)}}),fr=Object.freeze({is(t){return t?.type==="mcdoc:identifier"}}),Jl=Object.freeze({destruct(t){return{keys:t.children.filter(wN.is)}},is(t){return t?.type==="mcdoc:dynamic_index"}}),wN=Object.freeze({is(t){return vt.is(t)||fr.is(t)||et.is(t)}}),sn=Object.freeze({is(t){return xN.is(t)||SN.is(t)||Mg.is(t)||Og.is(t)||Eg.is(t)||Rg.is(t)||Xl.is(t)||Ql.is(t)||So.is(t)||_o.is(t)||ec.is(t)||nc.is(t)||ic.is(t)}}),_g=Object.freeze({destruct(t){return{appendixes:t.children.filter(e=>ki.is(e)||Yl.is(e)),attributes:t.children.filter(Mn.is)}}}),Mn=Object.freeze({destruct(t){return{name:t.children.find(fr.is),value:t.children.find(Q1.is)}},is(t){return t?.type==="mcdoc:attribute"}}),Q1=Object.freeze({is(t){return sn.is(t)||Cg.is(t)}}),Cg=Object.freeze({destruct(t){return{positional:t.children.find(Ag.is),named:t.children.find(Tg.is)}},is(t){return t?.type==="mcdoc:attribute/tree"}}),Ag=Object.freeze({destruct(t){return{values:t.children.filter(Q1.is)}},is(t){return t?.type==="mcdoc:attribute/tree/pos"}}),Tg=Object.freeze({destruct(t){let e={values:[]},r;for(let n of t.children)Ya.is(n)||(fr.is(n)||et.is(n)?r=n:r&&(e.values.push({key:r,value:n}),r=void 0));return e},is(t){return t?.type==="mcdoc:attribute/tree/named"}}),Yl=Object.freeze({destruct(t){return{args:t.children.filter(sn.is)}},is(t){return t?.type==="mcdoc:type_arg_block"}}),xN=Object.freeze({is(t){return t?.type==="mcdoc:type/any"}}),SN=Object.freeze({is(t){return t?.type==="mcdoc:type/boolean"}}),Us=Object.freeze({destruct(t){return tS(t)},is(t){return t?.type==="mcdoc:int_range"}}),Og=Object.freeze({destruct(t){return{value:t.children.find(_N.is)}},is(t){return t?.type==="mcdoc:type/literal"}}),_N=Object.freeze({is(t){return vt.is(t)||xo.is(t)||et.is(t)}}),xo=Object.freeze({destruct(t){return{value:t.children.find(Sr.is),suffix:t.children.find(vt.is)}},is(t){return t?.type==="mcdoc:typed_number"}}),Eg=Object.freeze({destruct(t){return{numericKind:t.children.find(vt.is),valueRange:t.children.find(ih.is)||t.children.find(Us.is)}},is(t){return t?.type==="mcdoc:type/numeric_type"}}),Er="<";function eS(t){let e=t&2?Er:"",r=t&1?Er:"";return`${e}..${r}`}function tS(t){let e,r,n;return t.children.length===1?(e=0,r=n=t.children[0]):t.children.length===3?(e=i(t.children[1]),r=t.children[0],n=t.children[2]):vt.is(t.children[0])?(e=i(t.children[0]),n=t.children[1]):(e=i(t.children[1]),r=t.children[0]),{kind:e,min:r,max:n};function i(o){let s=0;return o.value.startsWith(Er)&&(s|=2),o.value.endsWith(Er)&&(s|=1),s}}var ih=Object.freeze({destruct(t){return tS(t)},is(t){return t?.type==="mcdoc:float_range"}}),Rg=Object.freeze({destruct(t){let e,r,n=!1;for(let i of t.children)vt.is(i)&&i.value==="[]"?n=!0:Us.is(i)&&(n?e=i:r=i);return{arrayKind:t.children.find(vt.is),lengthRange:e,valueRange:r}},is(t){return t?.type==="mcdoc:type/primitive_array"}}),Xl=Object.freeze({destruct(t){return{item:t.children.find(sn.is),lengthRange:t.children.find(Us.is)}},is(t){return t?.type==="mcdoc:type/list"}}),Mg=Object.freeze({destruct(t){return{lengthRange:t.children.find(Us.is)}},is(t){return t?.type==="mcdoc:type/string"}}),Ql=Object.freeze({destruct(t){return{items:t.children.filter(sn.is)}},is(t){return t?.type==="mcdoc:type/tuple"}}),Y1=new Set(["byte","short","int","long","float","double","string"]),So=Object.freeze({kinds:Y1,destruct(t){return{block:t.children.find(oh.is),docComments:t.children.find(Hs.is),enumKind:e(t),identifier:t.children.find(fr.is),keyword:t.children.find(vt.is)};function e(r){for(let n of r.children.filter(vt.is))if(Y1.has(n.value))return n.value}},is(t){return t?.type==="mcdoc:enum"}}),Hs=Object.freeze({asText(t){if(!t)return;let e=t.children.map(r=>r.comment);return e.every(r=>r.length===0||r.startsWith(" "))&&(e=e.map(r=>r.slice(1))),e.join(`
`)},is(t){return t?.type==="mcdoc:doc_comments"}}),oh=Object.freeze({destruct(t){return{fields:t.children.filter(sh.is)}},is(t){return t?.type==="mcdoc:enum/block"}}),sh=Object.freeze({destruct(t){return{attributes:t.children.filter(Mn.is),identifier:t.children.find(fr.is),value:t.children.find(CN.is)}},is(t){return t?.type==="mcdoc:enum/field"}}),CN=Object.freeze({is(t){return xo.is(t)||et.is(t)}}),v5=Object.freeze({is(t){return Mn.is(t)||Hs.is(t)}}),_o=Object.freeze({destruct(t){return{block:t.children.find(lh.is),docComments:t.children.find(Hs.is),identifier:t.children.find(fr.is),keyword:t.children.find(vt.is)}},is(t){return t?.type==="mcdoc:struct"}}),ec=Object.freeze({destruct(t){return{path:t.children.find(tc.is)}},is(t){return t?.type==="mcdoc:type/reference"}}),ah=Object.freeze({destruct(t){return{params:t.children.filter(Dg.is)}},is(t){return t?.type==="mcdoc:type_param_block"}}),Dg=Object.freeze({destruct(t){return{identifier:t.children.find(fr.is)}},is(t){return t?.type==="mcdoc:type_param"}}),tc=Object.freeze({destruct(t){let e=Za(t?.children,-1);return{children:t?.children??[],isAbsolute:t?.isAbsolute,lastIdentifier:fr.is(e)?e:void 0}},is(t){return t?.type==="mcdoc:path"}}),lh=Object.freeze({destruct(t){return{fields:t.children.filter(Ng.is)}},is(t){return t?.type==="mcdoc:struct/block"}}),Ng=Object.freeze({is(t){return Ws.is(t)||ch.is(t)}}),Ws=Object.freeze({destruct(t){return{attributes:t.children.filter(Mn.is),key:t.children.find(Pg.is),type:t.children.find(sn.is),isOptional:t.isOptional}},is(t){return t?.type==="mcdoc:struct/field/pair"}}),Pg=Object.freeze({is(t){return et.is(t)||fr.is(t)||rc.is(t)}}),rc=Object.freeze({destruct(t){return{type:t.children.find(sn.is)}},is(t){return t?.type==="mcdoc:struct/map_key"}}),ch=Object.freeze({destruct(t){return{attributes:t.children.filter(Mn.is),type:t.children.find(sn.is)}},is(t){return t?.type==="mcdoc:struct/field/spread"}}),nc=Object.freeze({destruct(t){return{location:t.children.find(U.is),index:t.children.find(ki.is)}},is(t){return t?.type==="mcdoc:type/dispatcher"}}),ic=Object.freeze({destruct(t){return{members:t.children.filter(sn.is)}},is(t){return t?.type==="mcdoc:type/union"}}),Lg=Object.freeze({destruct(t){return{injection:t.children.find(AN.is)}},is(t){return t?.type==="mcdoc:injection"}}),AN=Object.freeze({is(t){return Ig.is(t)||TN.is(t)}}),Ig=Object.freeze({is(t){return t?.type==="mcdoc:injection/enum"}}),TN=Object.freeze({is(t){return t?.type==="mcdoc:injection/struct"}}),oc=Object.freeze({destruct(t){return{attributes:t.children.filter(Mn.is),docComments:t.children.find(Hs.is),identifier:t.children.find(fr.is),keyword:t.children.find(vt.is),typeParams:t.children.find(ah.is),rhs:t.children.find(sn.is)}},is(t){return t?.type==="mcdoc:type_alias"}}),fh=Object.freeze({destruct(t){return{binding:t.children.find(fr.is),path:t.children.find(tc.is)}},is(t){return t?.type==="mcdoc:use_statement"}});var ON=Object.freeze({is(t){return!!t&&typeof t=="object"&&typeof t.nextAnonymousIndex=="number"}}),jg=Object.freeze({is(t){return!!t&&typeof t=="object"&&typeof t.typeDef=="object"}}),rS=ol.create(async(t,e)=>{let r=$N(e.doc.uri,e);if(!r){e.err.report(y("mcdoc.binder.out-of-root",P(e.doc.uri)),v.Beginning,0);return}let n={...e,moduleIdentifier:r};return nS(t,n)});async function nS(t,e){let r={nextAnonymousIndex:0};e.symbols.query({doc:e.doc,node:t},"mcdoc",e.moduleIdentifier).amend({data:{data:r}}),EN(t,e);for(let n of t.children)switch(n.type){case"mcdoc:dispatch_statement":await RN(n,e);break;case"mcdoc:enum":sS(n,e);break;case"mcdoc:injection":await NN(n,e);break;case"mcdoc:struct":await aS(n,e);break;case"mcdoc:type_alias":await LN(n,e);break;case"mcdoc:use_statement":await IN(n,e);break}}function EN(t,e){Ct(t,()=>!0,X1.is,c=>{switch(c.type){case"mcdoc:enum":r(c);break;case"mcdoc:struct":n(c);break;case"mcdoc:type_alias":i(c);break;case"mcdoc:use_statement":o(c);break}});function r(c){s("enum",c,So.destruct,f=>({typeDef:uS(f,e)}))}function n(c){s("struct",c,_o.destruct,f=>({typeDef:hS(f,e)}))}function i(c){s("type_alias",c,oc.destruct,f=>{let{attributes:u,rhs:h,typeParams:d}=oc.destruct(f);if(!h)return;let p={typeDef:an(h,e)};return d&&iS(c,d,p,e),p.typeDef=zg(p.typeDef,u,e),p})}function o(c){let{binding:f,path:u}=fh.destruct(c);if(!u)return;let{lastIdentifier:h}=tc.destruct(u),d=f??h;d&&e.symbols.query({doc:e.doc,node:c},"mcdoc",`${e.moduleIdentifier}::${d.value}`).ifDeclared(p=>qs(e,p,d)).elseEnter({data:{subcategory:"use_statement_binding",visibility:1},usage:{type:"definition",node:d,fullRange:c}})}function s(c,f,u,h){let{docComments:d,identifier:p,keyword:b}=u(f),m=p?.value??l(f,e);e.symbols.query({doc:e.doc,node:f},"mcdoc",`${e.moduleIdentifier}::${m}`).ifDeclared(k=>qs(e,k,p??f)).elseEnter({data:{data:h(f),desc:Hs.asText(d),subcategory:c},usage:{type:"definition",node:p??b,fullRange:p&&f}})}function a(c,f){let u=f.symbols.query({doc:f.doc,node:c},"mcdoc",f.moduleIdentifier).getData(ON.is);if(!u)throw new Error(`No symbol data for module '${f.moduleIdentifier}'`);return u.nextAnonymousIndex++}function l(c,f){return`<anonymous ${a(c,f)}>`}}function iS(t,e,r,n){t.locals=Object.create(null),r.typeDef={kind:"template",child:r.typeDef,typeParams:[]};let{params:i}=ah.destruct(e);for(let o of i){let{identifier:s}=Dg.destruct(o);if(s.value){let a=`${n.moduleIdentifier}::${s.value}`;n.symbols.query({doc:n.doc,node:t},"mcdoc",a).ifDeclared(l=>qs(n,l,s)).elseEnter({data:{visibility:0},usage:{type:"declaration",node:s,fullRange:o}}),r.typeDef.typeParams.push({path:a})}}}async function RN(t,e){let{attributes:r,location:n,index:i,target:o,typeParams:s}=xg.destruct(t);if(!(n&&i&&o))return;let a=U.toString(n,"full");e.symbols.query(e.doc,"mcdoc/dispatcher",a).enter({usage:{type:"reference",node:n,fullRange:t}});let{parallelIndices:l}=ki.destruct(i);if(l.length){let c={typeDef:an(o,e)};s&&iS(t,s,c,e),c.typeDef=zg(c.typeDef,r,e);for(let f of l)Jl.is(f)||e.symbols.query(e.doc,"mcdoc/dispatcher",a,ac(f)).ifDeclared(u=>qs(e,u,f,{localeString:"mcdoc.binder.dispatcher-statement.duplicated-key"})).elseEnter({data:{data:c},usage:{type:"definition",node:f,fullRange:t}})}await vi(o,e)}async function vi(t,e){if(nc.is(t))await MN(t,e);else if(So.is(t))sS(t,e);else if(Xl.is(t)){let{item:n}=Xl.destruct(t);await vi(n,e)}else if(ec.is(t)){let{path:n}=ec.destruct(t);await oS(n,e)}else if(_o.is(t))await aS(t,e);else if(Ql.is(t)){let{items:n}=Ql.destruct(t);for(let i of n)await vi(i,e)}else if(ic.is(t)){let{members:n}=ic.destruct(t);for(let i of n)await vi(i,e)}let{appendixes:r}=_g.destruct(t);for(let n of r)if(Yl.is(n)){let{args:i}=Yl.destruct(n);for(let o of i)await vi(o,e)}}async function MN(t,e){let{index:r,location:n}=nc.destruct(t),i=U.toString(n,"full");e.symbols.query(e.doc,"mcdoc/dispatcher",i).enter({usage:{type:"reference",node:n,fullRange:t}});let{parallelIndices:o}=ki.destruct(r);for(let s of o)Jl.is(s)||e.symbols.query(e.doc,"mcdoc/dispatcher",i,ac(s)).enter({usage:{type:"reference",node:s,fullRange:t}})}async function oS(t,e){for(let{identifiers:r,node:n,indexRight:i}of lS(t,e,{reportErrors:!0}))if(r?.length){if(i===1){let o=uh(r),s=jN(o,e);if(!s){e.err.report(y("mcdoc.binder.path.unknown-module",P(o)),t,2);return}await e.ensureBindingStarted(s)}e.symbols.query({doc:e.doc,node:n},"mcdoc",uh(r)).ifDeclared((o,s)=>s.enter({usage:{type:"reference",node:n,fullRange:t,skipRenaming:vt.is(n)}})).else(()=>{i===0&&e.err.report(y("mcdoc.binder.path.unknown-identifier",P(Za(r,-1)),P(uh(r.slice(0,-1)))),t,2)})}}function sS(t,e){let{block:r,identifier:n,keyword:i}=So.destruct(t),o=n?.symbol??i.symbol;if(o?.subcategory!=="enum")return;let s=e.symbols.query({doc:e.doc,node:t},"mcdoc",...o.path);nr.assertDefined(s.symbol),DN(r,e,s)}function DN(t,e,r,n={}){let{fields:i}=oh.destruct(t);for(let o of i){let{identifier:s}=sh.destruct(o);r.member(s.value,a=>a.ifDeclared(l=>qs(e,l,s)).elseEnter({usage:{type:"definition",node:s,fullRange:o}}))}}async function NN(t,e){let{injection:r}=Lg.destruct(t);Ig.is(r)}async function aS(t,e){let{block:r,identifier:n,keyword:i}=_o.destruct(t),o=n?.symbol??i.symbol;if(o?.subcategory!=="struct")return;let s=e.symbols.query({doc:e.doc,node:t},"mcdoc",...o.path);nr.assertDefined(s.symbol),await PN(r,e,s)}async function PN(t,e,r,n={}){let{fields:i}=lh.destruct(t);for(let o of i)if(Ws.is(o)){let{key:s,type:a}=Ws.destruct(o);rc.is(s)||r.member(s.value,l=>l.ifDeclared(c=>qs(e,c,s)).elseEnter({usage:{type:"definition",node:s,fullRange:o}})),await vi(a,e)}else{let{type:s}=ch.destruct(o);await vi(s,e)}}async function LN(t,e){let{identifier:r,rhs:n,typeParams:i}=oc.destruct(t);r?.value&&n&&await vi(n,e)}async function IN(t,e){let{path:r}=fh.destruct(t);if(r)return oS(r,e)}function $g(t){t.registerBinder("mcdoc:module",rS)}function qs(t,e,r,n={localeString:"mcdoc.binder.duplicated-declaration"}){t.err.report(y(n.localeString,P(e.identifier)),r,2,{related:[{location:Pe.getDeclaredLocation(e),message:y(`${n.localeString}.related`,P(e.identifier))}]})}function*lS(t,e,r={}){let{children:n,isAbsolute:i}=tc.destruct(t),o=i?[]:e.moduleIdentifier.slice(2).split("::");for(let[s,a]of n.entries()){switch(a.type){case"mcdoc:identifier":o.push(a.value);break;case"mcdoc:literal":if(o.length===0){r.reportErrors&&e.err.report(y("mcdoc.binder.path.super-from-root"),a);return}o.pop();break;default:nr.assertNever(a)}yield{identifiers:o,node:a,index:s,indexRight:n.length-1-s}}}function BN(t,e,r={}){return Za([...lS(t,e,r)],-1)?.identifiers}function jN(t,e){return e.symbols.global.mcdoc?.[t]?.definition?.[0]?.uri}function $N(t,e){return Object.values(e.symbols.global.mcdoc??{}).find(r=>r.subcategory==="module"&&r.definition?.some(n=>n.uri===t))?.identifier}function uh(t){return t?`::${t.join("::")}`:void 0}function an(t,e){switch(t.type){case"mcdoc:enum":return uS(t,e);case"mcdoc:struct":return hS(t,e);case"mcdoc:type/any":return eP(t,e);case"mcdoc:type/boolean":return tP(t,e);case"mcdoc:type/dispatcher":return rP(t,e);case"mcdoc:type/list":return nP(t,e);case"mcdoc:type/literal":return iP(t,e);case"mcdoc:type/numeric_type":return aP(t,e);case"mcdoc:type/primitive_array":return lP(t,e);case"mcdoc:type/string":return cP(t,e);case"mcdoc:type/reference":return fP(t,e);case"mcdoc:type/tuple":return uP(t,e);case"mcdoc:type/union":return hP(t,e);default:return nr.assertNever(t)}}function Ft(t,e,r,n={}){let{attributes:i,appendixes:o}=_g.destruct(t),s=e;for(let a of o)if(ki.is(a)){if(n.skipFirstIndexBody){n.skipFirstIndexBody=!1;continue}s={kind:"indexed",child:s,parallelIndices:fS(a,r)}}else s={kind:"concrete",child:s,typeArgs:WN(a,r)};return s=zg(s,i,r),s}function zg(t,e,r){for(let n of e)t={kind:"attributed",attribute:cS(n,r),child:t};return t}function Fg(t,e){return zN(t.map(r=>cS(r,e)))}function zN(t){return t.length?t:void 0}function cS(t,e){let{name:r,value:n}=Mn.destruct(t);return{name:r.value,value:n&&Bg(n,e)}}function Bg(t,e){return t.type==="mcdoc:attribute/tree"?{kind:"tree",values:FN(t,e)}:an(t,e)}function FN(t,e){let r={},{named:n,positional:i}=Cg.destruct(t);if(i){let{values:o}=Ag.destruct(i);for(let[s,a]of o.entries())r[s]=Bg(a,e)}if(n){let{values:o}=Tg.destruct(n);for(let{key:s,value:a}of o)r[s.value]=Bg(a,e)}return r}function fS(t,e){let{parallelIndices:r}=ki.destruct(t);return r.map(n=>VN(n,e))}function VN(t,e){return Sg.is(t)?UN(t,e):HN(t,e)}function UN(t,e){return{kind:"static",value:ac(t)}}function HN(t,e){let{keys:r}=Jl.destruct(t);return{kind:"dynamic",accessor:r.map(ac)}}function WN(t,e){let{args:r}=Yl.destruct(t);return r.map(n=>an(n,e))}function uS(t,e){let{block:r,enumKind:n,identifier:i}=So.destruct(t),o=i?.symbol??t.symbol;return o&&jg.is(o.data)&&o.data.typeDef.kind==="enum"?o.data.typeDef:Ft(t,{kind:"enum",enumKind:n,values:qN(r,e)},e)}function qN(t,e){let{fields:r}=oh.destruct(t);return r.map(n=>KN(n,e))}function KN(t,e){let{attributes:r,identifier:n,value:i}=sh.destruct(t);return{attributes:Fg(r,e),identifier:n.value,value:GN(i,e)}}function GN(t,e){if(xo.is(t)){let{value:r}=xo.destruct(t);return r.value}return t.value}function hS(t,e){let{block:r,identifier:n}=_o.destruct(t),i=n?.symbol??t.symbol;return i&&jg.is(i.data)&&i.data.typeDef.kind==="struct"?i.data.typeDef:Ft(t,{kind:"struct",fields:ZN(r,e)},e)}function ZN(t,e){let{fields:r}=lh.destruct(t);return r.map(n=>JN(n,e))}function JN(t,e){return Ws.is(t)?YN(t,e):QN(t,e)}function YN(t,e){let{attributes:r,key:n,type:i,isOptional:o}=Ws.destruct(t);return{kind:"pair",attributes:Fg(r,e),key:XN(n,e),type:an(i,e),optional:o}}function XN(t,e){if(rc.is(t)){let{type:r}=rc.destruct(t);return an(r,e)}else return ac(t)}function QN(t,e){let{attributes:r,type:n}=ch.destruct(t);return{kind:"spread",attributes:Fg(r,e),type:an(n,e)}}function eP(t,e){return Ft(t,{kind:"any"},e)}function tP(t,e){return Ft(t,{kind:"boolean"},e)}function rP(t,e){let{index:r,location:n}=nc.destruct(t);return Ft(t,{kind:"dispatcher",parallelIndices:fS(r,e),registry:U.toString(n,"full")},e,{skipFirstIndexBody:!0})}function nP(t,e){let{item:r,lengthRange:n}=Xl.destruct(t);return Ft(t,{kind:"list",item:an(r,e),lengthRange:sc(n,e)},e)}function sc(t,e){if(!t)return;let{kind:r,min:n,max:i}=ih.is(t)?ih.destruct(t):Us.destruct(t);return{kind:r,min:n?.value,max:i?.value}}function iP(t,e){let{value:r}=Og.destruct(t);return Ft(t,{kind:"literal",value:oP(r,e)},e)}function oP(t,e){if(vt.is(t))return{kind:"boolean",value:t.value==="true"};if(xo.is(t)){let{suffix:r,value:n}=xo.destruct(t);return{kind:"number",value:n.value,suffix:sP(r,e)}}else return{kind:"string",value:t.value}}function sP(t,e){return t?.value?.toLowerCase()}function aP(t,e){let{numericKind:r,valueRange:n}=Eg.destruct(t);return Ft(t,{kind:r.value,valueRange:sc(n,e)},e)}function lP(t,e){let{arrayKind:r,lengthRange:n,valueRange:i}=Rg.destruct(t);return Ft(t,{kind:`${r.value}_array`,lengthRange:sc(n,e),valueRange:sc(i,e)},e)}function cP(t,e){let{lengthRange:r}=Mg.destruct(t);return Ft(t,{kind:"string",lengthRange:sc(r,e)},e)}function fP(t,e){let{path:r}=ec.destruct(t);return Ft(t,{kind:"reference",path:uh(BN(r,e))},e)}function uP(t,e){let{items:r}=Ql.destruct(t);return Ft(t,{kind:"tuple",items:r.map(n=>an(n,e))},e)}function hP(t,e){let{members:r}=ic.destruct(t);return Ft(t,{kind:"union",members:r.map(n=>an(n,e))},e)}function ac(t){return U.is(t)?U.toString(t,"short"):t.value}var dP=t=>[Te.create(t,"variable")],pP=t=>[Te.create(t,t.colorTokenType??"literal")];function dS(t){t.registerColorizer("mcdoc:literal",pP),t.registerColorizer("mcdoc:identifier",dP)}var mS=Object.freeze(["fallback","none","unknown"]),E5=Object.freeze({kind:"union",members:[]});var mP=Object.freeze(["b","s","l","f","d"]),gS=Object.freeze([...mP,"B","S","L","F","D"]),Ug=Object.freeze(["byte","short","int","long"]),dh=Object.freeze(["float","double"]),R5=Object.freeze([...Ug,...dh]),Hg=Object.freeze(["byte","int","long"]),M5=Object.freeze(Hg.map(t=>`${t}_array`)),hh;(function(t){function e(r){let n=o=>{if(!o)return"";let{kind:s,min:a,max:l}=o;return a===l?` @ ${a}`:` @ ${a??""}${eS(s)}${l??""}`},i=o=>{let s=[];for(let a of Ve.toArray(o))a===void 0?s.push("()"):s.push(a.kind==="static"?`[${a.value}]`:`[[${a.accessor.map(l=>typeof l=="string"?l:l.keyword).join(".")}]]`);return`[${s.join(", ")}]`};if(r===void 0)return"<unknown>";switch(r.kind){case"any":case"boolean":return r.kind;case"attributed":return`#[${r.attribute.name}${r.attribute.value?"=<value ...>":""}] ${e(r.child)}`;case"byte":return`byte${n(r.valueRange)}`;case"byte_array":return`byte${n(r.valueRange)}[]${n(r.lengthRange)}`;case"concrete":return`${e(r.child)}${r.typeArgs.length?`<${r.typeArgs.map(e).join(", ")}>`:""}`;case"dispatcher":return`${r.registry??"spyglass:unknown"}[${i(r.parallelIndices)}]`;case"double":return`double${n(r.valueRange)}`;case"enum":return"<enum ...>";case"float":return`float${n(r.valueRange)}`;case"indexed":return`${e(r.child)}${i(r.parallelIndices)}`;case"int":return`int${n(r.valueRange)}`;case"int_array":return`int${n(r.valueRange)}[]${n(r.lengthRange)}`;case"list":return`[${e(r.item)}]${n(r.lengthRange)}`;case"literal":return`${r.value}`;case"long":return`long${n(r.valueRange)}`;case"long_array":return`long${n(r.valueRange)}[]${n(r.lengthRange)}`;case"reference":return r.path??"<unknown_reference>";case"short":return`short${n(r.valueRange)}`;case"string":return`string${n(r.lengthRange)}`;case"struct":return"<struct ...>";case"template":return`${e(r.child)}${r.typeParams.length?`<${r.typeParams.map(o=>`?${o.path}`).join(", ")}>`:""}`;case"tuple":return`[${r.items.map(o=>e(o)).join(",")}${r.items.length===1?",":""}]`;case"union":return`(${r.members.map(e).join(" | ")})`;case"unsafe":return"unsafe";default:return nr.assertNever(r)}}t.toString=e})(hh||(hh={}));var nt;(function(t){t[t.Nah=0]="Nah",t[t.Assignable=1]="Assignable",t[t.StrictlyAssignable=3]="StrictlyAssignable"})(nt||(nt={}));var lc=(t,e)=>{if(!e)return!0;if(!t)return!1;let{min:r,max:n}=t,{min:i,max:o}=e;return(i===void 0||r!==void 0&&r>=i)&&(o===void 0||n!==void 0&&n<=o)},Gs=t=>{let e=new Set,r=n=>{for(let i of e){if((Ks(n,i)&nt.StrictlyAssignable)===nt.StrictlyAssignable)return;(Ks(i,n)&nt.StrictlyAssignable)===nt.StrictlyAssignable&&e.delete(i)}e.add(n)};for(let n of t.members)n.kind==="union"?Gs(n).members.forEach(r):r(n);return{kind:"union",members:[...e]}};var gP=t=>(t=Gs(t),t.members.length===1?t.members[0]:t),cc=t=>({kind:"list",item:Vg(t.item),...t.lengthRange?{lengthRange:{...t.lengthRange}}:{}}),Vg=t=>(t.kind==="union"?t=gP(t):t.kind==="list"&&(t=cc(t)),t),Ks=(t,e,r=[])=>{let n=s=>s?nt.StrictlyAssignable:nt.Nah,i=s=>s?nt.Assignable:nt.Nah,o;return t=Vg(t),e=Vg(e),t.kind==="any"||t.kind==="reference"||e.kind==="reference"?o=nt.Assignable:e.kind==="any"?o=nt.StrictlyAssignable:t.kind==="union"?o=i(t.members.every(s=>Ks(s,e,r))):e.kind==="union"?o=i(e.members.some(s=>Ks(t,s))):t.kind==="boolean"?o=n(e.kind==="boolean"||e.kind==="byte"):t.kind==="byte"?e.kind==="boolean"?o=Ks(t,{kind:"byte",valueRange:{kind:0,min:0,max:1}},r):e.kind==="byte"?o=n(lc(t.valueRange,e.valueRange)):e.kind==="enum"?o=i(!e.enumKind||e.enumKind==="byte"):o=nt.Nah:t.kind==="byte_array"||t.kind==="int_array"||t.kind==="long_array"?o=n(e.kind===t.kind&&lc(t.lengthRange,e.lengthRange)&&lc(t.valueRange,e.valueRange)):t.kind==="struct"||t.kind==="dispatcher"?o=i(e.kind==="struct"||e.kind==="dispatcher"):t.kind==="enum"?o=i((e.kind==="byte"||e.kind==="float"||e.kind==="double"||e.kind==="int"||e.kind==="long"||e.kind==="short"||e.kind==="string")&&(!t.enumKind||t.enumKind===e.kind)):t.kind==="float"||t.kind==="double"||t.kind==="int"||t.kind==="long"||t.kind==="short"?e.kind===t.kind?o=n(lc(t.valueRange,e.valueRange)):e.kind==="enum"?o=i(!e.enumKind||e.enumKind===t.kind):o=nt.Nah:t.kind==="list"?e.kind==="list"&&lc(t.lengthRange,e.lengthRange)?o=Ks(t.item,e.item,r):o=nt.Nah:t.kind==="string"?e.kind==="string"?o=nt.StrictlyAssignable:o=i(e.kind==="enum"&&(!e.enumKind||e.enumKind==="string")):o=nt.Nah,o||r.push(y("mcdoc.checker.type-not-assignable",P(hh.toString(t)),P(hh.toString(e)))),o};var _S=Is(El({singleLinePrefixes:new Set(["//"])}),(t,e)=>!e.slice(t).startsWith("///"),y("mcdoc.parser.syntax.doc-comment-unexpected"));function CS(t=!1){return(e,r)=>{let n=[];for(e.skipWhitespace();e.canRead()&&e.peek(2)==="//"&&(!t||e.peek(3)!=="///");){let i=_S(e,r);n.push(i),e.skipWhitespace()}return n}}function z(t,e=!1){return(r,n)=>{r.skipWhitespace();let i=be(t,CS(e))(r,n);return r.skipWhitespace(),i}}function Mr(t,e=!1){return Ls(t,CS(e))}function Rr(t,e){return(r,n)=>{let i={type:"mcdoc:literal",range:v.create(r),value:"",colorTokenType:e?.colorTokenType};return i.value=r.readIf(o=>e?.allowedChars?.has(o)??(e?.specialChars?.has(o)||/[a-z]/i.test(o))),i.range.end=r.cursor,Ve.toArray(t).every(o=>o!==i.value)&&n.err.report(y("expected-got",vn(t),P(i.value)),i),i}}function Et(t,e={colorTokenType:"keyword"}){return(r,n)=>{let i=Rr(t,e)(r,n);return Ve.toArray(t).includes(i.value)?i:V}}function Q(t){return(e,r)=>{e.skipWhitespace(),e.trySkip(t)||r.err.report(y("expected-got",P(t),P(e.peek())),e)}}function fe(t){return(e,r)=>{if(e.skipWhitespace(),!e.trySkip(t))return V}}function Wg(t){return Is(Oe(t),e=>e.namespace!==void 0,y("mcdoc.parser.resource-location.colon-expected",P(q.NamespacePathSep)))}var yP=Object.freeze(["\0","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","","","\x7F"]),Zs=Tn(dt({escapable:{characters:["b","f","n","r","t","\\",'"'],unicode:!0},quotes:['"']}),...yP),ur=(t,e)=>{let r=/^[\p{L}\p{Nl}]$/u,n=/^[\p{L}\p{Nl}\u200C\u200D\p{Mn}\p{Mc}\p{Nd}\p{Pc}]$/u,i=new Set(["any","boolean","byte","double","enum","false","float","int","long","short","string","struct","super","true"]),o={type:"mcdoc:identifier",range:v.create(t),options:{category:"mcdoc"},value:""},s=t.innerCursor;if(r.test(t.peek()))for(t.skip();n.test(t.peek());)t.skip();else e.err.report(y("expected",y("mcdoc.node.identifier")),t);return o.value=t.string.slice(s,t.innerCursor),o.range.end=t.cursor,i.has(o.value)&&e.err.report(y("mcdoc.parser.identifier.reserved-word",P(o.value)),o),o};function qg(t){let e=ne([{prefix:"%",parser:Rr(["%key","%parent"],{specialChars:new Set(["%"])})},{prefix:'"',parser:Zs},{parser:ur}]),r=se("mcdoc:dynamic_index",z([Q("["),e,Ls(be([fe("."),e])),Q("]")])),n=ne([{prefix:"%",parser:Rr(mS.map(i=>`%${i}`),{specialChars:new Set(["%"])})},{prefix:'"',parser:Zs},{prefix:"[",parser:t?.noDynamic?Is(r,()=>!1,y("mcdoc.parser.index-body.dynamic-index-not-allowed")):r},{parser:ar([Wg({category:"mcdoc/dispatcher",accessType:t?.accessType}),ur])}]);return se("mcdoc:index_body",z([Q("["),n,Mr(z([fe(","),oe(n)])),ke(fe(",")),Q("]")]))}var yS=ne([{prefix:"super",parser:Rr("super")},{parser:ur}]),mh=(t,e)=>{let r;return t.trySkip("::")&&(r=!0),J(be([yS,Ls(be([fe("::"),yS]))]),n=>({type:"mcdoc:path",children:n.children,range:n.range,isAbsolute:r}))(t,e)},bS=se("mcdoc:attribute/tree/pos",z([{get:()=>ph},Mr(z([fe(","),{get:()=>oe(ph)}],!0),!0)],!0)),kS=z([ne([{prefix:'"',parser:Zs},{parser:ur}]),ne([{prefix:"=",parser:z([Q("="),{get:()=>ph}],!0)},{parser:{get:()=>Kg}}])],!0),vS=se("mcdoc:attribute/tree/named",z([kS,Mr(z([fe(","),oe(kS)],!0),!0)],!0)),bP=ar([z([vS,ke(fe(","))]),z([bS,Q(","),vS,ke(fe(","))]),z([bS,ke(fe(","))])]),kP=Object.freeze({"(":")","[":"]","{":"}"}),Kg=(t,e)=>{let r=t.trySkip("(")?"(":t.trySkip("[")?"[":t.trySkip("{")?"{":void 0;if(!r)return V;let n=bP(t,e),i={type:"mcdoc:attribute/tree",range:n.range,children:n.children,delim:r};return t.trySkip(kP[r]),i},ph=ne([{predicate:t=>["(","[","{"].includes(t.peek()),parser:Kg},{parser:{get:()=>Ot}}]),vP=se("mcdoc:attribute",z([fe("#["),ur,ne([{prefix:"=",parser:z([Q("="),ph,Q("]")],!0)},{predicate:t=>["(","[","{"].includes(t.peek()),parser:z([Kg,Q("]")],!0)},{parser:Q("]")}])],!0)),gh=Ls(vP),wS=se("mcdoc:type_param",z([ur])),wP=se("mcdoc:type_param_block",z([Q("<"),ne([{prefix:">",parser:Q(">")},{parser:z([wS,Mr(z([fe(","),oe(wS)])),ke(fe(",")),Q(">")])}])])),Gg=()=>{},AS=ne([{prefix:"<",parser:wP},{parser:Gg}]),xP=se("mcdoc:dispatch_statement",z([gh,Et("dispatch"),Wg({category:"mcdoc/dispatcher",accessType:1}),qg({noDynamic:!0}),AS,Rr("to"),{get:()=>Ot}],!0)),SP=El({singleLinePrefixes:new Set(["///"]),includesEol:!0}),_P=se("mcdoc:doc_comments",Ls(SP,t=>(t.skipWhitespace(),[]))),uc=z([ke(oe(_P)),gh]),TS=Rr(["byte","short","int","long","string","float","double"],{colorTokenType:"type"}),OS=en({pattern:/^[-+]?(?:[0-9]+(?:[eE][-+]?[0-9]+)?|[0-9]*\.[0-9]+(?:[eE][-+]?[0-9]+)?)$/}),ES=se("mcdoc:typed_number",be([OS,ke(Et(gS,{colorTokenType:"keyword"}))])),CP=ne([{prefix:'"',parser:Zs},{parser:ES}]),xS=se("mcdoc:enum/field",z([uc,ur,Q("="),CP],!0)),RS=se("mcdoc:enum/block",z([Q("{"),ne([{prefix:"}",parser:Q("}")},{parser:z([xS,Mr(z([fe(","),oe(xS)],!0),!0),ke(fe(",")),Q("}")],!0)}])],!0)),MS=se("mcdoc:enum",z([uc,Et("enum"),Q("("),TS,Q(")"),ke(Ol(ur)),RS],!0)),AP=se("mcdoc:struct/map_key",z([Q("["),{get:()=>Ot},Q("]")],!0)),TP=ne([{prefix:'"',parser:Zs},{prefix:"[",parser:AP},{parser:ur}]),OP=(t,e)=>{let r,n=z([uc,TP],!0)(t,e);t.trySkip("?")&&(r=!0);let i=z([Q(":"),{get:()=>Ot}],!0)(t,e);return{type:"mcdoc:struct/field/pair",children:[...n.children,...i.children],range:v.span(n,i),isOptional:r}},EP=se("mcdoc:struct/field/spread",z([gh,fe("..."),{get:()=>Ot}],!0)),SS=ar([EP,OP]),DS=se("mcdoc:struct/block",z([Q("{"),ne([{prefix:"}",parser:Q("}")},{parser:z([SS,Mr(z([fe(","),oe(SS)],!0),!0),ke(fe(",")),Q("}")],!0)}])],!0)),NS=se("mcdoc:struct",z([uc,Et("struct"),ke(oe(ur)),DS],!0)),RP=se("mcdoc:injection/enum",z([Rr("enum"),Q("("),TS,Q(")"),mh,RS])),MP=se("mcdoc:injection/struct",z([Rr("struct"),mh,DS])),DP=se("mcdoc:injection",z([Et("inject"),ne([{prefix:"enum",parser:RP},{parser:MP}])])),NP=se("mcdoc:type_alias",z([uc,Et("type"),ur,AS,Q("="),{get:()=>Ot}],!0)),PP=se("mcdoc:use_statement",z([Et("use"),mh,ne([{prefix:"as",parser:z([Rr("as"),ur])},{parser:Gg}])],!0)),LP=ar([_S,xP,MS,DP,NS,NP,PP]),PS=se("mcdoc:module",Mr(LP,!0)),IP=se("mcdoc:type_arg_block",z([fe("<"),ne([{prefix:">",parser:Q(">")},{parser:z([{get:()=>Ot},Mr(z([fe(","),{get:()=>oe(Ot)}],!0),!0),ke(fe(",")),Q(">")],!0)}])]));function Dr(t,e){return se(t,z([gh,e,Mr(ne([{prefix:"<",parser:IP},{parser:Ol(qg())}]))],!0))}var BP=Dr("mcdoc:type/any",Et("any",{colorTokenType:"type"})),jP=Dr("mcdoc:type/boolean",Et("boolean",{colorTokenType:"type"})),$P=Ar({pattern:/^(?:0|[-+]?[1-9][0-9]*)$/});function LS(t,e){let r=i=>i.tryPeek("..")||i.tryPeek(`${Er}..`),n=Rr(["..",`..${Er}`,`${Er}..`,`${Er}..${Er}`],{allowedChars:new Set([".",Er])});return se(t,ne([{predicate:r,parser:be([n,e])},{parser:be([Tn(e,".."),ne([{predicate:r,parser:be([n,ke(oe(e))])},{parser:Gg}])])}]))}var zP=LS("mcdoc:int_range",$P),fc=ke((t,e)=>t.trySkip("@")?(t.skipWhitespace(),zP(t,e)):V),FP=Dr("mcdoc:type/string",z([Et("string",{colorTokenType:"type"}),fc])),VP=Dr("mcdoc:type/literal",ne([{predicate:t=>t.tryPeek("false")||t.tryPeek("true"),parser:Et(["false","true"],{colorTokenType:"type"})},{prefix:'"',parser:oe(Zs)},{parser:Ol(ES)}])),UP=LS("mcdoc:float_range",OS),HP=ke((t,e)=>t.trySkip("@")?(t.skipWhitespace(),UP(t,e)):V),WP=Dr("mcdoc:type/numeric_type",ne([{predicate:t=>dh.some(e=>t.tryPeek(e)),parser:z([Et(dh,{colorTokenType:"type"}),HP])},{parser:z([Et(Ug,{colorTokenType:"type"}),fc])}])),qP=Dr("mcdoc:type/primitive_array",z([Rr(Hg),fc,Et("[]",{allowedChars:new Set(["[","]"]),colorTokenType:"type"}),fc])),KP=Dr("mcdoc:type/list",z([fe("["),{get:()=>Ot},Q("]"),fc],!0)),GP=Dr("mcdoc:type/tuple",z([fe("["),{get:()=>Ot},fe(","),ne([{prefix:"]",parser:Q("]")},{parser:z([{get:()=>Ot},Mr(z([fe(","),{get:()=>oe(Ot)}],!0),!0),ke(fe(",")),Q("]")],!0)}])],!0)),ZP=Dr("mcdoc:type/dispatcher",z([Ol(Wg({category:"mcdoc/dispatcher"})),qg()])),JP=Dr("mcdoc:type/union",z([fe("("),ne([{prefix:")",parser:Q(")")},{parser:z([{get:()=>Ot},Mr(z([fe("|"),{get:()=>oe(Ot)}],!0),!0),ke(fe("|")),Q(")")],!0)}])])),YP=Dr("mcdoc:type/reference",z([mh])),Ot=ar([BP,jP,ZP,MS,KP,VP,WP,qP,FP,NS,GP,JP,YP]);function IS(t){return`::${t.join("::")}`}var Js=".mcdoc",BS="mcdoc/",jS=(t,e)=>{let r=[];for(let n of t){if(!n.endsWith(Js))continue;let i=Y.getRel(n,e.roots);i&&(i=i.slice(0,-Js.length).replace(/(^|\/)mod$/,""),r.push([n,i]))}r.every(([n,i])=>i.startsWith(BS))&&(r=r.map(([n,i])=>[n,i.slice(BS.length)]));for(let[n,i]of r)e.symbols.query(n,"mcdoc",IS(i.split("/"))).ifKnown(()=>{}).elseEnter({data:{subcategory:"module"},usage:{type:"definition"}})},$S=(t,e,r)=>t.endsWith(Js)&&!e.endsWith(Js)?-1:!t.endsWith(Js)&&e.endsWith(Js)?1:r(t,e);var zS=({meta:t})=>{t.registerLanguage("mcdoc",{extensions:[".mcdoc"],parser:PS}),t.registerUriBinder(jS),t.setUriSorter($S),$g(t),dS(t)};function FS(t){t.registerColorizer("nbt:byte",Le.number),t.registerColorizer("nbt:short",Le.number),t.registerColorizer("nbt:int",Le.number),t.registerColorizer("nbt:long",Le.number),t.registerColorizer("nbt:float",Le.number),t.registerColorizer("nbt:double",Le.number)}var ln={};yr(ln,{byteArray:()=>Yg,compound:()=>wi,entry:()=>xi,intArray:()=>Xg,list:()=>Jg,longArray:()=>Qg,path:()=>ey,primitive:()=>Ao,string:()=>Zg});function hr(t){return y(`nbt.node.${t.replace(/^nbt:/,"")}`)}var wi=(t,e)=>se("nbt:compound",Tr({start:"{",pair:{key:oe(dt({...ui,colorTokenType:"property"})),sep:":",value:xi,end:",",trailingEnd:!1},end:"}"}))(t,e);var US=(2-2**-23)*2**127,eL=[{pattern:/^[-+]?(?:0|[1-9][0-9]*)b$/i,type:"nbt:byte",hasSuffix:!0,group:2,min:-128,max:127},{pattern:/^[-+]?(?:0|[1-9][0-9]*)s$/i,type:"nbt:short",hasSuffix:!0,group:2,min:-32768,max:32767},{pattern:/^[-+]?(?:0|[1-9][0-9]*)$/,type:"nbt:int",hasSuffix:!1,group:2,min:-2147483648,max:2147483647},{pattern:/^[-+]?(?:0|[1-9][0-9]*)l$/i,type:"nbt:long",hasSuffix:!0,group:3,min:-9223372036854775808n,max:9223372036854775807n},{pattern:/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?f$/i,type:"nbt:float",hasSuffix:!0,group:1,min:-US,max:US},{pattern:/^[-+]?(?:[0-9]+\.|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?$/i,type:"nbt:double",hasSuffix:!1,group:1,min:-Number.MAX_VALUE,max:Number.MAX_VALUE},{pattern:/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?d$/i,type:"nbt:double",hasSuffix:!0,group:1,min:-Number.MAX_VALUE,max:Number.MAX_VALUE},{pattern:/^true$/i,type:"nbt:byte",value:1,group:0},{pattern:/^false$/i,type:"nbt:byte",value:0,group:0}],Zg=ho,Ao=(t,e)=>{if(_e.isBrigadierQuote(t.peek()))return Zg(t,e);let{result:r,updateSrcAndCtx:n}=zt(Zg,t,e);for(let i of eL)if(i.pattern.test(r.value)){if(i.group===0){let f={type:"nbt:byte",range:r.range,value:i.value};return n(),f}let o=!1,s=()=>o=!0,a=i.group===2?Ar({pattern:/./,min:i.min,max:i.max,onOutOfRange:s}):i.group===3?Rl({pattern:/./,min:i.min,max:i.max,onOutOfRange:s}):en({pattern:/./,min:i.min,max:i.max,onOutOfRange:s}),{result:l,updateSrcAndCtx:c}=zt(a,t,e);if(o){e.err.report(y("nbt.parser.number.out-of-range",hr(i.type),y("nbt.node.string"),i.min,i.max),r,2);break}return c(),i.hasSuffix&&(t.skip(),l.range.end++),{...l,type:i.type}}return n(),r};var xi=(t,e)=>oe(ne([{predicate:r=>r.tryPeek("[B;"),parser:Yg},{predicate:r=>r.tryPeek("[I;"),parser:Xg},{predicate:r=>r.tryPeek("[L;"),parser:Qg},{predicate:r=>r.tryPeek("["),parser:Jg},{predicate:r=>r.tryPeek("{"),parser:wi},{parser:Ao}]))(t,e);var Jg=(t,e)=>{let n=fi({start:"[",value:xi,sep:",",trailingSep:!1,end:"]"})(t,e);if(n.type="nbt:list",n.valueType=n.children[0]?.value?.type,n.valueType)for(let{value:i}of n.children)i&&i.type!==n.valueType&&e.err.report(y("expected-got",hr(n.valueType),hr(i.type)),i);return n},Yg=(t,e)=>{let n=fi({start:"[B;",value:Ao,sep:",",trailingSep:!1,end:"]"})(t,e);n.type="nbt:byte_array";for(let{value:i}of n.children)i&&i.type!=="nbt:byte"&&e.err.report(y("expected-got",y("nbt.node.byte"),hr(i.type)),i);return n},Xg=(t,e)=>{let n=fi({start:"[I;",value:Ao,sep:",",trailingSep:!1,end:"]"})(t,e);n.type="nbt:int_array";for(let{value:i}of n.children)i&&i.type!=="nbt:int"&&e.err.report(y("expected-got",y("nbt.node.int"),hr(i.type)),i);return n},Qg=(t,e)=>{let n=fi({start:"[L;",value:Ao,sep:",",trailingSep:!1,end:"]"})(t,e);n.type="nbt:long_array";for(let{value:i}of n.children)i&&i.type!=="nbt:long"&&e.err.report(y("expected-got",y("nbt.node.long"),hr(i.type)),i);return n};var ey=(t,e)=>{let r={type:"nbt:path",children:[],range:v.create(t)},n=["filter","key"],i=HS(t),o;for(;o!==t.cursor&&(n.includes(i)||e.err.report(y("expected-got",vn(n.map(WS),!1,"or"),WS(i)),t),i!=="end");)o=t.cursor,n=iL[i](r.children,t,e),i=HS(t);return r.range.end=t.cursor,r},tL=(t,e,r)=>(t.push(wi(e,r)),e.trySkip(".")?["key"]:["end"]),rL=(t,e,r)=>{let n={type:"nbt:path/index",children:void 0,range:v.create(e)};if(!e.trySkip("["))throw new Error(`NBT path index parser called at illegal position: \u201C${e.peek()}\u201D at ${e.cursor}`);e.skipSpace();let i=e.peek();return i==="{"?n.children=[wi(e,r)]:i!=="]"&&(n.children=[Ar({pattern:/^-?\d+$/})(e,r)]),e.skipSpace(),e.trySkip("]")||r.err.report(y("expected-got",P("]"),P(e.peek())),e),n.range.end=e.cursor,t.push(n),e.trySkip(".")?["index","key"]:["end","index"]},nL=(t,e,r)=>{let n=dt({colorTokenType:"property",escapable:{},quotes:['"'],unquotable:{blockList:new Set([`
`,"\r","	"," ",'"',"[","]",".","{","}"])}})(e,r);return t.push(n),e.trySkip(".")?["index","key"]:["end","filter","index"]};function HS(t){switch(t.peek()){case"":case" ":case`
`:case"\r":return"end";case"{":return"filter";case"[":return"index";default:return"key"}}function WS(t){return y(`nbt.node.path.${t}`)}var iL={filter:tL,index:rL,key:nL};var it={};yr(it,{blockStates:()=>gy,compound:()=>QS,definition:()=>XS,enum_:()=>lL,fieldValue:()=>dc,index:()=>YS,path:()=>cL});var qS;(function(t){function e(r){return ty.is(r)||Nr.is(r)||uy.is(r)}t.is=e})(qS||(qS={}));var ty;(function(t){function e(r){return ry.is(r)||et.is(r)}t.is=e})(ty||(ty={}));var ry;(function(t){function e(r){return ny.is(r)||ly.is(r)}t.is=e})(ry||(ry={}));var ny;(function(t){function e(r){return iy.is(r)||oy.is(r)||sy.is(r)||ay.is(r)}t.is=e})(ny||(ny={}));var iy;(function(t){function e(r){return r?.type==="nbt:byte"}t.is=e})(iy||(iy={}));var oy;(function(t){function e(r){return r?.type==="nbt:short"}t.is=e})(oy||(oy={}));var sy;(function(t){function e(r){return r?.type==="nbt:int"}t.is=e})(sy||(sy={}));var ay;(function(t){function e(r){return r?.type==="nbt:long"}t.is=e})(ay||(ay={}));var ly;(function(t){function e(r){return cy.is(r)||fy.is(r)}t.is=e})(ly||(ly={}));var cy;(function(t){function e(r){return r?.type==="nbt:float"}t.is=e})(cy||(cy={}));var fy;(function(t){function e(r){return r?.type==="nbt:double"}t.is=e})(fy||(fy={}));var Nr;(function(t){function e(r){return r?.type==="nbt:compound"}t.is=e})(Nr||(Nr={}));var uy;(function(t){function e(r){return hc.is(r)||hy.is(r)}t.is=e})(uy||(uy={}));var hc;(function(t){function e(r){return r?.type==="nbt:list"}t.is=e})(hc||(hc={}));var hy;(function(t){function e(r){return dy.is(r)||py.is(r)||my.is(r)}t.is=e})(hy||(hy={}));var dy;(function(t){function e(r){return r?.type==="nbt:byte_array"}t.is=e})(dy||(dy={}));var py;(function(t){function e(r){return r?.type==="nbt:int_array"}t.is=e})(py||(py={}));var my;(function(t){function e(r){return r?.type==="nbt:long_array"}t.is=e})(my||(my={}));var Ys;(function(t){function e(r){return r?.type==="nbt:path"}t.is=e})(Ys||(Ys={}));var KS;(function(t){function e(r){return r?.type==="nbt:path/index"}t.is=e})(KS||(KS={}));var oL={"minecraft:brain_coral_fan":["minecraft:brain_coral_fan","minecraft:brain_coral_wall_fan"],"minecraft:bubble_coral_fan":["minecraft:bubble_coral_fan","minecraft:bubble_coral_wall_fan"],"minecraft:fire_coral_fan":["minecraft:fire_coral_fan","minecraft:fire_coral_wall_fan"],"minecraft:horn_coral_fan":["minecraft:horn_coral_fan","minecraft:horn_coral_wall_fan"],"minecraft:tube_coral_fan":["minecraft:tube_coral_fan","minecraft:tube_coral_wall_fan"],"minecraft:creeper_head":["minecraft:creeper_head","minecraft:creeper_wall_head"],"minecraft:dragon_head":["minecraft:dragon_head","minecraft:dragon_wall_head"],"minecraft:player_head":["minecraft:player_head","minecraft:player_wall_head"],"minecraft:skeleton_skull":["minecraft:skeleton_skull","minecraft:skeleton_wall_skull"],"minecraft:wither_skeleton_skull":["minecraft:wither_skeleton_skull","minecraft:wither_skeleton_wall_skull"],"minecraft:dead_brain_coral_fan":["minecraft:dead_brain_coral_fan","minecraft:dead_brain_coral_wall_fan"],"minecraft:dead_bubble_coral_fan":["minecraft:dead_bubble_coral_fan","minecraft:dead_bubble_coral_wall_fan"],"minecraft:dead_fire_coral_fan":["minecraft:dead_fire_coral_fan","minecraft:dead_fire_coral_wall_fan"],"minecraft:dead_horn_coral_fan":["minecraft:dead_horn_coral_fan","minecraft:dead_horn_coral_wall_fan"],"minecraft:dead_tube_coral_fan":["minecraft:dead_tube_coral_fan","minecraft:dead_tube_coral_wall_fan"],"minecraft:torch":["minecraft:torch","minecraft:wall_torch"],"minecraft:soul_torch":["minecraft:soul_torch","minecraft:soul_wall_torch"],"minecraft:redstone_torch":["minecraft:redstone_torch","minecraft:redstone_wall_torch"],"minecraft:beetroot_seeds":["minecraft:beetroots"],"minecraft:carrot":["minecraft:carrots"],"minecraft:cocoa_beans":["minecraft:cocoa"],"minecraft:glow_berries":["minecraft:cave_vines"],"minecraft:melon_seeds":["minecraft:melon_stem"],"minecraft:potato":["minecraft:potatoes"],"minecraft:pumpkin_seeds":["minecraft:pumpkin_stem"],"minecraft:redstone":["minecraft:redstone_wire"],"minecraft:string":["minecraft:tripwire"],"minecraft:sweat_berries":["minecraft:sweat_berry_bush"],"minecraft:wheat_seeds":["minecraft:wheat"]};function GS(t){return oL[t]}function ZS(t){if(t==="minecraft:armor_stand")return t;let e=t.match(/^minecraft:([a-z0-9_]+)_spawn_egg$/);if(e)return`minecraft:${e[1]}`}var sL={"::minecraft::block::banner::Banner.CustomName":"mcfunction:component","::minecraft::block::brewingstand::BrewingStand.CustomName":"mcfunction:component","::minecraft::block::commandblock::CommandBlock.Command":"mcfunction:command","::minecraft::block::commandblock::CommandBlock.CustomName":"mcfunction:component","::minecraft::block::container::ContainerBase.CustomName":"mcfunction:component","::minecraft::block::enchantingtable::EnchantingTable.CustomName":"mcfunction:component","::minecraft::block::furnace::Furnace.CustomName":"mcfunction:component","::minecraft::block::hopper::Hopper.CustomName":"mcfunction:component","::minecraft::block::sign::Sign.Text1":"mcfunction:component","::minecraft::block::sign::Sign.Text2":"mcfunction:component","::minecraft::block::sign::Sign.Text3":"mcfunction:component","::minecraft::block::sign::Sign.Text4":"mcfunction:component","::minecraft::entity::effectcloud::EffectCloud.Particle":"mcfunction:particle","::minecraft::entity::minecart::CommandMinecart.Command":"mcfunction:command","::minecraft::entity::mob::LivingEntity.Team":"mcfunction:team","::minecraft::entity::EntityBase.Tags[]":"mcfunction:tag","::minecraft::item::blockitem::BlockItem.CanPlaceOn[]":"mcfunction:block_predicate","::minecraft::item::book::WrittenBook.pages[]":"mcfunction:component","::minecraft::item::ItemBase.CanDestroy[]":"mcfunction:block_predicate"};function JS(t){return sL[t]}function YS(t,e,r={}){switch(t){case"custom:blockitemstates":let n=GS(e);return n?gy(n,r):tt.noop;case"custom:blockstates":return gy([e],r);case"custom:spawnitemtag":let i=ZS(e);return i?YS("entity_type",i,r):tt.noop;default:let o=aL(t);return o?(s,a)=>{XS(o,r)(s,a)}:tt.noop}}function aL(t){switch(t){case"block":return"::java::server::world::block::BlockEntity";case"entity_type":return"::java::server::world::entity::AnyEntity";case"item":return"::java::server::world::item::AnyItem";default:return}}function XS(t,e={}){return(r,n)=>{let o=n.symbols.query(n.doc,"mcdoc",t).getData(Co.TypeDefSymbolData.is)?.typeDef;if(o)switch(o.kind){case"struct":QS(o,e)(r,n);break;default:n.logger.error(`[nbt.checker.definition] Expected a struct type, but got ${o.kind}`)}}}function gy(t,e={}){return(r,n)=>{let i=Ga("block",t,n);for(let{key:o,value:s}of r.children)if(!(!o||!s)){if(s.type==="nbt:byte"&&(n.src.slice(s.range).toLowerCase()==="false"||n.src.slice(s.range).toLowerCase()==="true")){n.err.report(y("nbt.checker.block-states.fake-boolean"),s,2);continue}else if(s.type!=="string"&&s.type!=="nbt:int"){n.err.report(y("nbt.checker.block-states.unexpected-value-type"),s,2);continue}if(Object.keys(i).includes(o.value)){let a=i[o.value];a.includes(s.value.toString())||n.err.report(y("expected-got",a,P(s.value.toString())),s,2)}else n.err.report(y("nbt.checker.block-states.unknown-state",P(o.value),t),o,2)}}}function QS(t,e={}){return(r,n)=>{for(let{key:i,value:o}of r.children){if(!i||!o)continue;let s=i.value,a=t.fields.find(l=>l.kind==="pair"&&l.key===s);a?dc(a.type,e)(o,n):e.allowUnknownKey||n.err.report(y("unknown-key",P(s)),i,2)}}}function lL(t,e={}){return t?(r,n)=>{}:tt.noop}function cL(t,e){return(r,n)=>{}}function dc(t,e){let r=(i,{kind:o,min:s=-1/0,max:a=1/0})=>{let l=(c,f,u)=>u?c<f:c<=f;return l(s,i,o&2)&&l(i,a,o&1)},n={boolean:"nbt:byte",byte:"nbt:byte",byte_array:"nbt:byte_array",double:"nbt:double",float:"nbt:float",int:"nbt:int",int_array:"nbt:int_array",list:"nbt:list",long:"nbt:long",long_array:"nbt:long_array",short:"nbt:short",string:"string",struct:"nbt:compound",tuple:"nbt:list"};return(i,o)=>{if(t.kind!=="any"&&t.kind!=="dispatcher"&&t.kind!=="enum"&&t.kind!=="literal"&&t.kind!=="reference"&&t.kind!=="union"&&t.kind!=="attributed"&&t.kind!=="unsafe"&&t.kind!=="concrete"&&t.kind!=="indexed"&&t.kind!=="template"&&i.type!==n[t.kind]){o.err.report(y("expected",hr(n[t.kind])),i,2);return}switch(t.kind){case"boolean":i=i,i.value!==0&&i.value!==1&&o.err.report(y("nbt.checker.boolean.out-of-range",P("0b"),P("1b")),i,2);break;case"byte_array":case"int_array":case"long_array":if(i=i,t.lengthRange&&!r(i.children.length,t.lengthRange)&&o.err.report(y("expected",y("nbt.checker.collection.length-between",hr(i.type),t.lengthRange.min??"-\u221E",t.lengthRange.max??"+\u221E")),i,2),t.valueRange)for(let{value:l}of i.children)l&&!r(Number(l.value),t.valueRange)&&o.err.report(y("number.between",t.valueRange.min??"-\u221E",t.valueRange.max??"+\u221E"),i,2);break;case"byte":case"short":case"int":case"long":case"float":case"double":i=i,t.valueRange&&!r(Number(i.value),t.valueRange)&&o.err.report(y("number.between",t.valueRange.min??"-\u221E",t.valueRange.max??"+\u221E"),i,2);break;case"dispatcher":i=i;break;case"list":i=i,t=cc(t),t.lengthRange&&!r(i.children.length,t.lengthRange)&&o.err.report(y("expected",y("nbt.checker.collection.length-between",hr(i.type),t.lengthRange.min??"-\u221E",t.lengthRange.max??"+\u221E")),i,2);for(let{value:l}of i.children)l&&dc(t.item,e)(l,o);break;case"string":i=i;let s="",a=i;if(fu.is(i.parent)&&hc.is(i.parent.parent)&&(s="[]",a=i.parent.parent),kn.is(a.parent)){let l=a.parent.key?.symbol?.parentSymbol?.path.join("::"),c=a.parent.key?.value,f=`${l}.${c}${s}`,u=JS(f);if(u)try{let h=o.meta.getParser(u),d=uo(h,i.value,i.valueMap,o);d!==V&&(i.children=[d],d.parent=i)}catch(h){o.logger.error("[nbt.checker.fieldValue#string]",h)}}break;case"reference":i=i;break;case"union":t=Gs(t),t.members.length===0?o.err.report(y("nbt.checker.compound.field.union-empty-members"),kn.is(i.parent)?i.parent.key??i.parent:i,2):tt.any(t.members.map(l=>dc(l,e)))(i,o);break;case"attributed":dc(t.child,e)(i,o);break}}}var e_=({meta:t})=>{t.registerLanguage("nbt",{extensions:[".snbt"],parser:xi}),t.registerParser("nbt:entry",xi),t.registerParser("nbt:compound",wi),t.registerParser("nbt:path",ey),FS(t)};var Vt;(function(t){function e(r,n){return Math.sign(Number(r.slice(2))-Number(n.slice(2)))}t.cmp=e})(Vt||(Vt={}));var by={5:/^1\.15.*$/,6:/^1\.16.*$/,7:/^1\.17.*$/,8:/^1\.18(\.1)?$/,9:/^1\.18.*$/,10:/^1\.19.*$/},bh;(function(t){function e(r){let n=r?.pack?.pack_format?.toString();if(!n)throw new Error("\u201Cpack.pack_format\u201D undefined");if(!Object.keys(by).includes(n))throw new Error(`Unknown pack_format \u201C${n}\u201D`)}t.assert=e})(bh||(bh={}));function t_(t,{packMcmeta:e,versions:r}){function n(i){i<0&&(i=0);let o=r[i];return{id:o.id,name:o.name,release:o.release_target??"1.99",isLatest:i===0}}if(r.length===0)throw new Error("mcmeta version list is empty");if(t=t.toLowerCase(),r=r.sort((i,o)=>o.data_version-i.data_version),t==="auto"){if(e){let i=by[e.pack.pack_format];if(i)return n(r.findIndex(o=>i.test(o.release_target)))}return n(0)}else{if(t==="latest release")return n(r.findIndex(i=>i.type==="release"));if(t==="latest snapshot")return n(r.findIndex(i=>i.type==="snapshot"))}return n(r.findIndex(i=>t===i.id.toLowerCase()||t===i.name.toLowerCase()))}var fL={fastly:"https://fastly.jsdelivr.net/gh/${user}/${repo}@${tag}/${path}",github:"https://raw.githubusercontent.com/${user}/${repo}/${tag}/${path}",jsdelivr:"https://cdn.jsdelivr.net/gh/${user}/${repo}@${tag}/${path}"};function r_(t,e,r){let n=e?"summary":`${t}-summary`;function i(o){let a=(fL[r.toLowerCase()]??r).replace(/\${user}/g,"misode").replace(/\${repo}/g,"mcmeta").replace(/\${tag}/g,n).replace(/\${path}/g,o);if(!Aw.is(a))throw new Error(`Expected a remote URI from data source template but got ${a}`);return a}return{blocks:i("blocks/data.json.gz"),commands:i("commands/data.json.gz"),registries:i("registries/data.json.gz")}}function n_(t){let e="mcmeta://summary/registries.json";function r(i,o,s){let a=`${i[0].toUpperCase()}${i.slice(1)}`;for(let[l,[c,f]]of Object.entries(o)){let u=e;s.query(u,i,q.lengthen(l)).onEach(Object.entries(c),([h,d],p)=>{let b=f[h];p.member(`${u}#${a}_states`,h,m=>{m.enter({data:{subcategory:"state"},usage:{type:"declaration"}}).onEach(d,k=>{m.member(k,S=>{S.enter({data:{subcategory:"state_value"},usage:{type:"declaration"}}),k===b&&m.amend({data:{relations:{default:{category:i,path:S.path}}}})})})})})}}function n(i,o){function s(a){return hs.includes(a)||Gi.includes(a)}for(let[a,l]of Object.entries(i))if(s(a))for(let c of l)o.query(e,a,q.lengthen(c)).enter({usage:{type:"declaration"}})}return i=>{n(t.registries,i),r("block",t.blocks,i),r("fluid",t.fluids,i)}}var i_={flowing_lava:[{falling:["false","true"],level:["1","2","3","4","5","6","7","8"]},{falling:"false",level:"1"}],flowing_water:[{falling:["false","true"],level:["1","2","3","4","5","6","7","8"]},{falling:"false",level:"1"}],lava:[{falling:["false","true"]},{falling:"false"}],water:[{falling:["false","true"]},{falling:"false"}]};var kh=15e3;async function o_(t,e){return e.download({id:"mc-je/versions.json.gz",uri:"https://raw.githubusercontent.com/misode/mcmeta/summary/versions/data.json.gz",transformer:r=>dm(t,r),cache:ky("misode","mcmeta","refs/heads/summary"),ttl:kh})}async function s_(t,e,r,n,i,o,s={}){let a=uL({defaultBranch:"summary",getTag:m=>`${m}-summary`,isLatest:i,version:n}),l=r_(n,i,o),c;async function f(m,k){if(k)try{let S=await Y.readJson(t,k.path);return k.replace?S:Ka(m,S)}catch(S){r.error(`[je] [mcmeta-overrides] Failed loading customized mcmeta summary file \u201C${k.path}\u201D`,S)}return m}let u=async(m,k)=>{let S={},_=await e.download({id:`mc-je/${n}/${m}.json.gz`,uri:l[m],transformer:w=>dm(t,w),cache:ky("misode","mcmeta",a),ttl:kh},S);return c||=S.checksum,f(_,k)},[h,d,p,b]=[await u("blocks",s.blocks),await u("commands",s.commands),await f(i_,s.fluids),await u("registries",s.registries)];return{blocks:h,commands:d,fluids:p,registries:b,checksum:c}}function uL({defaultBranch:t,getTag:e,isLatest:r,version:n}){return r?`refs/heads/${t}`:`refs/tags/${e(n)}`}var a_={headers:{Accept:"application/vnd.github.v3+json","User-Agent":"SpyglassMC"}};function ky(t,e,r){return{checksumExtension:".commit-sha",checksumJob:{uri:`https://api.github.com/repos/${t}/${e}/git/${r}`,transformer:n=>{let i=JSON.parse(ir(n));if(Array.isArray(i))return i[0].object.sha;if(i.message===void 0)return i.object.sha;throw new Error(i.message)},options:a_,ttl:kh}}}async function l_(t){let e="SpyglassMC",r="vanilla-mcdoc",n="refs/heads/main",i={};return await t.download({id:"mc-je/vanilla-mcdoc.tar.gz",uri:`https://api.github.com/repos/${e}/${r}/tarball/${n}`,transformer:o=>o,cache:ky(e,r,n),options:a_,ttl:kh},i),{info:{startDepth:1},uri:i.cacheUri}}var dL=(()=>{let t=new Set(["block","fluid","function","game_event","item","worldgen/block_placer_type","worldgen/surface_builder"]),e=new Map([["advancements",{category:"advancement",extname:".json"}],["dimension",{category:"dimension",extname:".json",since:"1.16"}],["dimension_type",{category:"dimension_type",extname:".json",since:"1.16"}],["functions",{category:"function",extname:".mcfunction"}],["item_modifiers",{category:"item_modifier",extname:".json",since:"1.17"}],["loot_tables",{category:"loot_table",extname:".json"}],["predicates",{category:"predicate",extname:".json"}],["recipes",{category:"recipe",extname:".json"}],["tags/blocks",{category:"tag/block",extname:".json"}],["tags/entity_types",{category:"tag/entity_type",extname:".json"}],["tags/fluids",{category:"tag/fluid",extname:".json"}],["tags/functions",{category:"tag/function",extname:".json"}],["tags/game_events",{category:"tag/game_event",extname:".json",since:"1.17"}],["tags/items",{category:"tag/item",extname:".json"}],["worldgen/biome",{category:"worldgen/biome",extname:".json",since:"1.16"}],["worldgen/configured_carver",{category:"worldgen/configured_carver",extname:".json",since:"1.16"}],["worldgen/configured_feature",{category:"worldgen/configured_feature",extname:".json",since:"1.16"}],["worldgen/configured_structure_feature",{category:"worldgen/configured_structure_feature",extname:".json",since:"1.16"}],["worldgen/configured_surface_builder",{category:"worldgen/configured_surface_builder",extname:".json",since:"1.16",until:"1.17"}],["worldgen/density_function",{category:"worldgen/density_function",extname:".json",since:"1.18"}],["worldgen/noise",{category:"worldgen/noise",extname:".json",since:"1.18"}],["worldgen/noise_settings",{category:"worldgen/noise_settings",extname:".json",since:"1.16"}],["worldgen/placed_feature",{category:"worldgen/placed_feature",extname:".json",since:"1.18"}],["worldgen/processor_list",{category:"worldgen/processor_list",extname:".json",since:"1.16"}],["worldgen/template_pool",{category:"worldgen/template_pool",extname:".json",since:"1.16"}]]);for(let r of Cm)t.has(r)||e.set(`tags/${r}`,{category:`tag/${r}`,extname:".json",since:"1.18"});return e})();function*pL(t,e){yield*Y.getRels(t,e);let r=t.split("/");for(let n=r.length-2;n>=0;n--)r[n]==="data"&&(yield r.slice(n).join("/"))}function vy(t,e){let r=/^data\/([^\/]+)\/((?:tags\/|worldgen\/)?[a-z_]+)\/(.*)(\.(?:mcfunction|json))$/,n=pL(t,e.roots);for(let i of n){let o=i.match(r);if(!o)continue;let s=dL.get(o[2]);if(!s||s.extname!==o[4])continue;let a=e.project.loadedVersion;if(!(!a||!mL(a,s.since,s.until)))return{category:s.category,namespace:o[1],identifier:o[3]}}}var c_=(t,e)=>{for(let r of t){let n=vy(r,e);n&&e.symbols.query(r,n.category,`${n.namespace}:${n.identifier}`).enter({usage:{type:"definition"}})}};function mL(t,e,r){return!(e&&Vt.cmp(t,e)<0||r&&Vt.cmp(r,t)<0)}var gL=t=>[Te.create(t,"literal")],yL=t=>[Te.create(t,"literal")],bL=(t,e)=>{let r=[];for(let n of t.children)if(n.key&&r.push(Te.create(n.key,"property")),n.value){let i=e.meta.getColorizer(n.value.type);r.push(...i(n.value,e))}return r};function f_(t){t.registerColorizer("json:boolean",gL),t.registerColorizer("json:null",yL),t.registerColorizer("json:number",Le.number),t.registerColorizer("json:object",bL),t.registerColorizer("json:string",Le.string)}var mc={};yr(mc,{JsonStringOptions:()=>vh,array:()=>Sy,entry:()=>Si,json:()=>p_,number:()=>wy,object:()=>xy,string:()=>pc});var h_=(t,e)=>{let r=t.cursor;return t.trySkip("false")?{type:"json:boolean",range:v.create(r,t),value:!1}:t.trySkip("true")?{type:"json:boolean",range:v.create(r,t),value:!0}:V};var d_=(t,e)=>{let r=t.cursor;return t.trySkip("null")?{type:"json:null",range:v.create(r,t)}:V};var wy=(t,e)=>{let n=en({pattern:/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][-+]?\d+)?$/})(t,e);return n.type="json:number",n};var vh={escapable:{characters:["b","f","n","r","t"],unicode:!0},quotes:['"']},pc=(t,e)=>{let n=dt(vh)(t,e);return n.type="json:string",n};var xy=(t,e)=>se("json:object",Tr({start:"{",pair:{key:pc,sep:":",value:Si,end:",",trailingEnd:!1},end:"}"}))(t,e);var kL=new Set(["0","1","2","3","4","5","6","7","8","9","-"]);function p_(t=!1){return(e,r)=>{let n=ne([{predicate:i=>i.tryPeek("["),parser:Sy},{predicate:i=>i.tryPeek("false")||i.tryPeek("true"),parser:h_},{predicate:i=>i.tryPeek("null"),parser:d_},{predicate:i=>kL.has(i.peek()),parser:wy},{predicate:i=>i.tryPeek("{"),parser:xy},{parser:pc}])(e,r);return t&&r.err.dump(),n}}var Si=p_(!0);var Sy=(t,e)=>{let n=fi({start:"[",value:Si,sep:",",trailingSep:!1,end:"]"})(t,e);return n.type="json:array",n};var wh;(function(t){function e(n){return Pr.is(n)||Oo.is(n)||dr.is(n)||Xs.is(n)||gc.is(n)||Ay.is(n)}t.is=e;function r(n){return t.is(n)||_y.is(n)||Cy.is(n)}t.isRelated=r})(wh||(wh={}));var To;(function(t){function e(i){return i.type==="json:array"}t.isArray=e;function r(i){return i.type==="json:object"}t.isObject=r;function n(i){return i.type==="json:string"}t.isString=n})(To||(To={}));var Pr;(function(t){function e(n){return n?.type==="json:object"}t.is=e;function r(n){return{type:"json:object",range:v.get(n),children:[]}}t.mock=r})(Pr||(Pr={}));var _y;(function(t){function e(r){return r.type==="pair"}t.is=e})(_y||(_y={}));var Oo;(function(t){function e(n){return n?.type==="json:array"}t.is=e;function r(n){return{type:"json:array",range:v.get(n),children:[]}}t.mock=r})(Oo||(Oo={}));var Cy;(function(t){function e(r){return r.type==="item"}t.is=e})(Cy||(Cy={}));var xh;(function(t){function e(r){return r.type==="json:string"}t.is=e})(xh||(xh={}));var dr;(function(t){function e(n){return n?.type==="json:string"}t.is=e;function r(n){return{...et.mock(n,vh),type:"json:string"}}t.mock=r})(dr||(dr={}));var Xs;(function(t){function e(r){return r.type==="json:number"}t.is=e})(Xs||(Xs={}));var gc;(function(t){function e(r){return r.type==="json:boolean"}t.is=e})(gc||(gc={}));var Ay;(function(t){function e(r){return r.type==="json:null"}t.is=e})(Ay||(Ay={}));var m_=[`
`,":",'"'],Ty={"json:object":"{$1}","json:array":"[$1]","json:string":'"$1"',"json:boolean":"${1|false,true|}","json:number":"${1:0}"},vL=(t,e)=>re.dispatch(t,e),wL=re.record({key:(t,e,r,n,i,o)=>t.expectation?bc(t.expectation.filter(To.isObject).flatMap(s=>CL(n,t,s,r,i,o,e?.key?.value))):[],value:(t,e,r)=>e.value&&!v.isEmpty(e.value)?re.dispatch(e.value,r):t.expectation?bc(t.expectation.filter(To.isObject).filter(n=>n.fields).map(n=>n.fields.find(i=>i.key===e.key?.value)).flatMap(n=>g_(r.offset,n.value,r))):[]}),xL=(t,e)=>{let r=Dw(t.children,e.offset,(i,o)=>i.sep?v.compareOffset(v.translate(i,0,-1),o,!0):v.compareOffset(i.range,o,!0)),n=r>=0?t.children[r]:void 0;return n?.value?re.dispatch(n.value,e):t.expectation&&v.contains(v.translate(t,1,-1),e.offset,!0)?bc(t.expectation.filter(To.isArray).filter(i=>i.items).flatMap(i=>g_(e.offset,i.items,e))):[]},SL=t=>["false","true"].map(e=>yc(t,e)),_L=(t,e)=>t.children?.length?re.string(t,e):t.expectation?bc(t.expectation.filter(To.isString).flatMap(r=>Oy(t,r,e))):[];function CL(t,e,r,n,i,o,s){return r.fields?r.fields.filter(a=>a.key===s||!e.children.find(l=>a.key===l.key?.value)).map(a=>AL(t,a,i,o)):r.keys?r.keys.flatMap(a=>Oy(t,a,n).map(l=>({...l,...i?{insertText:`${l.insertText}: ${o?",":""}`}:{}}))):[]}function AL(t,e,r,n){let i=e.value?.[0]?Ty[e.value[0].type]:"";return pe.create(e.key,t,{kind:10,detail:e.value?.map(o=>o.typedoc).join(" | "),sortText:`${e.deprecated?2:e.opt?1:0}${e.key}`,deprecated:e.deprecated,filterText:`"${e.key}"`,insertText:`"${e.key}"${r?`: ${i}`:""}${n?",":""}`})}function g_(t,e,r){return bc(e.flatMap(n=>{switch(n.type){case"json:object":case"json:array":return[yc(t,Ty[n.type])];case"json:string":return Oy(r.offset,n,r);case"json:boolean":return["false","true"].map(i=>yc(t,i));case"json:number":return[yc(t,"0")]}}))}function Oy(t,e,r){return Array.isArray(e.pool)?e.pool.map(n=>pe.create(n,t,{kind:12,filterText:`"${n}"`,insertText:`"${n}"`})):[yc(t,Ty[e.type])]}function yc(t,e){return pe.create(e.replace("$1",""),t,{kind:12,insertText:e})}function bc(t){let e=[],r=new Set;return t.forEach(n=>{r.has(n.label)||(r.add(n.label),e.push(n))}),e}function y_(t){t.registerCompleter("json:entry",vL),t.registerCompleter("json:array",xL),t.registerCompleter("json:boolean",SL),t.registerCompleter("json:object",wL),t.registerCompleter("json:string",_L)}var TL=(t,e)=>t.children.length===0?"[]":`[
${t.children.map(n=>{let i=n.value&&e.meta.getFormatter(n.value.type)(n.value,Im(e));return`${e.indent(1)}${i??""}`}).join(`,
`)}
${e.indent()}]`,OL=(t,e)=>t.children.length===0?"{}":`{
${t.children.map(n=>{let i=n.key&&Xr.string(n.key,e),o=n.value&&e.meta.getFormatter(n.value.type)(n.value,Im(e));return`${e.indent(1)}${i??""}: ${o??""}`}).join(`,
`)}
${e.indent()}}`;function k_(t){t.registerFormatter("json:array",TL),t.registerFormatter("json:boolean",Xr.boolean),t.registerFormatter("json:null",()=>"null"),t.registerFormatter("json:number",Xr.float),t.registerFormatter("json:object",OL),t.registerFormatter("json:string",Xr.string)}function _i(t,e){t.expectation=[{type:"json:boolean",typedoc:"Boolean"}],gc.is(t)||e.err.report(y("expected",y("boolean")),t)}function w_(t){return(e,r)=>t()(e,r)}function Ey(t,e){return(r,n)=>{e(r,{...n,context:t})}}function EL(t,e,r){let n={...r,err:new ut,symbols:r.symbols.clone()};t(e,n);let i=e.expectation;return Qe.undoChanges(e),{totalErrorSpan:n.err.errors.map(s=>s.range.end-s.range.start).reduce((s,a)=>s+a,0),maxSeverity:Math.max(...n.err.errors.map(s=>s.severity)),expectation:i,updateNodeAndCtx:()=>{r.err.absorb(n.err),Qe.redoChanges(e),n.symbols.applyDelayedEdits()}}}function Qs(t=[]){return(e,r)=>{if(t.length===0)return;let n=t.map(s=>EL(s,e,r)).sort((s,a)=>s.maxSeverity-a.maxSeverity||s.totalErrorSpan-a.totalErrorSpan),i=n.filter(s=>s.expectation?.map(a=>a.type).includes(e.type)),o=n.filter(s=>s.expectation).flatMap(s=>s.expectation);if(i.length===0){let s=o.map(a=>y(a.type.slice(5)));r.err.report(y("expected",vn(s,!1)),e)}else i[0].updateNodeAndCtx();e.expectation=o}}function kc(t,e){let r=Qe.create({type:"json:null",range:v.create(0)}),n={...e,err:new ut,depth:(e.depth??0)+1};return t(r,n),r.expectation}function vc(t){return(e,r)=>{e.expectation=[{type:"json:array",typedoc:"Array"}],(!r.depth||r.depth<=0)&&(e.expectation[0].items=kc(t,r)),Oo.is(e)?e.children.filter(n=>n.value).forEach(n=>t(n.value,r)):r.err.report(y("expected",y("array")),e)}}var Sh=t=>(e,r)=>(n,i)=>{let o="Number"+(e===void 0&&r===void 0?"":`(${e??"-\u221E"}, ${r??"+\u221E"})`);n.expectation=[{type:"json:number",typedoc:o}],!Xs.is(n)||t==="integer"&&!Number.isInteger(n.value)?i.err.report(y("expected",y(t)),n):e!==void 0&&r!==void 0&&(n.value<e||n.value>r)?i.err.report(y("expected",y("number.between",e,r)),n):e!==void 0&&n.value<e?i.err.report(y("expected",y("number.>=",e)),n):r!==void 0&&n.value>r&&i.err.report(y("expected",y("number.<=",r)),n)},x_=Sh("integer")(void 0,void 0),kV=Sh("float")(void 0,void 0),RL=Sh("integer"),vV=Sh("float");function Rt(t){return t?.checker!==void 0}function S_(t,e,r={}){return(n,i)=>{if(n.expectation=[{type:"json:object",typedoc:"Object"}],!i.depth||i.depth<=0)if(Array.isArray(t)&&e){let o=t.map(s=>[s,e(s,i)]).filter(([s,a])=>a!==void 0);n.expectation[0].fields=o.map(([s,a])=>({key:s,value:kc(Rt(a)?a.checker:a,i),...Rt(a)&&(a.opt||a.deprecated)?{opt:!0}:{},...Rt(a)&&a.deprecated?{deprecated:!0}:{}}))}else typeof t=="function"&&e&&(n.expectation[0].keys=kc(t,i)?.filter(xh.is));if(!Pr.is(n))i.err.report(y("expected",y("object")),n);else if(Array.isArray(t)&&e){let o=n.children.map(s=>s.key?.value);t.forEach(s=>{let a=e(s,i);!a||Rt(a)&&(a.opt||a.deprecated)||o.includes(s)||i.err.report(y("json.checker.property.missing",P(s)),v.create(n.range.start,n.range.start+1))}),n.children.filter(s=>s.key).forEach(s=>{let a=s.key.value,l=e(a,i);if(!l||!t.includes(a)){r.allowUnknownProperties||i.err.report(y("json.checker.property.unknown",P(a)),s.key,2);return}Rt(l)&&l.deprecated&&i.err.report(y("json.checker.property.deprecated",P(a)),s.key,0,{deprecated:!0});let c=i.context+(Rt(l)&&l.context?`.${l.context}`:""),f=y(`json.doc.${c}`),u=s.value!==void 0?s.value:{type:"json:null",range:v.create(0)},h=Rt(l)?l.checker:l;try{h(u,{...i,context:`${c}.${a}`})}catch(b){let m=i.doc.positionAt(s.range.start);i.logger.error(`Checking "${a}" at ${m.line}:${m.character} in "${i.doc.uri}"`,b)}let d=Rt(l)?l.def:void 0,p=u.expectation?.map(b=>b.typedoc).join(" | ");s.key.hover=`\`\`\`typescript
${c}.${a}: ${p}
\`\`\`${f||d!==void 0?`
******
 `:""}${f}${d!==void 0?`
\`@default\` ${JSON.stringify(d)}`:""}`})}else typeof t=="function"&&e&&n.children.filter(o=>o.key).forEach(o=>{if(t(o.key,i),o.value!==void 0){let s=e(o.key.value,i);s&&(Rt(s)?s.checker:s)(o.value,i)}})}}function Dn(t,e){return S_(Object.keys(t),r=>t[r],e)}function le(t,e){if(t!==void 0)return Rt(t)?{...t,opt:!0,def:e}:{checker:t,opt:!0,def:e}}function __(t){if(t!==void 0)return Rt(t)?{...t,deprecated:!0}:{checker:t,deprecated:!0}}function _h(t,e){return(r,n)=>{if(!Pr.is(r))n.err.report(y("expected",y("object")),r);else if(e){let i=r.children.findIndex(a=>a.key?.value===t),o=r.children[i],s=o?.value?.type==="json:string"?o.value.value:void 0;e(s,r.children,n)(r,n)}else t(r.children,n)(r,n)}}function Ry(t,e){if(t===void 0)return{};let r=e[q.shorten(t)];return r===void 0?{}:(Object.keys(r).forEach(n=>{let i=r[n];i!==void 0&&(r[n]={checker:Rt(i)?i.checker:i,opt:Rt(i)?i.opt:void 0,deprecated:Rt(i)?i.deprecated:void 0,context:q.shorten(t)})}),r)}function C_(t,e){let r=e?.find(n=>n.key?.value===t);return r?.value?.type==="json:string"?r.value.value:void 0}function My(t,e,r){let n=new Set(Pr.is(t)?t.children.map(s=>s.key?.value):[]),i=Object.keys(r).find(s=>n.has(s));if(i===void 0)return e.err.report(y("json.checker.property.missing",Object.keys(r)),v.create(t.range.start,t.range.start+1)),Object.fromEntries(Object.entries(r).map(([s,a])=>[s,le(typeof a=="function"?Qs():a[s]??Qs())]));let o=r[i];return typeof o=="function"?o():o}function wc(t,e=!1){return wt(t,Oe(typeof t=="string"?{category:t,allowTag:e}:{pool:t.map(q.lengthen)}),tt.resourceLocation)}function ea(t){return typeof t=="string"?wt(t,Bs(t)):wt(t,De(...t))}function wt(t,e,r,n){return(i,o)=>{if(i.expectation=[{type:"json:string",typedoc:ML(t),...n}],!dr.is(i))o.err.report(y("expected",y("string")),i);else if(e){let s=uo(Zn.resolve(e),i.value,i.valueMap,o);s!==V&&(i.children=[s],s.parent=i,r&&Zn.resolve(r)(s,o))}else r&&Zn.resolve(r)(i,o)}}function ML(t){return t?typeof t=="string"?`String("${t}")`:t.slice(0,10).map(e=>`"${e}"`).join(" | ")+(t.length>10?" | ...":""):"String"}var Ee=wt();var A_=({meta:t})=>{t.registerLanguage("json",{extensions:[".json",".mcmeta"],triggerCharacters:m_,parser:Si}),t.registerParser("json:entry",Si),f_(t),y_(t),k_(t)};var T_=new Map([["advancement","::java::data::advancement::Advancement"],["dimension","::java::data::worldgen::dimension::Dimension"],["dimension_type","::java::data::worldgen::dimension::DimensionType"],["item_modifier","::java::data::item_modifier::ItemModifier"],["loot_table","::java::data::loot::LootTable"],["predicate","::java::data::predicate::Predicate"],["recipe","::java::data::recipe::Recipe"],["worldgen/biome","::java::data::worldgen::biome::Biome"],["worldgen/configured_carver","::java::data::worldgen::carver::ConfiguredCarver"],["worldgen/configured_surface_builder","::java::data::worldgen::surface_builder::ConfiguredSurfaceBuilder"],["worldgen/configured_feature","::java::data::feature::ConfiguredFeature"],["worldgen/configured_structure_feature","::java::data::worldgen::structure::Structure"],["worldgen/density_function","::java::data::worldgen::density_function::DensityFunction"],["worldgen/noise","::java::data::worldgen::dimension::biome_source::NoiseParameters"],["worldgen/noise_settings","::java::data::worldgen::noise_settings::NoiseGeneratorSettings"],["worldgen/processor_list","::java::data::worldgen::processor_list::ProcessorList"],["worldgen/template_pool","::java::data::worldgen::template_pool::TemplatePool"]]),ta=(t,e)=>{let r=vy(e.doc.uri,e);if(r&&T_.has(r.category)){let n=T_.get(r.category);return O_(n)(t,e)}else if(!r?.category.startsWith("tag/"))return e.doc.uri.endsWith("/pack.mcmeta")?O_("::java::Pack")(t,e):void 0};function E_(t){t.registerChecker("json:array",ta),t.registerChecker("json:boolean",ta),t.registerChecker("json:null",ta),t.registerChecker("json:number",ta),t.registerChecker("json:object",ta),t.registerChecker("json:string",ta)}function O_(t){return(e,r)=>{let i=r.symbols.query(r.doc,"mcdoc",t).getData(Co.TypeDefSymbolData.is)?.typeDef;if(i)switch(i.kind){case"struct":R_(i)(e,r);break;default:r.logger.error(`[json.checker.definition] Expected a struct type, but got ${i.kind}`)}}}function R_(t){return(e,r)=>{if(Pr.is(e))for(let{key:n,value:i}of e.children){if(!n||!i)continue;let o=n.value,s=t.fields.find(a=>a.kind==="pair"&&a.key===o);s?Ah(s.type)(i,r):r.err.report(y("unknown-key",P(o)),n,2)}}}function Ah(t){let e=(n,{kind:i,min:o=-1/0,max:s=1/0})=>{let a=(l,c,f)=>f?l<c:l<=c;return a(o,n,i&2)&&a(n,s,i&1)},r={boolean:"json:boolean",byte:"json:number",byte_array:"json:array",double:"json:number",float:"json:number",int:"json:number",int_array:"json:array",list:"json:array",long:"json:number",long_array:"json:array",short:"json:number",string:"json:string",struct:"json:object",tuple:"json:array"};return(n,i)=>{if(t.kind!=="any"&&t.kind!=="dispatcher"&&t.kind!=="enum"&&t.kind!=="literal"&&t.kind!=="reference"&&t.kind!=="union"&&t.kind!=="attributed"&&t.kind!=="unsafe"&&t.kind!=="concrete"&&t.kind!=="indexed"&&t.kind!=="template"&&n.type!==r[t.kind]){i.err.report(y("expected",Ch(r[t.kind])),n,2);return}switch(t.kind){case"boolean":break;case"byte_array":case"int_array":case"long_array":if(n=n,t.lengthRange&&!e(n.children.length,t.lengthRange)&&i.err.report(y("expected",y("json.checker.array.length-between",Ch(n.type),t.lengthRange.min??"-\u221E",t.lengthRange.max??"+\u221E")),n,2),t.valueRange)for(let{value:o}of n.children)o?.type!=="json:number"?i.err.report(y("expected",Ch("json:number")),n,2):o&&!e(Number(o.value),t.valueRange)&&i.err.report(y("number.between",t.valueRange.min??"-\u221E",t.valueRange.max??"+\u221E"),n,2);break;case"byte":case"short":case"int":case"long":case"float":case"double":n=n,t.valueRange&&!e(Number(n.value),t.valueRange)&&i.err.report(y("number.between",t.valueRange.min??"-\u221E",t.valueRange.max??"+\u221E"),n,2);break;case"dispatcher":n=n;break;case"list":n=n,t=cc(t),t.lengthRange&&!e(n.children.length,t.lengthRange)&&i.err.report(y("expected",y("json.checker.collection.length-between",Ch(n.type),t.lengthRange.min??"-\u221E",t.lengthRange.max??"+\u221E")),n,2);for(let{value:o}of n.children)o&&Ah(t.item)(o,i);break;case"struct":n=n,R_(t)(n,i);break;case"string":break;case"reference":break;case"union":t=Gs(t),t.members.length===0?i.err.report(y("json.checker.object.field.union-empty-members"),kn.is(n.parent)?n.parent.key??n.parent:n,2):tt.any(t.members.map(o=>Ah(o)))(n,i);break;case"attributed":Ah(t.child)(n,i);break}}}function Ch(t){let e=`json.node.${t.replace(/^json:/,"")}`;return y(e)}var D_=t=>{A_(t),E_(t.meta)};function P_(t){t.registerColorizer("mcfunction:command_child/literal",Le.literal),t.registerColorizer("mcfunction:command_child/trailing",Le.error)}var Dh={};yr(Dh,{command:()=>B_,entry:()=>NL});var Th;(function(t){function e(n){return n.type==="mcfunction:command"}t.is=e;function r(n){return{type:"mcfunction:command",range:v.get(n),children:[]}}t.mock=r})(Th||(Th={}));var Oh;(function(t){function e(r){return r.type==="mcfunction:command_child"}t.is=e})(Oh||(Oh={}));var I_;(function(t){function e(r){return r?.type==="mcfunction:command_child/literal"}t.is=e})(I_||(I_={}));var Eh;(function(t){function e(r){return r?.type==="mcfunction:entry"}t.is=e})(Eh||(Eh={}));var Sc,Rh=class{constructor(){R(this,Sc,new Map);if(Rh._instance)throw new Error("Use the `instance` static property to get an instance.")}register(e,r,n){g(this,Sc).set(e,n?Ka(r,n):r)}get(e){let r=g(this,Sc).get(e);if(!r)throw new Error(`No command tree exist for version \u201C${e}\u201D`);return r}static get instance(){return this._instance??(this._instance=new Rh)}},pr=Rh;Sc=new WeakMap,H(pr,"_instance");function Dy(t,e){return e.reduce((r,n)=>r?.children?.[n],t)}function Eo(t,e,r){return t?.redirect?{treeNode:Dy(e,t.redirect),path:[...t.redirect]}:t&&!t.children&&!t.executable?{treeNode:e,path:[]}:{treeNode:t,path:r}}function Mh(t){let e={literalTreeNodes:[],argumentTreeNodes:[]};for(let r of Object.entries(t))r[1].type==="literal"?e.literalTreeNodes.push(r):r[1].type==="argument"&&e.argumentTreeNodes.push(r);return e}function NL(t,e){return(r,n)=>{let i=pr.instance.get(t),o=Ke.findChild(r,n.offset,!0);return Ya.is(o)?[]:B_(i,e)(o??Th.mock(n.offset),n)}}function B_(t,e){return(r,n)=>{let i=Ke.findChildIndex(r,n.offset,!0),o=r.children[i]?.children[0];if(o)return re.dispatch(o,n);let s=Ke.findLastChild(r,n.offset);if(!s)return Object.keys(t.children??{}).map(u=>pe.create(u,n.offset,{kind:14}));let a=s.path,{treeNode:l}=Eo(Dy(t,a),t);if(!l?.children)return[];let{literalTreeNodes:c,argumentTreeNodes:f}=Mh(l.children);return[...c.map(([u])=>pe.create(u,n.offset,{kind:14})),...f.flatMap(([u,h])=>Ve.toArray(e(h,n.offset)).flatMap(d=>re.dispatch(d,n)))]}}function j_(t,e){let r=e.parser.slice(e.parser.indexOf(":")+1);return`<${t}: ${r}>`}var _c=(t,e)=>{let r=t.cursor,n=t.readSpace();return n!==" "&&e.err.report(y("expected",y("mcfunction.parser.sep",P(" "))),v.create(r,t)),n};function $_(t,e=!1){let r={pool:t,colorTokenType:e?"keyword":"literal"};return(n,i)=>{let o=n.cursor,s=n.readUntil(" ","\r",`
`);if(!s.length)return V;let a={type:"mcfunction:command_child/literal",range:v.create(o,n),options:r,value:s};return t.includes(s)||i.err.report(y("expected",t),a),a}}function Nh(t,e){return(r,n)=>{let i={type:"mcfunction:command",range:v.create(r),children:[]},o=r.cursor;if(r.trySkip("/")&&(i.slash=v.create(o,r.cursor)),PL(i.children,r,n,[],t,t,e),r.canReadInLine()){let s=IL(r,n);i.children.push({type:"mcfunction:command_child",range:s.range,children:[s],path:[]})}return i.range.end=r.cursor,i}}function PL(t,e,r,n,i,o,s){function a(c,f){let{treeNode:u,path:h}=Eo(f,i,c);c=h;let d=u?.children;if(!d)return!1;let{literalTreeNodes:p,argumentTreeNodes:b}=Mh(d),m=b.map(([E,x])=>({name:E,parser:s(x)??LL(x)})),k=p.length?$_(p.map(([E,x])=>E),u.type==="root"):void 0,S=[...k?[k]:[],...m.map(E=>E.parser)],_={index:0},C=(S.length>1?ar(S,_):S[0])(e,r);if(C!==V){let E=m[_.index-(k?1:0)]?.name??C.value,x=[...c,E];t.push({type:"mcfunction:command_child",range:C.range,children:[C],path:x});let T=d[E];if(!T)return!1;let O=T.permission??2;if(r.config.env.permissionLevel<O&&r.err.report(y("mcfunction.parser.no-permission",O,r.config.env.permissionLevel),C),C.type==="mcfunction:command_child/unknown")return!1;if(e.canReadInLine())return _c(e,r),{childPath:x,childTreeNode:T};T.executable||r.err.report(y("mcfunction.parser.eoc-unexpected"),e)}else r.err.report(y("expected",jL(d)),v.create(e));return!1}let l=a(n,o);for(;l;)l=a(l.childPath,l.childTreeNode)}function LL(t){return(e,r)=>{let n=e.cursor,i=e.readUntilLineEnd(),o=v.create(n,e);return r.err.report(y("mcfunction.parser.unknown-parser",P(t.parser)),o,0),{type:"mcfunction:command_child/unknown",range:o,value:i}}}var IL=(t,e)=>{let r=t.cursor,n=t.readUntilLineEnd(),i=v.create(r,t);return e.err.report(y("mcfunction.parser.trailing",P(n)),i),{type:"mcfunction:command_child/trailing",range:i,value:n}};function BL(t,e){return e?`[${t}]`:t}function Ny(t,e=!1){return Object.entries(t).map(([n,i])=>BL(Py(n,i),e))}function jL(t){let e=Ny(t);return e.length>5?`${e.slice(0,3).join("|")}|...|${e.slice(-2).join("|")}`:e.join("|")}function Py(t,e){return e.type==="argument"?j_(t,e):t}function z_(t,e){return(r,n)=>{let i={type:"mcfunction:entry",range:v.create(r),children:[]};for(;r.skipWhitespace().canReadInLine();){let o;r.peek()==="#"?o=$L(r,n):o=Nh(pr.instance.get(t),e)(r,n),i.children.push(o),r.nextLine()}return i.range.end=r.cursor,i}}var $L=El({singleLinePrefixes:new Set(["#"])});var F_=({meta:t})=>{P_(t),t.registerCompleter("mcfunction:command_child/literal",re.literal)};function zL(t,e,r){return r.symbols.query(r.doc,t,q.lengthen(e)).symbol?.definition?.map(n=>n.uri)??[]}function Ro(t,e,r){let n=o=>dr.is(o)?o.value:o.children.find(s=>s.key?.value==="id").value.value;return[...zL(t,e,r).reduce((o,s)=>o,new Set)]}function V_(){let t=/^[0-9a-f]{1,6}$/i,e=(r,n)=>{let i=0,o=r.cursor;if(r.trySkip("#")){let s=r.readRemaining();s.match(t)?i=parseInt(s,16):n.err.report(y("expected",y("json.checker.string.hex-color")),v.create(o,r))}else{let s=r.readRemaining();ht.NamedColors.has(s)?i=ht.NamedColors.get(s):n.err.report(y("expected",ht.ColorNames),v.create(o,r))}return ht.fromCompositeInt(i)};return(r,n)=>{if(r.expectation=[{type:"json:string",typedoc:'String("Color")',pool:ht.ColorNames}],!dr.is(r))n.err.report(y("expected",y("string")),r);else{let i=uo(e,r.value,r.valueMap,n);i!==V&&(r.color={value:i,format:[Bt.HexRGB],range:{start:r.range.start+1,end:r.range.end-1}})}}}function Ly(t){return FL(t)?VL(t):UL(t)}function FL(t){return typeof t.definition=="string"}function VL({definition:t}){return(e,r)=>{if(!r.ensureBindingStarted){Ee(e,r);return}let n=r.meta.getParserLazily("nbt:compound"),i=it.definition(t);wt("nbt",n,i)(e,r)}}function UL(t){return(e,r)=>{let n=U_(t,r);if(!r.ensureBindingStarted){Ee(e,r);return}let i=r.meta.getParser("nbt:compound"),o=it.index(t.registry,n);wt("nbt",i,o)(e,r)}}function Ph(t){return(e,r)=>{let n=U_(t,r);if(!r.ensureBindingStarted){Ee(e,r);return}let i=r.meta.getParser("nbt:path"),o=it.path(t.registry,n);wt("nbt_path",i,o)(e,r)}}function U_({registry:t,id:e,idOrTag:r,ids:n,tag:i},o){return r&&(r.startsWith("#")?i=r.slice(1):e=r),i&&(t==="block"||t==="item"||t==="entity_type")?n=Ro(`tag/${t}`,i,o):e&&(n=[e]),n?.map(q.lengthen)}var WU=wt("recipe_group",Bs("recipe_group"));var HL=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,Iy=wt(void 0,void 0,(t,e)=>{t.value.match(HL)||e.err.report(y("expected",y("uuid")),t)});function WL(t){return t.project.loadedVersion}function By(t,e){return Vt.cmp(WL(t),e)}function ra(t,e,r,n){if(typeof e=="string"){let i=By(t,e)>=0;return r===void 0?r:Array.isArray(r)?i?r:[]:i?r:void 0}else{let i=By(t,r)<0;return e===void 0?e:Array.isArray(e)?i?e:n??[]:i?e:n??void 0}}function Lh(t,e,r){return By(t,e)<0?r:__(r)}var qL=["key.jump","key.sneak","key.sprint","key.left","key.right","key.back","key.forward","key.attack","key.pickItem","key.use","key.drop","key.hotbar.1","key.hotbar.2","key.hotbar.3","key.hotbar.4","key.hotbar.5","key.hotbar.6","key.hotbar.7","key.hotbar.8","key.hotbar.9","key.inventory","key.swapOffhand","key.loadToolbarActivator","key.saveToolbarActivator","key.playerlist","key.chat","key.command","key.socialInteractions","key.advancements","key.spectatorOutlines","key.screenshot","key.smoothCamera","key.fullscreen","key.togglePerspective"],KL=Ey("text_component",(t,e)=>Dn({...My(t,e,{text:{text:Ee},translate:{translate:Ee,with:le(vc(cn),[])},selector:{selector:Ee,separator:le(ra(e,"1.17",cn))},score:{score:Dn({name:Ee,objective:Ee,value:le(Ee)})},keybind:{keybind:ea(qL)},nbt:()=>({nbt:Ee,...My(t,e,{block:{block:Ee,nbt:Ph({registry:"block"})},entity:{entity:Ee,nbt:Ph({registry:"entity_type"})},storage:{storage:wc("storage"),nbt:Ph({registry:"storage"})}}),interpret:le(_i,!1),separator:le(ra(e,"1.17",cn))})}),color:le(V_()),font:le(Ee),bold:le(_i),italic:le(_i),underlined:le(_i),strikethrough:le(_i),obfuscated:le(_i),insertion:le(Ee),clickEvent:le(_h("action",r=>Dn({action:ea(["open_url","open_file","run_command","suggest_command","change_page","copy_to_clipboard"]),value:Ee,...Ry(r,{run_command:{value:wt("command",e.meta.getParserLazily("mcfunction:command"),e.meta.getChecker("mcfunction:command"))},change_page:{value:wt("number",Ar({pattern:/\d+/,min:0}))}})}))),hoverEvent:le(_h("action",(r,n,i)=>Dn({action:ea(["show_text","show_item","show_entity"]),...Ry(r,{show_text:{value:Lh(i,"1.16",cn),contents:le(ra(i,"1.16",cn))},show_item:{value:Lh(i,"1.16",Ly({definition:"::minecraft::util::invitem::InventoryItem"})),contents:le(ra(i,"1.16",_h(o=>Dn({id:wc("item"),count:le(x_),tag:le(Ly({registry:"item",id:C_("id",o)}))}))))},show_entity:{value:Lh(i,"1.16",Dn({name:le(Ee),type:le(wc("entity_type")),id:le(Iy)})),contents:le(ra(i,"1.16",Dn({name:le(cn),type:le(wc("entity_type")),id:le(Iy)})))}})}))),extra:le(vc(cn))})(t,e)),cn=Ey("text_component",Qs([Ee,KL,vc(w_(()=>cn))]));var Ih;(function(t){function e(r){return r.type==="mcfunction:block/states"}t.is=e})(Ih||(Ih={}));var Lr;(function(t){function e(n){return n?.type==="mcfunction:block"}t.is=e;function r(n,i){let o=U.mock(n,{category:"block",allowTag:i});return{type:"mcfunction:block",range:v.get(n),children:[o],id:o}}t.mock=r})(Lr||(Lr={}));var Bh;(function(t){function e(n){return{type:"mcfunction:coordinate",range:v.get(n),notation:"",value:0}}t.mock=e;function r(n){let i=n.value%360;return i>=180?i-360:i<-180?i+360:i}t.toDegree=r})(Bh||(Bh={}));var jh;(function(t){function e(r){return r.type==="mcfunction:entity_selector/arguments"}t.is=e})(jh||(jh={}));var W_=["a","e","p","r","s"],H_;(function(t){function e(r){return W_.includes(r)}t.is=e})(H_||(H_={}));var Ac=W_.map(t=>`@${t}`),na;(function(t){function e(r){return Ac.includes(r)}t.is=e})(na||(na={}));var Ir;(function(t){function e(i){return i?.type==="mcfunction:entity_selector"}t.is=e;function r(i){let o=Ue.mock(i,{pool:Ac,colorTokenType:"keyword"});return{type:"mcfunction:entity_selector",range:v.get(i),children:[o],variable:"e"}}t.mock=r,t.ArgumentKeys=new Set(["advancements","distance","gamemode","level","limit","name","nbt","predicate","scores","sort","tag","team","type","x","y","z","dx","dy","dz","x_rotation","y_rotation"]);function n(i,o,s){let a=c=>!!o.children.find(f=>f.key?.value===c),l=c=>!!o.children.find(f=>f.key?.value===c&&!f.value?.inverted);switch(s){case"advancements":case"distance":case"level":case"scores":case"x":case"y":case"z":case"dx":case"dy":case"dz":case"x_rotation":case"y_rotation":return a(s)?1:0;case"gamemode":case"name":case"team":return l(s)?1:0;case"limit":case"sort":return i.currentEntity?2:a(s)?1:0;case"type":return i.typeLimited?a(s)?1:2:0}return 0}t.canKeyExist=n})(Ir||(Ir={}));var ia;(function(t){function e(r){return r?.type==="mcfunction:entity"}t.is=e})(ia||(ia={}));var Ci;(function(t){function e(n){return n?.type==="mcfunction:item"}t.is=e;function r(n,i){let o=U.mock(n,{category:"item",allowTag:i});return{type:"mcfunction:item",range:v.get(n),children:[o],id:o}}t.mock=r})(Ci||(Ci={}));var $h;(function(t){function e(r){return{type:"mcfunction:int_range",range:v.get(r),children:[],value:[void 0,void 0]}}t.mock=e})($h||($h={}));var Ai;(function(t){t.SimpleValues=["air","armor","deathCount","dummy","food","health","level","playerKillCount","totalKillCount","trigger","xp"],t.ComplexCategories=new Map([["broken","item"],["crafted","item"],["custom","custom_stat"],["dropped","item"],["killed","entity_type"],["killed_by","entity_type"],["mined","block"],["picked_up","item"],["used","item"]]),t.ComplexSep=":";function e(r){return{type:"mcfunction:objective_criteria",range:v.get(r)}}t.mock=e})(Ai||(Ai={}));var Mo;(function(t){let e=new Set(["block","block_marker","dust","dust_color_transition","falling_dust","item","sculk_charge","shriek","vibration"]);function r(o){return e.has(o)}t.isSpecialType=r;function n(o){return o?.type==="mcfunction:particle"}t.is=n;function i(o){let s=U.mock(o,{category:"particle_type"});return{type:"mcfunction:particle",range:v.get(o),children:[s],id:s}}t.mock=i})(Mo||(Mo={}));var zh;(function(t){function e(r){let n=or.mock(r,{category:"score_holder"});return{type:"mcfunction:score_holder",range:v.get(r),children:[n],fakeName:n}}t.mock=e})(zh||(zh={}));var Fh;(function(t){t.UnitToTicks=new Map([["",1],["t",1],["s",20],["d",24e3]]),t.Units=[...t.UnitToTicks.keys()]})(Fh||(Fh={}));var Ut;(function(t){function e(r,n){return{type:"mcfunction:vector",range:v.get(r),children:[],options:n,system:0}}t.mock=e})(Ut||(Ut={}));var GL=(t,e)=>{t.slash&&t.parent&&Eh.is(t.parent)&&e.err.report(y("unexpected-leading-slash"),t.slash),q_(t.children,0,e)},Ht=(t,e)=>t[e]?.path[t[e].path.length-1],Wt=(t,e)=>t[e]?.children[0],q_=(t,e,r)=>{for(let{children:[n]}of t)Lr.is(n)?K_(n,r):ia.is(n)?G_(n,r):Ci.is(n)?Z_(n,r):Mo.is(n)?J_(n,r):wh.is(n)&&cn(n,{...r,context:""});if(Ht(t,e)==="data")if(Ht(t,e+1)==="get")Vh(t,e+2,r);else if(Ht(t,e+1)==="merge")ZL(t,e+2,r);else if(Ht(t,e+1)==="modify"){Vh(t,e+2,r);let n=Wt(t,e+4)}else Ht(t,e+1)==="remove"&&Vh(t,e+2,r);else if(Ht(t,e)==="execute"){for(let n=e+1;n<t.length;n++)if((Ht(t,n)==="if"||Ht(t,n)==="unless")&&Ht(t,n+1)==="data")Vh(t,n+2,r),n+=2;else if(Ht(t,n)==="run"){q_(t,n+1,r);break}}else Ht(t,e)==="summon"&&JL(t,e+1,r)},K_=(t,e)=>{t.nbt&&it.index("block",U.toString(t.id,"full"))(t.nbt,e)},G_=(t,e)=>{let r=t.selector?.arguments?.children.find(o=>o.key?.value==="nbt");if(!r)return;let n=jy(t,e),i=r.value;it.index("entity_type",n)(i,e)},Z_=(t,e)=>{t.nbt&&it.index("item",U.toString(t.id,"full"))(t.nbt,e)},J_=(t,e)=>{tt.dispatchSync(t,e)},ZL=(t,e,r)=>{switch(Ht(t,e)){case"block":{let i=Wt(t,e+2);Nr.is(i)&&it.index("block",void 0)(i,r);break}case"entity":{let i=Wt(t,e+1),o=Wt(t,e+2);if(ia.is(i)&&Nr.is(o)){let s=jy(i,r);it.index("entity_type",s)(o,r)}break}case"storage":{let i=Wt(t,e+1),o=Wt(t,e+2);U.is(i)&&Nr.is(o)&&it.index("storage",U.toString(i,"full"))(o,r);break}}},Vh=(t,e,r)=>{switch(Ht(t,e)){case"block":{let i=Wt(t,e+2);Ys.is(i)&&it.path("block",void 0)(i,r);break}case"entity":{let i=Wt(t,e+1),o=Wt(t,e+2);if(ia.is(i)&&Ys.is(o)){let s=jy(i,r);it.path("entity_type",s)(o,r)}break}case"storage":{let i=Wt(t,e+1),o=Wt(t,e+2);U.is(i)&&Ys.is(o)&&it.path("storage",U.toString(i,"full"))(o,r);break}}},JL=(t,e,r)=>{let n=Wt(t,e),i=Wt(t,e+2);U.is(n)&&Nr.is(i)&&it.index("entity_type",U.toString(n,"full"))(i,r)},jy=(t,e)=>{if(t.playerName!==void 0||t.selector?.playersOnly)return["minecraft:player"];if(t.selector){let r=t.selector.arguments;if(!r)return;let n=[];for(let i of r.children){if(i.key?.value!=="type")continue;let o=i.value;if(!o||o.inverted)continue;let s=U.toString(o.value,"full",!0);if(s.startsWith(q.TagPrefix)){let a=Ro("tag/entity_type",s.slice(1),e);n=n.filter(l=>a.includes(l))}else n=[s]}return n}};function Y_(t){t.registerChecker("mcfunction:command",GL),t.registerChecker("mcfunction:block",K_),t.registerChecker("mcfunction:entity",G_),t.registerChecker("mcfunction:item",Z_),t.registerChecker("mcfunction:particle",J_)}var YL=t=>[Te.create(t,"type")],XL=t=>[Te.create(t,"vector")];function Q_(t){t.registerColorizer("mcfunction:coordinate",Le.number),t.registerColorizer("mcfunction:vector",XL),t.registerColorizer("mcfunction:objective_criteria",YL)}var Uh=[...ht.ColorNames,"reset"],Hh=["feet","eyes"],Wh=[...[...Array(54).keys()].map(t=>`container.${t}`),...[...Array(27).keys()].map(t=>`enderchest.${t}`),...[...Array(15).keys()].map(t=>`horse.${t}`),...[...Array(9).keys()].map(t=>`hotbar.${t}`),...[...Array(27).keys()].map(t=>`inventory.${t}`),...[...Array(8).keys()].map(t=>`villager.${t}`),"armor.chest","armor.feet","armor.head","armor.legs","horse.armor","horse.chest","horse.saddle","weapon","weapon.mainhand","weapon.offhand"],qh=["=","+=","-=","*=","/=","%=","<",">","><"],Kh=["belowName","list","sidebar",...ht.ColorNames.map(t=>`sidebar.team.${t}`)],Gh=["x","xy","xz","xyz","xzy","y","yx","yz","yxz","yzx","z","zx","zy","zxy","zyx"];var tC=(t,e)=>{let r=t;switch(r.parser){case"brigadier:bool":return cu.mock(e);case"brigadier:double":case"brigadier:float":case"brigadier:integer":case"brigadier:long":case"minecraft:float_range":case"minecraft:message":case"minecraft:time":case"minecraft:uuid":return[];case"brigadier:string":return r.properties.type==="phrase"?et.mock(e,ui):[];case"minecraft:angle":return Bh.mock(e);case"minecraft:block_pos":return Ut.mock(e,{dimension:3,integersOnly:!0});case"minecraft:block_predicate":return Lr.mock(e,!0);case"minecraft:block_state":return Lr.mock(e,!1);case"minecraft:color":return Ue.mock(e,{pool:Uh});case"minecraft:column_pos":return Ut.mock(e,{dimension:2,integersOnly:!0});case"minecraft:component":return[Oo.mock(e),Pr.mock(e),dr.mock(e)];case"minecraft:dimension":return U.mock(e,{category:"dimension"});case"minecraft:entity":case"minecraft:game_profile":return Ir.mock(e);case"minecraft:entity_anchor":return Ue.mock(e,{pool:Hh});case"minecraft:entity_summon":return U.mock(e,{category:"entity_type"});case"minecraft:function":return U.mock(e,{category:"function"});case"minecraft:int_range":return $h.mock(e);case"minecraft:item_enchantment":return U.mock(e,{category:"enchantment"});case"minecraft:item_predicate":return Ci.mock(e,!0);case"minecraft:item_slot":return Ue.mock(e,{pool:Wh});case"minecraft:item_stack":return Ci.mock(e,!1);case"minecraft:mob_effect":return U.mock(e,{category:"mob_effect"});case"minecraft:objective":return or.mock(e,{category:"objective"});case"minecraft:objective_criteria":return Ai.mock(e);case"minecraft:operation":return Ue.mock(e,{pool:qh,colorTokenType:"operator"});case"minecraft:particle":return Mo.mock(e);case"minecraft:resource":case"minecraft:resource_or_tag":return U.mock(e,{category:q.shorten(r.properties.registry),allowTag:r.parser==="minecraft:resource_or_tag"});case"minecraft:resource_location":return U.mock(e,r.properties??{pool:[],allowUnknown:!0});case"minecraft:rotation":return Ut.mock(e,{dimension:2,noLocal:!0});case"minecraft:scoreboard_slot":return Ue.mock(e,{pool:Kh});case"minecraft:score_holder":return zh.mock(e);case"minecraft:swizzle":return Ue.mock(e,{pool:Gh});case"minecraft:team":return or.mock(e,{category:"team"});case"minecraft:vec2":return Ut.mock(e,{dimension:2,integersOnly:!0});case"minecraft:vec3":return Ut.mock(e,{dimension:3});case"spyglassmc:tag":return or.mock(e,{category:"tag"});case"minecraft:nbt_compound_tag":case"minecraft:nbt_path":case"minecraft:nbt_tag":default:return[]}},QL=(t,e)=>{let r=[];return v.contains(t.id,e.offset,!0)&&r.push(...re.resourceLocation(t.id,e)),t.states&&v.contains(v.translate(t.states,1,-1),e.offset,!0)&&r.push(...eI(t.states,e)),r},eI=(t,e)=>{if(!Lr.is(t.parent))return[];let r=t.parent.id,n=U.toString(r,"full"),i=r.isTag?Ro("tag/block",n,e):[n],o=Ga("block",i,e);return re.record({key:(s,a,l,c,f,u,h)=>Object.keys(o).filter(d=>a?.key?.value===d||!h.some(p=>p.value===d)).map(d=>pe.create(d,c,{kind:10,detail:y("mcfunction.completer.block.states.default-value",P(o[d][0])),insertText:new al().literal(d).if(f,p=>p.literal("=").placeholder(...o[d])).if(u,p=>p.literal(",")).build()})),value:(s,a,l)=>a.key&&o[a.key.value]?o[a.key.value].map(c=>pe.create(c,a.value??l.offset,{kind:12})):[]})(t,e)},tI=(t,e)=>[pe.create("~",t)],rI=(t,e)=>{let r=[];return v.contains(t.id,e.offset,!0)&&r.push(...re.resourceLocation(t.id,e)),r},nI=(t,e)=>{let r=Ai.SimpleValues.map(n=>pe.create(n,t));return(!t.children?.[0]||v.contains(t.children[0],e.offset,!0))&&r.push(...re.resourceLocation(t.children?.[0]??U.mock(t,{category:"stat_type",namespacePathSep:"."}),e)),t.children?.[1]&&v.contains(t.children[1],e.offset,!0)&&r.push(...re.resourceLocation(t.children[1],e)),r},iI=(t,e)=>{let r=Ke.findChild(t,e.offset,!0);if(r)return re.dispatch(r,e);let n=U.toString(t.id,"short"),i={block:[Lr.mock(e.offset,!1)],block_marker:[Lr.mock(e.offset,!1)],dust:[Ut.mock(e.offset,{dimension:3}),Sr.mock(e.offset)],dust_color_transition:[Ut.mock(e.offset,{dimension:3}),Sr.mock(e.offset),Ut.mock(e.offset,{dimension:3})],falling_dust:[Lr.mock(e.offset,!1)],item:[Ci.mock(e.offset,!1)],sculk_charge:[Sr.mock(e.offset)],shriek:[Ki.mock(e.offset)],vibration:[Ut.mock(e.offset,{dimension:3}),Ut.mock(e.offset,{dimension:3}),Ki.mock(e.offset)]};if(Mo.isSpecialType(n)){let o=t.children?.slice(1).filter(a=>a.range.end<e.offset).length??0,s=i[n][o];if(s)return re.dispatch(s,e)}return[]},oI=(t,e)=>{let r;return t.selector&&v.contains(t.selector,e.offset,!0)?(r=$y(t.selector,e),v.contains(t.children[0],e.offset,!0)&&r.push(...re.symbol(or.mock(t,{category:"score_holder"}),e))):(r=re.symbol(t.fakeName??or.mock(t,{category:"score_holder"}),e),r.push(...$y(Ir.mock(t),e))),r},$y=(t,e)=>v.contains(t.children[0],e.offset,!0)?re.literal(t.children[0],e):t.arguments&&v.contains(v.translate(t.arguments,1,-1),e.offset,!0)?rC(t.arguments,e):[],rC=(t,e)=>{let r=t.parent;return Ir.is(r)?re.record({key:(n,i,o,s,a,l)=>[...Ir.ArgumentKeys].filter(c=>Ir.canKeyExist(r,n,c)===0).map(c=>pe.create(c,s,{kind:10,insertText:new al().literal(c).if(a,f=>f.literal("=").placeholder()).if(l,f=>f.literal(",")).build()})),value:(n,i,o)=>i.value?re.dispatch(i.value,o):[]})(t,e):[]},sI=(t,e)=>[pe.create("-2147483648..2147483647",t,{kind:21})],aI=(t,e)=>{let r=(i,o)=>pe.create(new Array(t.options.dimension).fill(i).join(" "),t,{sortText:o}),n=[];return n.push(r("~","a")),t.options.noLocal||n.push(r("^","b")),n.push(r("0.0","c")),n};function nC(t){t.registerCompleter("mcfunction:block",QL),t.registerCompleter("mcfunction:coordinate",tI),t.registerCompleter("mcfunction:entity_selector",$y),t.registerCompleter("mcfunction:entity_selector/arguments",rC),t.registerCompleter("mcfunction:int_range",sI),t.registerCompleter("mcfunction:item",rI),t.registerCompleter("mcfunction:objective_criteria",nI),t.registerCompleter("mcfunction:particle",iI),t.registerCompleter("mcfunction:score_holder",oI),t.registerCompleter("mcfunction:vector",aI)}var oC=(t,e)=>{if(t.children[0]?.type!=="mcfunction:entry")return[];let r=[];return Ct(t,n=>!0,Oh.is,n=>{let i=n,o=e.config.env.feature.inlayHint;(o===!0||typeof o=="object"&&o.enabledNodes.includes(i.children[0].type))&&r.push({offset:i.range.start,text:`${i.path[i.path.length-1]}:`})}),r};var aC=/^-?\d+$/,lC=/^-?(?:\d+\.?\d*|\.\d+)$/,cC=Number.MAX_VALUE,lI=-cC,fC=(2-2**-23)*2**127,cI=-fC,fI=2**31-1,uI=-(2**31),uC=9223372036854775807n,hI=-9223372036854775808n,dI=40,pI=16,mI=16;function gI(t){let e=t.project.loadedVersion;return!e||Vt.cmp(e,"1.18")<0}var Fy=t=>{let e=t,r=n=>oe(Tn(n,"\r",`
`));switch(e.parser){case"brigadier:bool":return r(ju);case"brigadier:double":return r(Jh(e.properties?.min,e.properties?.max));case"brigadier:float":return r(aa(e.properties?.min,e.properties?.max));case"brigadier:integer":return r(la(e.properties?.min,e.properties?.max));case"brigadier:long":return r(yI(e.properties?.min,e.properties?.max));case"brigadier:string":switch(e.properties.type){case"word":return r(bC);case"phrase":return r(ho);case"greedy":default:return r(dC)}case"minecraft:angle":return r(Is(zy(),n=>n.notation!=="^",y("mcfunction.parser.vector.local-disallowed")));case"minecraft:block_pos":return r(oa({dimension:3,integersOnly:!0}));case"minecraft:block_predicate":return r(Vy);case"minecraft:block_state":return r(Zh);case"minecraft:color":return r(J(De(...Uh),n=>({...n,color:ht.NamedColors.has(n.value)?ht.fromCompositeInt(ht.NamedColors.get(n.value)):void 0})));case"minecraft:column_pos":return r(oa({dimension:2,integersOnly:!0}));case"minecraft:component":return r(Uy);case"minecraft:dimension":return r(Oe({category:"dimension"}));case"minecraft:entity":return r(sC(e.properties.amount,e.properties.type));case"minecraft:entity_anchor":return r(De(...Hh));case"minecraft:entity_summon":return r(Oe({category:"entity_type"}));case"minecraft:float_range":return r(sa("float"));case"minecraft:function":return r(Oe({category:"function",allowTag:!0}));case"minecraft:game_profile":return r(sC("multiple","players"));case"minecraft:int_range":return r(sa("integer"));case"minecraft:item_enchantment":return r(Oe({category:"enchantment"}));case"minecraft:item_predicate":return r(bI);case"minecraft:item_slot":return r(De(...Wh));case"minecraft:item_stack":return r(mC);case"minecraft:message":return r(kI);case"minecraft:mob_effect":return r(Oe({category:"mob_effect"}));case"minecraft:nbt_compound_tag":return r(ln.compound);case"minecraft:nbt_path":return r(ln.path);case"minecraft:nbt_tag":return r(ln.entry);case"minecraft:objective":return r(yC(el.is(e.properties?.usageType)?e.properties?.usageType:void 0));case"minecraft:objective_criteria":return r(SI);case"minecraft:operation":return r(De({pool:qh,colorTokenType:"operator"}));case"minecraft:particle":return r(Hy);case"minecraft:resource":case"minecraft:resource_or_tag":return r(Oe({category:q.shorten(e.properties.registry),allowTag:e.parser==="minecraft:resource_or_tag"}));case"minecraft:resource_location":return r(Oe(e.properties??{pool:[],allowUnknown:!0}));case"minecraft:rotation":return r(oa({dimension:2,noLocal:!0}));case"minecraft:score_holder":return r(xI(e.properties.amount));case"minecraft:scoreboard_slot":return r(De(...Kh));case"minecraft:swizzle":return r(De(...Gh));case"minecraft:team":return r(Xh(el.is(e.properties?.usageType)?e.properties?.usageType:void 0));case"minecraft:time":return r(_I);case"minecraft:uuid":return r(kC);case"minecraft:vec2":return r(oa({dimension:2,noLocal:!0}));case"minecraft:vec3":return r(oa({dimension:3}));case"spyglassmc:tag":return r(Yh());default:return}};function hC(t){return J(be([Oe({category:"block",allowTag:t}),ke(J(oe(Tr({start:"[",pair:{key:dt({...ui,colorTokenType:"property"}),sep:"=",value:ho,end:",",trailingEnd:!0},end:"]"})),e=>({...e,type:"mcfunction:block/states"}))),ke(oe(ln.compound))]),e=>({type:"mcfunction:block",range:e.range,children:e.children,id:e.children.find(U.is),states:e.children.find(Ih.is),nbt:e.children.find(Nr.is)}))}var Zh=hC(!1),Vy=hC(!0),Uy=mc.json();function Jh(t=lI,e=cC){return en({pattern:lC,min:t,max:e})}function aa(t=cI,e=fC){return en({pattern:lC,min:t,max:e})}function la(t=uI,e=fI){return Ar({pattern:aC,min:t,max:e})}function yI(t,e){return Rl({pattern:aC,min:BigInt(t??hI),max:BigInt(e??uC)})}function zy(t=!1){return(e,r)=>{let n={type:"mcfunction:coordinate",notation:"",range:v.create(e),value:0};if(e.trySkip("^")?n.notation="^":e.trySkip("~")&&(n.notation="~"),e.canReadInLine()&&e.peek()!==" "||n.notation===""){let i=(t&&n.notation===""?la:Jh)()(e,r);n.value=Number(i.value)}return n.range.end=e.cursor,n}}function sC(t,e){return J(ne([{predicate:r=>na.is(r.peek(2)),parser:Wy()},{parser:ar([Ky(ho,mI,"mcfunction.parser.entity-selector.player-name.too-long"),kC])}]),(r,n,i)=>{let o={type:"mcfunction:entity",range:r.range,children:[r]};return et.is(r)?o.playerName=r:Ir.is(r)?o.selector=r:o.uuid=r,t==="single"&&o.selector&&!o.selector.single&&i.err.report(y("mcfunction.parser.entity-selector.multiple-disallowed"),o),e==="players"&&(o.uuid||o.selector&&!o.selector.playersOnly&&!o.selector.currentEntity)&&i.err.report(y("mcfunction.parser.entity-selector.entities-disallowed"),o),o})}var dC=dt({unquotable:{blockList:new Set([`
`,"\r"])}});function pC(t){return J(be([Oe({category:"item",allowTag:t}),ke(oe(ln.compound))]),e=>({type:"mcfunction:item",range:e.range,children:e.children,id:e.children.find(U.is),nbt:e.children.find(Nr.is)}))}var mC=pC(!1),bI=pC(!0),kI=(t,e)=>{let r={type:"mcfunction:message",range:v.create(t),children:[]};for(;t.canReadInLine();)na.is(t.peek(2))?r.children.push(Wy()(t,e)):r.children.push(Tn(dC,...Ac)(t,e));return r},Hy=(()=>{let t=J(_c,()=>[]),e=oa({dimension:3}),r=J(e,i=>({...i,color:i.children.length===3?{value:ht.fromDecRGB(i.children[0].value,i.children[1].value,i.children[2].value),format:[Bt.DecRGB]}:void 0})),n={block:Zh,block_marker:Zh,dust:be([r,aa()],t),dust_color_transition:be([r,aa(),r],t),falling_dust:Zh,item:mC,sculk_charge:aa(),shriek:la(),vibration:be([e,la()],t)};return J(be([Oe({category:"particle_type"}),{get:i=>n[U.toString(i.children[0],"short")]}],t),i=>({type:"mcfunction:particle",range:i.range,children:i.children,id:i.children.find(U.is)}))})();function sa(t,e,r,n){let i=t==="float"?aa(e,r):la(e,r),o=oe(Tn(i,"..")),s=oe(De({pool:[".."],colorTokenType:"keyword"})),a=oe(i);return J(ar([be([o]),be([o,s]),be([s,a]),be([o,s,a])]),(l,c,f)=>{let u=t==="float"?l.children.filter(Sr.is):l.children.filter(Ki.is),h=l.children.find(Ue.is),d={type:t==="float"?"mcfunction:float_range":"mcfunction:int_range",range:l.range,children:l.children,value:h?u.length===2?[u[0].value,u[1].value]:v.endsBefore(u[0].range,h.range.start)?[u[0].value,void 0]:[void 0,u[0].value]:[u[0].value,u[0].value]};return!n&&d.value[0]!==void 0&&d.value[1]!==void 0&&d.value[0]>d.value[1]&&f.err.report(y("mcfunction.parser.range.min>max",d.value[0],d.value[1]),l),d})}function Wy(){let t,e,r,n,i,o,s;return J(be([oe(De({pool:Ac,colorTokenType:"keyword"})),{get:a=>{let l=Ue.is(a.children?.[0])?a.children[0].value:void 0;e=l?l==="@s":void 0,n=l?l==="@p"||l==="@a"||l==="@r":void 0,i=l==="@e"?["Entity::isAlive"]:void 0,o=l?l==="@p"||l==="@r"||l==="@s":void 0,s=n;function c(f){return J(be([ke(oe(De({pool:["!"],colorTokenType:"keyword"}))),u=>{u.skipSpace()},f]),u=>({type:"mcfunction:entity_selector/arguments/value/invertable",range:u.range,children:u.children,inverted:!!u.children.find(d=>Ue.is(d)&&d.value==="!"),value:u.children.find(d=>!Ue.is(d)||d.value!=="!")}))}return ke(J(oe(Tr({start:"[",pair:{key:dt({...ui,value:{parser:De({pool:[...Ir.ArgumentKeys],colorTokenType:"property"}),type:"literal"}}),sep:"=",value:{get:(f,u)=>{let h=p=>!!f.children.find(b=>b.key?.value===p),d=p=>!!f.children.find(b=>b.key?.value===p&&!b.value?.inverted);switch(u?.value){case"advancements":return J(Tr({start:"{",pair:{key:Oe({category:"advancement"}),sep:"=",value:ne([{predicate:p=>p.peek()==="{",parser:J(Tr({start:"{",pair:{key:bC,sep:"=",value:ju,end:",",trailingEnd:!0},end:"}"}),p=>({...p,type:"mcfunction:entity_selector/arguments/advancements/criteria"}))},{parser:ju}]),end:",",trailingEnd:!0},end:"}"}),(p,b,m)=>(h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),{...p,type:"mcfunction:entity_selector/arguments/advancements"}));case"distance":return J(sa("float",0),(p,b,m)=>(r=!0,t??=!n&&p.value[1]!==void 0,h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"gamemode":return J(c(dt({unquotable:Ml,value:{type:"literal",parser:De("adventure","creative","spectator","survival")}})),(p,b,m)=>(n=!0,(p.inverted?d(u.value):h(u.value))&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"limit":return J(la(0),(p,b,m)=>(o=p.value<=1,h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),e&&m.err.report(y("mcfunction.parser.entity-selector.arguments.not-applicable",P(u.value)),u),p));case"level":return J(sa("integer",0),(p,b,m)=>(n=!0,h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"name":return J(c(ho),(p,b,m)=>((p.inverted?d(u.value):h(u.value))&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"nbt":return c(ln.compound);case"predicate":return c(Oe({category:"predicate"}));case"scores":return J(Tr({start:"{",pair:{key:yC("reference",["[","=",",","]","{","}"]),sep:"=",value:sa("integer"),end:",",trailingEnd:!0},end:"}"}),(p,b,m)=>(h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),{...p,type:"mcfunction:entity_selector/arguments/scores"}));case"sort":return J(dt({unquotable:Ml,value:{type:"literal",parser:De("arbitrary","furthest","nearest","random")}}),(p,b,m)=>(h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),e&&m.err.report(y("mcfunction.parser.entity-selector.arguments.not-applicable",P(u.value)),u),p));case"tag":return c(Yh(["[","=",",","]","{","}"]));case"team":return J(c(Xh("reference",["[","=",",","]","{","}"])),(p,b,m)=>((p.inverted?d(u.value):h(u.value))&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"type":return J(c(Oe({category:"entity_type",allowTag:!0})),(p,b,m)=>(s?h(u.value)?m.err.report(y("duplicate-key",P(u.value)),u):m.err.report(y("mcfunction.parser.entity-selector.arguments.not-applicable",P(u.value)),u):!p.inverted&&!p.value.isTag&&(s=!0,U.toString(p.value,"short")==="player"&&(n=!0)),p));case"x":case"y":case"z":return J(Jh(),(p,b,m)=>(r=!0,h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"dx":case"dy":case"dz":return J(Jh(),(p,b,m)=>(r=!0,t=!n,h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),p));case"x_rotation":case"y_rotation":return J(sa("float",void 0,void 0,!0),(p,b,m)=>(h(u.value)&&m.err.report(y("duplicate-key",P(u.value)),u),p));case void 0:return()=>V;default:return(p,b)=>(b.err.report(y("mcfunction.parser.entity-selector.arguments.unknown",P(u.value)),u),V)}}},end:",",trailingEnd:!0},end:"]"})),f=>({...f,type:"mcfunction:entity_selector/arguments"})))}}]),a=>{let l={type:"mcfunction:entity_selector",range:a.range,children:a.children,variable:a.children.find(Ue.is).value.slice(1),arguments:a.children.find(jh.is),chunkLimited:t,currentEntity:e,dimensionLimited:r,playersOnly:n,predicates:i,single:o,typeLimited:s};return l.hover=vI(l),l})}function vI(t){let e=new Map([[0,"\u{1F922}"],[1,"\u{1F605}"],[2,"Good"],[3,"Great"],[4,"\u{1F60C}\u{1F44C}"]]),r;if(t.currentEntity)r=`**Performance**: ${e.get(4)}  
- \`currentEntity\`: \`${t.currentEntity}\``;else{let n=[t.chunkLimited,t.dimensionLimited,t.playersOnly,t.typeLimited].filter(i=>i).length;r=`**Performance**: ${e.get(n)}  
- \`chunkLimited\`: \`${!!t.chunkLimited}\`
- \`dimensionLimited\`: \`${!!t.dimensionLimited}\`
- \`playersOnly\`: \`${!!t.playersOnly}\`
- \`typeLimited\`: \`${!!t.chunkLimited}\``}return t.predicates?.length&&(r+=`

------
**Predicates**: 
${t.predicates.map(n=>`- \`${n}\``).join(`
`)}`),r}var wI=Ky(gC("score_holder"),dI,"mcfunction.parser.score_holder.fake-name.too-long");function xI(t){return J(ne([{predicate:e=>na.is(e.peek(2)),parser:Wy()},{parser:wI}]),(e,r,n)=>{let i={type:"mcfunction:score_holder",range:e.range,children:[e]};return or.is(e)?i.fakeName=e:i.selector=e,t==="single"&&i.selector&&!i.selector.single&&n.err.report(y("mcfunction.parser.entity-selector.multiple-disallowed"),i),i})}function gC(t,e=[]){return Tn(Bs(t),Iw,e)}function yC(t,e=[]){return Ky(qy({category:"objective",usageType:t},e),pI,"mcfunction.parser.objective.too-long")}var SI=J(ar([be([Tn(Oe({category:"stat_type",namespacePathSep:"."}),":"),oe(De(":")),{get:t=>{if(U.is(t.children[0])){let e=Ai.ComplexCategories.get(U.toString(t.children[0],"short"));if(e)return Oe({category:e,namespacePathSep:"."})}return Oe({pool:[],allowUnknown:!0,namespacePathSep:"."})}}]),De(...Ai.SimpleValues)]),t=>{let e={type:"mcfunction:objective_criteria",range:t.range};return Ue.is(t)?e.simpleValue=t.value:e.children=t.children.filter(U.is),e});function Yh(t=[]){return qy("tag",t)}function Xh(t,e=[]){return qy({category:"team",usageType:t},e)}function qy(t,e){return AI(gC(t,e))}var _I=J(be([aa(0,void 0),ke(oe(De(...Fh.Units)))]),t=>{let e=t.children.find(Sr.is),r=t.children.find(Ue.is);return{type:"mcfunction:time",range:t.range,children:t.children,value:e.value,unit:r?.value}}),bC=dt({unquotable:Ml}),CI=/^[0-9a-f]+-[0-9a-f]+-[0-9a-f]+-[0-9a-f]+-[0-9a-f]+$/i,kC=(t,e)=>{let r={type:"mcfunction:uuid",range:v.create(t),bits:[0n,0n]},n=t.readUntil(" ","\r",`
`,"\r"),i=!1;if(n.match(CI))try{let o=n.split("-").map(s=>BigInt(`0x${s}`));o.every(s=>s<=uC)&&(i=!0,r.bits[0]=BigInt.asIntN(64,o[0]<<32n|o[1]<<16n|o[2]),r.bits[1]=BigInt.asIntN(64,o[3]<<48n|o[4]))}catch{}return r.range.end=t.cursor,i||e.err.report(y("mcfunction.parser.uuid.invalid"),r),r};function Ky(t,e,r){return(n,i)=>gI(i)?J(t,(o,s,a)=>(o.value.length>e&&a.err.report(y(r,e),o),o))(n,i):t(n,i)}function AI(t){return J(t,(e,r,n)=>(e.value.match(Rx)||n.err.report(y("parser.string.illegal-brigadier",P(e.value)),e),e))}function oa(t){return(e,r)=>{let n={type:"mcfunction:vector",range:v.create(e),children:[],options:t,system:0};e.peek()==="^"&&(n.system=1);for(let i=0;i<t.dimension;i++){i>0&&_c(e,r);let o=(t.integersOnly,zy(t.integersOnly)(e,r));n.children.push(o),n.system===1!=(o.notation==="^")&&r.err.report(y("mcfunction.parser.vector.mixed"),o)}return t.noLocal&&n.system===1&&r.err.report(y("mcfunction.parser.vector.local-disallowed"),n),n.range.end=e.cursor,n}}function wC(t){let e=pr.instance.get(t);return(r,n)=>{if(r.children[0]?.type!=="mcfunction:entry")return;let i=TI(r,n.offset),o=i?i.children:[],s=OI(e,o);if(s.length===0)return;let a=0;for(let c of o)if(n.offset>c.range.end)a+=1;else break;if(a>=s[0].length)return;let l={activeSignature:0,signatures:[]};return l.signatures=s.map(c=>{let f=c[a],u=a+1<c.length?` ${c[a+1]}`:"",h=`${f}${u}`;return{label:h,activeParameter:0,parameters:[{label:[0,f.length]},{label:[f.length,h.length]}]}}),l}}function TI(t,e){return Ke.findChild(t.children[0],e,!0)}function OI(t,e){let r=[],n=t;for(let i of e){let o=i.path[i.path.length-1];if(!o||(n=Eo(n,t).treeNode?.children?.[o],!n))break;r.push(Py(o,n))}return n&&(n=Eo(n,t).treeNode,n?.children)?Ny(n.children,n.executable).map(i=>[...r,i]):r.length?[r]:[]}function AC(t){return{children:{advancement:{children:{grant:xC,revoke:xC}},...Vt.cmp(t,"1.16")>=0?{attribute:{children:{target:{children:{attribute:{properties:{category:"attribute"},children:{modifier:{children:{add:{children:{uuid:{properties:{category:"attribute_modifier_uuid",usageType:"definition"}}}},remove:{children:{uuid:{properties:{category:"attribute_modifier_uuid"}}}},value:{children:{get:{children:{uuid:{properties:{category:"attribute_modifier_uuid"}}}}}}}}}}}}}}}:{},ban:{permission:3},"ban-ip":{permission:3},banlist:{permission:3},bossbar:{children:{add:{children:{id:{properties:{category:"bossbar",usageType:"definition"}}}},get:{children:{id:{properties:{category:"bossbar"}}}},remove:{children:{id:{properties:{category:"bossbar"}}}},set:{children:{id:{properties:{category:"bossbar",accessType:1}}}}}},data:{children:{get:Qh,merge:TC,modify:{children:{block:{children:{targetPos:{children:{targetPath:Gy}}}},entity:{children:{target:{children:{targetPath:Gy}}}},storage:{children:{target:{properties:{category:"storage",accessType:1},children:{targetPath:Gy}}}}}},remove:Qh}},debug:{permission:3},deop:{permission:3},execute:{children:{if:SC,store:{children:{result:_C,success:_C}},unless:SC}},...Vt.cmp(t,"1.17")>=0?{item:{children:{replace:{children:{block:{children:{pos:{children:{slot:{children:{from:{children:{block:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}},entity:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}}}}}}}}}},entity:{children:{targets:{children:{slot:{children:{from:{children:{block:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}},entity:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}}}}}}}}}}}},modify:{children:{block:{children:{pos:{children:{slot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}},entity:{children:{targets:{children:{slot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}}}}}}}:{},help:{permission:0},kick:{permission:3},list:{permission:0},...Vt.cmp(t,"1.16")>=0?{locatebiome:{children:{biome:{properties:{category:"worldgen/biome"}}}}}:{},loot:{children:{give:{children:{players:Do}},insert:{children:{targetPos:Do}},replace:{children:{block:{children:{targetPos:{children:{slot:{children:{...Do.children,count:Do}}}}}},entity:{children:{entities:{children:{slot:{children:{...Do.children,count:Do}}}}}}}},spawn:{children:{targetPos:Do}}}},me:{permission:0},msg:{permission:0},op:{permission:3},pardon:{permission:3},"pardon-ip":{permission:3},playsound:mr,publish:{permission:4},recipe:{children:{give:CC,take:CC}},"save-all":{permission:4},"save-off":{permission:4},"save-on":{permission:4},scoreboard:{children:{objectives:{children:{add:{children:{objective:{parser:"minecraft:objective",properties:{usageType:"definition"}}}}}},players:{children:{add:Oc,operation:Oc,remove:Oc,reset:Oc,set:Oc}}}},setidletimeout:{permission:3},stop:{permission:4},stopsound:{children:{targets:{children:{"*":mr,ambient:mr,block:mr,hostile:mr,master:mr,music:mr,neutral:mr,player:mr,record:mr,voice:mr,weather:mr}}}},tag:{children:{targets:{children:{add:{children:{name:{parser:"spyglassmc:tag"}}},remove:{children:{name:{parser:"spyglassmc:tag"}}}}}}},team:{children:{add:{children:{team:{parser:"minecraft:team",properties:{usageType:"definition"}}}}}},teammsg:{permission:0},teleport:{children:{destination:void 0,targets:{executable:!0}}},tell:{permission:0},tm:{permission:0},trigger:{permission:0,children:{objective:{properties:{category:"objective",accessType:1}}}},w:{permission:0},whitelist:{permission:3}}}}var xC=Object.freeze({children:{targets:{children:{from:{children:{advancement:{properties:{category:"advancement"}}}},only:{children:{advancement:{properties:{category:"advancement"}}}},through:{children:{advancement:{properties:{category:"advancement"}}}},until:{children:{advancement:{properties:{category:"advancement"}}}}}}}}),Qh=Object.freeze({children:{storage:{children:{source:{properties:{category:"storage"}}}}}}),TC=Object.freeze({children:{storage:{children:{target:{properties:{category:"storage",accessType:1}}}}}}),Tc=Object.freeze({children:{from:Qh}}),Gy=Object.freeze({children:{append:Tc,insert:{children:{index:Tc}},merge:Tc,prepend:Tc,set:Tc}}),SC=Object.freeze({children:{data:Qh,predicate:{children:{predicate:{properties:{category:"predicate"}}}}}}),_C=Object.freeze({children:{...TC.children,bossbar:{children:{id:{properties:{category:"bossbar",accessType:1}}}}}}),Do=Object.freeze({children:{fish:{children:{loot_table:{properties:{category:"loot_table"}}}},loot:{children:{loot_table:{properties:{category:"loot_table"}}}}}}),Oc=Object.freeze({children:{targets:{children:{objective:{properties:{accessType:1}}}}}}),CC=Object.freeze({children:{targets:{children:{recipe:{properties:{category:"recipe"}}}}}}),mr=Object.freeze({children:{sound:{properties:{category:"sound_event"}}}});var OC=(t,e,r)=>{let{meta:n}=t;F_(t),pr.instance.register(r,e,AC(r)),n.registerLanguage("mcfunction",{extensions:[".mcfunction"],parser:z_(r,Fy),completer:Dh.entry(r,tC),triggerCharacters:[" ","[","=","!",",","{",":","/",".",'"',"'"]}),n.registerParser("mcfunction:block_predicate",Vy),n.registerParser("mcfunction:component",Uy),n.registerParser("mcfunction:particle",Hy),n.registerParser("mcfunction:tag",Yh()),n.registerParser("mcfunction:team",Xh()),n.registerParser("mcfunction:command",Nh(pr.instance.get(r),Fy)),Y_(n),Q_(n),nC(n),n.registerInlayHintProvider(oC),n.registerSignatureHelpProvider(wC(r))};var RC=async t=>{let{config:e,downloader:r,externals:n,logger:i,meta:o,projectRoot:s}=t;async function a(){let p,b=`${s}pack.mcmeta`;try{let m=await Y.readJson(n,b);bh.assert(m),p=m}catch(m){n.error.isKind(m,"ENOENT")||i.error(`[je.initialize] Failed loading pack.mcmeta \u201C${b}\u201D`,m)}return p}o.registerUriBinder(c_);let l=await o_(t.externals,t.downloader);if(!l){t.logger.error("[je-initialize] Failed loading game version list. Expect everything to be broken.");return}let c=await a(),{release:f,id:u,isLatest:h}=t_(e.env.gameVersion,{packMcmeta:c,versions:l});o.registerDependencyProvider("@vanilla-mcdoc",()=>l_(r));let d=await s_(t.externals,r,i,u,h,e.env.dataSource,e.env.mcmetaSummaryOverrides);if(!d.blocks||!d.commands||!d.fluids||!d.registries){t.logger.error("[je-initialize] Failed loading mcmeta summaries. Expect everything to be broken.");return}return o.registerSymbolRegistrar("mcmeta-summary",{checksum:d.checksum,registrar:n_(d)}),o.registerLinter("nameOfNbtKey",{configValidator:ni.configValidator.nameConvention,linter:ni.nameConvention("value"),nodePredicate:p=>!p.symbol&&p.parent?.parent?.type==="nbt:compound"&&kn.is(p.parent)&&p.type==="string"&&p.parent.key===p||!p.symbol&&p.parent?.type==="nbt:path"&&p.type==="string"||Ng.is(p.parent)&&Pg.is(p)&&!p.symbol?.path[0]?.startsWith("::minecraft")}),D_(t),OC(t,d.commands,f),e_(t),{loadedVersion:f}};var ed=document.getElementById("language"),RI=document.getElementById("editor-container"),Ti=document.getElementById("uri"),MC="execute as @a run say hello world",DC=()=>ed.selectedOptions[0]?.dataset?.language??ed.value,NC=t=>PC.state.sliceDoc(0),Zy=0,fn=new Bu({logger:console,profilers:new si(console,["cache#load","cache#save","project#init","project#ready"]),project:{cacheRoot:"file:///.cache/",defaultConfig:to.merge(Mm,{env:{dependencies:[]}}),externals:wg,initializers:[zS,RC],projectRoot:"file:///root/"}});await fn.project.ready();await fn.project.onDidOpen(Ti.value,DC(),0,MC);var MI=B.updateListener.of(t=>{if(!t.docChanged)return;let e=NC(t.state);fn.project.onDidChange(Ti.value,[{text:e}],++Zy).catch(r=>console.error("[onChange]",r))});async function DI(t){let e=await fn.project.ensureClientManagedChecked(Ti.value);if(!e)return null;let r=fn.complete(e.node,e.doc,t.pos);return r.length?{from:r[0].range.start,to:r[0].range.end,options:r.map(n=>({label:n.label,detail:n.detail,info:n.documentation}))}:null}var NI=ce.define({create(){return $.none},update(t,e){let r=fn.project.getClientManaged(Ti.value);if(!r)return t;let{node:n}=r;t=$.none;for(let i of fs.getErrors(n))t=t.update({add:[PI(i).range(i.range.start,i.range.end===i.range.start?i.range.start+1:i.range.end)]});return t},provide:t=>B.decorations.from(t)}),PI=t=>$.mark({attributes:{"data-diagnostic-message":t.message},class:`spyglassmc-diagnostic spyglassmc-diagnostic-${t.severity}`}),LI=B.baseTheme({".spyglassmc-diagnostic::before":{content:"attr(data-diagnostic-message)",display:"none",position:"absolute",transform:"translateY(-100%)",border:"1px solid black","background-color":"wheat",opacity:"90%","white-space":"break-spaces",overflow:"hidden",height:"fit-content",width:"fit-content","max-height":"4em","max-width":"60em"},".spyglassmc-diagnostic:hover::before":{display:"block"},".spyglassmc-diagnostic-0":{textDecoration:"underline 1.5px darkgray"},".spyglassmc-diagnostic-1":{textDecoration:"underline 1.5px lightblue"},".spyglassmc-diagnostic-2":{textDecoration:"underline 1.5px orange"},".spyglassmc-diagnostic-3":{textDecoration:"underline 1.5px red"}}),II=ce.define({create(){return $.none},update(t,e){let r=fn.project.getClientManaged(Ti.value);if(!r)return t;let{node:n,doc:i}=r,o=fn.colorize(n,i);t=$.none;for(let s of o)s.range.start!==s.range.end&&(t=t.update({add:[BI(s).range(s.range.start,s.range.end)]}));return t},provide:t=>B.decorations.from(t)}),BI=t=>$.mark({class:`spyglassmc-color-token-${t.type} ${t.modifiers?.map(e=>`spyglassmc-color-token-modifier-${e}`).join()??""}`}),jI=B.baseTheme({".spyglassmc-color-token-comment":{color:"#008000"},".spyglassmc-color-token-enum":{color:"#0070C1"},".spyglassmc-color-token-enumMember":{color:"#0070C1"},".spyglassmc-color-token-function":{color:"#795E26"},".spyglassmc-color-token-keyword":{color:"#AF00DB"},".spyglassmc-color-token-modifier":{color:"#001080"},".spyglassmc-color-token-number":{color:"#098658"},".spyglassmc-color-token-operator":{color:"#AF00DB"},".spyglassmc-color-token-property":{color:"#001080"},".spyglassmc-color-token-string":{color:"#A31515"},".spyglassmc-color-token-struct":{color:"#001080"},".spyglassmc-color-token-type":{color:"#267F99"},".spyglassmc-color-token-variable":{color:"#001080"},".spyglassmc-color-token-error":{color:"#FF0000"},".spyglassmc-color-token-literal":{color:"#0000FF"},".spyglassmc-color-token-resourceLocation":{color:"#795E26"},".spyglassmc-color-token-vector":{color:"#098658"}}),$I=B.theme({"&":{maxHeight:"40em"},".cm-gutter,.cm-content":{height:"40em"},".cm-scroller":{overflow:"auto"}}),PC=new B({parent:RI,state:G.create({doc:MC,extensions:[Cw,Ii.of([aw]),Lf({override:[DI]}),MI,NI,LI,II,jI,$I]})});ed.onchange=async()=>{fn.project.onDidClose(Ti.value),Ti.value=`file:///root/foo.${ed.value}`,Zy=0,await fn.project.onDidOpen(Ti.value,DC(),Zy,NC(PC.state))};
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
